extrafont::loadfonts(device="win") 
library(tidyverse)
library(lubridate)
library(readxl)
library(skimr)
library(rlang)
library(haven)
library(fs)
library(officer)
library(devEMF)
library(ggrepel)
library(rvest)
library(scales)
library(testthat)
library(patchwork)
library(vdemdata)
library(naniar)
library(dichromat)
library(RColorBrewer)
library(fmsb)
library(ggcorrplot)
library(bazar)
library(cowplot)
library(ggplotify)
library(elementalist)
library(ggforce)
library(magick)
library(ggpubr)
library(grid)
library(rworldxtra)
library(sf)        
library(lwgeom)    
library(rworldmap)
library(pals)
library(openxlsx)

# setwd
setwd("C:/Users/sdevine/Desktop/usaid/mcp/malign_influence")
options(scipen = 999)


#//////////////////////////////////////////////////////////////////////////////////////////////////////


# create custom color_palette ####
color_palette <- tibble(hex = c("#083D7F", "#2474B6", "#8BBFD0",
                                "#CBCBCB", "#7D7D7D",
                                "#99ba78", "#35B779FF", "#006629", 
                                "#E4DC68", "#FDA159", "#EF6712", "#CE1B1E",
                                "#8B008B", "#DA70D6"))
color_palette
color_palette %>% pull(hex) %>% show_col()

# color_palette supports 11 colors, plus possible extensions via fill/line type
show_col(color_palette %>% slice(1, 3) %>% pull(hex)) # 2 colors
show_col(color_palette %>% slice(1, 2, 3) %>% pull(hex)) # 3 colors
show_col(color_palette %>% slice(1, 2, 3, 4) %>% pull(hex)) # 4 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5) %>% pull(hex)) # 5 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6) %>% pull(hex)) # 6 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7) %>% pull(hex)) # 7 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8) %>% pull(hex)) # 8 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9) %>% pull(hex)) # 9 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) %>% pull(hex)) # 10 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11) %>% pull(hex)) # 11 colors


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read country_crosswalk and get country_crosswalk_expanded ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/usaid/mcp/useful_info/country_crosswalk")
country_crosswalk <- read_csv("country_crosswalk.csv", lazy = FALSE)
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read final fmir data ####
fmir <- read.csv(file = "data/fmir/fmir_20211202.csv") %>% as_tibble()

# inspect
fmir
fmir %>% glimpse()
fmir %>% nrow() # 27434
fmir %>% ncol() # 54


fmir %>% count(obj)
fmir %>% count(obj_num)
fmir %>% count(obj_short_name)
fmir %>% count(sub_obj)
fmir %>% count(sub_obj_num)
fmir %>% count(sub_obj_short_name)
fmir %>% count(concept)
fmir %>% count(indicator_name)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# create get_label_position() for use in facet charts ####
get_label_position <- function(chart_data) {
        
        # get initial label_position
        chart_data <- chart_data %>% arrange(year, values) %>% 
                group_by(year) %>%
                mutate(label_position = round(values, digits = 3),
                       dist_to_lower = round(label_position - lag(label_position, n = 1), digits = 3),
                       dist_to_higher = round(lead(label_position, n = 1) - label_position, digits = 3),
                       overlap_flag = case_when(dist_to_lower < .03 ~ 1,
                                                TRUE ~ 0)) %>%
                ungroup()
        
        # set counter
        counter <- 0
        
        # run loop to update label_position
        while((chart_data %>% mutate(sum_overlap_flag = sum(overlap_flag)) %>% slice(1) %>% pull(sum_overlap_flag)) != 0) {
                
                counter <- counter + 1
                print(counter + 1)
                
                chart_data <- chart_data %>% arrange(year, values) %>% 
                        group_by(year) %>%
                        mutate(label_position = case_when(is.na(dist_to_lower) | 
                                                                  dist_to_lower >= .03 ~ round(label_position, digits = 3),
                                                          TRUE ~ round(label_position + (.03 - dist_to_lower), digits = 3)),
                               dist_to_higher = round(lead(label_position, n = 1) - label_position, digits = 3),
                               dist_to_lower = round(label_position - lag(label_position, n = 1), digits = 3),
                               overlap_flag = case_when(dist_to_lower < .03 ~ 1,
                                                        TRUE ~ 0)) %>%
                        ungroup() %>%
                        arrange(desc(year), values)
        }
        
        # return
        return(chart_data)
}


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_vdem_rule_of_law_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_1_vdem_rule_of_law", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1_vdem_rule_of_law", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1_vdem_rule_of_law", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1_vdem_rule_of_law", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1_vdem_rule_of_law", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_1_vdem_rule_of_law_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_vdem_rule_of_law_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_vdem_rule_of_law_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_1_1_vdem_rule_of_law_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_1_vdem_rule_of_law_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_vdem_rule_of_law_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_vdem_rule_of_law_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_1_vdem_rule_of_law_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_vdem_rule_of_law_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_1_vdem_rule_of_law_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_1_vdem_rule_of_law_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_1_vdem_rule_of_law_balkans_patch_line_chart,
                                           sub_obj_1_1_vdem_rule_of_law_eurasia_patch_line_chart,
                                           sub_obj_1_1_vdem_rule_of_law_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_vdem_rule_of_law_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_1_vdem_rule_of_law_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_vdem_civil_society_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2_vdem_civil_society", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2_vdem_civil_society", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2_vdem_civil_society", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2_vdem_civil_society", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2_vdem_civil_society", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_2_vdem_civil_society", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_vdem_civil_society_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_vdem_civil_society_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_vdem_civil_society_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_1_2_vdem_civil_society", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_1_2_vdem_civil_society_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_2_vdem_civil_society", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_vdem_civil_society_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_vdem_civil_society_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_vdem_civil_society_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_2_vdem_civil_society_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_vdem_civil_society_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_2_vdem_civil_society_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_2_vdem_civil_society_patch_line_chart <- wrap_plots(plot_spacer(),
                                                            sub_obj_1_2_vdem_civil_society_balkans_patch_line_chart,
                                                            sub_obj_1_2_vdem_civil_society_eurasia_patch_line_chart,
                                                            sub_obj_1_2_vdem_civil_society_mcp_grouping_patch_line_chart, 
                                                            plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_vdem_civil_society_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_2_vdem_civil_society_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>% skim(values)
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>% distinct(high_value_is_good_outcome_flag)

# plot
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
                        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>%
        group_by(mcp_grouping, year) %>%
        mutate(values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2, by = .5), limits = c(-2.5, 2.0), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2, by = .5), limits = c(-2.5, 2.0), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_vdem_foreign_gov_dissem_false_info_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_3_vdem_foreign_gov_dissem_false_info_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2, by = .5), limits = c(-2.5, 2.0), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_3_vdem_foreign_gov_dissem_false_info_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_3_vdem_foreign_gov_dissem_false_info_patch_line_chart <- wrap_plots(plot_spacer(),
                                                              sub_obj_1_3_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart,
                                                              sub_obj_1_3_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart,
                                                              sub_obj_1_3_vdem_foreign_gov_dissem_false_info_mcp_grouping_patch_line_chart, 
                                                              plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_vdem_foreign_gov_dissem_false_info_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_3_vdem_foreign_gov_dissem_false_info_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_media_bias_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1_vdem_media_bias", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1_vdem_media_bias", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1_vdem_media_bias", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1_vdem_media_bias", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_1_vdem_media_bias", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_vdem_media_bias_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2.5, by = 1), limits = c(-2.5, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -0.5, yend = -0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0.5, yend = 0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_vdem_media_bias_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_media_bias_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_2_1_vdem_media_bias_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_1_vdem_media_bias", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_vdem_media_bias_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2.5, by = 1), limits = c(-2.5, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -0.5, yend = -0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0.5, yend = 0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_vdem_media_bias_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_media_bias_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_media_bias") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_1_vdem_media_bias_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 2.5, by = 1), limits = c(-2.5, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -0.5, yend = -0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0.5, yend = 0.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_vdem_media_bias_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_1_vdem_media_bias_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_1_vdem_media_bias_patch_line_chart <- wrap_plots(plot_spacer(),
                                                            sub_obj_2_1_vdem_media_bias_balkans_patch_line_chart,
                                                            sub_obj_2_1_vdem_media_bias_eurasia_patch_line_chart,
                                                            sub_obj_2_1_vdem_media_bias_mcp_grouping_patch_line_chart, 
                                                            plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_vdem_media_bias_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_vdem_media_bias_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# sub_obj_2_2_vdem_media_range_of_perspectives_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives",
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives") %>%
        group_by(mcp_grouping, year) %>% mutate(values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2_vdem_media_range_of_perspectives", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2_vdem_media_range_of_perspectives", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2_vdem_media_range_of_perspectives", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2_vdem_media_range_of_perspectives", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_vdem_media_range_of_perspectives_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = -2, to = 2.5, by = 1), limits = c(-2, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2, yend = -2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_vdem_media_range_of_perspectives_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_vdem_media_range_of_perspectives_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_vdem_media_range_of_perspectives_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = -2, to = 2.5, by = 1), limits = c(-2, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2, yend = -2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_vdem_media_range_of_perspectives_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_vdem_media_range_of_perspectives_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_2_vdem_media_range_of_perspectives_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = -2, to = 2.5, by = 1), limits = c(-2, 2.5), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2, ymax = 2.5, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2, yend = -2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_vdem_media_range_of_perspectives_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_2_vdem_media_range_of_perspectives_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_2_vdem_media_range_of_perspectives_patch_line_chart <- wrap_plots(plot_spacer(),
                                                           sub_obj_2_2_vdem_media_range_of_perspectives_balkans_patch_line_chart,
                                                           sub_obj_2_2_vdem_media_range_of_perspectives_eurasia_patch_line_chart,
                                                           sub_obj_2_2_vdem_media_range_of_perspectives_mcp_grouping_patch_line_chart, 
                                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_vdem_media_range_of_perspectives_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_2_vdem_media_range_of_perspectives_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# sub_obj_2_3_vdem_gov_censor_of_media_effort_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort",
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort") %>%
        group_by(mcp_grouping, year) %>% mutate(values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3_vdem_gov_censor_of_media_effort", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3_vdem_gov_censor_of_media_effort", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3_vdem_gov_censor_of_media_effort", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3_vdem_gov_censor_of_media_effort", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort", mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_vdem_gov_censor_of_media_effort_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 3, by = 1), limits = c(-2.5, 3), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 3, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2.5, yend = -2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_vdem_gov_censor_of_media_effort_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_vdem_gov_censor_of_media_effort_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_vdem_gov_censor_of_media_effort_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 3, by = 1), limits = c(-2.5, 3), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 3, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2.5, yend = -2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_vdem_gov_censor_of_media_effort_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_vdem_gov_censor_of_media_effort_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_3_vdem_gov_censor_of_media_effort_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = -2.5, to = 3, by = 1), limits = c(-2.5, 3), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -2.5, ymax = 3, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -2.5, yend = -2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -1.5, yend = -1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = -.5, yend = -.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2.5, yend = 2.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -2.5, yend = -2.5), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_vdem_gov_censor_of_media_effort_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_3_vdem_gov_censor_of_media_effort_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_3_vdem_gov_censor_of_media_effort_patch_line_chart <- wrap_plots(plot_spacer(),
                                                                            sub_obj_2_3_vdem_gov_censor_of_media_effort_balkans_patch_line_chart,
                                                                            sub_obj_2_3_vdem_gov_censor_of_media_effort_eurasia_patch_line_chart,
                                                                            sub_obj_2_3_vdem_gov_censor_of_media_effort_mcp_grouping_patch_line_chart, 
                                                                            plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_vdem_gov_censor_of_media_effort_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_3_vdem_gov_censor_of_media_effort_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", mcp_grouping == "Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", mcp_grouping == "E&E Balkans",
               year <= 2018) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2018, by = 4)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", mcp_grouping == "E&E Eurasia",
               year <= 2018) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2018, by = 4)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes",
                              year <= 2018) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2018, by = 4)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_patch_line_chart <- wrap_plots(plot_spacer(),
                                                              sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_balkans_patch_line_chart,
                                                              sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_eurasia_patch_line_chart,
                                                              sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_mcp_grouping_patch_line_chart, 
                                                              plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", mcp_grouping == "E&E Balkans") %>%
        select(country, year, values)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", mcp_grouping == "E&E Balkans",
               year >= 2009) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = percent_format(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2009, to = 2019, by = 2)) +
        labs(x = NULL, y = "Share", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi", mcp_grouping == "E&E Eurasia",
               year >= 2009) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = percent_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 2)) +
        labs(x = NULL, y = "Share", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi",
                              year >= 2009) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7), expand = c(0, 0),
                           labels = percent_format(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 2)) +
        labs(x = NULL, y = "Share", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_patch_line_chart <- wrap_plots(plot_spacer(),
                                                            sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_balkans_patch_line_chart,
                                                            sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_eurasia_patch_line_chart,
                                                            sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_mcp_grouping_patch_line_chart, 
                                                            plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", mcp_grouping == "E&E Balkans",
               year <= 2019) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = .5, by = .1), limits = c(0, .5), expand = c(0, 0),
                           labels = percent_format(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Share", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp", mcp_grouping == "E&E Eurasia",
               year <= 2019) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = .5, by = .1), limits = c(0, .5), expand = c(0, 0),
                           labels = percent_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Share", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp",
                              year <= 2019) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = .5, by = .1), limits = c(0, .5), expand = c(0, 0),
                           labels = percent_format(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Share", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_patch_line_chart <- wrap_plots(plot_spacer(),
                                                                                  sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_balkans_patch_line_chart,
                                                                                  sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_eurasia_patch_line_chart,
                                                                                  sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_mcp_grouping_patch_line_chart, 
                                                                                  plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_dots_imports_from_russia_as_share_of_gdp_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_unctad_export_product_concentration_index_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index") %>%
        group_by(year) %>% skim(values)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index",
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index") %>%
        group_by(mcp_grouping, year) %>% mutate(values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_unctad_export_product_concentration_index", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_unctad_export_product_concentration_index", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_unctad_export_product_concentration_index", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1_unctad_export_product_concentration_index", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index", mcp_grouping == "E&E Balkans",
               year <= 2019) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_unctad_export_product_concentration_index_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_unctad_export_product_concentration_index_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_unctad_export_product_concentration_index_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index", mcp_grouping == "E&E Eurasia",
               year <= 2019) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_unctad_export_product_concentration_index_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Share", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_unctad_export_product_concentration_index_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_unctad_export_product_concentration_index_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_4_1_unctad_export_product_concentration_index",
                              year <= 2019) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_1_unctad_export_product_concentration_index_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_unctad_export_product_concentration_index_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_1_unctad_export_product_concentration_index_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_1_unctad_export_product_concentration_index_patch_line_chart <- wrap_plots(plot_spacer(),
                                                                                    sub_obj_4_1_unctad_export_product_concentration_index_balkans_patch_line_chart,
                                                                                    sub_obj_4_1_unctad_export_product_concentration_index_eurasia_patch_line_chart,
                                                                                    sub_obj_4_1_unctad_export_product_concentration_index_mcp_grouping_patch_line_chart, 
                                                                                    plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_unctad_export_product_concentration_index_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_unctad_export_product_concentration_index_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_bti_banking_system_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system",
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system") %>%
        group_by(mcp_grouping, year) %>% mutate(values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2_bti_banking_system", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2_bti_banking_system", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2_bti_banking_system", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2_bti_banking_system", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_2_bti_banking_system", mcp_grouping == "E&E Balkans",
               year >= 2006) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_bti_banking_system_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = jitter(values, factor = 1), 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 2, to = 10, by = 2), limits = c(2, 10), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2006, to = 2019, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 2, ymax = 10, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 4, yend = 4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 6, yend = 6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 8, yend = 8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 2, yend = 2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_bti_banking_system_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_bti_banking_system_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", indicator_name == "sub_obj_4_2_bti_banking_system_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia",  
                indicator_name == "sub_obj_4_2_bti_banking_system_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_4_2_bti_banking_system", mcp_grouping == "E&E Eurasia",
               year >= 2006) %>%
        mutate(values = case_when(country == "Belarus" ~ values,
                                  TRUE ~ jitter(values, factor = 1))) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_bti_banking_system_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 2, to = 10, by = 2), limits = c(1.95, 10), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2006, to = 2019, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 2, ymax = 10, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 4, yend = 4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 6, yend = 6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 8, yend = 8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 2, yend = 2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_bti_banking_system_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_bti_banking_system_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system") %>%
        group_by(mcp_grouping, year) %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system") %>%
        distinct(mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(indicator_name == "sub_obj_4_2_bti_banking_system",
                              year >= 2006) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_values = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_values) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_2_bti_banking_system_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = jitter(values, factor = 1), 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 2, to = 10, by = 2), limits = c(2, 10), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2006, to = 2019, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 2, ymax = 10, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 4, yend = 4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 6, yend = 6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 8, yend = 8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 2, yend = 2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_bti_banking_system_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_2_bti_banking_system_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_2_bti_banking_system_patch_line_chart <- wrap_plots(plot_spacer(),
                                                                           sub_obj_4_2_bti_banking_system_balkans_patch_line_chart,
                                                                           sub_obj_4_2_bti_banking_system_eurasia_patch_line_chart,
                                                                           sub_obj_4_2_bti_banking_system_mcp_grouping_patch_line_chart, 
                                                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_bti_banking_system_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_2_bti_banking_system_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_1", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
# spike is the velvet revolution in 2018
# https://en.wikipedia.org/wiki/2018_Armenian_revolution
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_rule_of_law") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_1", 
                indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        select(country, year, sub_obj_num, values, sub_obj_avg)


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_1_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_1_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_1_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_1_balkans_patch_line_chart,
                                           sub_obj_1_1_eurasia_patch_line_chart,
                                           sub_obj_1_1_mcp_grouping_patch_line_chart, 
                             plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_1_1", indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_1_1", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_1_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_1_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_1_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_1_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_2_balkans_patch_line_chart,
                                           sub_obj_1_2_eurasia_patch_line_chart,
                                           sub_obj_1_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_1_2", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_1_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_1_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_2_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect kosovo
# note they score nearly at the bottom for sub_obj_1_3_vdem_foreign_gov_dissem_false_info,
# sub_obj_1_3_vdem_gov_cyber_sec_capacity, sub_obj_1_3_vdem_political_polarization, sub_obj_1_3_vdem_political_violence
fmir %>% filter(sub_obj_num == "sub_obj_1_3", country == "Kosovo", year == 2003) %>% 
        select(country, indicator_name)
fmir %>% filter(sub_obj_num == "sub_obj_1_3", country == "Kosovo", year == 2003) %>% 
        select(country, indicator_name, values, indicator_normalized_values, indicator_q5, indicator_q95, 
               sub_obj_avg, sub_obj_avg, sub_obj_q5, sub_obj_q95) 

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_1_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_1_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_3_balkans_patch_line_chart,
                                           sub_obj_1_3_eurasia_patch_line_chart,
                                           sub_obj_1_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 
# atlas_iea_combined_fossil_imports_from_russia_as_share_of_tes_patch_line_chart


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_1_3", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_1_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_1_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_3_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_1_balkans_patch_line_chart,
                                           sub_obj_2_1_eurasia_patch_line_chart,
                                           sub_obj_2_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_1", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_2_balkans_patch_line_chart,
                                           sub_obj_2_2_eurasia_patch_line_chart,
                                           sub_obj_2_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 
# atlas_iea_combined_fossil_imports_from_russia_as_share_of_tes_patch_line_chart


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_2", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_2_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values - .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_2_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_3_balkans_patch_line_chart,
                                           sub_obj_2_3_eurasia_patch_line_chart,
                                           sub_obj_2_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 
# atlas_iea_combined_fossil_imports_from_russia_as_share_of_tes_patch_line_chart


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_3", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_3_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>% group_by(year) %>% skim(values)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()


fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% skim(values)
fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% 
        skim(indicator_normalized_values)

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect
fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes", year == 2016) %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes", 
                country == "Moldova") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes", 
                country == "Belarus") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes", 
                country == "Armenia") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)


fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values, sub_obj_avg)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values - .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect azerbaijan
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect georgia
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_1", 
                indicator_name == "sub_obj_3_1_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values + .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_3_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values + .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_1_balkans_patch_line_chart,
                                           sub_obj_3_1_eurasia_patch_line_chart,
                                           sub_obj_3_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)

# inspect luxembourg
fmir %>% filter(country == "Luxembourg", sub_obj_num == "sub_obj_3_1") %>%
        select(country, year, indicator_name, values, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2018, sub_obj_num == "sub_obj_3_1", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_1_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>% group_by(year) %>% skim(values)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()


fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% skim(values)
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% 
        skim(indicator_normalized_values)

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", year == 2016) %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", 
                country == "Moldova") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", 
                country == "Belarus") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes", 
                country == "Armenia") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)


fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values, sub_obj_avg)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect azerbaijan
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect georgia
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_2", 
                indicator_name == "sub_obj_3_2_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_3_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
        #           mapping = aes(x = year + .65, y = values, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_2_balkans_patch_line_chart,
                                           sub_obj_3_2_eurasia_patch_line_chart,
                                           sub_obj_3_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
chart_data <- fmir %>% filter(year == 2018, sub_obj_num == "sub_obj_3_2",
                              !is.na(sub_obj_avg)) %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_2_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>% group_by(year) %>% skim(values)
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()


fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% skim(values)
fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>% group_by(country) %>% 
        skim(indicator_normalized_values)

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect
fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes", year == 2016) %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes", 
                country == "Moldova") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes", 
                country == "Belarus") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)

fmir %>% filter(indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes", 
                country == "Armenia") %>% 
        arrange(desc(values)) %>% select(country, year, values, indicator_normalized_values, sub_obj_avg)


fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values, sub_obj_avg)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values - .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect frontier
fmir %>% filter(sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_good_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

fmir %>% filter(sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes",
                sub_obj_bad_frontier_flag == 1) %>%
        distinct(country, year, sub_obj_num, values, sub_obj_avg, 
                 sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect azerbaijan
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Azerbaijan", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

# inspect georgia
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        select(country, year, values, sub_obj_avg, sub_obj_good_frontier_flag, sub_obj_bad_frontier_flag)
fmir %>% filter(country == "Georgia", sub_obj_num == "sub_obj_3_3", 
                indicator_name == "sub_obj_3_3_iea_russian_gas_imports_as_share_of_tes") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values + .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values - .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_3_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_3_balkans_patch_line_chart,
                                           sub_obj_3_3_eurasia_patch_line_chart,
                                           sub_obj_3_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_3_3", year == 2019, is.na(sub_obj_avg)) %>%
        distinct(country, year, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_3_3", !is.na(sub_obj_avg),
                              country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_3_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# sub_obj_4_1_balkans_patch_line_chart ####
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)
fmir %>% 
         filter(sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_4_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_4_1_balkans_patch_line_chart,
                                           sub_obj_4_1_eurasia_patch_line_chart,
                                           sub_obj_4_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_4_1", year == 2019) %>%
        # filter(is.na(sub_obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, sub_obj_avg)
        
# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_4_1", mcp_grouping != "Russia", 
                              !is.na(sub_obj_avg)) %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_4_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_4_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
# note that 2006 sub_obj_avg is manually set to NA because only bti has value for 2006 and
# since bti doesn't cover the EU/US, the E&E coutnries have relatively high normalized scores for bti
# compared to legatum, which does cover EU/US, where E&E countries have relatively lower normalized scores
# after inspecting the charts, there is a spike (up or down) for almost all E&E countries from 2006-2007 when legatum is added
# so to avoid this artifact, 2006 is set to NA
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values,
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect belarus
fmir %>% filter(sub_obj_num == "sub_obj_4_2", country == "Belarus") %>% 
        select(country, year, values, indicator_normalized_values, sub_obj_avg, sub_obj_avg)

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
# note that 2006 sub_obj_avg is manually set to NA because only bti has value for 2006 and
# since bti doesn't cover the EU/US, the E&E coutnries have relatively high normalized scores for bti
# compared to legatum, which does cover EU/US, where E&E countries have relatively lower normalized scores
# after inspecting the charts, there is a spike (up or down) for almost all E&E countries from 2006-2007 when legatum is added
# so to avoid this artifact, 2006 is set to NA
chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(sub_obj_num == "sub_obj_4_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note that 2006 sub_obj_avg is manually set to NA because only bti has value for 2006 and
# since bti doesn't cover the EU/US, the E&E coutnries have relatively high normalized scores for bti
# compared to legatum, which does cover EU/US, where E&E countries have relatively lower normalized scores
# after inspecting the charts, there is a spike (up or down) for almost all E&E countries from 2006-2007 when legatum is added
# so to avoid this artifact, 2006 is set to NA
# note russia is dropped
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_4_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% 
        mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


sub_obj_4_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = jitter(values, factor = 1), 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values + .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_4_2_balkans_patch_line_chart,
                                           sub_obj_4_2_eurasia_patch_line_chart,
                                           sub_obj_4_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_4_2", !is.na(values),
                              country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_4_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 13 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_4_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_2_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_balkans_patch_line_chart ####
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Balkans", 
               year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)
fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                # mcp_grouping == "E&E Balkans"
                mcp_grouping == "E&E Eurasia"
                ) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                # mcp_grouping == "E&E Balkans"
                mcp_grouping == "E&E Eurasia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
cross_cutting_obj_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values + .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
cross_cutting_obj_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
cross_cutting_obj_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
cross_cutting_obj_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "cross_cutting_obj") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                              country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


cross_cutting_obj_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
cross_cutting_obj_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for cross_cutting_obj_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
cross_cutting_obj_patch_line_chart <- wrap_plots(plot_spacer(),
                                           cross_cutting_obj_balkans_patch_line_chart,
                                           cross_cutting_obj_eurasia_patch_line_chart,
                                           cross_cutting_obj_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/cross_cutting_obj_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", year == 2019) %>%
        # filter(is.na(sub_obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "cross_cutting_obj", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                              !is.na(sub_obj_avg), country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
cross_cutting_obj_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
cross_cutting_obj_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/cross_cutting_obj_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# obj_1_to_4_balkans_patch_line_chart ####
fmir %>% distinct(country, year, obj_num, obj_avg, miri_avg) %>% arrange(country, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        mutate(values = miri_avg) %>%
        arrange(country, year) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_to_4_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_to_4_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_to_4_eurasia_patch_line_chart ####
fmir %>% distinct(country, year, obj_num, obj_avg, miri_avg) %>% arrange(country, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Eurasia") %>% 
        mutate(values = miri_avg) %>%
        arrange(country, year) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_to_4_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_to_4_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_to_4_mcp_grouping_patch_line_chart ####

# inspect
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        arrange(mcp_grouping, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        arrange(mcp_grouping, year) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_miri_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% 
        filter(country != "Russia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        mutate(values = avg_miri_avg) %>%
        arrange(mcp_grouping, year) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


obj_1_to_4_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_to_4_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
obj_1_to_4_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_1_to_4_balkans_patch_line_chart,
                                     obj_1_to_4_eurasia_patch_line_chart,
                                     obj_1_to_4_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_to_4_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_1_to_4_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# obj_1_balkans_patch_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values + .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_eurasia_patch_line_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(obj_num == "obj_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


obj_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
obj_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           obj_1_balkans_patch_line_chart,
                                           obj_1_eurasia_patch_line_chart,
                                           obj_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_1", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_1", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_1", indicator_name == "obj_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_1",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_1_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_balkans_patch_line_chart ####
fmir %>% filter(obj_num == "obj_2") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_2", indicator_name == "obj_2_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_eurasia_patch_line_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_2", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values + .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(obj_num == "obj_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


obj_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
obj_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_2_balkans_patch_line_chart,
                                     obj_2_eurasia_patch_line_chart,
                                     obj_2_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_2", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_2", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_2", indicator_name == "obj_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_2",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is bettter)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_2_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_balkans_patch_line_chart ####
fmir %>% filter(obj_num == "obj_3") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_3", indicator_name == "obj_3_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
# note that because rise data only starts in 2010, there are massive spikes from 2009 to 2010 for countries like azerbaijan and
# belarus that have basically sub_obj_avg of 1 for 3.1 and 3.2
# there are also spikes from 2018 to 2019, because IEA stops at 2018;
# to avoid spikes, will truncate series to begin at 2010 and end at 2018, with NA values manually added for 2001-2009 and 2019
chart_data <- fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_eurasia_patch_line_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_3", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
# note that because rise data only starts in 2010, there are massive spikes from 2009 to 2010 for countries like azerbaijan and
# belarus that have basically sub_obj_avg of 1 for 3.1 and 3.2
# to avoid spikes, will truncate series to begin at 2010
chart_data <- fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note that because rise data only starts in 2010, there are massive spikes from 2009 to 2010 for countries like azerbaijan and
# belarus that have basically sub_obj_avg of 1 for 3.1 and 3.2
# to avoid spikes, will truncate series to begin at 2010
# note russia is dropped
chart_data <- fmir %>% filter(obj_num == "obj_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


obj_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values + .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
obj_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_3_balkans_patch_line_chart,
                                     obj_3_eurasia_patch_line_chart,
                                     obj_3_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_3", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_3", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_3", indicator_name == "obj_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2018, obj_num == "obj_3",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_3_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_balkans_patch_line_chart ####
fmir %>% filter(obj_num == "obj_4") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_4", indicator_name == "obj_4_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Albania"),
                  mapping = aes(x = year + .65, y = values - .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "BiH"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Kosovo"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "N. Macedonia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Serbia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Albania", "BiH", "Kosovo",
                                      "N. Macedonia", "Serbia")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Albania", "BiH", "Kosovo",
                                         "N. Macedonia", "Serbia")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_eurasia_patch_line_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_4", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Armenia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Azerbaijan"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Belarus"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Georgia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Moldova"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), country == "Ukraine"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Armenia", "Azerbaijan", "Belarus",
                                      "Georgia", "Moldova", "Ukraine")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Armenia", "Azerbaijan", "Belarus",
                                         "Georgia", "Moldova", "Ukraine")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_4") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_4") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(obj_num == "obj_4", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


obj_4_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Balkans"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Eurasia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Graduates"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "CARs"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "Russia"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "EU-15"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), mcp_grouping == "U.S."),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Balkans", 
                                      "Eurasia", 
                                      "Graduates", 
                                      "CARs",
                                      "Russia",
                                      "EU-15",
                                      "U.S.")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Balkans", 
                                         "Eurasia", 
                                         "Graduates", 
                                         "CARs",
                                         "Russia",
                                         "EU-15",
                                         "U.S.")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E regions",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_4_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
obj_4_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_4_balkans_patch_line_chart,
                                     obj_4_eurasia_patch_line_chart,
                                     obj_4_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_4_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_4", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_4", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_4", indicator_name == "obj_4_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_4",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_4_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_4_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_4_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# indicator_correlation_matrix ####

# note there were issues printing the correclation matrix to emf, with it being auto-cropped etc
# since the matrix is just an internal diagnostic, for simplicity i just took a screenshot when displaying it in R graphic viewer

# note russia is dropped
indicator_correlation_matrix <- fmir %>% 
        # select(country, year, indicator_name, values) %>%
        # pivot_wider(id_cols = -c(indicator_name, values), names_from = "indicator_name", values_from = "values") %>% 
        select(country, year, indicator_name, indicator_normalized_values) %>%
        filter(country != "Russia") %>%
        pivot_wider(id_cols = -c(indicator_name, indicator_normalized_values), names_from = "indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        select(-c(country, year)) %>%
        cor() %>%
        # correlate() %>% 
        # select(-term) %>% skim() %>% select(-numeric.sd)
        # ggcorr(angle = 0, hjust = 1, layout.exp = 50) 
        ggcorrplot(corr = ., method = "square", type = "lower", lab = FALSE, colors = c("red", "white", "blue"))
        # corrplot(method = 'color', order = 'alphabet', type = "lower")
        

indicator_correlation_matrix


#//////////////////////////////////


# had to screengrab it because plot output was crunched

# save chart as emf
# filename <- tempfile(fileext = ".emf")
# emf(file = filename)
# print(indicator_correlation_matrix)
# dev.off()
# 
# # add emf to word doc
# read_docx() %>%
#         body_add_img(src = filename, width = 6, height = 6) %>%
#         print(target = "output/charts/indicator_correlation_matrix.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_correlation_matrix ####

# note russia is dropped
obj_correlation_matrix <- fmir %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        filter(country != "Russia") %>%
        mutate(obj_num = case_when(obj_num == "obj_1" ~ "Obj. 1: Democratic",
                                   obj_num == "obj_2" ~ "Obj. 2: Media",
                                   obj_num == "obj_3" ~ "Obj. 3: Energy",
                                   obj_num == "obj_4" ~ "Obj. 4: Economic",
                                   obj_num == "obj_c" ~ "  Cross-cutting obj.: Corruption")) %>%
        pivot_wider(id_cols = -c(obj_num, obj_avg), names_from = "obj_num", values_from = "obj_avg") %>%
        select(-c(country, year)) %>%
        cor() %>%
        # correlate() %>%
        # select(-term) %>% skim() %>% select(-numeric.sd)
        ggcorrplot(corr = ., method = "square", type = "lower", lab = TRUE, colors = c("red", "white", "blue"),
                   tl.cex = 18, tl.col = "#333333", digits = 2, lab_col = "#333333", lab_size = 6)
        # corrplot(method = 'color', order = 'alphabet', type = "lower", addCoef.col = "#000000")

obj_correlation_matrix


#//////////////////////////////////////


# save chart as emf
# filename <- tempfile(fileext = ".emf")
# emf(file = filename)
# print(obj_correlation_matrix)
# dev.off()
# 
# # add emf to word doc
# read_docx() %>%
#         body_add_img(src = filename, width = 6, height = 6) %>%
#         print(target = "output/charts/obj_correlation_matrix.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_to_4_country_facet_chart ####

obj_1_to_4_country_facet_chart <- fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_short_name, obj_avg) %>%
        bind_rows(., fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
                          mutate(obj_num = "miri", obj_short_name = "MIR Index") %>%
                          rename(obj_avg = miri_avg) %>% select(country, mcp_grouping, year, obj_num, obj_short_name, obj_avg)) %>%
        arrange(country, year) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        mutate(values = obj_avg,
               var = case_when(obj_short_name == "MIR Index" ~ "MIR Index",
                               obj_short_name == "Democratic resilience" ~ "Obj. 1: Democratic resilience",
                               obj_short_name == "Information resilience" ~ "Obj. 2: Media resilience",
                               obj_short_name == "Energy resilience" ~ "Obj. 3: Energy resilience",
                               obj_short_name == "Economic resilience" ~ "Obj. 4: Economic resilience",
                               obj_short_name == "Corruption resilience" ~ "Cross-cutting obj.:\nCorruption resilience")) %>%
        mutate(var = fct_relevel(.f = var, 
                                 "Obj. 1: Democratic resilience",
                                 "Obj. 2: Media resilience",
                                 "Obj. 3: Energy resilience",
                                 "Obj. 4: Economic resilience",
                                 "Cross-cutting obj.:\nCorruption resilience",
                                 "MIR Index")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex), 
                           breaks = c("MIR Index",
                                      "Obj. 1: Democratic resilience",
                                      "Obj. 2: Media resilience",
                                      "Obj. 3: Energy resilience",
                                      "Obj. 4: Economic resilience",
                                      "Cross-cutting obj.:\nCorruption resilience")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1"),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1") %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1") %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

obj_1_to_4_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_to_4_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_to_4_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_country_facet_chart ####
obj_num_var <- "obj_1"
obj_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 1 avg.",
                               var == "Checks and balances and rule of law" ~ "Sub-obj. 1.1: Checks and balances\nand rule of law",
                               var == "Civil society" ~ "Sub-obj. 1.2: Civil society",
                               var == "Resilience to electoral/political interference and polarization" ~
                                       "  Sub-obj. 1.3: Resilience to electoral /\n     political interference and polarization",
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 1 avg.", 
                                 "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                 "Sub-obj. 1.2: Civil society",
                                 "  Sub-obj. 1.3: Resilience to electoral /\n     political interference and polarization")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

obj_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_country_facet_chart ####
obj_num_var <- "obj_2"
obj_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 2 avg.",
                               var == "Media capacity" | var == "Media professionalism" ~ "    Sub-obj 2.1: Media professionalism",
                               var == "Media demand" ~ "Sub-obj 2.2: Media demand",
                               var == "Media freedom" ~ "Sub-obj 2.3: Media freedom",
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 2 avg.",
                                 "    Sub-obj 2.1: Media professionalism")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

obj_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_country_facet_chart ####
obj_num_var <- "obj_3"
obj_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 3 avg.",
                               var == "Energy security" ~ "Sub-obj. 3.1: Energy security",
                               var == "Independence from Russian energy" ~ "   Sub-obj. 3.2: Independence from\nRussian energy",
                               var == "Energy regulation" ~ " Sub-obj. 3.3: Energy regulation",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Objective 3 avg.",
                                 "Sub-obj. 3.1: Energy security",
                                 "   Sub-obj. 3.2: Independence from\nRussian energy",
                                 " Sub-obj. 3.3: Energy regulation")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

obj_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_country_facet_chart ####
obj_num_var <- "obj_4"
obj_4_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 4 avg.",
                               var == "Economic competitiveness" ~ "   Sub-obj. 4.1: Economic competitiveness",
                               var == "Financial health" ~ "Sub-obj 4.2: Financial health", 
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 4 avg.",
                                 "   Sub-obj. 4.1: Economic competitiveness",
                                 "Sub-obj 4.2: Financial health")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

obj_4_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_1"
sub_obj_1_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.1 avg.",
                               var == "fh_judicial_framework_and_indep" ~ "FH: Judicial framework\nand indep.",
                               var == "fh_local_democratic_gov" ~ "FH: Local democratic\ngovernance",
                               var == "fh_national_democratic_gov" ~ "FH: National democratic\ngovernance",
                               var == "vdem_judicial_constraints_on_exec" ~ "VDem: Judicial constraints\non executive",
                               var == "vdem_leg_constraints_on_exec" ~ " VDem: Legislative constraints\non executive",
                               var == "wgi_rule_of_law" ~ "WGI: Rule of law",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "VDem: Judicial constraints\non executive", after = Inf),
               var = fct_relevel(.f = var, " VDem: Legislative constraints\non executive", after = Inf),
               var = fct_relevel(.f = var, "Sub-objective 1.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 1.1 avg.",
                                      "FH: Judicial framework\nand indep.",
                                      "FH: Local democratic\ngovernance",
                                      "FH: National democratic\ngovernance",
                                      "VDem: Judicial constraints\non executive",
                                      " VDem: Legislative constraints\non executive",
                                      "WGI: Rule of law")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_1_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_2"
sub_obj_1_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.2 avg.",
                               var == "fhi_csosi_overall" ~ "FHI 360: Civil society",
                               var == "vdem_civil_society" ~ "VDem: Civil society",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 1.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 1.2 avg.",
                                      "FHI 360: Civil society",
                                      "VDem: Civil society")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_1_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_3"
sub_obj_1_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.3 avg.",
                               var == "fh_electoral_process" ~ "FH: Electoral process",
                               var == "vdem_electoral_democracy" ~ "VDem: Electoral democracy index",
                               var == "vdem_foreign_gov_advertising" ~ "VDem: Foreign govt. advertising",
                               var == "vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign govt. dissem. false info",
                               var == "vdem_gov_cyber_sec_capacity" ~ "VDem: Govt. cyber sec. capacity",
                               var == "vdem_political_party_cyber_sec_capacity" ~ "VDem: Political party cyber sec. capacity",
                               var == "vdem_mobilization_for_autocracy" ~ "VDem: Mobiliation for autocracy",
                               var == "vdem_political_polarization" ~ "VDem: Political polarization",
                               var == "vdem_political_violence" ~ "VDem: Political violence",
                               var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Hostility from Russia",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "VDem: Political party cyber sec. capacity", after = 6),
               var = fct_relevel(.f = var, "Sub-objective 1.3 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 1.3 avg.",
                                      "FH: Electoral process",
                                      "VDem: Electoral democracy index",
                                      "VDem: Political polarization",
                                      "VDem: Political violence",
                                      "VDem: Mobiliation for autocracy",
                                      "VDem: Govt. cyber sec. capacity",
                                      "VDem: Political party cyber sec. capacity",
                                      "VDem: Foreign govt. dissem. false info",
                                      "VDem: Foreign govt. advertising",
                                      "ICEWS: Hostility from Russia")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_1_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_1"
sub_obj_2_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.1 avg.",
                               var == "msi_professional_journalism" ~ "IREX: Professional journalism",
                               var == "vdem_media_bias" ~ "VDem: Media bias",
                               var == "vdem_media_critical" ~ " VDem: Print/broadcast media critical",
                               var == "vdem_media_corrupt" ~ "VDem: Media corrupt",
                               var == "aiddata_content_producers" ~ "AidData: MRMI Content producers",
                               var == "vdem_gov_dissem_false_info_domestically" ~ "VDem: Govt. dissem. false info domestically",
                               var == "vdem_political_parties_dissem_false_info_domestically" ~ "VDem: Political parties dissem. false info domestically",
                               var == "vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign govt. dissem. false info",
                               var == "vdem_foreign_gov_advertising" ~ "VDem: Foreign govt. advertising",
                               var == "icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian state media narratives",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "IREX: Professional journalism"),
               var = fct_relevel(.f = var, "Sub-objective 2.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.1 avg.",
                                      "IREX: Professional journalism",
                                      "AidData: MRMI Content producers",
                                      "VDem: Media bias",
                                      " VDem: Print/broadcast media critical",
                                      "VDem: Media corrupt",
                                      "VDem: Govt. dissem. false info domestically",
                                      "VDem: Political parties dissem. false info domestically",
                                      "VDem: Foreign govt. dissem. false info",
                                      "VDem: Foreign govt. advertising",
                                      "ICEWS: Russian state media narratives")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_2"
sub_obj_2_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.2 avg.",
                               var == "msi_business_management" ~ "IREX: Business management",
                               var == "msi_plurality_of_news" ~ "IREX: Plurality of news",
                               var == "aiddata_content_consumers" ~ "AidData: MRMI Content consumers",
                               var == "vdem_print_broadcast_media_range_of_perspectives" ~ " VDem: Print/broadcast media perspectives",
                               var == "vdem_online_media_range_of_perspectives" ~ "VDem: Online media perspectives",
                               var == "vdem_online_media_existence" ~ " VDem: Online media existence",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 2.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.2 avg.",
                                      "IREX: Business management",
                                      "IREX: Plurality of news",
                                      "AidData: MRMI Content consumers",
                                      " VDem: Print/broadcast media perspectives",
                                      "VDem: Online media perspectives",
                                      " VDem: Online media existence")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_3"
sub_obj_2_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.3 avg.",
                               var == "msi_freedom_of_speech" ~ "IREX: Freedom of speech",
                               var == "aiddata_institutional_environment" ~ "AidData: Institutional environment",
                               var == "vdem_gov_censor_of_media_effort" ~ "VDem: Govt. censorship effort - Media",
                               var == "vdem_harassment_of_journalists" ~ "VDem: Harassment of journalists",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 2.3 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.3 avg.",
                                      "IREX: Freedom of speech",
                                      "AidData: Institutional environment",
                                      "VDem: Govt. censorship effort - Media",
                                      "VDem: Harassment of journalists")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_1"
sub_obj_3_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.1 avg.",
                               var == "iea_net_energy_imports_as_share_of_tes" ~ "IEA: Net energy imports\nas % of primary supply",
                               var == "aiddata_esi" ~ "AidData: Energy Security Index",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 3.1 avg.",
                                      "IEA: Net energy imports\nas % of primary supply",
                                      "AidData: Energy Security Index")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_2"
sub_obj_3_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.2 avg.",
                               var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                               var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                       "IEA: Natural gas imports from Russia\nas % of natural gas imports",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 3.2 avg.",
                                      "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                                      "IEA: Natural gas imports from Russia\nas % of natural gas imports")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_country_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_3"
sub_obj_3_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.3 avg.",
                               var == "rise_energy_efficiency_regulation_rank" ~ "WB: RISE energy efficiency regulation rank",
                               var == "rise_renewable_energy_regulation_rank" ~ "WB: RISE renewable energy regulation rank",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.3 avg.")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = fct_relevel(var, "sub_obj_avg"))) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_4_1"
sub_obj_4_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 4.1 avg.",
                               var == "cdis_russian_fdi_as_share_of_total_fdi" ~ "IMF: Russia FDI stock as % of total FDI stock",
                               var == "dots_exports_to_eu_as_share_of_total_exports" ~ "IMF: Exports to EU-15 as % of total exports",
                               var == "dots_exports_to_russia_as_share_of_total_exports" ~ "IMF: Exports to Russia as % of total exports",
                               var == "atlas_eci" ~ "Atlas: Economic Complexity Index",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 4.1 avg.")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = fct_relevel(var, "sub_obj_avg"))) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_4_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_4_2"
sub_obj_4_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               values = case_when(year <= 2006 ~ NA_real_,
                                  TRUE ~ values)) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 4.2 avg.",
                               var == "bti_banking_system" ~ "BTI: Banking system",
                               var == "legatum_financing_ecosystem" ~ "Legatum: Financing ecosystem",
                               var == "legatum_fiscal_sustainability" ~ "Legatum: Fiscal sustainability",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 4.2 avg.")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = fct_relevel(var, "sub_obj_avg"))) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                   slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_4_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_country_facet_chart ####
sub_obj_num_var <- "sub_obj_c"
cross_cutting_obj_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_normalized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_normalized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "  Cross-cutting objective avg.",
                               var == "cross_cutting_obj_fh_corruption" ~ "  FH: Corruption",
                               var == "cross_cutting_obj_wgi_control_of_corruption" ~ "  WGI: Control of corruption",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "  Cross-cutting objective avg.")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


cross_cutting_obj_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/cross_cutting_obj_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_1_1"
sub_obj_1_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_1_1_vdem_judicial_constraints_on_exec" ~
                                                  "VDem: Judicial constraints on executive",
                                          indicator_name == "sub_obj_1_1_vdem_leg_constraints_on_exec" ~
                                                  "VDem: Legislative constraints on executive",
                                          indicator_name == "sub_obj_1_1_fh_national_democratic_gov" ~
                                                  "FH: National democratic governance",
                                          indicator_name == "sub_obj_1_1_fh_local_democratic_gov" ~
                                                  "FH: Local democratic governance",
                                          indicator_name == "sub_obj_1_1_fh_judicial_framework_and_indep" ~
                                                  "FH: Judicial framework and indep.",
                                          indicator_name == "sub_obj_1_1_wgi_rule_of_law" ~
                                                  "WGI: Rule of law")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_1_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_1_2"
sub_obj_1_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_1_2_vdem_civil_society" ~
                                       "VDem: Civil society",
                               indicator_name == "sub_obj_1_2_fhi_csosi_overall" ~
                                       "FHI 360: Civil society")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_1_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_1_3"
sub_obj_1_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_1_3_fh_electoral_process" ~
                                       "FH: Electoral process",
                               indicator_name == "sub_obj_1_3_vdem_electoral_democracy" ~
                                       "VDem: Electoral democracy index",
                               indicator_name == "sub_obj_1_3_vdem_political_polarization" ~
                                       "VDem: Political polarization",
                               indicator_name == "sub_obj_1_3_vdem_political_violence" ~
                                       "VDem: Political violence", 
                               indicator_name == "sub_obj_1_3_vdem_mobilization_for_autocracy" ~
                                       "VDem: Mobilization for autocracy",
                               indicator_name == "sub_obj_1_3_vdem_gov_cyber_sec_capacity" ~
                                       "VDem: Gov. cyber sec. capacity",
                               indicator_name == "sub_obj_1_3_vdem_political_party_cyber_sec_capacity" ~
                                       "VDem: Political party cyber sec. capacity",
                               indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info" ~
                                       "VDem: Foreign govt. dissem. false info",
                               indicator_name == "sub_obj_1_3_vdem_foreign_gov_advertising" ~
                                       "VDem: Foreign govt. advertising")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_1_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_1"
sub_obj_2_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~
                                       "MSI: Professional journalism",
                               indicator_name == "sub_obj_2_1_vdem_media_critical" ~
                                       "VDem: Print/broadcast media critical",
                               indicator_name == "sub_obj_2_1_vdem_media_bias" ~
                                       "VDem: Media bias",
                               indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~
                                       "VDem: Media corrupt")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_indicator_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_2"
sub_obj_2_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_2_2_msi_plurality_of_news" ~
                                       "MSI: Plurality of news",
                               indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives" ~
                                       "VDem: Print/broadcast media perspectives",
                               indicator_name == "sub_obj_2_2_msi_business_management" ~
                                       "MSI: Business management",
                               indicator_name == "sub_obj_2_2_vdem_online_media_existence" ~
                                       "VDem: Online media existence")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_3"
sub_obj_2_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_2_3_msi_freedom_of_speech" ~
                                       "MSI: Freedom of speech",
                               indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort" ~
                                       "VDem: Govt. censorship effort - Media",
                               indicator_name == "sub_obj_2_3_vdem_harassment_of_journalists" ~
                                       "VDem: Harassment of journalists")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_3_1"
sub_obj_3_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_3_1_aiddata_esi" ~
                                       "AidData: Energy Security Index",
                               indicator_name == "sub_obj_3_1_iea_net_energy_imports_as_share_of_tes" ~
                                       "IEA: Net energy imports as % of primary supply")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_3_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_3_3"
sub_obj_3_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_3_3_rise_energy_efficiency_regulation_rank" ~
                                       "RISE: Energy efficiency regulation rank",
                               indicator_name == "sub_obj_3_3_rise_renewable_energy_regulation_rank" ~
                                       "RISE: Renewable energy regulation rank")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_3_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_4_1"
sub_obj_4_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_4_1_atlas_eci" ~
                                       "Atlas: Economic Complexity Index",
                               indicator_name == "sub_obj_4_1_dots_exports_to_eu_as_share_of_total_exports" ~
                                       "IMF: Exports to EU-15 as % of total exports",
                               indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi" ~
                                       "IMF: Russia FDI stock as % of total FDI stock",
                               indicator_name == "sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports" ~
                                       "IMF: Exports to Russia as % of total exports")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_4_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_4_2"
sub_obj_4_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "sub_obj_4_2_legatum_financing_ecosystem" ~
                                       "Legatum: Financing ecosystem",
                               indicator_name == "sub_obj_4_2_legatum_fiscal_sustainability" ~
                                       "Legatum: Fiscal sustainability",
                               indicator_name == "sub_obj_4_2_bti_banking_system" ~
                                       "BTI: Banking system")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_4_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_c"
sub_obj_c_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_normalized_values) %>%
        mutate(values = indicator_normalized_values,
               var = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~
                                       "WGI: Control of corruption",
                               indicator_name == "cross_cutting_obj_fh_corruption" ~
                                       "FH: Corruption")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_c_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_c_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_missingness ####
obj_num_var <- "obj_1"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_missingness ####
obj_num_var <- "obj_2"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_missingness ####
obj_num_var <- "obj_3"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_missingness ####
obj_num_var <- "obj_4"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_4_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/2, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_4_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_part_1_missingness ####
sub_obj_num_var <- "sub_obj_1_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("fh_judicial_framework_and_indep",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_1_part_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_1_part_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_part_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_part_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_part_2_missingness ####
sub_obj_num_var <- "sub_obj_1_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
                                                                   "vdem_leg_constraints_on_exec",
                                                                   "fh_national_democratic_gov",
                                                                   "fh_local_democratic_gov",
                                                                   sep = "|")))) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_1_part_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_1_part_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_part_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_part_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_missingness ####
sub_obj_num_var <- "sub_obj_1_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("fh_civil_society",
                                                                   "vdem_civil_society",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_part_1_missingness ####
sub_obj_num_var <- "sub_obj_1_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("fh_electoral_process",
                                                                   "vdem_electoral_democracy",
                                                                   "sub_obj_avg", sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                         pct_miss == 100 ~ "#7D7D7D"),
       color_bin = case_when(pct_miss == 0 ~ "Not missing",
                             pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_3_part_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_3_part_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_part_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_part_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_part_2_missingness ####
sub_obj_num_var <- "sub_obj_1_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("vdem_political_violence",
                               "vdem_political_polarization",
                               "vdem_mobilization_for_autocracy", sep = "|")))) %>%
        # mutate(variable = fct_relevel(.f = variable,
        #                               "sub_obj_avg_2001",
        #                               "sub_obj_avg_2002",
        #                               "sub_obj_avg_2003",
        #                               "sub_obj_avg_2004",
        #                               "sub_obj_avg_2005",
        #                               "sub_obj_avg_2006",
        #                               "sub_obj_avg_2007",
        #                               "sub_obj_avg_2008",
        #                               "sub_obj_avg_2009",
        #                               "sub_obj_avg_2010",
        #                               "sub_obj_avg_2011",
        #                               "sub_obj_avg_2012",
        #                               "sub_obj_avg_2013",
        #                               "sub_obj_avg_2014",
        #                               "sub_obj_avg_2015",
        #                               "sub_obj_avg_2016",
        #                               "sub_obj_avg_2017",
        #                               "sub_obj_avg_2018",
        #                               "sub_obj_avg_2019",
        #                               after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                         pct_miss == 100 ~ "#7D7D7D"),
       color_bin = case_when(pct_miss == 0 ~ "Not missing",
                             pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_3_part_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                              fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_3_part_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_part_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_part_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_part_3_missingness ####
sub_obj_num_var <- "sub_obj_1_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("vdem_gov_cyber_sec_capacity",
                                                                   "vdem_political_party_cyber_sec_capacity",
                                                                   "vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_1_3_vdem_foreign_gov_advertising",
                                                                   sep = "|")))) %>%
        # mutate(variable = fct_relevel(.f = variable,
        #                               "sub_obj_avg_2001",
        #                               "sub_obj_avg_2002",
        #                               "sub_obj_avg_2003",
        #                               "sub_obj_avg_2004",
        #                               "sub_obj_avg_2005",
        #                               "sub_obj_avg_2006",
        #                               "sub_obj_avg_2007",
        #                               "sub_obj_avg_2008",
        #                               "sub_obj_avg_2009",
        #                               "sub_obj_avg_2010",
#                               "sub_obj_avg_2011",
#                               "sub_obj_avg_2012",
#                               "sub_obj_avg_2013",
#                               "sub_obj_avg_2014",
#                               "sub_obj_avg_2015",
#                               "sub_obj_avg_2016",
#                               "sub_obj_avg_2017",
#                               "sub_obj_avg_2018",
#                               "sub_obj_avg_2019",
#                               after = Inf)) %>%
mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                         pct_miss == 100 ~ "#7D7D7D"),
       color_bin = case_when(pct_miss == 0 ~ "Not missing",
                             pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_3_part_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_3_part_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_part_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_part_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_missingness ####
sub_obj_num_var <- "sub_obj_2_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("msi_professional_journalism",
                                                                   "vdem_media_critical",
                                                                   "vdem_media_bias",
                                                                   "vdem_media_corrupt",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 4, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_missingness ####
sub_obj_num_var <- "sub_obj_2_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("msi_plurality_of_news",
                                                                   "msi_business_management",
                                                                   "vdem_media_range_of_perspectives",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_missingness ####
sub_obj_num_var <- "sub_obj_2_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("msi_freedom_of_speech",
                                                                   "vdem_harassment_of_journalists",
                                                                   "vdem_gov_censor_of_media_effort",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_missingness.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_missingness ####
sub_obj_num_var <- "sub_obj_3_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("iea_net_energy_imports_as_share_of_tes",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/3, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 10), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_missingness ####
sub_obj_num_var <- "sub_obj_3_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("iea_fossil_fuel_imports_from_russia_as_share_of_tes",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/3, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 15), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_missingness ####
sub_obj_num_var <- "sub_obj_3_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("rise_energy_efficiency_regulation",
                                                                   "rise_renewable_energy_regulation",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/2, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 10), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_part_1_missingness ####
sub_obj_num_var <- "sub_obj_4_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("unctad_export_product_concentration_index",
        #                                                            "dots_exports_to_eu_as_share_of_total_exports",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_4_1_part_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/2, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 15), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_4_1_part_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_part_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_part_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_part_2_missingness ####
sub_obj_num_var <- "sub_obj_4_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("cdis_russian_fdi_as_share_of_total_fdi",
                                                                   "dots_exports_to_russia_as_share_of_total_exports",
                                                                   sep = "|")))) %>%
        # mutate(variable = fct_relevel(.f = variable,
        #                               "sub_obj_avg_2001",
        #                               "sub_obj_avg_2002",
        #                               "sub_obj_avg_2003",
        #                               "sub_obj_avg_2004",
        #                               "sub_obj_avg_2005",
        #                               "sub_obj_avg_2006",
        #                               "sub_obj_avg_2007",
        #                               "sub_obj_avg_2008",
        #                               "sub_obj_avg_2009",
        #                               "sub_obj_avg_2010",
        #                               "sub_obj_avg_2011",
        #                               "sub_obj_avg_2012",
        #                               "sub_obj_avg_2013",
        #                               "sub_obj_avg_2014",
        #                               "sub_obj_avg_2015",
        #                               "sub_obj_avg_2016",
        #                               "sub_obj_avg_2017",
        #                               "sub_obj_avg_2018",
        #                               "sub_obj_avg_2019",
        #                               after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_4_1_part_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/3, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 10), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_4_1_part_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_part_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_part_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_missingness ####
sub_obj_num_var <- "sub_obj_4_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("legatum_financing_ecosystem",
                                                                   "legatum_fiscal_sustainability",
                                                                   "bti_banking_system",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_4_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_4_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_missingness ####
sub_obj_num_var <- "cross_cutting_obj"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        filter(str_detect(string = variable, pattern = regex(str_c("fh_corruption",
                                                                   "wgi_control_of_corruption",
                                                                   "sub_obj_avg",
                                                                   sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2001",
                                      "sub_obj_avg_2002",
                                      "sub_obj_avg_2003",
                                      "sub_obj_avg_2004",
                                      "sub_obj_avg_2005",
                                      "sub_obj_avg_2006",
                                      "sub_obj_avg_2007",
                                      "sub_obj_avg_2008",
                                      "sub_obj_avg_2009",
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
cross_cutting_obj_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


cross_cutting_obj_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/cross_cutting_obj_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_albania_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        bind_rows(., fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
                          mutate(obj_num = "miri") %>%
                          rename(values = miri_avg) %>% select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(country, year) %>%
        filter(country == "Albania") %>%
        mutate(color_bin = case_when(obj_num == "miri" ~ "MIR Index",
                                     obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "MIR Index" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Democratic" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_albania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("MIR Index", "Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("MIR Index", "Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "MIR Index"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values - .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values + .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 10, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_albania_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_albania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_albania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_armenia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "armenia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Armenia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        bind_rows(., fmir %>% 
                          filter(country == "Armenia") %>%
                          distinct(country, mcp_grouping, year, miri_avg) %>%
                          mutate(obj_num = "miri",
                                 values = miri_avg) %>%
                          select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_armenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_armenia_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_armenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_armenia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_azerbaijan_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "azerbaijan") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Azerbaijan") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_azerbaijan_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_azerbaijan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_belarus_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "belarus") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Belarus") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values - .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values - .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values + .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_belarus_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_belarus_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_bih_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "bih") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "BiH") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values - .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values + .02, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_bih_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_georgia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "georgia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. georgia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Georgia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values - .03, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_georgia_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_kosovo_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "kosovo") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Kosovo") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_kosovo_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values + .04, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_kosovo_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_kosovo_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_kosovo_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_moldova_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "moldova") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Moldova") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_moldova_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_moldova_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_moldova_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_moldova_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_macedonia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "macedonia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "N. Macedonia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_macedonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_macedonia_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_macedonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_macedonia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_serbia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "serbia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Serbia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_serbia_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_ukraine_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "ukraine") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "ukraine", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(country == "Ukraine") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Media",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_ukraine_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")),
                             linetype = factor(color_bin, levels = c("Democratic", "Media", "Energy", "Economic", "Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .65, y = values - .01, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .65, y = values, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none",
                           labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none",
                              labels = c("Democratic", "Media", "Energy", "Economic", "Corruption")) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -20, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_ukraine_line_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_ukraine_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_ukraine_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# get ee_region_obj_infographic ####


# flags from state dept: https://www.state.gov/countries-areas/

# create circle_palette
# https://www.rdocumentation.org/packages/dichromat/versions/1.1/topics/colorRampPalette
circle_palette <- colorRampPalette(c("#9ECAE1", "#08306B"))


#//////////////////////


# inspect
brewer.pal(n = 9, "Blues") %>% show_col()
circle_palette(5) %>% show_col()
circle_palette(100) %>% show_col()
col2rgb(col = "#9ECAE1") %>% str_c(., collapse = "/") 
col2rgb(col = "#9ECAE1")
col2rgb(col = "#78A3C3")
col2rgb(col = "#08306B")


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get ee_region_obj_infographic
# note that the obj_avg value will be displayed on the table, but the obj_avg_normalized value will be used to set color quantile
# since the obj_avg_normalized will now range from 0 to 1, while obj_avg does not necessarily because max/min may be in other year
# this ensures full range of circle_palette colors are used to allow for most distinction possible
# obj_avg_normalized btw 0-20 = q1, 21-40 = q2, 41-60 = q3, 61-80 = q4, 81-100 = q5

# get round_to_digits
round_to_digits <- function(x, digits, big_mark = ",") {
        sign <- sign(x)
        z <- abs(x) * 10^digits
        z <- z + 0.5
        z <- trunc(z)
        z <- z / 10^digits
        z <- z * sign
        return(str_trim(string = format(x = z, nsmall = digits, big.mark = big_mark), side = "both"))
}


#////////////////


ee_region_obj_infographic <- fmir %>% 
        filter(year == 2020,
                mcp_grouping %in% c("E&E Eurasia", "E&E Balkans")) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        mutate(obj_avg = round_to_digits(obj_avg, digits = 2),
               country = str_c("  ", country)) %>%
        select(obj_num, country, obj_avg) %>%
        pivot_wider(id_cols = country, names_from = obj_num, values_from = obj_avg)


#//////////////////////


# inspect
ee_region_obj_infographic 
ee_region_obj_infographic %>% skim()

# inspect
ee_region_obj_infographic %>% skim(obj_avg)

# test rgb values
ee_region_obj_infographic


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_avg_normalized_quantile_cutoffs
obj_avg_normalized_quantile_cutoffs <- fmir %>% 
        filter(year == 2020,
                mcp_grouping %in% c("E&E Eurasia", "E&E Balkans")) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        mutate(obj_avg_min = min(obj_avg),
               obj_avg_max = max(obj_avg),
               obj_avg_normalized = (obj_avg - obj_avg_min) / (obj_avg_max - obj_avg_min),
               q0_to_q20 = .20 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q21_to_q40 = .40 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q41_to_q60 = .60 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q61_to_q80 = .80 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q81_to_q100 = 1 * (obj_avg_max - obj_avg_min) + obj_avg_min)


#/////////////////////////


# inspect
obj_avg_normalized_quantile_cutoffs %>% select(-obj_num)
(obj_avg - obj_avg_min) / (obj_avg_max - obj_avg_min)

# check q0-q20 threshold
(.187 - .0518) / (.726 - .0518)

# check q21-q40 threshold
(.322 - .0518) / (.726 - .0518)

# check q41-q60 threshold
(.457 - .0518) / (.726 - .0518)

# check q61-q80 threshold
(.591 - .0518) / (.726 - .0518)

# check q61-q80 threshold
(.726 - .0518) / (.726 - .0518)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# create circle_palette_tbl
# manually apply conditional formatting in excel to highlight and change font color
# =IF(AND(B4>5, B4<10),TRUE,FALSE)
circle_palette_tbl <- obj_avg_normalized_quantile_cutoffs %>% select(starts_with("q")) %>% distinct() %>%
        pivot_longer(cols = everything(), names_to = "quintile", values_to = "obj_avg_threshold") %>%
        left_join(., tibble(hex = circle_palette(5), 
                             quintile = c("q0_to_q20", "q21_to_q40", "q41_to_q60", "q61_to_q80", "q81_to_q100")) %>%
                mutate(rgb = map(.x = hex, .f = ~ col2rgb(col = .x) %>% str_c(., collapse = "."))) %>%
                unnest(rgb),
                by = "quintile")
circle_palette_tbl 


#//////////////////////////////////////////////////////////////////////////////////////////////////


# write ee_region_obj_infographic to file

# note csv will be copied into xlsx shell and formatted
# blue header is rgb 31/73/125
# grey grid lines are rgb 217/217/217, medium weight
# country rows on left side gets a rgb 217/217/217 heavy border
# grey top/bottom row above/under table is rgb 217/217/217, height = 15
# font is Calibri, size 15, bolded, centered horizontally/vertically in cells; 
# grey font color = rgb 51/51/51, white for column headers
# flag column is width = 15
# country name column is width = 32
# data columns are width = 28
# column header row height = 95
# data row height = 35
# data cells formatted as number with two decimal places, to avoid truncation (e.g. 0.70 converted to 0.7)

# output is copied into powerpoint using paste special -> Picture (Enhanced Metafile), aligned center
# flags are copy/pasted in from state dept website, w locked aspect ratio, and resized to 87% 
# ungroup old table and bring flags to front, then drag flags on top of new table
# then right click on grouped image and save as EMF
# emf is then added to slide deck by Insert -> Picture and resized to 182% and centered
ee_region_obj_infographic %>% write_csv("output/charts/ee_region_obj_infographic.csv")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# create obj_radar_charts ####

# get custom radarchart2, which takes vlabcol and vlab_fontface arg
# https://stackoverflow.com/questions/54185029/change-labels-colors-in-r-radarchart
# https://r-charts.com/ranking/radar-chart/

# updated workflow to save radarchart as ggplot w/ emf:
# 1) use recordPlot to get last plot as saved object
# 2) use ggplotify::as.ggplot() to wrap cowplot::as_grob to save as ggplot object, then save as normal
# https://stackoverflow.com/questions/29583849/save-a-plot-in-an-object
# https://cran.r-project.org/web/packages/ggplotify/vignettes/ggplotify.html
# https://rdrr.io/cran/cowplot/man/as_grob.html
grid.newpage()
radarchart2(df = chart_data, country = current_country)
y <- recordPlot()
z <- as.ggplot(as_grob(y))

# optional use of patchwork to combine ggplots
x <- starwars %>% count(homeworld) %>% arrange(desc(n)) %>% slice(1:10) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = homeworld, .x = n, .desc = FALSE), y = n)) + geom_col()
p <- z + x
p

q <- z + z + z

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(q)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/p.docx")


#/////////////////////////


radarchart2 <- function (df, country = NULL, axistype = 0, seg = 4, pty = 16, pcol = 1:8, plty = 1:6, 
                         plwd = 1, pdensity = NULL, pangle = 45, pfcol = NA, cglty = 3, 
                         cglwd = 1, cglcol = "navy", axislabcol = "blue", vlabcol = "black", vlab_fontface = 1, title = "", 
                         maxmin = TRUE, na.itp = TRUE, centerzero = FALSE, vlabels = NULL, 
                         vlcex = NULL, caxislabels = NULL, calcex = NULL, paxislabels = NULL, 
                         palcex = NULL, ...) {
       
        # set default parameters
        axistype = 1 
        
        # point symbol
        pty = 32
        
        # color for outside of plotted rings
        pcol = c("#ff4d4d", "#2171B5")
        
        # color for inside of plotted rings
        pfcol = c(NA, "#2171B570")
        
        # width of plotted rings
        plwd = 4
        
        # line type for plotted rings
        plty = 1
        
        # number of axis segments between center and outer rim
        seg = 5 
        
        # line color for grid segments
        cglcol = "#999999"
        
        # line type for grid segments
        cglty = 1 
        
        # color of axis grid segment labels
        # axislabcol = "#333333", 
        axislabcol = "#333333"
        
        # values for axis grid segment labels
        caxislabels = c("0.0", "0.2", "0.4", "0.6", "0.8", "1.0")
        
        # line width for axis grid segments
        cglwd = 0.8
        
        # font magnification for outer labels
        vlcex = 1.5

        # font color for outer labels
        vlabcol = "#333333"
        
        # font face for outer labels
        vlab_fontface = 1
        
        # font magnification for center labels
        calcex = 1

        # set font as parameter; 1 is normal, 2 is bold, 3 is italic
        current_parameters <- par(family = "Calibri", font = 1)
        par(current_parameters)
        
        
        #///////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        if (!is.data.frame(df)) {
                cat("The data must be given as dataframe.\n")
                return()
        }
        if ((n <- length(df)) < 3) {
                cat("The number of variables must be 3 or more.\n")
                return()
        }
        if (maxmin == FALSE) {
                dfmax <- apply(df, 2, max)
                dfmin <- apply(df, 2, min)
                df <- rbind(dfmax, dfmin, df)
        }
        plot(c(-1.2, 1.2), c(-1.2, 1.2), type = "n", frame.plot = FALSE, 
             axes = FALSE, xlab = "", ylab = "", main = title, asp = 1, 
             ...)
        theta <- seq(90, 450, length = n + 1) * pi/180
        theta <- theta[1:n]
        xx <- cos(theta)
        yy <- sin(theta)
        CGap <- ifelse(centerzero, 0, 1)
        for (i in 0:seg) {
                polygon(xx * (i + CGap)/(seg + CGap), yy * (i + CGap)/(seg + 
                                                                               CGap), lty = cglty, lwd = cglwd, border = cglcol)
                if (axistype == 1 | axistype == 3) 
                        CAXISLABELS <- paste(i/seg * 100, "(%)")
                if (axistype == 4 | axistype == 5) 
                        CAXISLABELS <- sprintf("%3.2f", i/seg)
                if (!is.null(caxislabels) & (i < length(caxislabels))) 
                        CAXISLABELS <- caxislabels[i + 1]
                if (axistype == 1 | axistype == 3 | axistype == 4 | 
                    axistype == 5) {
                        if (is.null(calcex)) 
                                text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                     col = axislabcol)
                        else text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                  col = axislabcol, cex = calcex)
                }
        }
        if (centerzero) {
                arrows(0, 0, xx * 1, yy * 1, lwd = cglwd, lty = cglty, 
                       length = 0, col = cglcol)
        }
        else {
                arrows(xx/(seg + CGap), yy/(seg + CGap), xx * 1, yy * 
                               1, lwd = cglwd, lty = cglty, length = 0, col = cglcol)
        }
        PAXISLABELS <- df[1, 1:n]
        if (!is.null(paxislabels)) 
                PAXISLABELS <- paxislabels
        if (axistype == 2 | axistype == 3 | axistype == 5) {
                if (is.null(palcex)) 
                        text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol)
                else text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol, 
                          cex = palcex)
        }
        VLABELS <- colnames(df)
        if (!is.null(vlabels)) 
                VLABELS <- vlabels
        if (is.null(vlcex)) 
                text(xx * 1.2, yy * 1.2, VLABELS, col = vlabcol, font = vlab_fontface)
        else text(xx * 1.2, yy * 1.2, VLABELS, cex = vlcex, col = vlabcol, font = vlab_fontface)
        series <- length(df[[1]])
        SX <- series - 2
        if (length(pty) < SX) {
                ptys <- rep(pty, SX)
        }
        else {
                ptys <- pty
        }
        if (length(pcol) < SX) {
                pcols <- rep(pcol, SX)
        }
        else {
                pcols <- pcol
        }
        if (length(plty) < SX) {
                pltys <- rep(plty, SX)
        }
        else {
                pltys <- plty
        }
        if (length(plwd) < SX) {
                plwds <- rep(plwd, SX)
        }
        else {
                plwds <- plwd
        }
        if (length(pdensity) < SX) {
                pdensities <- rep(pdensity, SX)
        }
        else {
                pdensities <- pdensity
        }
        if (length(pangle) < SX) {
                pangles <- rep(pangle, SX)
        }
        else {
                pangles <- pangle
        }
        if (length(pfcol) < SX) {
                pfcols <- rep(pfcol, SX)
        }
        else {
                pfcols <- pfcol
        }
        for (i in 3:series) {
                xxs <- xx
                yys <- yy
                scale <- CGap/(seg + CGap) + (df[i, ] - df[2, ])/(df[1, 
                                                                     ] - df[2, ]) * seg/(seg + CGap)
                if (sum(!is.na(df[i, ])) < 3) {
                        cat(sprintf("[DATA NOT ENOUGH] at %d\n%g\n", i, 
                                    df[i, ]))
                }
                else {
                        for (j in 1:n) {
                                if (is.na(df[i, j])) {
                                        if (na.itp) {
                                                left <- ifelse(j > 1, j - 1, n)
                                                while (is.na(df[i, left])) {
                                                        left <- ifelse(left > 1, left - 1, n)
                                                }
                                                right <- ifelse(j < n, j + 1, 1)
                                                while (is.na(df[i, right])) {
                                                        right <- ifelse(right < n, right + 1, 
                                                                        1)
                                                }
                                                xxleft <- xx[left] * CGap/(seg + CGap) + 
                                                        xx[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                yyleft <- yy[left] * CGap/(seg + CGap) + 
                                                        yy[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                xxright <- xx[right] * CGap/(seg + CGap) + 
                                                        xx[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                yyright <- yy[right] * CGap/(seg + CGap) + 
                                                        yy[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                if (xxleft > xxright) {
                                                        xxtmp <- xxleft
                                                        yytmp <- yyleft
                                                        xxleft <- xxright
                                                        yyleft <- yyright
                                                        xxright <- xxtmp
                                                        yyright <- yytmp
                                                }
                                                xxs[j] <- xx[j] * (yyleft * xxright - yyright * 
                                                                           xxleft)/(yy[j] * (xxright - xxleft) - 
                                                                                            xx[j] * (yyright - yyleft))
                                                yys[j] <- (yy[j]/xx[j]) * xxs[j]
                                        }
                                        else {
                                                xxs[j] <- 0
                                                yys[j] <- 0
                                        }
                                }
                                else {
                                        xxs[j] <- xx[j] * CGap/(seg + CGap) + xx[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                        yys[j] <- yy[j] * CGap/(seg + CGap) + yy[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                }
                        }
                        if (is.null(pdensities)) {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], col = pfcols[i - 
                                                                                                                                          2])
                        }
                        else {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], density = pdensities[i - 
                                                                                                                                                  2], angle = pangles[i - 2], col = pfcols[i - 
                                                                                                                                                                                                   2])
                        }
                        points(xx * scale, yy * scale, pch = ptys[i - 2],
                               col = pcols[i - 2])
                }
        }
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # set default legend
        legend(x = .6, y = 1.2, legend = c("EU-15 avg.", country), bty = "n",
               pch = 20 , col = c("#ff4d4d", "#2171B5") , text.col = "#333333", cex = 1.5, pt.cex = 3)
        
}




#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# get eu_obj_avg 
# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_obj_avg <- fmir %>% filter(mcp_grouping == "EU-15", year == 2020) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        group_by(obj_num, year) %>%
        mutate(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>%
        slice(1) %>% 
        ungroup() %>% select(-c(country, obj_avg)) 


#//////////////////////


# inspect
eu_obj_avg
eu_obj_avg %>% nrow() # 5
eu_obj_avg %>% ncol() # 3

# test eu_obj_avg
test_eu_obj_avg <- function() {
        
        # test obj_1
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_1", year == 2020) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_1", year == 2020, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))  
        
        # test obj_2
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_2", year == 2020) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_2", year == 2020, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        
        # test obj_3
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_3", year == 2020) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_3", year == 2020, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        
        # test obj_4
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_1", year == 2020) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_1", year == 2020, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
}
test_eu_obj_avg()


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# note that for radar charts, if chart is single country, adjust radarchart() to have cex = 1 
# in both the default argument at the top of function, and also in the legend() call at the bottom of function
# if radar charts will be faceted by ee region, then set both these cex values to 1.5

# note for facet chart, the emf is cropped tight in word, pasted into ee_balkans_and_eurasia_obj_facet_radar_chart, 
# then lock aspect ratio and resize to 60%; once all countries added, group and save as EMF; 
# emf then added to main deck and resized to 183% w/ centeer alignment


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# albania_obj_radar_chart ####


# get current_country_obj
current_country <- "Albania"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/albania_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# armenia_obj_radar_chart ####


# get current_country_obj
current_country <- "Armenia"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/armenia_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# azerbaijan_obj_radar_chart ####


# get current_country_obj
current_country <- "Azerbaijan"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/azerbaijan_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# belarus_obj_radar_chart ####


# get current_country_obj
current_country <- "Belarus"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/belarus_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# bih_obj_radar_chart ####


# get current_country_obj
current_country <- "BiH"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/bih_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# georgia_obj_radar_chart ####


# get current_country_obj
current_country <- "Georgia"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/georgia_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# kosovo_obj_radar_chart ####


# get current_country_obj
current_country <- "Kosovo"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/kosovo_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# moldova_obj_radar_chart ####


# get current_country_obj
current_country <- "Moldova"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/moldova_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# macedonia_obj_radar_chart ####


# get current_country_obj
current_country <- "N. Macedonia"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/macedonia_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# serbia_obj_radar_chart ####


# get current_country_obj
current_country <- "Serbia"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/serbia_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_radar_chart ####


# get current_country_obj
current_country <- "Ukraine"
current_country_obj <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                                       country == current_country) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        rename("Obj. 1: Democratic" = obj_1, "Obj. 2: Media" = obj_2, "Obj. 3: Energy" = obj_3, 
               "Obj. 4: Economic" = obj_4, "Cross-cutting Obj.:\nCorruption" = obj_c)

chart_data


#//////////////////////////


# save chart as emf
dev.off()
filename <- tempfile(fileext = ".emf")
emf(file = filename)

radarchart2(df = chart_data, country = current_country)

# write emf
dev.off()

# add emf to word doc - will manually crop map in word doc 
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/ukraine_obj_radar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# check ron's avg ####


# inspect balkans vs eurasia avg for latest year
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, obj_num, obj_avg) %>%
        group_by(mcp_grouping, obj_num) %>%
        mutate(regional_avg = mean(obj_avg)) %>%
        ungroup() %>%
        arrange(obj_num, mcp_grouping) %>%
        # print(n = 20)
        distinct(obj_num, mcp_grouping, regional_avg) 

# eurasia avg for obj_1
mean(c(.51, .1, .17, .52, .51, .45))
        

#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# inspect change from 2013 to 2019
# 11 countries * 2 years * 5 obj = 110 records per country
fmir %>% filter(year %in% c(2013, 2019) & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year %in% c(2013, 2018) & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        mutate(period = case_when(year == 2013 ~ "period_1", 
                                  year %in% c(2018, 2019) ~ "period_2")) %>%
        distinct(country, period, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, period, obj_num), names_from = period, values_from = obj_avg) %>%
        mutate(diff_from_2013_to_2019 = period_2 - period_1) %>%
        arrange(desc(diff_from_2013_to_2019)) %>%
        group_by(country) %>%
        mutate(country_avg_diff = mean(diff_from_2013_to_2019),
               country_sum_diff = sum(diff_from_2013_to_2019),
               improving_obj_flag = case_when(diff_from_2013_to_2019 > 0 ~ 1, TRUE ~ 0),
               count_of_improving_obj = sum(improving_obj_flag)) %>%
        ungroup() %>%
        arrange(desc(country_avg_diff), country) %>%
        # arrange(desc(country_sum_diff), country) %>%
        # arrange(desc(count_of_improving_obj), country) %>%
        print(n = nrow(.))


#////////////////////////////////////////////////////////////////////////////////////////////


# inspect latest year (2019/2018)
# 11 countries * 1 year * 5 obj == 55 records
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        group_by(country) %>%
        mutate(obj_avg_max_flag = case_when(obj_avg == max(obj_avg) ~ 1, TRUE ~ 0),
               obj_avg_min_flag = case_when(obj_avg == min(obj_avg) ~ 1, TRUE ~ 0)) %>%
        ungroup() %>%
        group_by(obj_num) %>%
        mutate(obj_avg_max_flag_sum = sum(obj_avg_max_flag),
                  obj_avg_min_flag_sum = sum(obj_avg_min_flag)) %>%
        ungroup() %>%
        # distinct(obj_num, obj_avg_max_flag_sum) %>%
        # distinct(obj_num, obj_avg_min_flag_sum) %>%
        # arrange(desc(obj_avg_max_flag_sum))
        # arrange(desc(obj_avg_min_flag_sum)) %>%
        # filter(obj_num == "obj_c") %>%
        # filter(obj_num == "obj_3") %>%
        # filter(country == "Belarus") %>%
        # filter(country %in% c("Armenia", "Georgia")) %>%
        filter(obj_avg_max_flag == 1 | obj_avg_min_flag == 1) %>%
        print(n = 30)


#////////////////////////////////////////////////////////////////////////////////////////////


# inspect countries degree of lag compared to eu

# get eu_obj_avg
# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_obj_avg <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                              mcp_grouping == "EU-15") %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        group_by(obj_num, year) %>%
        mutate(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>%
        slice(1) %>% 
        ungroup() %>% select(-c(country, obj_avg)) 

fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping == "E&E Balkans") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(eu_lag = obj_avg - obj_avg_for_eu) %>%
        group_by(country) %>%
        mutate(eu_lag_max_flag = case_when(eu_lag == max(eu_lag) ~ 1, TRUE ~ 0),
               eu_lag_min_flag = case_when(eu_lag == min(eu_lag) ~ 1, TRUE ~ 0)) %>%
        ungroup() %>%
        group_by(obj_num) %>%
        mutate(eu_lag_max_flag_sum = sum(eu_lag_max_flag),
               eu_lag_min_flag_sum = sum(eu_lag_min_flag)) %>%
        ungroup() %>%
        # filter(eu_lag_max_flag == 1) %>%
        # filter(eu_lag_min_flag == 1) %>%
        # distinct(obj_num, eu_lag_max_flag_sum) %>%
        # distinct(obj_num, eu_lag_min_flag_sum) 
        # filter(obj_num == "obj_1")
        # filter(obj_num == "obj_2")
        filter(obj_num == "obj_3")
        # filter(obj_num == "obj_4")
        # filter(obj_num == "obj_c")
        # filter(country == "Serbia")
        # filter(country == "Belarus")
        print(n = 30)


#///////////////////////////////////////////////////////////////////////////


# inspect which countries have greatest resilience in each obj
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        # filter(obj_num == "obj_1") %>%
        # filter(obj_num == "obj_2") %>%
        # filter(obj_num == "obj_3") %>%
        # filter(obj_num == "obj_4") %>%
        filter(obj_num == "obj_c") %>%
        arrange(desc(obj_avg))
        

#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_2_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_2"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
                color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                          TRUE ~ NA_character_),
                color_bin = mcp_grouping,
                color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                  color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                  color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                  color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                  color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                  color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                  color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                linetype_bin = mcp_grouping,
                linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_2_scatterplot <- obj_1_and_obj_2_ee_scatterplot + obj_1_and_obj_2_all_country_scatterplot 
obj_1_and_obj_2_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_2_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_2_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_3_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_3"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_3_scatterplot <- obj_1_and_obj_3_ee_scatterplot + obj_1_and_obj_3_all_country_scatterplot 
obj_1_and_obj_3_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_3_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_4_scatterplot <- obj_1_and_obj_4_ee_scatterplot + obj_1_and_obj_4_all_country_scatterplot 
obj_1_and_obj_4_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_c_scatterplot <- obj_1_and_obj_c_ee_scatterplot + obj_1_and_obj_c_all_country_scatterplot 
obj_1_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_c_scatterplot.docx")

#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_3_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_3"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_3_scatterplot <- obj_2_and_obj_3_ee_scatterplot + obj_2_and_obj_3_all_country_scatterplot 
obj_2_and_obj_3_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_3_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_4_scatterplot <- obj_2_and_obj_4_ee_scatterplot + obj_2_and_obj_4_all_country_scatterplot 
obj_2_and_obj_4_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_c_scatterplot <- obj_2_and_obj_c_ee_scatterplot + obj_2_and_obj_c_all_country_scatterplot 
obj_2_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_c_scatterplot.docx")



#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_3"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_3_and_obj_4_scatterplot <- obj_3_and_obj_4_ee_scatterplot + obj_3_and_obj_4_all_country_scatterplot 
obj_3_and_obj_4_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_3"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_3_and_obj_c_scatterplot <- obj_3_and_obj_c_ee_scatterplot + obj_3_and_obj_c_all_country_scatterplot 
obj_3_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_c_scatterplot.docx")



#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_4_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_4"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_4_and_obj_c_scatterplot <- obj_4_and_obj_c_ee_scatterplot + obj_4_and_obj_c_all_country_scatterplot 
obj_4_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_and_obj_c_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot <- obj_1_and_obj_2_ee_scatterplot + obj_1_and_obj_3_ee_scatterplot 
obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot <- obj_1_and_obj_4_ee_scatterplot + obj_1_and_obj_c_ee_scatterplot 
obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot <- obj_2_and_obj_3_ee_scatterplot + obj_2_and_obj_4_ee_scatterplot 
obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot <- obj_2_and_obj_c_ee_scatterplot + obj_3_and_obj_4_ee_scatterplot 
obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot ####


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot <- obj_3_and_obj_c_ee_scatterplot + obj_4_and_obj_c_ee_scatterplot 
obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot <- obj_1_and_obj_3_ee_scatterplot + obj_1_and_obj_4_ee_scatterplot 
obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_all_country_stacked_bar_chart ####


# inspect
fmir %>% filter(year == 2019, country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_normalized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year == 2020) %>% select(country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(year == 2020, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>% 
        select(country, mcp_grouping, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        mutate(var = obj_num, values = obj_avg) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Obj. 1: Democratic    ",
                                     var == "obj_2" ~ 
                                             "Obj. 2: Information    ",
                                     var == "obj_3" ~ 
                                             "Obj. 3: Energy    ",
                                     var == "obj_4" ~ 
                                             "Obj. 4: Economic    ",
                                     var == "obj_c" ~
                                             "Cross-cutting obj:\nCorruption    "),
               color = case_when(color_bin == "Obj. 1: Democratic    " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Obj. 2: Information    " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Obj. 3: Energy    " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 4: Economic    " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ color_palette %>% slice(5) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                          color_bin == "Obj. 2: Information    " ~ 2,
                          color_bin == "Obj. 3: Energy    " ~ 3,
                          color_bin == "Obj. 4: Economic    " ~ 4,
                          color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                          color_bin == "Obj. 2: Information    " ~ 2,
                          color_bin == "Obj. 3: Energy    " ~ 3,
                          color_bin == "Obj. 4: Economic    " ~ 4,
                          color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
# orignally used 8 font
obj_avg_all_country_stacked_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values, 
                             fill = factor(color_bin, levels = c("Obj. 1: Democratic    ", 
                                                                 "Obj. 2: Information    ", 
                                                                 "Obj. 3: Energy    ", 
                                                                 "Obj. 4: Economic    ",
                                                                 "Cross-cutting obj:\nCorruption    ")))) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 5, by = 1),
                           limits = c(0, 5),
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is bettter)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 1.5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_all_country_stacked_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_all_country_stacked_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_all_country_stacked_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart ####


# inspect
fmir %>% filter(year %in% c(2010, 2020), country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_normalized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year %in% c(2010, 2018, 2019, 2020), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        mutate(obj_avg = case_when(year %in% c(2018, 2019) ~ NA_real_,
                                   TRUE ~ obj_avg),
               year_fct = factor(year, levels = c(2018, 2010, 2020, 2019))) %>%
        select(country, year, year_fct, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        arrange(country, year) %>%
        ggplot(data = ., mapping = aes(x = year_fct,
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) + 
        scale_x_discrete(labels = c("", "2010", "2020", "")) +
        facet_wrap(facets = vars(country), nrow = 1) +
        theme(
                panel.spacing = unit(1.25, "lines"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(year %in% c(2010, 2018, 2019, 2020), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        mutate(obj_avg = case_when(year %in% c(2018, 2019) ~ NA_real_,
                                   TRUE ~ obj_avg),
               year_fct = factor(year, levels = c(2018, 2010, 2020, 2019)),
               country = case_when(country == "N. Macedonia" ~ "North\nMacedonia",
                                   TRUE ~ country),
               country_order = case_when(year == 2020 ~ miri_avg)) %>%
        group_by(country) %>% fill(country_order, .direction = "downup") %>%
        ungroup() %>%
        select(country, year, year_fct, obj_num, obj_avg, miri_avg, country_order) %>% distinct() %>%
        mutate(country = fct_reorder(.f = country, .x = country_order, .desc = FALSE)) %>% 
        mutate(var = obj_num, values = obj_avg) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Obj. 1: Democratic    ",
                                     var == "obj_2" ~ 
                                             "Obj. 2: Information    ",
                                     var == "obj_3" ~ 
                                             "Obj. 3: Energy    ",
                                     var == "obj_4" ~ 
                                             "Obj. 4: Economic    ",
                                     var == "obj_c" ~
                                             "Cross-cutting obj:\nCorruption    "),
               color = case_when(color_bin == "Obj. 1: Democratic    " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Obj. 2: Information    " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 3: Energy    " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Obj. 4: Economic    " ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ color_palette %>% slice(7) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                                 color_bin == "Obj. 2: Information    " ~ 2,
                                 color_bin == "Obj. 3: Energy    " ~ 3,
                                 color_bin == "Obj. 4: Economic    " ~ 4,
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                                 color_bin == "Obj. 2: Information    " ~ 2,
                                 color_bin == "Obj. 3: Energy    " ~ 3,
                                 color_bin == "Obj. 4: Economic    " ~ 4,
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = year_fct, 
                             y = values, 
                             fill = factor(color_bin, levels = c("Obj. 1: Democratic    ", 
                                                                 "Obj. 2: Information    ", 
                                                                 "Obj. 3: Energy    ", 
                                                                 "Obj. 4: Economic    ",
                                                                 "Cross-cutting obj:\nCorruption    ")))) + 
        geom_col(position = "stack", width = .85) + 
        facet_wrap(facets = vars(country), nrow = 1, strip.position = "top") +
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(labels = c("", "2010", "2020", ""), expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 5, by = 1),
                           limits = c(0, 5.01),
                           expand = c(0, 0),
                           labels = number_format(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is bettter)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 2.5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                panel.spacing = unit(0, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                # axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart.docx")


#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////


# create get_country_profile_radar_chart() ####

# get custom radarchart2, which takes vlabcol and vlab_fontface arg
# https://stackoverflow.com/questions/54185029/change-labels-colors-in-r-radarchart
# https://r-charts.com/ranking/radar-chart/

# updated workflow to save radarchart as ggplot w/ emf:
# 1) use recordPlot to get last plot as saved object
# 2) use ggplotify::as.ggplot() to wrap cowplot::as_grob to save as ggplot object, then save as normal
# https://stackoverflow.com/questions/29583849/save-a-plot-in-an-object
# https://cran.r-project.org/web/packages/ggplotify/vignettes/ggplotify.html
# https://rdrr.io/cran/cowplot/man/as_grob.html

# create radar chart and save as ggplot
# grid.newpage()
# radarchart2(df = chart_data, country = current_country)
# y <- recordPlot()
# z <- as.ggplot(as_grob(y))
# 
# # optional use of patchwork to combine ggplots
# x <- starwars %>% count(homeworld) %>% arrange(desc(n)) %>% slice(1:10) %>%
#         ggplot(data = ., mapping = aes(x = fct_reorder(.f = homeworld, .x = n, .desc = FALSE), y = n)) + geom_col()
# p <- z + x
# p
# 
# # combine multiple radar charts
# q <- z + z + z
# 
# # save chart as emf
# filename <- tempfile(fileext = ".emf")
# emf(file = filename)
# print(q)
# dev.off()
# 
# # add emf to word doc
# read_docx() %>%
#         body_add_img(src = filename, width = 6, height = 6) %>%
#         print(target = "output/charts/p.docx")


#/////////////////////////


get_country_profile_radar_chart <- function (df, country = NULL, axistype = 0, seg = 4, pty = 16, pcol = 1:8, plty = 1:6, 
                                             plwd = 1, pdensity = NULL, pangle = 45, pfcol = NA, cglty = 3, 
                                             cglwd = 1, cglcol = "navy", axislabcol = "blue", vlabcol = "black", vlab_fontface = 1, title = "", 
                                             maxmin = TRUE, na.itp = TRUE, centerzero = FALSE, vlabels = NULL, 
                                             vlcex = NULL, caxislabels = NULL, calcex = NULL, paxislabels = NULL, 
                                             palcex = NULL, ...) {
        
        # set default parameters
        axistype = 1 
        
        # point symbol
        pty = 32
        
        # color for outside of plotted rings
        pcol = c("#083D7F", "#EF6712")
        
        # color for inside of plotted rings
        pfcol = c(NA, "#EF671270")
        
        # width of plotted rings
        # plwd = 2
        plwd = 12
        
        # line type for plotted rings
        plty = 1
        
        # number of axis segments between center and outer rim
        seg = 5 
        
        # line color for grid segments
        cglcol = "#999999"
        
        # line type for grid segments
        cglty = 1 
        
        # color of axis grid segment labels
        axislabcol = "#333333"
        
        # values for axis grid segment labels
        caxislabels = c("0.0", "0.2", "0.4", "0.6", "0.8", "1.0")
        
        # line width for axis grid segments
        # cglwd = 0.8
        cglwd = 3
        
        # font color for outer labels
        vlabcol = "#333333"
        
        # font face for outer labels
        vlab_fontface = 1
        
        # font magnification for outer labels
        # vlcex = .75
        vlcex = 2
        
        # font magnification for center labels
        # calcex = .75
        calcex = 2
        
        # font magnification for peripheral labels
        # palcex = .75
        palcex = 2
        
        # set font as parameter; 1 is normal, 2 is bold, 3 is italic
        current_parameters <- par(family = "Calibri", font = 1)
        par(current_parameters)
        
        
        #///////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        if (!is.data.frame(df)) {
                cat("The data must be given as dataframe.\n")
                return()
        }
        if ((n <- length(df)) < 3) {
                cat("The number of variables must be 3 or more.\n")
                return()
        }
        if (maxmin == FALSE) {
                dfmax <- apply(df, 2, max)
                dfmin <- apply(df, 2, min)
                df <- rbind(dfmax, dfmin, df)
        }
        plot(c(-1.2, 1.2), c(-1.2, 1.2), type = "n", frame.plot = FALSE, 
             axes = FALSE, xlab = "", ylab = "", main = title, asp = 1, 
             ...)
        theta <- seq(90, 450, length = n + 1) * pi/180
        theta <- theta[1:n]
        xx <- cos(theta)
        yy <- sin(theta)
        CGap <- ifelse(centerzero, 0, 1)
        for (i in 0:seg) {
                polygon(xx * (i + CGap)/(seg + CGap), yy * (i + CGap)/(seg + 
                                                                               CGap), lty = cglty, lwd = cglwd, border = cglcol)
                if (axistype == 1 | axistype == 3) 
                        CAXISLABELS <- paste(i/seg * 100, "(%)")
                if (axistype == 4 | axistype == 5) 
                        CAXISLABELS <- sprintf("%3.2f", i/seg)
                if (!is.null(caxislabels) & (i < length(caxislabels))) 
                        CAXISLABELS <- caxislabels[i + 1]
                if (axistype == 1 | axistype == 3 | axistype == 4 | 
                    axistype == 5) {
                        if (is.null(calcex)) 
                                text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                     col = axislabcol)
                        else text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                  col = axislabcol, cex = calcex)
                }
        }
        if (centerzero) {
                arrows(0, 0, xx * 1, yy * 1, lwd = cglwd, lty = cglty, 
                       length = 0, col = cglcol)
        }
        else {
                arrows(xx/(seg + CGap), yy/(seg + CGap), xx * 1, yy * 
                               1, lwd = cglwd, lty = cglty, length = 0, col = cglcol)
        }
        PAXISLABELS <- df[1, 1:n]
        if (!is.null(paxislabels)) 
                PAXISLABELS <- paxislabels
        if (axistype == 2 | axistype == 3 | axistype == 5) {
                if (is.null(palcex)) 
                        text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol)
                else text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol, 
                          cex = palcex)
        }
        VLABELS <- colnames(df)
        if (!is.null(vlabels)) 
                VLABELS <- vlabels
        if (is.null(vlcex)) 
                text(xx * 1.2, yy * 1.2, VLABELS, col = vlabcol, font = vlab_fontface)
        else text(xx * 1.2, yy * 1.2, VLABELS, cex = vlcex, col = vlabcol, font = vlab_fontface)
        series <- length(df[[1]])
        SX <- series - 2
        if (length(pty) < SX) {
                ptys <- rep(pty, SX)
        }
        else {
                ptys <- pty
        }
        if (length(pcol) < SX) {
                pcols <- rep(pcol, SX)
        }
        else {
                pcols <- pcol
        }
        if (length(plty) < SX) {
                pltys <- rep(plty, SX)
        }
        else {
                pltys <- plty
        }
        if (length(plwd) < SX) {
                plwds <- rep(plwd, SX)
        }
        else {
                plwds <- plwd
        }
        if (length(pdensity) < SX) {
                pdensities <- rep(pdensity, SX)
        }
        else {
                pdensities <- pdensity
        }
        if (length(pangle) < SX) {
                pangles <- rep(pangle, SX)
        }
        else {
                pangles <- pangle
        }
        if (length(pfcol) < SX) {
                pfcols <- rep(pfcol, SX)
        }
        else {
                pfcols <- pfcol
        }
        for (i in 3:series) {
                xxs <- xx
                yys <- yy
                scale <- CGap/(seg + CGap) + (df[i, ] - df[2, ])/(df[1, 
                ] - df[2, ]) * seg/(seg + CGap)
                if (sum(!is.na(df[i, ])) < 3) {
                        cat(sprintf("[DATA NOT ENOUGH] at %d\n%g\n", i, 
                                    df[i, ]))
                }
                else {
                        for (j in 1:n) {
                                if (is.na(df[i, j])) {
                                        if (na.itp) {
                                                left <- ifelse(j > 1, j - 1, n)
                                                while (is.na(df[i, left])) {
                                                        left <- ifelse(left > 1, left - 1, n)
                                                }
                                                right <- ifelse(j < n, j + 1, 1)
                                                while (is.na(df[i, right])) {
                                                        right <- ifelse(right < n, right + 1, 
                                                                        1)
                                                }
                                                xxleft <- xx[left] * CGap/(seg + CGap) + 
                                                        xx[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                yyleft <- yy[left] * CGap/(seg + CGap) + 
                                                        yy[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                xxright <- xx[right] * CGap/(seg + CGap) + 
                                                        xx[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                yyright <- yy[right] * CGap/(seg + CGap) + 
                                                        yy[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                if (xxleft > xxright) {
                                                        xxtmp <- xxleft
                                                        yytmp <- yyleft
                                                        xxleft <- xxright
                                                        yyleft <- yyright
                                                        xxright <- xxtmp
                                                        yyright <- yytmp
                                                }
                                                xxs[j] <- xx[j] * (yyleft * xxright - yyright * 
                                                                           xxleft)/(yy[j] * (xxright - xxleft) - 
                                                                                            xx[j] * (yyright - yyleft))
                                                yys[j] <- (yy[j]/xx[j]) * xxs[j]
                                        }
                                        else {
                                                xxs[j] <- 0
                                                yys[j] <- 0
                                        }
                                }
                                else {
                                        xxs[j] <- xx[j] * CGap/(seg + CGap) + xx[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                        yys[j] <- yy[j] * CGap/(seg + CGap) + yy[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                }
                        }
                        if (is.null(pdensities)) {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], col = pfcols[i - 
                                                                                                                                          2])
                        }
                        else {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], density = pdensities[i - 
                                                                                                                                                  2], angle = pangles[i - 2], col = pfcols[i - 
                                                                                                                                                                                                   2])
                        }
                        points(xx * scale, yy * scale, pch = ptys[i - 2],
                               col = pcols[i - 2])
                }
        }
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # set default legend
        legend(x = .6, y = 1.2, legend = c("EU-15", country), bty = "n",
               pch = 20, col = c("#083D7F", "#EF6712") , text.col = "#333333", cex = 2, pt.cex = 6)
        
}


#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////


# country_profiles ####


# note the best workflow is to create plot_layout with patchwork, but mainly just to establish output size that will cover entire
# pdf page with out need for any resizing in word before converting to pdf (just horizontal/vertical centering)
# note the pdf page has wider margins than word doc, so in word the plot will look to be over edge of margins, but
# once print to pdf it will be within pdf page boundaries (setting word margins to zero didnt have any effect)
# then all plots/images/text are saved as png, and added with cowplot::draw_image/label
# cowplot gives more control than patchwork::inset_element, since inset_element only works on ggplot objects, not png
# also the coordinates for inset_elements are highly finicky based on adding/subtracting additional elements, requiring lots of tuning
# but cowplot draw_image coordinates stay fixed even when adding/subtracting other images - a huge time saver for adjustments

# to get wider/narrower png shape on page, use combo of aspect.ratio for relative height, but then also 
# adjust draw_image width/height (cropped as needed)
# note that the draw_image x/y coordinates can specify the center, left, or right of image, depending on hjust/vjust arg

# note that manually adding an image or shape to word output caused some kind of issue preventing the banner across top
# from spanning the entire pdf. but if no manual image/shapes are added to word, the banner print correctly to pdf spanning page

# notes on ggsave dpi
# https://largeprinting.com/resources/image-resolution-and-dpi.html
# main takeaway is 300 dpi is the standard for high resoltuion print graphics
# to confirm 300 dpi image on printed page, divide pixel count by 300 dpi, to get pixels/dots per inch
# ggsave has arguments for dpi and height width - the output pixel dimensions will be width * dpi
# so dpi = 300 and width = 6 yields an 1800 x 1800 image file, which can be displayed at 300 dpi on printed page if 6 inch or less
# "So, if you want to print an image that is 1024  768 (listed as Width=1024px, Height=768px on a PC), 
# you need to divide each value by 300 to see how many inches you can print at 300 dpi.
# 1024 / 300 = 3.4133 (width)
# 768 / 300 = 2.56 (height)
# So, you could print this 1024px  768px image at 300 DPI at a size of 3.4133  2.56 - 
# any bigger than this, and you risk the image becoming pixellated"

# note that getting rounded rectangle can be problematic in extreme cases because geom_shape has an aspect ratio limit for wide/narrow, 
# and element_rect_round has a weird outcome where it automatically fills the entire background when saved as png
# but the geom_shape aspect.ratio limit is not binding for this use case
# this is just an issue with geom_shape though, geom_rect supports any aspect.ratio
# widening ggsave width just widens the printed white box, but the plot itself still retains its same aspect ratio


#////////////////////////////////////////////////////////////////////////////////////////////////////


# create get_country_profile()
get_country_profile <- function(current_country) {
        
        print(current_country)
        
        # get current_country_full_name
        current_country_full_name <- case_when(current_country == "BiH" ~ "Bosnia and\nHerzegovina",
                                               current_country == "N. Macedonia" ~ "North\nMacedonia",
                                               current_country == "U.K." ~ "United\nKingdom",
                                               TRUE ~ current_country)
        
        
        #////////////////////////////////////////////////////////////////////////////////////////////////////
        #////////////////////////////////////////////////////////////////////////////////////////////////////
        #////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # create obj_radar_charts ####
        
        
        print(str_c(current_country, " radar chart"))
        
        # get eu_obj_avg 
        # note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
        eu_obj_avg <- fmir %>% filter(mcp_grouping == "EU-15", year == 2020) %>% 
                distinct(country, year, obj_num, obj_avg) %>%
                arrange(country, obj_num) %>% 
                group_by(obj_num, year) %>%
                mutate(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>%
                slice(1) %>% 
                ungroup() %>% select(-c(country, obj_avg)) 
        
        
        #//////////////////////
        
        
        # inspect
        # eu_obj_avg
        # eu_obj_avg %>% nrow() # 5
        # eu_obj_avg %>% ncol() # 3
        
        # test eu_obj_avg
        test_eu_obj_avg <- function() {
                
                # test obj_1
                expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_1", year == 2020) %>% pull(obj_avg_for_eu),
                             expected = fmir %>% filter(obj_num == "obj_1", year == 2020, mcp_grouping == "EU-15") %>% 
                                     distinct(country, year, obj_num, obj_avg) %>% 
                                     summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))  
                
                # test obj_2
                expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_2", year == 2020) %>% pull(obj_avg_for_eu),
                             expected = fmir %>% filter(obj_num == "obj_2", year == 2020, mcp_grouping == "EU-15") %>% 
                                     distinct(country, year, obj_num, obj_avg) %>% 
                                     summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
                
                # test obj_3
                expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_3", year == 2020) %>% pull(obj_avg_for_eu),
                             expected = fmir %>% filter(obj_num == "obj_3", year == 2020, mcp_grouping == "EU-15") %>% 
                                     distinct(country, year, obj_num, obj_avg) %>% 
                                     summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
                
                # test obj_4
                expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_1", year == 2020) %>% pull(obj_avg_for_eu),
                             expected = fmir %>% filter(obj_num == "obj_1", year == 2020, mcp_grouping == "EU-15") %>% 
                                     distinct(country, year, obj_num, obj_avg) %>% 
                                     summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        }
        test_eu_obj_avg()
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_radar_chart ####
        current_country_obj <- fmir %>% filter(country == current_country, year == 2020) %>% 
                distinct(country, year, obj_num, obj_avg) %>%
                arrange(obj_num) %>%
                select(obj_num, obj_avg) %>%
                pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)
        
        # current_country_obj
        
        # get chart_data
        chart_data <- tibble(obj_1 = c(1, 0), 
                             obj_2 = c(1, 0),
                             obj_3 = c(1, 0),
                             obj_4 = c(1, 0),
                             obj_c = c(1, 0)) %>%
                bind_rows(., eu_obj_avg %>% select(-year) %>% 
                                  pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
                bind_rows(., current_country_obj) %>%
                rename("Democratic" = obj_1, "Information   \n" = obj_2, "Energy" = obj_3, 
                       "Economic" = obj_4, "   Corruption\n" = obj_c)
        
        # chart_data
        
        
        #//////////////////////////
        
        
        # convert to a ggplot
        # grid.newpage()
        # get_country_profile_radar_chart(df = chart_data, country = current_country)
        # country_profile_radar_chart <- recordPlot()
        # country_profile_radar_chart <- as.ggplot(as_grob(country_profile_radar_chart))
        # country_profile_radar_chart
        
        # save ggplot as a png
        # ggsave(filename = str_c("output/charts/country_profile/country_profile_radar_chart_", str_to_lower(current_country), ".png"), 
        #        plot = country_profile_radar_chart, dpi = 300, width = 9, height = 9)
        
        png(filename = str_c("output/charts/country_profile/country_profile_radar_chart_", str_to_lower(current_country), ".png"),
            width = 12, height = 8, units = "in", res = 300)
        get_country_profile_radar_chart(df = chart_data, country = current_country)
        dev.off()
        
        # load png, crop, and resave as png
        # image_read(str_c("output/charts/country_profile/country_profile_radar_chart_",
        #                  str_to_lower(current_country), ".png")) %>% image_info() # w = 2100, h = 2100 (dpi * width)
        country_profile_radar_chart_png <- image_read(str_c("output/charts/country_profile/country_profile_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 2400, height = 1700, x_off = 700, y_off = 250)) 
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_dot_plots ####
        
        print(str_c(current_country, " dot_plots"))
        
        # get sub_obj_output_names tailored to fit on dot plots
        # tibble(fmir %>% distinct(sub_obj_short_name)) %>%
        #         mutate(sub_obj_dotplot_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ 
        #                                                         "Checks/balances\nand rule of law",
        #                                                 sub_obj_short_name == "Resilience to electoral/political interference and polarization" ~
        #                                                         "Electoral/political\ninterference",
        #                                                 sub_obj_short_name %in% 
        #                                                         c("Media professionalism", "Trusted media and information") ~ 
        #                                                         "Trusted media\nand information",
        #                                                 sub_obj_short_name == "Independence from Russian energy" ~ 
        #                                                         "Indepence from\nRussian energy",
        #                                                 sub_obj_short_name == "Energy regulation" ~ "Energy\nregulation",
        #                                                 sub_obj_short_name == "Economic competitiveness" ~ "Economic\ncompetitiveness",
        #                                                 sub_obj_short_name == "Control of corruption" ~ "Corruption",
        #                                                 TRUE ~ sub_obj_short_name)) %>%
        #         mutate(nchar = nchar(sub_obj_short_name)) %>%
        #         ggplot(data = ., mapping = aes(x = sub_obj_dotplot_name, y = nchar)) +
        #         geom_col() + coord_flip() + 
        #         theme(
        #                 axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
        #                                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
        #         )
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_dot_plot_legend ####
        
        current_sub_obj_num <- "sub_obj_1_1"
        current_sub_obj_short_name <- fmir %>% filter(sub_obj_num == current_sub_obj_num) %>% distinct(sub_obj_short_name) %>%
                mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~
                                                              "Checks and balances\nand rule of law",
                                                      TRUE ~ sub_obj_short_name)) %>% pull(sub_obj_short_name)
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ str_c(country, "    "),
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                            "CARs", "EU-15") ~ str_c(mcp_grouping, "    "),
                                             TRUE ~ "Other countries    "),
                       dot_label_plot_order = case_when(dot_label == "Other countries    " ~ 1,
                                                        dot_label == "EU-15    " ~ 2,
                                                        dot_label == "CARs    " ~ 3,
                                                        dot_label == "E&E graduates    " ~ 4,
                                                        dot_label == "E&E Eurasia    " ~ 5,
                                                        dot_label == "E&E Balkans    " ~ 6,
                                                        dot_label == str_c(current_country, "    ") ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == str_c(current_country, "    ") ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans    " ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia    " ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates    " ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs    " ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15    " ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other countries    " ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(
                               TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other countries    " ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other countries    " ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == str_c(current_country, "    ") ~ 1,
                                         color_bin == "E&E Balkans    " ~ 2,
                                         color_bin == "E&E Eurasia    " ~ 3,
                                         color_bin == "E&E graduates    " ~ 4,
                                         color_bin == "CARs    " ~ 5,
                                         color_bin == "EU-15    " ~ 6,
                                         color_bin == "Other countries    " ~ 7)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == str_c(current_country, "    ") ~ 1,
                                         color_bin == "E&E Balkans    " ~ 2,
                                         color_bin == "E&E Eurasia    " ~ 3,
                                         color_bin == "E&E graduates    " ~ 4,
                                         color_bin == "CARs    " ~ 5,
                                         color_bin == "EU-15    " ~ 6,
                                         color_bin == "Other countries    " ~ 7)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                mutate(level = case_when(color_bin == str_c(current_country, "    ") ~ 1,
                                         color_bin == "E&E Balkans    " ~ 2,
                                         color_bin == "E&E Eurasia    " ~ 3,
                                         color_bin == "E&E graduates    " ~ 4,
                                         color_bin == "CARs    " ~ 5,
                                         color_bin == "EU-15    " ~ 6,
                                         color_bin == "Other countries    " ~ 7)) %>%
                arrange(level) %>%
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                mutate(level = case_when(color_bin == str_c(current_country, "    ") ~ 1,
                                         color_bin == "E&E Balkans    " ~ 2,
                                         color_bin == "E&E Eurasia    " ~ 3,
                                         color_bin == "E&E graduates    " ~ 4,
                                         color_bin == "CARs    " ~ 5,
                                         color_bin == "EU-15    " ~ 6,
                                         color_bin == "Other countries    " ~ 7)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        country_profile_dot_plot_legend <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, 
                                   name = "",
                                   labels = names(chart_data_color_list)) +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
                labs(x = NULL, y = current_sub_obj_short_name, 
                     caption = NULL, color = "test", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke)) +
                scale_shape_manual(values = chart_data_shape_list, 
                                   name = "",
                                   labels = names(chart_data_shape_list)) +
                # scale_size_continuous(range = c(1, 3), guide = "none") +
                scale_size_continuous(range = c(4, 6), guide = "none") +
                coord_fixed(ratio = 1 / 15, clip = "off") +
                theme_bw() +
                theme(
                        # plot.background = element_rect(fill = "blue"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_line(size = .5, color = "#DDDDDD"),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 0)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 8, family = "Calibri", face = "bold", color = "#083D7F"),
                        # legend.title = element_blank(),
                        legend.text = element_text(size = 8.5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) +
                guides(color = guide_legend(nrow = 2, byrow = TRUE, 
                                            label.hjust = 0,
                                            color = "#333333", 
                                            keywidth = .5,
                                            override.aes = list(size = 5)
                )
                # linetype = guide_legend(keywidth = 1)
                )
        
        # inspect
        # country_profile_dot_plot_legend
        
        
        #/////////////////////
        
        
        # extract legend
        country_profile_dot_plot_legend <- as_ggplot(get_legend(country_profile_dot_plot_legend))
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/country_profile_dot_plot_legend.png"), 
               plot = country_profile_dot_plot_legend, 
               dpi = 600, height = 6, width = 6)
        
        # crop png
        # image_read("output/charts/country_profile/country_profile_dot_plot_legend.png") %>% image_info()
        country_profile_dot_plot_legend_png <- image_read("output/charts/country_profile/country_profile_dot_plot_legend.png") %>%
                # image_crop(image = ., geometry = geometry_area(width = 1150, height = 176, x_off = 315, y_off = 812))
                image_crop(image = ., geometry = geometry_area(width = 2500, height = 400, x_off = 550, y_off = 1600))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # miri_country_profile_dot_plot ####
        name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, miri_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018),
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, 
                                           miri_avg, avg_miri_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, miri_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(miri_avg = avg_miri_avg) %>%
                                  distinct(country, mcp_grouping, year,  
                                           miri_avg) %>%
                                  select(country, mcp_grouping, year, miri_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       miri_avg = case_when(y_axis_order == 2 ~ miri_avg,
                                            TRUE ~ NA_real_),
                       var = mcp_grouping, values = miri_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        miri_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                        # margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # miri_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/miri_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = miri_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/miri_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        miri_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/miri_country_profile_dot_plot_", 
                                                              str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # obj_1_country_profile_dot_plot ####
        current_obj_num <- "obj_1"
        obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, obj_short_name, obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, 
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg, avg_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(obj_avg = avg_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg) %>%
                                  select(country, mcp_grouping, year, obj_short_name, obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       obj_avg = case_when(y_axis_order == 2 ~ obj_avg,
                                           TRUE ~ NA_real_),
                       var = mcp_grouping, values = obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        obj_1_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                        # margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # obj_1_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/obj_1_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = obj_1_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/obj_1_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        obj_1_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/obj_1_country_profile_dot_plot_", 
                                                               str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # obj_2_country_profile_dot_plot ####
        current_obj_num <- "obj_2"
        obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, obj_short_name, obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, 
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg, avg_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(obj_avg = avg_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg) %>%
                                  select(country, mcp_grouping, year, obj_short_name, obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       obj_avg = case_when(y_axis_order == 2 ~ obj_avg,
                                           TRUE ~ NA_real_),
                       var = mcp_grouping, values = obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        obj_2_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # obj_2_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/obj_2_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = obj_2_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/obj_2_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        obj_2_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/obj_2_country_profile_dot_plot_", 
                                                               str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # obj_3_country_profile_dot_plot ####
        current_obj_num <- "obj_3"
        obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, obj_short_name, obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, 
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg, avg_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(obj_avg = avg_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg) %>%
                                  select(country, mcp_grouping, year, obj_short_name, obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       obj_avg = case_when(y_axis_order == 2 ~ obj_avg,
                                           TRUE ~ NA_real_),
                       var = mcp_grouping, values = obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        obj_3_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # obj_3_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/obj_3_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = obj_3_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/obj_3_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        obj_3_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/obj_3_country_profile_dot_plot_", 
                                                               str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # obj_4_country_profile_dot_plot ####
        current_obj_num <- "obj_4"
        obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, obj_short_name, obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, 
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg, avg_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(obj_avg = avg_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg) %>%
                                  select(country, mcp_grouping, year, obj_short_name, obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       obj_avg = case_when(y_axis_order == 2 ~ obj_avg,
                                           TRUE ~ NA_real_),
                       var = mcp_grouping, values = obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        obj_4_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # obj_4_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/obj_4_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = obj_4_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/obj_4_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        obj_4_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/obj_4_country_profile_dot_plot_", 
                                                               str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # obj_c_country_profile_dot_plot ####
        current_obj_num <- "obj_c"
        obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, obj_short_name, obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), obj_num == current_obj_num, 
                                             !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg, avg_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(obj_avg = avg_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, obj_short_name, 
                                           obj_avg) %>%
                                  select(country, mcp_grouping, year, obj_short_name, obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       obj_avg = case_when(y_axis_order == 2 ~ obj_avg,
                                           TRUE ~ NA_real_),
                       var = mcp_grouping, values = obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        obj_c_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # obj_c_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/obj_c_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = obj_c_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/obj_c_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        obj_c_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/obj_c_country_profile_dot_plot_", 
                                                               str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_1_1_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_1_1"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_1_1_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                        # margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_1_1_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_1_1_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_1_1_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_1_1_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_1_1_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_1_1_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_1_2_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_1_2"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_1_2_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_1_2_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_1_2_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_1_2_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_1_2_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_1_2_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_1_2_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_1_3_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_1_3"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_1_3_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_1_3_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_1_3_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_1_3_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_1_3_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_1_3_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_1_3_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_2_1_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_2_1"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_2_1_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                        # margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_2_1_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_2_1_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_2_1_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_2_1_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_2_1_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_2_1_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_2_2_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_2_2"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_2_2_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_2_2_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_2_2_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_2_2_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_2_2_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_2_2_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_2_2_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_2_3_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_2_3"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_2_3_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_2_3_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_2_3_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_2_3_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_2_3_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_2_3_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_2_3_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_3_1_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_3_1"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_3_1_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                        # margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_3_1_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_3_1_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_3_1_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_3_1_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_3_1_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_3_1_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_3_2_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_3_2"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_3_2_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_3_2_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_3_2_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_3_2_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_3_2_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_3_2_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_3_2_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_3_3_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_3_3"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_3_3_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_3_3_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_3_3_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_3_3_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_3_3_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_3_3_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_3_3_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_4_1_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_4_1"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_4_1_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#DDDDDD", size = 2.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(0, 0, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_blank(),
                        # axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_blank(),
                        # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                        #                            margin = margin(t = 10, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_4_1_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_4_1_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_4_1_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_4_1_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_4_1_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_4_1_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 153, x_off = 0, y_off = 825))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_4_2_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_4_2"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_4_2_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_4_2_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_4_2_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_4_2_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_4_2_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_4_2_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_4_2_country_profile_dot_plot_", 
                                                                     str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # sub_obj_c_country_profile_dot_plot ####
        current_sub_obj_num <- "sub_obj_c"
        sub_obj_short_name_placeholder <- str_c(rep(x = " ", times = 32), collapse = "")
        
        
        # get chart_data
        chart_data <- fmir %>% 
                filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>% 
                select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>% distinct() %>%
                bind_rows(., fmir %>% filter(year %in% c(2020, 2019, 2018), sub_obj_num == current_sub_obj_num, !(country %in% c("Russia", "U.S."))) %>%
                                  group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
                                  ungroup() %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg, avg_sub_obj_avg) %>%
                                  arrange(mcp_grouping) %>%
                                  select(-c(country, sub_obj_avg)) %>% 
                                  mutate(country = mcp_grouping) %>%
                                  rename(sub_obj_avg = avg_sub_obj_avg) %>%
                                  distinct(country, mcp_grouping, year, sub_obj_short_name, 
                                           sub_obj_avg) %>%
                                  select(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg)) %>%
                mutate(y_axis_order = case_when(year == 2018 ~ 1, 
                                                year == 2020 ~ 2,
                                                year == 2019 ~ 3),
                       sub_obj_avg = case_when(y_axis_order == 2 ~ sub_obj_avg,
                                                        TRUE ~ NA_real_),
                       var = mcp_grouping, values = sub_obj_avg,
                       dot_label = case_when(country == current_country ~ country,
                                             country %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15") ~ mcp_grouping,
                                             TRUE ~ "Other"),
                       dot_label_plot_order = case_when(dot_label == "Other" ~ 1,
                                                        dot_label == "EU-15" ~ 2,
                                                        dot_label == "CARs" ~ 3,
                                                        dot_label == "E&E graduates" ~ 4,
                                                        dot_label == "E&E Eurasia" ~ 5,
                                                        dot_label == "E&E Balkans" ~ 6,
                                                        dot_label == current_country ~ 7)) %>%
                arrange(dot_label_plot_order) %>%
                mutate(color_bin = dot_label,
                       color = case_when(color_bin == current_country ~ color_palette %>% slice(11) %>% pull(hex),
                                         color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "CARs" ~ color_palette %>% slice(5) %>% pull(hex),
                                         # color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                         # color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                                         color_bin == "Other" ~ color_palette %>% slice(4) %>% pull(hex)),
                       point_size = case_when(color_bin == "Other" ~ 2,
                                              TRUE ~ 3),
                       point_shape = case_when(color_bin == "Other" ~ 1,
                                               TRUE ~ 19),
                       point_stroke = case_when(color_bin == "Other" ~ 1,
                                                TRUE ~ 1))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color)
        
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
                mutate(level = case_when(color_bin == current_country ~ 1,
                                         color_bin == "E&E Balkans" ~ 2,
                                         color_bin == "E&E Eurasia" ~ 3,
                                         color_bin == "E&E graduates" ~ 4,
                                         color_bin == "CARs" ~ 5,
                                         color_bin == "EU-15" ~ 6)) %>%
                arrange(level) %>%
                pull(color_bin)
        
        # inspect
        # chart_data_color_list
        
        
        # create chart_data_shape_list for to pass to scale_shape_manual
        chart_data_shape_list <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(point_shape)
        
        names(chart_data_shape_list) <- chart_data %>% count(color_bin, point_shape) %>% 
                pull(color_bin)
        
        # inspect
        # chart_data_shape_list
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        sub_obj_c_country_profile_dot_plot <- chart_data %>% 
                ggplot(data = ., mapping = aes(x = values, y = y_axis_order, 
                                               color = color_bin, shape = color_bin)) + 
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = NULL, limits = c(1, 3), expand = c(0, 0),
                                   labels = number_format(accuracy = 1)) +
                scale_x_continuous(breaks = seq(from = 0, to = 1, by = .1), limits = c(-.02, 1.02)) +
                labs(x = NULL, y = sub_obj_short_name_placeholder, 
                     caption = NULL, color = "", linetype = "") +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = -.02,
                #                            y = 1, yend = 3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = -.02, xend = 1.02,
                                           y = 1, yend = 1), color = "#333333", size = 1.5) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = -.02, xend = 1,
                #                            y = 3., yend = 3), color = "#DDDDDD", size = .25) +
                geom_point(mapping = aes(size = point_size, stroke = point_stroke), show.legend = FALSE) +
                scale_shape_manual(values = chart_data_shape_list) +
                scale_size_continuous(range = c(4, 6)) +
                # coord_fixed(ratio = 1 / 20, clip = "off") +
                theme_bw() +
                theme(
                        aspect.ratio = 1 / 10,
                        # plot.background = element_rect(fill = "#E0ECF7"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        # plot.background = element_rect(fill = "transparent", color = NA),
                        # plot.background = element_blank(),
                        # plot.margin = unit(c(0, -8, 0, 0), "mm"),
                        plot.margin = unit(c(2, 0, 2, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        # panel.background = element_rect(fill = "transparent"), 
                        panel.background = element_blank(),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        # axis.ticks.x = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        # axis.text.x = element_blank(),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 2, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                   margin = margin(t = 0, r = -20, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", angle = 0,
                                                    vjust = .5, margin = margin(t = 0, r = 0, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Gill Sans", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        
        # sub_obj_c_country_profile_dot_plot
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/sub_obj_c_country_profile_dot_plot_", 
                            str_to_lower(current_country), ".png"), plot = sub_obj_c_country_profile_dot_plot, 
               dpi = 300, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/sub_obj_c_country_profile_dot_plot_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        sub_obj_c_country_profile_dot_plot_png <- image_read(str_c("output/charts/country_profile/sub_obj_c_country_profile_dot_plot_", 
                                                                   str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 200, x_off = 0, y_off = 810))
        
        
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # create rect_background ####
        
        print(str_c(current_country, " blue_rect_background"))
        
        # inspect colors
        # brewer.blues(10) %>% show_col() # obj_dot_plots "#E0ECF7", 
        # ri_dot_plot "#002F6C" is usaid blue: # https://www.usaid.gov/sites/default/files/documents/1869/USAID_GSM-02_04_2020.pdf
        # brewer.greys(10) %>% show_col() # "#DEDEDE"
        # color_palette %>% pull(hex) %>% show_col() # "#CBCBCB" is too light
        
        
        #//////////////////////////////
        
        
        # top/bottom margin are height of magnifying glass
        one_row_blue_rect_background <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), fill = "#E0ECF7") +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 5.3) 
        
        # one_row_blue_rect_background
        ggsave(filename = "output/charts/country_profile/one_row_blue_rect_background.png", 
               plot = one_row_blue_rect_background, dpi = 300, width = 6, height = 6)
        one_row_blue_rect_background_png <- image_read(path = "output/charts/country_profile/one_row_blue_rect_background.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 346, x_off = 0, y_off = 727))
        
        
        #//////////////////////////////
        
        
        # top/bottom margin are height of magnifying glass
        two_row_blue_rect_background <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), fill = "#E0ECF7") +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 3.8)
        
        # two_row_blue_rect_background
        ggsave(filename = "output/charts/country_profile/two_row_blue_rect_background.png", 
               plot = two_row_blue_rect_background, dpi = 300, width = 6, height = 6)
        two_row_blue_rect_background_png <- image_read(path = "output/charts/country_profile/two_row_blue_rect_background.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 466, x_off = 0, y_off = 667))
        
        
        #/////////////////////
        
        
        # top/bottom margin are height of magnifying glass
        three_row_blue_rect_background <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), fill = "#E0ECF7") +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 2.95)
        
        # three_row_blue_rect_background
        ggsave(filename = "output/charts/country_profile/three_row_blue_rect_background.png", 
               plot = three_row_blue_rect_background, dpi = 300, width = 6, height = 6)
        three_row_blue_rect_background_png <- image_read(path = "output/charts/country_profile/three_row_blue_rect_background.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 590, x_off = 0, y_off = 605)) 
        
        
        #/////////////////////
        
        
        # top/bottom margin are height of magnifying glass
        six_row_blue_rect_background <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), fill = "#1B69AF") +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 1.75)
        
        # six_row_blue_rect_background
        ggsave(filename = "output/charts/country_profile/six_row_blue_rect_background.png", 
               plot = six_row_blue_rect_background, dpi = 300, width = 6, height = 6)
        six_row_blue_rect_background_png <- image_read(path = "output/charts/country_profile/six_row_blue_rect_background.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 1000, x_off = 0, y_off = 400))
        
        
        #////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        legend_gray_rect_background <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), fill = "#DEDEDE") +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 4.3) 
        
        # legend_gray_rect_background
        ggsave(filename = "output/charts/country_profile/legend_gray_rect_background.png", 
               plot = legend_gray_rect_background, dpi = 300, width = 6, height = 6)
        legend_gray_rect_background_png <- image_read(path = "output/charts/country_profile/legend_gray_rect_background.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 420, x_off = 0, y_off = 690))
        
        
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # get gray_border ####
        
        line_chart_gray_border <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_shape(radius = unit(.5, 'cm'), color = "#CBCBCB", size = .5, fill = NA) +
                scale_x_continuous(limits = c(0, 2)) +
                scale_y_continuous(limits = c(0, 2)) +
                theme_nothing() +
                theme(aspect.ratio = 1 / 2.2) 
        line_chart_gray_border
        
        
        ggsave(filename = "output/charts/country_profile/line_chart_gray_border.png", 
               plot = line_chart_gray_border, dpi = 300, width = 6, height = 6)
        line_chart_gray_border_png <- image_read(path = "output/charts/country_profile/line_chart_gray_border.png") %>%
                # image_crop(image = ., geometry = geometry_area(width = 1700, height = 1150, x_off = 50, y_off = 325))
                image_crop(image = ., geometry = geometry_area(width = 1700, height = 800, x_off = 50, y_off = 500))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_line_chart ####
        
        print(str_c(current_country, " line_chart"))
        
        # plot
        # fmir %>% 
        #         filter(country == current_country) %>%
        #         mutate(values = obj_avg) %>%
        #         distinct(country, mcp_grouping, year, obj_num, values) %>%
        #         bind_rows(., fmir %>% 
        #                           filter(country == current_country) %>%
        #                           distinct(country, mcp_grouping, year, miri_avg) %>%
        #                           mutate(obj_num = "miri",
        #                                  values = miri_avg) %>%
        #                           select(obj_num, country, year, mcp_grouping, values)) %>%
        #         ggplot(data = ., mapping = aes(x = year, y = values, color = obj_num)) + geom_line()
        
        
        #//////////////////
        
        
        # add color_bin and color
        chart_data <- fmir %>% 
                filter(country == current_country) %>%
                mutate(values = obj_avg) %>%
                distinct(country, mcp_grouping, year, obj_num, values) %>%
                bind_rows(., fmir %>% 
                                  filter(country == current_country) %>%
                                  distinct(country, mcp_grouping, year, miri_avg) %>%
                                  mutate(obj_num = "miri",
                                         values = miri_avg) %>%
                                  select(obj_num, country, year, mcp_grouping, values)) %>%
                arrange(desc(obj_num)) %>%
                mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                             obj_num == "obj_2" ~ "Information",
                                             obj_num == "obj_3" ~ "Energy",
                                             obj_num == "obj_4" ~ "Economic",
                                             obj_num == "obj_c" ~ "Corruption",
                                             obj_num == "miri" ~ "Resilience Index"),
                       color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                         color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                         color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                         color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                         color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                         color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
                       linetype_bin = color_bin,
                       linetype = case_when(TRUE ~ "solid"))
        
        # create color_list for to pass to scale_color_manual
        chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
        names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
        chart_data_color_list
        
        # create linetype_list for to pass to scale_linetype_manual
        chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
        names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
        chart_data_linetype_list
        
        
        #/////////////////////
        
        
        # get label_position
        chart_data <- chart_data %>% arrange(country, year, values) %>% 
                group_by(country, year) %>%
                mutate(label_position = values,
                       dist_to_lower = label_position - lag(label_position, n = 1),
                       dist_to_higher = lead(label_position, n = 1) - label_position,
                       overlap_flag = case_when(dist_to_lower <= .04 ~ 1,
                                                TRUE ~ 0)) %>%
                ungroup()
        
        # inspect
        # chart_data
        
        # set counter
        counter <- 0
        
        # run loop to update label_position
        while((chart_data %>% mutate(sum_overlap_flag = sum(overlap_flag)) %>% slice(1) %>% pull(sum_overlap_flag)) != 0) {
                
                counter <- counter + 1
                # print(counter + 1)
                
                chart_data <- chart_data %>% arrange(country, year, values) %>% 
                        group_by(country, year) %>%
                        mutate(label_position = case_when(is.na(dist_to_lower) | dist_to_lower >= .05 ~ label_position,
                                                          TRUE ~ label_position + (.05 - dist_to_lower)),
                               dist_to_higher = lead(label_position, n = 1) - label_position,
                               dist_to_lower = label_position - lag(label_position, n = 1),
                               overlap_flag = case_when(dist_to_lower <= .04 ~ 1,
                                                        TRUE ~ 0)) %>%
                        ungroup()
        }
        
        # inspect
        # chart_data
        
        
        #/////////////////////
        
        
        # create chart
        country_profile_line_chart <- chart_data %>%
                ggplot(data = ., aes(x = year, 
                                     y = values, 
                                     color = color_bin,
                                     linetype = color_bin)) + 
                # geom_line(size = 1) +
                # geom_point(size = 2) +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
                          mapping = aes(x = year + .35, y = label_position, label = color_bin),
                          fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
                scale_color_manual(values = chart_data_color_list, guide = "none") +
                scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
                scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                                   labels = number_format(accuracy = .01)) +
                scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
                labs(x = NULL, y = "Score (higher is better)", 
                     caption = NULL, color = "", linetype = "") +
                coord_fixed(ratio = 6 / 1, clip = "off") +
                # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .75) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .75) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .75) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .75) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .75) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 0, yend = 0), color = "#333333", size = .75) +
                geom_line(size = 1.5) + 
                # geom_point(size = 2) +
                # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
                theme_bw() +
                theme(
                        # plot.background = element_rect(fill = "blue"),
                        # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                        plot.margin = unit(c(0, 25, 0, 0), "mm"),
                        plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                    color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                        # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                        panel.grid.minor = element_blank(),
                        panel.grid.major.x = element_blank(),
                        # panel.grid.major.y = element_line(color = "#DDDDDD"),
                        panel.grid.major.y = element_blank(),
                        panel.border = element_blank(),
                        # panel.border = element_rect(color = "#DDDDDD", size = .5),
                        # panel.grid = element_blank(),
                        # line = element_blank(),
                        # rect = element_blank(),
                        axis.ticks.y = element_blank(),
                        axis.ticks.x = element_line(size = .5),
                        # axis.ticks.length.y.left = unit(.2, "cm"),
                        axis.ticks.length.x.bottom = unit(.1, "cm"),
                        axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                   margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                        axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                   margin = margin(t = 0, r = 0, b = 0, l = 0)),
                        # axis.line.x.bottom = element_line(color = "#333333"),
                        axis.line.x.bottom = element_blank(),
                        axis.line.y.left = element_blank(),
                        axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                                    margin = margin(t = 13, r = 0, b = 5, l = 0)),
                        axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                                    margin = margin(t = 0, r = 10, b = 0, l = 5)),
                        # axis.title.y = element_blank(),
                        # axis.text.y = element_blank(),
                        plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                                  margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                        legend.position = "bottom",
                        # legend.key.size = unit(2, "mm"), 
                        legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                        legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                                   hjust = .5, color = "#333333")
                        # legend.spacing.y = unit(5.5, "cm"),
                        # legend.key = element_rect(size = 5),
                        # legend.key.size = unit(2, 'lines')
                ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #        linetype = guide_legend(keywidth = 4))
        
        # inspect
        # country_profile_line_chart
        
        
        #///////////////////////
        
        
        # save plot as png
        ggsave(file = str_c("output/charts/country_profile/country_profile_line_chart_", 
                            str_to_lower(current_country), ".png"), plot = country_profile_line_chart, 
               dpi = 400, height = 6, width = 6)
        
        # crop png
        # image_read(str_c("output/charts/country_profile/country_profile_line_chart_", 
        #                  str_to_lower(current_country), ".png")) %>% image_info()
        country_profile_line_chart_png <- image_read(str_c("output/charts/country_profile/country_profile_line_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
                image_crop(image = ., geometry = geometry_area(width = 2350, height = 1050, x_off = 0, y_off = 650))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_map ####
        
        print(str_c(current_country, " map"))
        
        # https://wilkelab.org/practicalgg/articles/Winkel_tripel.html
        # note that getMap uses natural earth for country boundaries, but fixes several issues, so better to pull from rworldmap
        # (see rworldmap docs: https://cran.r-project.org/web/packages/rworldmap/rworldmap.pdf)
        # ?countriesCoarse
        # ?countriesCoarseLessIslands
        
        # another option is rnaturalearth package: https://docs.ropensci.org/rnaturalearth/
        
        
        # get world map as sf object
        world_sf <- st_as_sf(getMap(resolution = "high"))
        # world_sf
        # world_sf %>% glimpse()
        # world_sf %>% class()
        # world_sf %>% nrow() # 253
        # st_crs(world_sf)
        
        # note when I pull SOVEREIGNT out as a character in a tibble, it's only 202 countries; 
        # there is 253 rows though, and 253 distinct SOVEREIGNT - but some are duplicates, 
        # the duplicates appear to be countries with non-contiguous boundaries (aka mainlands and islands)
        # since world_sf is an sf object, calling distinct(SOVEREIGNT) kind of always implicitly includes the geometry variable
        # and since these non-contiguous countries have multiple geometries, distinct() returns those multiple rows
        # world_sf %>% nrow() # 253
        # world_sf %>% as_tibble() %>% distinct(SOVEREIGNT) %>% nrow() # 204
        
        # check country names
        # fmir %>% distinct(country) %>% filter(!(country %in% c("U.S.", "Russia"))) %>%
        #         anti_join(., world_sf %>% 
        #                           mutate(SOVEREIGNT = as.character(SOVEREIGNT),
        #                                   SOVEREIGNT = case_when(SOVEREIGNT == "Czech Republic" ~ "Czechia",
        #                                                         SOVEREIGNT == "Macedonia" ~ "N. Macedonia",
        #                                                         SOVEREIGNT == "Republic of Serbia" ~ "Serbia",
        #                                                         SOVEREIGNT == "United Kingdom" ~ "U.K.",
        #                                                         SOVEREIGNT == "Bosnia and Herzegovina" ~ "BiH",
        #                                                         TRUE ~ SOVEREIGNT)) %>%
        #                           as_tibble() %>% distinct(SOVEREIGNT), 
        #                   by = c("country" = "SOVEREIGNT"))
        # 
        # world_sf %>% as_tibble() %>% distinct(SOVEREIGNT) %>%
        #         filter(str_detect(string = SOVEREIGNT, pattern = "Bosnia"))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # plot
        country_profile_map <- world_sf %>% 
                mutate(SOVEREIGNT = as.character(SOVEREIGNT),
                       SOVEREIGNT = case_when(SOVEREIGNT == "Czech Republic" ~ "Czechia",
                                              SOVEREIGNT == "Macedonia" ~ "N. Macedonia",
                                              SOVEREIGNT == "Republic of Serbia" ~ "Serbia",
                                              SOVEREIGNT == "United Kingdom" ~ "U.K.",
                                              SOVEREIGNT == "Bosnia and Herzegovina" ~ "BiH",
                                              TRUE ~ SOVEREIGNT),
                       fill_color_bin = "selected_color") %>%
                filter(SOVEREIGNT != "Antarctica") %>%
                filter(SOVEREIGNT == current_country) %>%
                ggplot(data = ., mapping = aes(fill = factor(fill_color_bin))) + 
                geom_sf(color = "#E0ECF7", size = 0.1) +
                scale_fill_manual(values = list("selected_color" = "#E0ECF7"), guide = "none") +
                theme_bw() +
                theme(panel.grid.major = element_line(color = "transparent"),
                      plot.background = element_blank(), 
                      panel.grid.minor = element_blank(), panel.border = element_blank(),
                      axis.ticks.y = element_blank(), axis.text.y = element_blank(), axis.title.y = element_blank(),
                      axis.ticks.x = element_blank(), axis.text.x = element_blank(), axis.title.x = element_blank(),
                      # plot.title = element_text(size = 6, face = "bold", hjust = 0, family = "Trebuchet MS"), 
                      plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                                  color = "#000000", margin = margin(t = 0, r = 0, b = 0, l = 0)),
                      legend.position = "right",
                      legend.key.size = unit(2, "mm"),
                      legend.text = element_text(size = 12, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")), 
                      legend.title = element_text(size = 12, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                      panel.grid = element_blank(),
                      line = element_blank(),
                      rect = element_blank(),
                      text = element_blank())
        
        # inspect
        # country_profile_map
        
        ggsave(filename = str_c("output/charts/country_profile/map_", str_to_lower(current_country), ".png"), 
               plot = country_profile_map, 
               dpi = 300, width = 6, height = 6)
        
        # crop
        # image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), ".png")) %>% image_info() # w = 1800, h = 1800 (dpi * width)
        
        if(current_country == "Albania") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 800, height = 1700, x_off = 500, y_off = 50))
                
        } else if(current_country == "Azerbaijan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1300, x_off = 50, y_off = 250))
                
        } else if(current_country == "Belarus") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1500, x_off = 50, y_off = 150))
                
        } else if(current_country == "Bulgaria") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Czechia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1000, x_off = 50, y_off = 400))
                
        } else if(current_country == "Estonia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Georgia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 900, x_off = 50, y_off = 450))
                
        } else if(current_country == "Hungary") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1100, x_off = 50, y_off = 350))
                
        } else if(current_country == "Kazakhstan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1000, x_off = 50, y_off = 400))
                
        } else if(current_country == "Kyrgyzstan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 800, x_off = 50, y_off = 500))
                
        } else if(current_country == "Latvia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1100, x_off = 50, y_off = 350))
                
        } else if(current_country == "Lithuania") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1300, x_off = 50, y_off = 250))
                
        } else if(current_country == "N. Macedonia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1300, x_off = 50, y_off = 250))
                
        } else if(current_country == "Moldova") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1300, height = 1700, x_off = 250, y_off = 50))
                
        } else if(current_country == "Montenegro") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1500, height = 1700, x_off = 150, y_off = 50))
                
        } else if(current_country == "Poland") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1600, x_off = 50, y_off = 75))
                
        } else if(current_country == "Romania") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Serbia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1300, height = 1700, x_off = 250, y_off = 50))
                
        } else if(current_country == "Slovakia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 900, x_off = 50, y_off = 450))
                
        } else if(current_country == "Slovenia") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1100, x_off = 50, y_off = 350))
                
        } else if(current_country == "Tajikistan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Turkmenistan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Ukraine") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else if(current_country == "Uzbekistan") {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country), 
                                                            ".png")) %>%
                        image_crop(image = ., geometry = geometry_area(width = 1700, height = 1200, x_off = 50, y_off = 300))
                
        } else {
                
                country_profile_map_png <- image_read(str_c("output/charts/country_profile/map_", str_to_lower(current_country),
                                                            ".png"))
                
        }
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_title ####
        
        # p1 <- ggplot(mtcars) + 
        #         geom_point(aes(mpg, disp))
        # ggdraw(p1) +
        #         draw_label(label = current_country_full_name, color = "#002F6C", size = 20, angle = 0,
        #                    fontface = "bold", fontfamily = "Calibri",
        #                    x = .5, y = .5) +
        #         draw_label(label = "Resilience Index: FY 2020 Country Profile", color = "#002F6C", size = 15, angle = 0,
        #                    fontface = "plain", fontfamily = "Calibri",
        #                    x = .79, y = .42) 
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_flag ####
        
        print(str_c(current_country, " flag"))
        
        # best source is britannica which has high-quality pngs cropped to proper dimensions
        # https://www.britannica.com/topic/flag-of-Bosnia-and-Herzegovina
        
        # unused official state dept. flags have correct dimensions, but they require manual cropping based on wikipedia dimensions
        # https://www.state.gov/countries-areas/
        # https://en.wikipedia.org/wiki/List_of_aspect_ratios_of_national_flags
        
        # unused open source flag svgs (does not always have correct dimensions however)
        # https://flagicons.lipis.dev/
        
        # image_read(str_c("output/charts/flags/", current_country, ".png")) %>% image_info()
        country_profile_flag_png <- image_read(str_c("output/charts/flags/", current_country, ".png"))
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_usaid_logo ####
        
        print(str_c(current_country, " logo"))
        
        # https://www.usaid.gov/branding/resources # best source w white logo
        # https://www.usaid.gov/sites/default/files/documents/1869/USAID_GSM-02_04_2020.pdf
        # usaid blue: #002F6C
        
        # extra un-used sources
        # https://cloudconvert.com/ai-to-svg
        # https://seekvectorlogo.net/download-vector-logo-3901/#
        # https://stephanieevergreen.com/events/uganda/1200px-usaid-logo-svg/
        
        # read usaid white logo as png, convert to resized ggplot w blue background, resave as png
        # note that there was no discernable difference in 300 vs 600 dpi image; pdf file size increased by 200 kb, will go w 300 dpi
        usaid_png <- image_read(path = "output/charts/usaid_logo/Horizontal_RGB_294_White.png")
        usaid_logo <- ggplot() + background_image(usaid_png) + 
                coord_fixed(1 / 2.5) +
                theme_nothing() +
                theme(
                        # panel.background = element_rect(fill = "transparent"),
                        # plot.background = element_rect(fill = "transparent", color = NA)
                        panel.background = element_rect(fill = "#002F6C"),
                        plot.background = element_rect(fill = "#002F6C"),
                        rect = element_rect(fill = "#002F6C")
                )
        ggsave(filename = "output/charts/usaid_logo/usaid_logo_white_resized.png", plot = usaid_logo, dpi = 300, width = 6, height = 6)
        # ggsave(filename = "output/charts/usaid_logo/usaid_logo_white_resized.png", plot = usaid_logo, dpi = 600, width = 6, height = 6)
        
        # crop
        # image_read("output/charts/usaid_logo/usaid_logo_white_resized.png") %>% image_info() # w = 1800, h = 1800 (dpi * width)
        country_profile_usaid_logo_png <- image_read("output/charts/usaid_logo/usaid_logo_white_resized.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1600, height = 600, x_off = 100, y_off = 600)) # crop 300 dpi
        # image_crop(image = ., geometry = geometry_area(width = 3200, height = 1100, x_off = 200, y_off = 1200)) # crop 600 dpi
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # create country_profile_blue_banner ####
        
        print(str_c(current_country, " blue_banner"))
        
        country_profile_blue_banner <- tibble(x = c(0, 0, 2, 2), y = c(0, 2, 2, 0)) %>%
                ggplot(data = ., mapping = aes(x = x, y = y)) +
                geom_rect(xmin = 0, xmax = 2, ymin = 0, ymax = 2, color = "#002F6C", fill = "#002F6C") +
                theme_nothing() +
                theme(
                        aspect.ratio = 1 / 100
                )
        # country_profile_blue_banner 
        ggsave(filename = "output/charts/usaid_logo/country_profile_blue_banner.png", 
               plot = country_profile_blue_banner, dpi = 300, width = 6, height = 6)
        
        # crop
        # image_read("output/charts/usaid_logo/country_profile_blue_banner.png") %>% image_info() # w = 1800, h = 1800 (dpi * width)
        country_profile_blue_banner_png <- image_read("output/charts/usaid_logo/country_profile_blue_banner.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 16, x_off = 0, y_off = 892)) 
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # country_profile_divider ####
        
        print(str_c(current_country, " divider"))
        
        country_profile_divider <- tibble(x = c(0, 1), y = c(1, 3), color = "dot_color") %>%
                ggplot(data = ., mapping = aes(x = x, y = y, color = color)) +
                geom_point() +
                scale_color_manual(values = "#ffffff") +
                geom_segment(x = 0, y = 2, xend = 1, yend = 2, colour = "#CBCBCB", lineend = "round", size = 1) +
                theme_nothing() +
                theme(
                        aspect.ratio = 1 / 50
                )
        ggsave(filename = "output/charts/country_profile/country_profile_divider.png", 
               plot = country_profile_divider, dpi = 300, width = 6, height = 6)
        
        # read resized usaid logo png and crop
        # image_read("output/charts/country_profile/country_profile_divider.png") %>% image_info() # w = 1800, h = 1800 (dpi * width)
        country_profile_divider_png <- image_read("output/charts/country_profile/country_profile_divider.png") %>%
                image_crop(image = ., geometry = geometry_area(width = 1800, height = 50, x_off = 0, y_off = 875)) 
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # create country_profile layout ####
        
        print(str_c(current_country, " layout"))
        
        page_height <- 100
        page_width <- 100
        side_margin <- 11 # 11 give appropriate to edge in pdf
        center_margin <- 2
        below_margin <- 2
        dot_plot_section_height <- 60
        top_section_height <- 100 - dot_plot_section_height
        dot_plot_width <- (page_width - (2 * side_margin) - center_margin) / 2
        dot_plot_ri_height <- round((dot_plot_section_height - (3 * below_margin)) * (4/11))
        dot_plot_obj_1_height <- round((dot_plot_section_height - (3 * below_margin)) * (2/11))
        dot_plot_obj_2_height <- round((dot_plot_section_height - (3 * below_margin)) * (2/11))
        dot_plot_obj_3_height <- round((dot_plot_section_height - (3 * below_margin)) * (2/11))
        dot_plot_obj_4_height <- round((dot_plot_section_height - (3 * below_margin)) * (1.5/11))
        dot_plot_obj_c_height <- round((dot_plot_section_height - (3 * below_margin)) * (1/11))
        
        layout <- c(
                area(t = 1, l = 1, b = top_section_height, r = page_width), # spacer 1 to 1
                
                # dot_plot_ri
                area(t = (top_section_height) + 1, 
                     l = (side_margin) + 1, 
                     b = (top_section_height) + dot_plot_ri_height, 
                     r = (side_margin) + dot_plot_width), 
                
                # dot_plot_obj_1
                area(t = (top_section_height) + 1, 
                     l = (side_margin + dot_plot_width + center_margin) + 1, 
                     b = (top_section_height) + dot_plot_obj_1_height, 
                     r = (side_margin + dot_plot_width + center_margin) + dot_plot_width), 
                
                # dot_plot_obj_2
                area(t = (top_section_height + dot_plot_ri_height + below_margin) + 1, 
                     l = (side_margin) + 1, 
                     b = (top_section_height + dot_plot_ri_height + below_margin) + dot_plot_obj_2_height, 
                     r = (side_margin) + dot_plot_width), 
                
                # dot_plot_obj_3
                area(t = (top_section_height + dot_plot_obj_1_height + below_margin) + 1, 
                     l = (side_margin + dot_plot_width + center_margin) + 1, 
                     b = (top_section_height + dot_plot_obj_1_height + below_margin) + dot_plot_obj_3_height, 
                     r = (side_margin + dot_plot_width + center_margin) + dot_plot_width), 
                
                # dot_plot_obj_4
                area(t = (top_section_height + dot_plot_ri_height + below_margin + dot_plot_obj_2_height + below_margin) + 1, 
                     l = (side_margin) + 1, 
                     b = (top_section_height + dot_plot_ri_height + below_margin + dot_plot_obj_2_height) + dot_plot_obj_4_height, 
                     r = (side_margin) + dot_plot_width),
                
                # dot_plot_obj_c
                area(t = (top_section_height + dot_plot_obj_1_height + below_margin + dot_plot_obj_3_height + below_margin) + 1, 
                     l = (side_margin + dot_plot_width + center_margin) + 1, 
                     b = (top_section_height + dot_plot_obj_1_height + below_margin + dot_plot_obj_3_height + below_margin) + 
                             dot_plot_obj_c_height, 
                     r = (side_margin + dot_plot_width + center_margin) + dot_plot_width)
                
                # area(t = (top_section_height + dot_plot_ri_height + below_margin + dot_plot_obj_3_height + below_margin) + 1, 
                #      l = 1, 
                #      b = page_height, 
                #      r = page_width)
        )
        # plot(layout)
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////////
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # assemble country_profile patchwork ####
        
        print(str_c(current_country, " assembly"))
        
        # note this patchwork layout is no longer used, except to create canvas fitted to pdf page dimensions
        # instead cowplot is used to draw png images, which gave more efficiency / control because
        # patchwork inset_element had strange reference/alignment behavior requiring continual position adjustments
        # when new objects were added, whereas cowplot::draw_image sets permanent coordinates that are robust to additions
        # note however, that cowplot still has some weird behavior - in particular, it seems like coordinates are relative to
        # image size, which is weird. eg plot two country maps of same height but different width, and set vjust = 1
        # which should ensure that the top of each image is at the same height on the page, but instead one will be higher???
        # (eg azerbaijan and albania maps)
        
        # create country_profile_layout
        country_profile_layout <- wrap_plots(plot_spacer(),
                                             # six_row_blue_rect_background,
                                             # three_row_blue_rect_background,
                                             # three_row_blue_rect_background,
                                             # three_row_blue_rect_background,
                                             # three_row_blue_rect_background,
                                             # three_row_blue_rect_background
                                             plot_spacer(),
                                             plot_spacer(),
                                             plot_spacer(),
                                             plot_spacer(),
                                             plot_spacer(),
                                             plot_spacer()
        ) +
                plot_layout(design = layout)
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # set reference points
        
        top_dot_plot <- .435
        
        # dot_plot_legend
        dot_plot_legend <- top_dot_plot - .0127 
        
        # ri_dot_plot
        ri_dot_plot_ri <- top_dot_plot
        ri_dot_plot_obj_1 <- ri_dot_plot_ri - .028
        ri_dot_plot_obj_2 <- ri_dot_plot_obj_1 - .028
        ri_dot_plot_obj_3 <- ri_dot_plot_obj_2 - .028
        ri_dot_plot_obj_4 <- ri_dot_plot_obj_3 - .028
        ri_dot_plot_obj_c <- ri_dot_plot_obj_4 - .032
        
        # obj_1_dot_plot
        # obj_1_dot_plot_sub_obj_1_1 <- top_dot_plot
        # obj_1_dot_plot_sub_obj_1_1 <- dot_plot_legend - .079
        obj_1_dot_plot_sub_obj_1_1 <- dot_plot_legend - .086
        obj_1_dot_plot_sub_obj_1_2 <- obj_1_dot_plot_sub_obj_1_1 - .028
        obj_1_dot_plot_sub_obj_1_3 <- obj_1_dot_plot_sub_obj_1_2 - .032
        
        # obj_2_dot_plot
        obj_2_dot_plot_sub_obj_2_1 <- ri_dot_plot_obj_c - .079
        obj_2_dot_plot_sub_obj_2_2 <- obj_2_dot_plot_sub_obj_2_1 - .028
        obj_2_dot_plot_sub_obj_2_3 <- obj_2_dot_plot_sub_obj_2_2 - .032
        
        # obj_3_dot_plot
        obj_3_dot_plot_sub_obj_3_1 <- obj_1_dot_plot_sub_obj_1_3 - .079
        obj_3_dot_plot_sub_obj_3_2 <- obj_3_dot_plot_sub_obj_3_1 - .028
        obj_3_dot_plot_sub_obj_3_3 <- obj_3_dot_plot_sub_obj_3_2 - .032
        
        # obj_4_dot_plot
        obj_4_dot_plot_sub_obj_4_1 <- obj_2_dot_plot_sub_obj_2_3 - .079
        obj_4_dot_plot_sub_obj_4_2 <- obj_4_dot_plot_sub_obj_4_1 - .032
        
        # obj_c_dot_plot
        obj_c_dot_plot_sub_obj_c <- obj_3_dot_plot_sub_obj_3_3 - .079
        
        
        #///////////////////
        
        
        # set map scaling to account for cowplot::draw_image's odd behavior with coordinates being relative to image area
        # eg albania and azerbaijan maps set with vjust = 1 to same y coordinate will NOT be printed at same height on page???
        if(current_country == "Albania") {
                map_height_width_scale = .17
        }
        if(current_country == "Armenia") {
                map_height_width_scale = .18
        }
        if(current_country == "Azerbaijan") {
                map_height_width_scale = .21
        }
        if(current_country == "Belarus") {
                map_height_width_scale = .19
        }
        if(current_country == "BiH") {
                map_height_width_scale = .18
        }
        if(current_country == "Bulgaria") {
                map_height_width_scale = .25
        }
        if(current_country == "Croatia") {
                map_height_width_scale = .18
        }
        if(current_country == "Czechia") {
                map_height_width_scale = .28
        }
        if(current_country == "Estonia") {
                map_height_width_scale = .25
        }
        if(current_country == "Georgia") {
                map_height_width_scale = .32
        }
        if(current_country == "Hungary") {
                map_height_width_scale = .26
        }
        if(current_country == "Kazakhstan") {
                map_height_width_scale = .30
        }
        if(current_country == "Kosovo") {
                map_height_width_scale = .18
        }
        if(current_country == "Kyrgyzstan") {
                map_height_width_scale = .33
        }
        if(current_country == "Latvia") {
                map_height_width_scale = .27
        }
        if(current_country == "Lithuania") {
                map_height_width_scale = .22
        }
        if(current_country == "N. Macedonia") {
                map_height_width_scale = .22
        }
        if(current_country == "Moldova") {
                map_height_width_scale = .17
        }
        if(current_country == "Montenegro") {
                map_height_width_scale = .17
        }
        if(current_country == "Poland") {
                map_height_width_scale = .18
        }
        if(current_country == "Romania") {
                map_height_width_scale = .23
        }
        if(current_country == "Serbia") {
                map_height_width_scale = .17
        }
        if(current_country == "Slovakia") {
                map_height_width_scale = .34
        }
        if(current_country == "Slovenia") {
                map_height_width_scale = .25
        }
        if(current_country == "Tajikistan") {
                map_height_width_scale = .24
        }
        if(current_country == "Turkmenistan") {
                map_height_width_scale = .25
        }
        if(current_country == "Ukraine") {
                map_height_width_scale = .25
        }
        if(current_country == "Uzbekistan") {
                map_height_width_scale = .25
        }
        
        
        #///////////////////////////
        
        
        # draw images
        country_profile <- ggdraw(country_profile_layout) +
                
                # draw banner and logo
                draw_image(country_profile_blue_banner_png, x = .5, y = .97, hjust = .5, vjust = .5, width = 7, height = 7) +
                draw_image(country_profile_usaid_logo_png, x = .12, y = .969, hjust = 0, vjust = .5, width = 0.14, height = 0.14) +
                
                
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # draw map
                draw_image(country_profile_map_png, x = .5, y = .845, hjust = 1, vjust = .5, 
                           width = map_height_width_scale, height = map_height_width_scale) +
                # draw_image(country_profile_map_albania, x = .7, y = .845, hjust = 1, vjust = .5, width = 0.17, height = 0.17) +
                
                
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # draw radar chart
                draw_image(country_profile_radar_chart_png, 
                           x = .84, y = .955,
                           hjust = 1, vjust = 1, width = 0.22, height = 0.22) +
                
                
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # draw line chart
                draw_image(line_chart_gray_border_png, x = .504, y = .629, 
                           hjust = .5, vjust = .5, width = 0.55, height = 0.55) +
                draw_image(country_profile_line_chart_png, x = .504, y = .631, 
                           hjust = .5, vjust = .5, width = 0.5, height = 0.5) +
                
                
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # draw divider
                draw_image(country_profile_divider_png, x = .092, y = top_dot_plot + .048, 
                           hjust = 0, vjust = .5, width = .82, height = .82) +
                
                
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                #//////////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # draw sub_obj_dot_plots
                
                # note the top and bottom dot_plots have tailored label heights
                
        
        # ri_dot_plot background and label
        # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
        draw_image(six_row_blue_rect_background_png, x = .51, y = ri_dot_plot_ri + .128, 
                   hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Resilience Index objectives", color = "#ffffff", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .138, y = ri_dot_plot_ri + .023, hjust = 0, vjust = .5) +
                
                # ri_dot_plot_ri
                draw_image(miri_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_ri, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Resilience Index", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_ri + .003, hjust = .5, vjust = .5) +
                
                # ri_dot_plot_obj_1
                draw_image(obj_1_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_obj_1, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Democratic", color = "#333333", size = 4.5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_obj_1 + .004, hjust = .5, vjust = .5) +
                
                # ri_dot_plot_obj_2
                draw_image(obj_2_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_obj_2, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Information", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_obj_2 + .004, hjust = .5, vjust = .5) +
                
                # ri_dot_plot_obj_3
                draw_image(obj_3_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_obj_3, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Energy", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_obj_3 + .004, hjust = .5, vjust = .5) +
                
                # ri_dot_plot_obj_4
                draw_image(obj_4_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_obj_4, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Economic", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_obj_4 + .004, hjust = .5, vjust = .5) +
                
                # ri_dot_plot_obj_c
                draw_image(obj_c_country_profile_dot_plot_png, x = .139, y = ri_dot_plot_obj_c, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Corruption", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = ri_dot_plot_obj_c + .008, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # obj_1_dot_plot background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                draw_image(three_row_blue_rect_background_png, x = .895, y = obj_1_dot_plot_sub_obj_1_1 + .170, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Democratic sub-objectives", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .523, y = obj_1_dot_plot_sub_obj_1_1 + .023, hjust = 0, vjust = .5) +
                
                # obj_1_dot_plot_sub_obj_1_1
                draw_image(sub_obj_1_1_country_profile_dot_plot_png, x = .524, y = obj_1_dot_plot_sub_obj_1_1, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Checks / balances\nand rule of law", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_1_dot_plot_sub_obj_1_1 + .003, hjust = .5, vjust = .5) +
                
                # obj_1_dot_plot_sub_obj_1_2
                draw_image(sub_obj_1_2_country_profile_dot_plot_png, x = .524, y = obj_1_dot_plot_sub_obj_1_2, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Civil society", color = "#333333", size = 4.5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_1_dot_plot_sub_obj_1_2 + .004, hjust = .5, vjust = .5) +
                
                # obj_1_dot_plot_sub_obj_1_3
                draw_image(sub_obj_1_3_country_profile_dot_plot_png, x = .524, y = obj_1_dot_plot_sub_obj_1_3, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Electoral / political\ninterference", color = "#333333", size = 4.5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_1_dot_plot_sub_obj_1_3 + .008, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # obj_2_dot_plot background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                draw_image(three_row_blue_rect_background_png, x = .51, y = obj_2_dot_plot_sub_obj_2_1 + .171, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Information sub-objectives", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .138, y = obj_2_dot_plot_sub_obj_2_1 + .023, hjust = 0, vjust = .5) +
                
                # obj_2_dot_plot_sub_obj_2_1
                draw_image(sub_obj_2_1_country_profile_dot_plot_png, x = .139, y = obj_2_dot_plot_sub_obj_2_1, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Trusted media\nand information", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = obj_2_dot_plot_sub_obj_2_1 + .003, hjust = .5, vjust = .5) +
                
                # obj_2_dot_plot_sub_obj_2_2
                draw_image(sub_obj_2_2_country_profile_dot_plot_png, x = .139, y = obj_2_dot_plot_sub_obj_2_2, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Media demand", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = obj_2_dot_plot_sub_obj_2_2 + .004, hjust = .5, vjust = .5) +
                
                # obj_2_dot_plot_sub_obj_2_3
                draw_image(sub_obj_2_3_country_profile_dot_plot_png, x = .139, y = obj_2_dot_plot_sub_obj_2_3, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Media freedom", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = obj_2_dot_plot_sub_obj_2_3 + .008, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # obj_3_dot_plot background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                draw_image(three_row_blue_rect_background_png, x = .895, y = obj_3_dot_plot_sub_obj_3_1 + .171, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Energy sub-objectives", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .523, y = obj_3_dot_plot_sub_obj_3_1 + .023, hjust = 0, vjust = .5) +
                
                # obj_3_dot_plot_sub_obj_3_1
                draw_image(sub_obj_3_1_country_profile_dot_plot_png, x = .524, y = obj_3_dot_plot_sub_obj_3_1, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Energy security", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_3_dot_plot_sub_obj_3_1 + .003, hjust = .5, vjust = .5) +
                
                # obj_3_dot_plot_sub_obj_3_2
                draw_image(sub_obj_3_2_country_profile_dot_plot_png, x = .524, y = obj_3_dot_plot_sub_obj_3_2, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Independence from\nRussian energy", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_3_dot_plot_sub_obj_3_2 + .004, hjust = .5, vjust = .5) +
                
                # obj_3_dot_plot_sub_obj_3_3
                draw_image(sub_obj_3_3_country_profile_dot_plot_png, x = .524, y = obj_3_dot_plot_sub_obj_3_3, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Energy regulation", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_3_dot_plot_sub_obj_3_3 + .008, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # obj_4_dot_plot background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                draw_image(two_row_blue_rect_background_png, x = .51, y = obj_4_dot_plot_sub_obj_4_1 + .185, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Economic sub-objectives", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .138, y = obj_4_dot_plot_sub_obj_4_1 + .023, hjust = 0, vjust = .5) +
                
                # obj_4_dot_plot_sub_obj_4_1
                draw_image(sub_obj_4_1_country_profile_dot_plot_png, x = .139, y = obj_4_dot_plot_sub_obj_4_1, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Economic\ncompetitiveness", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = obj_4_dot_plot_sub_obj_4_1 + .003, hjust = .5, vjust = .5) +
                
                # obj_4_dot_plot_sub_obj_4_3
                draw_image(sub_obj_4_2_country_profile_dot_plot_png, x = .139, y = obj_4_dot_plot_sub_obj_4_2, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Financial health", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .183, y = obj_4_dot_plot_sub_obj_4_2 + .008, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # obj_c_dot_plot background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                draw_image(one_row_blue_rect_background_png, x = .895, y = obj_c_dot_plot_sub_obj_c + .198, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Corruption sub-objectives", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .523, y = obj_c_dot_plot_sub_obj_c + .023, hjust = 0, vjust = .5) +
                
                # obj_c_dot_plot_sub_obj_c_3
                # note that y coordinate for obj_c_dot_plot_sub_obj_c_3 and label needs special handling 
                # because it's uniquely both top and bottom, and bottom always has special handling
                draw_image(sub_obj_c_country_profile_dot_plot_png, x = .524, y = obj_c_dot_plot_sub_obj_c - .005, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) +
                draw_label(label = "Control of\ncorruption", color = "#333333", size = 5, angle = 0,
                           fontface = "plain", fontfamily = "Calibri",
                           x = .568, y = obj_c_dot_plot_sub_obj_c + .008 - .005, hjust = .5, vjust = .5) +
                
                
                #///////////////////////////////////////////////////////////////////////////////////////////////////////
                
                
                # dot_plot_legend background and label
                # note that for some reason the blue_rect y coordinate does not seem to have same reference as label and dot_plots
                # draw_image(legend_gray_rect_background_png, x = .895, y = .263, 
                draw_image(legend_gray_rect_background_png, x = .895, y = .624, 
                           hjust = 1, vjust = 1, width = .4, height = .4) +
                draw_label(label = "Legend", color = "#002F6C", size = 6, angle = 0,
                           fontface = "bold", fontfamily = "Calibri",
                           x = .523, y = dot_plot_legend + .036, hjust = 0, vjust = .5) +
                
                # dot_plot_legend
                # note that y coordinate for obj_c_dot_plot_sub_obj_c_3 and label needs special handling 
                # because it's uniquely both top and bottom, and bottom always has special handling
                draw_image(country_profile_dot_plot_legend_png, x = .524, y = dot_plot_legend, 
                           hjust = 0, vjust = .5, width = 0.34, height = 0.34) 
        
        
        #///////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # draw flag and title based on whether country name takes one or two rows
        if(!(current_country %in% c("BiH", "N. Macedonia"))) {
                
                country_profile <- ggdraw(country_profile) +
                        
                        # draw flag
                        draw_image(country_profile_flag_png, x = .4455, y = .862, hjust = 0, vjust = .5, width = 0.07, height = 0.07) +
                        
                        # draw title
                        draw_label(label = current_country_full_name, color = "#002F6C", size = 20, angle = 0,
                                   fontface = "bold", fontfamily = "Calibri",
                                   x = .13, y = .91, hjust = 0, vjust = 1) +
                        draw_label(label = "Resilience Index: 2020 Country Profile", color = "#002F6C", size = 10, angle = 0,
                                   fontface = "plain", fontfamily = "Calibri",
                                   x = .13, y = .862, hjust = 0, vjust = .5)
        }
        
        if(current_country %in% c("BiH", "N. Macedonia")) {
                
                country_profile <- ggdraw(country_profile) +
                        
                        # draw flag
                        draw_image(country_profile_flag_png, x = .4455, y = .862, hjust = 0, vjust = .5, width = 0.07, height = 0.07) +
                        
                        
                        # draw title
                        draw_label(label = current_country_full_name, color = "#002F6C", size = 20, angle = 0,
                                   fontface = "bold", fontfamily = "Calibri",
                                   x = .13, y = .91, hjust = 0, vjust = 1) +
                        draw_label(label = "Resilience Index: 2020 Country Profile", color = "#002F6C", size = 10, angle = 0,
                                   fontface = "plain", fontfamily = "Calibri",
                                   x = .13, y = .82, hjust = 0, vjust = .5)
        }
        
        # inspect
        # country_profile
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # save chart as emf
        filename <- tempfile(fileext = ".emf")
        emf(file = filename)
        print(country_profile)
        dev.off()
        
        # add emf to word doc
        output_name <- str_c("output/charts/country_profile_", str_to_lower(current_country), ".docx")
        read_docx() %>%
                body_add_img(src = filename, width = 11.68, height = 11.68) %>%
                print(target = output_name)
        
}


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# run get_country_profile() ####

# load get_country_profile() from get_country_profile.R, which is identical to the code above, but loads faster
# source("code/get_country_profile.R")

map(.x = fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>% 
                                 distinct(country) %>% pull(country),
    .f = ~ get_country_profile(current_country = .x))


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# manual updates to word emf output

# wrap text and bring-to-front
# use alt + 6 and alt + 7 hotkeys to center on page horizontally and vertically
# hit right arrow key once to shift image slightly to right 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare miri_avg to globsec vulnerability index ####

# note globsec vulnerability avg is funded by State Dept. GEC
# https://www.globsec.org/publications/the-globsec-vulnerability-index-evaluating-susceptibility-to-foreign-malign-influence-in-8-central-european-western-balkan-countries/
# https://www.globsec.org/wp-content/uploads/2021/11/Vulnerability-Index_Comparative-report.pdf
# https://www.globsec.org/wp-content/uploads/2021/11/Vulnerability-Index_Extended-methodology.pdf

# compare
ri_comparison_to_globsec_vulnerability_index <- fmir %>% filter(country %in% c("Czechia", "Slovakia", "Hungary", "Serbia", "Romania", 
                               "Bulgaria", "N. Macedonia", "Montenegro"),
                year == 2020) %>%
        distinct(country, year, miri_avg) %>%
        rename(ri_avg = miri_avg) %>%
        arrange(country) %>%
        mutate(globsec_avg = case_when(country == "Bulgaria" ~ 42,
                                   country == "Czechia" ~ 29,
                                   country == "Hungary" ~ 44,
                                   country == "Montenegro" ~ 44,
                                   country == "N. Macedonia" ~ 40,
                                   country == "Romania" ~ 29,
                                   country == "Serbia" ~ 55,
                                   country == "Slovakia" ~ 32)) %>%
        arrange(desc(ri_avg)) %>% mutate(ri_rank_best_to_worst = row_number()) %>%
        arrange(globsec_avg) %>% mutate(globsec_rank_best_to_worst = row_number(),
                                        difference_in_rank = ri_rank_best_to_worst - globsec_rank_best_to_worst)
        

# inspect
ri_comparison_to_globsec_vulnerability_index

# write 
ri_comparison_to_globsec_vulnerability_index %>% 
        write.xlsx(file = "output/charts/ri_comparison_to_globsec_vulnerability_index.xlsx", overwrite = TRUE)


