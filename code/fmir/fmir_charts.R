extrafont::loadfonts(device="win") 
library(tidyverse)
library(lubridate)
library(readxl)
library(skimr)
library(rlang)
library(haven)
library(fs)
library(janitor)
library(ggridges)
library(officer)
library(devEMF)
library(ggrepel)
library(rvest)
library(scales)
library(testthat)
library(patchwork)
library(vdemdata)
library(naniar)
library(dichromat)
library(RColorBrewer)
library(fmsb)
library(ggcorrplot)
library(bazar)
library(cowplot)
library(ggplotify)
# library(elementalist)
library(ggforce)
library(magick)
library(ggpubr)
library(grid)
library(rworldxtra)
library(sf)        
library(lwgeom)    
library(rworldmap)
library(pals)
library(openxlsx)

# setwd
# setwd("C:/Users/Stephen/Desktop/usaid/mcp/malign_influence")
setwd("C:/Users/sdevine/Desktop/usaid/mcp/malign_influence")
options(scipen = 999)


#//////////////////////////////////////////////////////////////////////////////////////////////////////


# create custom color_palette ####
color_palette <- tibble(hex = c("#083D7F", "#2474B6", "#8BBFD0",
                                "#CBCBCB", "#7D7D7D",
                                "#99ba78", "#35B779FF", "#006629", 
                                "#E4DC68", "#FDA159", "#EF6712", "#CE1B1E",
                                "#8B008B", "#DA70D6"))
color_palette
color_palette %>% pull(hex) %>% show_col()

# color_palette supports 11 colors, plus possible extensions via fill/line type
show_col(color_palette %>% slice(1, 3) %>% pull(hex)) # 2 colors
show_col(color_palette %>% slice(1, 2, 3) %>% pull(hex)) # 3 colors
show_col(color_palette %>% slice(1, 2, 3, 4) %>% pull(hex)) # 4 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5) %>% pull(hex)) # 5 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6) %>% pull(hex)) # 6 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7) %>% pull(hex)) # 7 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8) %>% pull(hex)) # 8 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9) %>% pull(hex)) # 9 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) %>% pull(hex)) # 10 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11) %>% pull(hex)) # 11 colors


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read country_crosswalk ####
current_wd <- getwd()
# setwd("C:/Users/Stephen/Desktop/usaid/mcp/useful_info/country_crosswalk")
setwd("C:/Users/sdevine/Desktop/usaid/mcp/useful_info/country_crosswalk")
country_crosswalk <- read_csv("country_crosswalk.csv", lazy = FALSE)
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read round_to_threshold ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
# setwd("C:/Users/Stephen/Desktop/r/assorted_helper_scripts")
source("round_to_threshold.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read get_label_position ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
# setwd("C:/Users/Stephen/Desktop/r/assorted_helper_scripts")
source("get_label_position.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read round_to_digits ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
# setwd("C:/Users/Stephen/Desktop/r/assorted_helper_scripts")
source("round_to_digits.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read final fmir data ####
# fmir <- read_excel(path = "data/fmir/fmir_20221012.xlsx")
fmir <- read_excel(path = "data/fmir/fmir_20230217.xlsx")



# inspect
fmir
fmir %>% glimpse()
fmir %>% nrow() # 35604
fmir %>% ncol() # 67


fmir %>% count(obj)
fmir %>% count(obj_num)
fmir %>% count(obj_short_name)
fmir %>% count(sub_obj)
fmir %>% count(sub_obj_num)
fmir %>% count(sub_obj_short_name)
fmir %>% count(concept)
fmir %>% count(indicator_name) %>% print(n = nrow(.))


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_c_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_c_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_c", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_c_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_c_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_c_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_c_balkans_patch_line_chart,
                                           sub_obj_c_eurasia_patch_line_chart,
                                           sub_obj_c_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_c_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_c_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_c", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_c_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_c_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_c_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_1_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_1_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_2_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_2_balkans_patch_line_chart,
                                           sub_obj_1_2_eurasia_patch_line_chart,
                                           sub_obj_1_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_1_2_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_1_2", indicator_name == "sub_obj_1_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_1_2", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_1_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_1_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_1_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_1_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_1_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_1_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_1_3_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_1_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_1_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_1_3_balkans_patch_line_chart,
                                           sub_obj_1_3_eurasia_patch_line_chart,
                                           sub_obj_1_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_1_3_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_1_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_1_3", indicator_name == "sub_obj_1_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_1_3", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_1_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_1_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_1_3_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_2_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_1_balkans_patch_line_chart,
                                           sub_obj_2_1_eurasia_patch_line_chart,
                                           sub_obj_2_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_2_1_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_1", indicator_name == "sub_obj_2_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_1", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_2_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_2_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_2_balkans_patch_line_chart,
                                           sub_obj_2_2_eurasia_patch_line_chart,
                                           sub_obj_2_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_2_2_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_2", indicator_name == "sub_obj_2_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_2", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_2_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_2_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_2_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_3_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_2_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_2_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_2_3_balkans_patch_line_chart,
                                           sub_obj_2_3_eurasia_patch_line_chart,
                                           sub_obj_2_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_2_3_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_2_3", indicator_name == "sub_obj_2_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_2_3", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_2_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_2_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_3_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_3_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_1_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_1_balkans_patch_line_chart,
                                           sub_obj_3_1_eurasia_patch_line_chart,
                                           sub_obj_3_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_3_1_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_1", indicator_name == "sub_obj_3_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)

# inspect luxembourg
fmir %>% filter(country == "Luxembourg", sub_obj_num == "sub_obj_3_1") %>%
        select(country, year, indicator_name, values, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2018, sub_obj_num == "sub_obj_3_1", country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_1_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_3_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_2_balkans_patch_line_chart,
                                           sub_obj_3_2_eurasia_patch_line_chart,
                                           sub_obj_3_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_3_2_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_2", indicator_name == "sub_obj_3_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
chart_data <- fmir %>% filter(year == 2018, sub_obj_num == "sub_obj_3_2",
                              !is.na(sub_obj_avg)) %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_3_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_3_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_3_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_3_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_3_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_3_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_3_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_3_3_balkans_patch_line_chart,
                                           sub_obj_3_3_eurasia_patch_line_chart,
                                           sub_obj_3_3_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_3_3_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_3_3", year == 2019, is.na(sub_obj_avg)) %>%
        distinct(country, year, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_3", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_3_3", indicator_name == "sub_obj_3_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_3_3", !is.na(sub_obj_avg),
                              country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_3_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_3_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_3_3_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_4_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_4_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_1_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_4_1_balkans_patch_line_chart,
                                           sub_obj_4_1_eurasia_patch_line_chart,
                                           sub_obj_4_1_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_4_1_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(sub_obj_num == "sub_obj_4_1", year == 2019) %>%
        # filter(is.na(sub_obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, sub_obj_avg)
        
# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_1", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_4_1", indicator_name == "sub_obj_4_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_4_1", mcp_grouping != "Russia", 
                              !is.na(sub_obj_avg)) %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_4_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_4_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_1_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_4_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_4_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_4_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_4_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_4_2_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_4_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_4_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_4_2_balkans_patch_line_chart,
                                           sub_obj_4_2_eurasia_patch_line_chart,
                                           sub_obj_4_2_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_4_2_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(sub_obj_num == "sub_obj_4_2", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "sub_obj_4_2", indicator_name == "sub_obj_4_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, sub_obj_num == "sub_obj_4_2", !is.na(values),
                              country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
sub_obj_4_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 13 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
sub_obj_4_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_4_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_balkans_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_c_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list
# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
sub_obj_c_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_mcp_grouping_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
        group_by(mcp_grouping, year) %>% mutate(sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = mcp_grouping)) + geom_line()
fmir %>% filter(sub_obj_num == "sub_obj_c", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()

fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "sub_obj_c", indicator_name == "sub_obj_c_vdem_rule_of_law") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_c", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
sub_obj_c_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for sub_obj_c_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
sub_obj_c_patch_line_chart <- wrap_plots(plot_spacer(),
                                           sub_obj_c_balkans_patch_line_chart,
                                           sub_obj_c_eurasia_patch_line_chart,
                                           sub_obj_c_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 

sub_obj_c_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_c_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_bar_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", year == 2019) %>%
        # filter(is.na(sub_obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, sub_obj_avg)

# plot
fmir %>% filter(sub_obj_num == "cross_cutting_obj", year == 2019) %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = sub_obj_avg), 
                                       y = sub_obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, sub_obj_avg) %>%
        select(country, year, sub_obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                              !is.na(sub_obj_avg), country != "Russia") %>% 
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
cross_cutting_obj_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
cross_cutting_obj_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/cross_cutting_obj_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////



# miri_level_balkans_patch_line_chart ####
fmir %>% distinct(country, year, obj_num, obj_avg, miri_avg) %>% arrange(country, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        mutate(values = miri_avg) %>%
        arrange(country, year) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
miri_level_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
miri_level_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# miri_level_eurasia_patch_line_chart ####
fmir %>% distinct(country, year, obj_num, obj_avg, miri_avg) %>% arrange(country, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(mcp_grouping == "E&E Eurasia") %>% 
        mutate(values = miri_avg) %>%
        arrange(country, year) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
miri_level_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
miri_level_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# miri_level_mcp_grouping_patch_line_chart ####

# inspect
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        arrange(mcp_grouping, year)

# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        arrange(mcp_grouping, year) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_miri_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% 
        filter(country != "Russia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        mutate(values = avg_miri_avg) %>%
        arrange(mcp_grouping, year) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#////////////////////////


miri_level_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
miri_level_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for miri_level_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
miri_level_patch_line_chart <- wrap_plots(plot_spacer(),
                                          miri_level_balkans_patch_line_chart,
                                          miri_level_eurasia_patch_line_chart,
                                          miri_level_mcp_grouping_patch_line_chart, 
                                          plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# crop and resize to 183%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(miri_level_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/miri_level_patch_line_chart.docx")


#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# miri_level_country_bar_chart ####


# inspect
fmir %>% filter(year == 2019, country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_standardized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year == 2020) %>% select(country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>% 
        distinct(country, mcp_grouping, miri_avg) %>%
        mutate(var = "miri", values = miri_avg) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
# for factsheet version with just E&E and graduates: ratio = 1.5 / 1 and font size = 9
# for chart deck version with all sub-regions including CARS and EU-15: ratio = 3 / 1 and font size = 8
miri_level_country_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2),
                           limits = c(0, 1),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 13 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
miri_level_country_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(miri_level_country_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/miri_level_country_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_level_change_for_ee_overall_line_chart ####

# inspect
fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(year, obj_num) %>%
        mutate(obj_avg_mean= mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        arrange(obj_num, year) %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg_mean, color = obj_num)) + geom_line(size = 1)


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(year, obj_num) %>%
        mutate(obj_avg_mean= mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        arrange(obj_num, year) %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        mutate(values = obj_avg_mean,
               color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic" ~ 1,
                                           color_bin == "Information" ~ 2,
                                           color_bin == "Energy" ~ 3,
                                           color_bin == "Economic" ~ 4,
                                           color_bin == "Corruption" ~ 5,
                                           color_bin == "Resilience Index" ~ 6),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = obj_num, gap = .02)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_level_change_for_ee_overall_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           breaks = seq(from = .2, to = .5, by = .1),
                           limits = c(.2, .5),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 19 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 20, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_level_change_for_ee_overall_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_level_change_for_ee_overall_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_level_change_for_ee_overall_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_balkans_patch_line_chart ####

fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_eurasia_patch_line_chart ####

fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_1") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(obj_num == "obj_1", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% 
        mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_1_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_1_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
obj_1_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_1_balkans_patch_line_chart,
                                     obj_1_eurasia_patch_line_chart,
                                     obj_1_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 

obj_1_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_1_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_1", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_1", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_1", indicator_name == "obj_1_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_1",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_1_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_1_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_1_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_balkans_patch_line_chart ####

fmir %>% filter(obj_num == "obj_2") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_2", indicator_name == "obj_2_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_eurasia_patch_line_chart ####

fmir %>% filter(obj_num == "obj_2") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_2", indicator_name == "obj_2_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_2", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_2", indicator_name == "obj_2_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_2", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_2") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(obj_num == "obj_2", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% 
        mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_2_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_2_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
obj_2_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_2_balkans_patch_line_chart,
                                     obj_2_eurasia_patch_line_chart,
                                     obj_2_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 

obj_2_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_2", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_2", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_2", indicator_name == "obj_2_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_2",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_2_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is bettter)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_2_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_balkans_patch_line_chart ####

fmir %>% filter(obj_num == "obj_3") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_3", indicator_name == "obj_3_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_3_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_eurasia_patch_line_chart ####

fmir %>% filter(obj_num == "obj_3") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_3", indicator_name == "obj_3_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_3", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_3", indicator_name == "obj_3_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_3", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_3_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_3") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(obj_num == "obj_3", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% 
        mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_3_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_3_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
obj_3_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_3_balkans_patch_line_chart,
                                     obj_3_eurasia_patch_line_chart,
                                     obj_3_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 

obj_3_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_3_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_3", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_3", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_3", indicator_name == "obj_3_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2018, obj_num == "obj_3",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_3_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_3_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_3_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_balkans_patch_line_chart ####

fmir %>% filter(obj_num == "obj_4") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_4", indicator_name == "obj_4_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()



#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Albania" ~ "    Albania",
                                     country == "BiH" ~ "    BiH",
                                     country == "Kosovo" ~ "    Kosovo",
                                     country == "N. Macedonia" ~ "    N. Macedonia",
                                     country == "Serbia" ~ "    Serbia"),
               color = case_when(country == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_4_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = "Score", 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_eurasia_patch_line_chart ####

fmir %>% filter(obj_num == "obj_4") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_4", indicator_name == "obj_4_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_4", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_4", indicator_name == "obj_4_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% 
        filter(obj_num == "obj_4", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(country == "Armenia" ~ "    Armenia",
                                     country == "Azerbaijan" ~ "    Azerbaijan",
                                     country == "Belarus" ~ "    Belarus",
                                     country == "Georgia" ~ "    Georgia",
                                     country == "Moldova" ~ "    Moldova",
                                     country == "Ukraine" ~ "    Ukraine"),
               color = case_when(country == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 country == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 country == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 country == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 country == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 country == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position(gap = .04, label_var = country)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_4_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(obj_num == "obj_4") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, obj_num, indicator_name, avg_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(obj_num == "obj_4") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color

chart_data <- fmir %>% filter(obj_num == "obj_4", country != "Russia") %>%
        group_by(mcp_grouping, year) %>% 
        mutate(avg_obj_avg = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "    Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "    Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "    Graduates",
                                     mcp_grouping == "CARs" ~ "    CARs",
                                     mcp_grouping == "EU-15" ~ "    EU-15",
                                     TRUE ~ mcp_grouping),
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 mcp_grouping == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 mcp_grouping == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 mcp_grouping == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 mcp_grouping == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 mcp_grouping == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(label_var = mcp_grouping)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_4_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3),
                           expand = c(.03, .03)) +
        labs(x = NULL, y = NULL, 
             # title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.text.y = element_blank(),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_mcp_grouping_patch_line_chart



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for obj_4_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


#///////////////


# create patchwork plot
obj_4_patch_line_chart <- wrap_plots(plot_spacer(),
                                     obj_4_balkans_patch_line_chart,
                                     obj_4_eurasia_patch_line_chart,
                                     obj_4_mcp_grouping_patch_line_chart, 
                                     plot_spacer()) +
        plot_layout(design = layout) 

obj_4_patch_line_chart


#///////////////////


# resize to 190%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_4_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_bar_chart ####

fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% filter(obj_num == "obj_4", year == 2019) %>%
        # filter(is.na(obj_avg)) %>%
        filter(country %in% c("Armenia", "Belarus")) %>%
        select(country, year, indicator_name, values, obj_avg)

# plot
fmir %>% filter(obj_num == "obj_4", year == 2019) %>%
        distinct(country, year, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg), 
                                       y = obj_avg)) + geom_col()

# inspect bih
fmir %>% filter(country == "BiH", obj_num == "obj_4", indicator_name == "obj_4_vdem_leg_constraints_on_exec") %>%
        distinct(country, year, obj_avg) %>%
        select(country, year, obj_avg)


#////////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(year == 2019, obj_num == "obj_4",  
                              !is.na(obj_avg), country != "Russia") %>% 
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


# title
title <- "FMI sub-objective 1.1 - Rule of law in 2019"


#/////////////////////


# create chart
obj_4_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = factor(country), .x = values), 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans", "E&E Eurasia", "E&E graduates", 
                                                                 "CARs", "Russia", "EU-15", "U.S.")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), 
                           limits = c(0, 1), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 9, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) + 
        guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_4_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_4_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# indicator_correlation_matrix ####

# note there were issues printing the correclation matrix to emf, with it being auto-cropped etc
# since the matrix is just an internal diagnostic, for simplicity i just took a screenshot when displaying it in R graphic viewer

# note russia is dropped
indicator_correlation_matrix <- fmir %>% 
        # select(country, year, indicator_name, values) %>%
        # pivot_wider(id_cols = -c(indicator_name, values), names_from = "indicator_name", values_from = "values") %>% 
        select(country, year, indicator_name, indicator_standardized_values) %>%
        filter(country != "Russia") %>%
        pivot_wider(id_cols = c(country, year), names_from = "indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        select(-c(country, year)) %>%
        cor() %>%
        # correlate() %>% 
        # select(-term) %>% skim() %>% select(-numeric.sd)
        # ggcorr(angle = 0, hjust = 1, layout.exp = 50) 
        ggcorrplot(corr = ., method = "square", type = "lower", lab = FALSE, colors = c("red", "white", "blue"))
        # corrplot(method = 'color', order = 'alphabet', type = "lower")
        

indicator_correlation_matrix


#//////////////////////////////////


# had to screengrab it because plot output was crunched

# save chart as emf
# filename <- tempfile(fileext = ".emf")
# emf(file = filename)
# print(indicator_correlation_matrix)
# dev.off()
# 
# # add emf to word doc
# read_docx() %>%
#         body_add_img(src = filename, width = 6, height = 6) %>%
#         print(target = "output/charts/indicator_correlation_matrix.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_correlation_matrix ####

obj_correlation_matrix <- fmir %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        mutate(obj_num = case_when(obj_num == "obj_1" ~ "Obj. 1: Democratic",
                                   obj_num == "obj_2" ~ "Obj. 2: Information",
                                   obj_num == "obj_3" ~ "Obj. 3: Energy",
                                   obj_num == "obj_4" ~ "Obj. 4: Economic",
                                   obj_num == "obj_c" ~ "  Cross-cutting obj.: Corruption")) %>%
        pivot_wider(id_cols = c(country, year), names_from = "obj_num", values_from = "obj_avg") %>%
        select(-c(country, year)) %>%
        cor() %>%
        # correlate() %>%
        # select(-term) %>% skim() %>% select(-numeric.sd)
        ggcorrplot(corr = ., method = "square", type = "lower", lab = TRUE, colors = c("red", "white", "blue"),
                   tl.cex = 18, tl.col = "#333333", digits = 2, lab_col = "#333333", lab_size = 6)
        # corrplot(method = 'color', order = 'alphabet', type = "lower", addCoef.col = "#000000", tl.srt = 45, diag = TRUE)

obj_correlation_matrix


#//////////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_correlation_matrix)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_correlation_matrix_v2.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_to_4_country_facet_chart ####

obj_1_to_4_country_facet_chart <- fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_short_name, obj_avg) %>%
        bind_rows(., fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
                          mutate(obj_num = "miri", obj_short_name = "MIRI") %>%
                          rename(obj_avg = miri_avg) %>% select(country, mcp_grouping, year, obj_num, obj_short_name, obj_avg)) %>%
        arrange(country, year) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        mutate(values = obj_avg,
               var = obj_short_name) %>%
        mutate(var = fct_relevel(.f = var, 
                                 "Democratic resilience",
                                 "Information resilience",
                                 "Energy resilience",
                                 "Economic resilience",
                                 "Corruption resilience",
                                 "MIRI")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)), 
                           breaks = c("MIRI",
                                      "Democratic resilience",
                                      "Information resilience",
                                      "Energy resilience",
                                      "Economic resilience",
                                      "Corruption resilience")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1"),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1") %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == "obj_1") %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))

obj_1_to_4_country_facet_chart


#//////////////////////////////////


# crop and resize to 179%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_to_4_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_to_4_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_country_facet_chart ####
obj_num_var <- "obj_1"
obj_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 1 avg.",
                               var == "Checks and balances and rule of law" ~ "Sub-obj. 1.1: Checks and balances\nand rule of law",
                               var == "Civil society" ~ "Sub-obj. 1.2: Civil society",
                               var == "Resilience to electoral/political interference and polarization" ~
                                       "  Sub-obj. 1.3: Resilience to electoral /\n     political interference and polarization",
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 1 avg.", 
                                 "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                 "Sub-obj. 1.2: Civil society",
                                 "  Sub-obj. 1.3: Resilience to electoral /\n     political interference and polarization")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Objective 1 avg.", 
                                      "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                      "Sub-obj. 1.2: Civil society",
                                      "  Sub-obj. 1.3: Resilience to electoral /\n     political interference and polarization")) +        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))

obj_1_country_facet_chart


#//////////////////////////////////


# crop and resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_country_facet_chart.docx")


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_country_facet_chart ####
obj_num_var <- "obj_2"
obj_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 2 avg.",
                               var == "Trust in media" ~ "Sub-obj 2.1: Trust in media",
                               var == "Media demand" ~ "Sub-obj 2.2: Media demand",
                               var == "Media freedom" ~ "Sub-obj 2.3: Media freedom",
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 2 avg.",
                                 "Sub-obj 2.1: Trust in media")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Objective 2 avg.", 
                                      "Sub-obj 2.1: Trust in media",
                                      "Sub-obj 2.2: Media demand",
                                      "Sub-obj 2.3: Media freedom")) + 
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))

obj_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_country_facet_chart ####
obj_num_var <- "obj_3"
obj_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 3 avg.",
                               var == "Energy security" ~ "Sub-obj. 3.1: Energy security",
                               var == "Independence from Russian energy" ~ "   Sub-obj. 3.2: Independence from\nRussian energy",
                               var == "Energy regulation" ~ " Sub-obj. 3.3: Energy regulation",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Objective 3 avg.",
                                 "Sub-obj. 3.1: Energy security",
                                 "   Sub-obj. 3.2: Independence from\nRussian energy",
                                 " Sub-obj. 3.3: Energy regulation")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Objective 3 avg.", 
                                      "Sub-obj. 3.1: Energy security",
                                      "   Sub-obj. 3.2: Independence from\nRussian energy",
                                      " Sub-obj. 3.3: Energy regulation")) + 
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))

obj_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_country_facet_chart ####
obj_num_var <- "obj_4"
obj_4_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
        # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
        distinct(country, year, sub_obj_short_name, concept, sub_obj_avg) %>%
        unite(col = "sub_obj_short_name_concept", sub_obj_short_name, concept, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "sub_obj_short_name_concept", 
                    values_from = "sub_obj_avg") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), obj_num == obj_num_var) %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_avg_x_obj_avg = obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("var", "concept"), sep = "_x_") %>%
        distinct(country, year, var, values) %>%
        mutate(var = case_when(var == "obj_avg" ~ "Objective 4 avg.",
                               var == "Economic competitiveness" ~ "   Sub-obj. 4.1: Economic competitiveness",
                               var == "Financial health" ~ "Sub-obj 4.2: Financial health", 
                               TRUE ~ var)) %>%
        mutate(var = fct_relevel(.f = var, "Objective 4 avg.",
                                 "   Sub-obj. 4.1: Economic competitiveness",
                                 "Sub-obj 4.2: Financial health")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Objective 4 avg.", 
                                      "   Sub-obj. 4.1: Economic competitiveness",
                                      "Sub-obj 4.2: Financial health")) + 
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), obj_num == obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))

obj_4_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_1"
sub_obj_1_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.1 avg.",
                               var == "fh_judicial_framework_and_indep" ~ "FH: Judicial framework\nand indep.",
                               var == "fh_local_democratic_gov" ~ "FH: Local democratic\ngovernance",
                               var == "fh_national_democratic_gov" ~ "FH: National democratic\ngovernance",
                               var == "vdem_judicial_constraints_on_exec" ~ "VDem: Judicial constraints\non executive",
                               var == "vdem_leg_constraints_on_exec" ~ " VDem: Legislative constraints\non executive",
                               var == "vdem_rule_of_law" ~ "VDem: Rule of law",
                               var == "wgi_rule_of_law" ~ "WGI: Rule of law",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "VDem: Judicial constraints\non executive", after = Inf),
               var = fct_relevel(.f = var, " VDem: Legislative constraints\non executive", after = Inf),
               var = fct_relevel(.f = var, "VDem: Rule of law", after = Inf),
               var = fct_relevel(.f = var, "Sub-objective 1.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 1.1 avg.",
                                      "FH: Judicial framework\nand indep.",
                                      "FH: Local democratic\ngovernance",
                                      "FH: National democratic\ngovernance",
                                      "VDem: Judicial constraints\non executive",
                                      " VDem: Legislative constraints\non executive",
                                      "VDem: Rule of law",
                                      "WGI: Rule of law")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))


sub_obj_1_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_2"
sub_obj_1_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.2 avg.",
                               var == "fhi_csosi_overall" ~ "FHI 360: Civil society",
                               var == "vdem_civil_society" ~ "VDem: Civil society",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 1.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 1.2 avg.",
                                      "FHI 360: Civil society",
                                      "VDem: Civil society")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_1_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_1_3"
sub_obj_1_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 1.3 avg.",
                               var == "fh_electoral_process" ~ "FH: Electoral process",
                               var == "vdem_electoral_democracy" ~ "VDem: Electoral democracy index",
                               var == "vdem_foreign_gov_advertising" ~ "VDem: Foreign govt. advertising",
                               var == "vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign govt. dissem. false info",
                               var == "vdem_gov_cyber_sec_capacity" ~ "VDem: Govt. cyber sec. capacity",
                               var == "vdem_political_party_cyber_sec_capacity" ~ "VDem: Political party cyber sec. capacity",
                               var == "vdem_mobilization_for_autocracy" ~ "VDem: Mobiliation for autocracy",
                               var == "vdem_political_polarization" ~ "VDem: Political polarization",
                               var == "vdem_political_violence" ~ "VDem: Political violence",
                               var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Hostility from Russia",
                               var == "nato_membership" ~ "NATO membership",
                               var == "csto_membership" ~ "CSTO membership",
                               var == "russian_military_presence" ~ "Russian military presence",
                               var == "russian_supported_breach_of_territorial_integrity" ~ "Russian-supported breach",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "VDem: Political party cyber sec. capacity", after = 6),
               var = fct_relevel(.f = var, "Sub-objective 1.3 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex), "#996633", "#ff0066"),
                           breaks = c("Sub-objective 1.3 avg.",
                                      "FH: Electoral process",
                                      "VDem: Electoral democracy index",
                                      "VDem: Political polarization",
                                      "VDem: Political violence",
                                      "VDem: Mobiliation for autocracy",
                                      "VDem: Govt. cyber sec. capacity",
                                      "VDem: Political party cyber sec. capacity",
                                      "VDem: Foreign govt. dissem. false info",
                                      "VDem: Foreign govt. advertising",
                                      "NATO membership",
                                      "CSTO membership",
                                      "Russian military presence",
                                      "ICEWS: Hostility from Russia",
                                      "Russian-supported breach")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_1_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_1"
sub_obj_2_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.1 avg.",
                               var == "msi_professional_journalism" ~ "IREX: Professional journalism",
                               var == "vdem_media_bias" ~ "VDem: Media bias",
                               var == "vdem_media_critical" ~ " VDem: Print/broadcast media critical",
                               var == "vdem_media_corrupt" ~ "VDem: Media corrupt",
                               var == "aiddata_content_producers" ~ "AidData: MRMI Content producers",
                               var == "vdem_gov_dissem_false_info_domestically" ~ "VDem: Govt. dissem. false info domestically",
                               var == "vdem_political_parties_dissem_false_info_domestically" ~ "VDem: Political parties dissem. false info domestically",
                               var == "vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign govt. dissem. false info",
                               var == "vdem_foreign_gov_advertising" ~ "VDem: Foreign govt. advertising",
                               var == "icews_russian_state_media_focus" ~ "ICEWS: Russian state media focus",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "IREX: Professional journalism"),
               var = fct_relevel(.f = var, "Sub-objective 2.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.1 avg.",
                                      "IREX: Professional journalism",
                                      "AidData: MRMI Content producers",
                                      "VDem: Media bias",
                                      " VDem: Print/broadcast media critical",
                                      "VDem: Media corrupt",
                                      "VDem: Govt. dissem. false info domestically",
                                      "VDem: Political parties dissem. false info domestically",
                                      "VDem: Foreign govt. dissem. false info",
                                      "VDem: Foreign govt. advertising",
                                      "ICEWS: Russian state media focus")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_2"
sub_obj_2_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.2 avg.",
                               var == "msi_business_management" ~ "IREX: Business management",
                               var == "msi_plurality_of_news" ~ "IREX: Plurality of news",
                               var == "aiddata_content_consumers" ~ "AidData: MRMI Content consumers",
                               var == "vdem_print_broadcast_media_range_of_perspectives" ~ " VDem: Print/broadcast media perspectives",
                               var == "vdem_online_media_range_of_perspectives" ~ "VDem: Online media perspectives",
                               var == "vdem_online_media_existence" ~ " VDem: Online media existence",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 2.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.2 avg.",
                                      "IREX: Business management",
                                      "IREX: Plurality of news",
                                      "AidData: MRMI Content consumers",
                                      " VDem: Print/broadcast media perspectives",
                                      "VDem: Online media perspectives",
                                      " VDem: Online media existence")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_2_3"
sub_obj_2_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 2.3 avg.",
                               var == "msi_freedom_of_speech" ~ "IREX: Freedom of speech",
                               var == "aiddata_institutional_environment" ~ "AidData: Institutional environment",
                               var == "vdem_gov_censor_of_media_effort" ~ "VDem: Govt. censorship effort - Media",
                               var == "vdem_harassment_of_journalists" ~ "VDem: Harassment of journalists",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 2.3 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 2.3 avg.",
                                      "IREX: Freedom of speech",
                                      "AidData: Institutional environment",
                                      "VDem: Govt. censorship effort - Media",
                                      "VDem: Harassment of journalists")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_2_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_country_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_1"
sub_obj_3_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.1 avg.",
                               var == "iea_net_energy_imports_as_share_of_tes" ~ "IEA: Net energy imports\nas % of primary supply",
                               var == "aiddata_esi" ~ "   AidData: Energy Security Index",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 3.1 avg.",
                                      "IEA: Net energy imports\nas % of primary supply",
                                      "   AidData: Energy Security Index")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_2"
sub_obj_3_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.2 avg.",
                               var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~
                                       "IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                               var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                               var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                       "IEA: Natural gas imports from Russia\nas % of natural gas imports",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 3.2 avg.",
                                      "IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                                      "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                                      "IEA: Natural gas imports from Russia\nas % of natural gas imports")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_country_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_country_facet_chart ####
sub_obj_num_var <- "sub_obj_3_3"
sub_obj_3_3_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 3.3 avg.",
                               var == "rise_energy_efficiency_regulation_rank" ~ "WB: RISE energy efficiency regulation rank",
                               var == "rise_renewable_energy_regulation_rank" ~ "WB: RISE renewable energy regulation rank",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 3.3 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 3.3 avg.",
                                      "WB: RISE energy efficiency regulation rank",
                                      "WB: RISE renewable energy regulation rank")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


sub_obj_3_3_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_country_facet_chart ####
sub_obj_num_var <- "sub_obj_4_1"
sub_obj_4_1_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = "")) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 4.1 avg.",
                               var == "cdis_russian_fdi_as_share_of_total_fdi" ~ "IMF: Russia FDI stock as % of total FDI stock",
                               var == "dots_exports_to_eu_as_share_of_total_exports" ~ "IMF: Goods exports to EU-27 as % of total exports",
                               var == "dots_exports_to_russia_as_share_of_total_exports" ~ "IMF: Goods exports to Russia as % of total exports",
                               var == "atlas_eci" ~ "Atlas: Economic Complexity Index",
                               var == "cdis_eu_fdi_as_share_of_total_fdi" ~ "IMF: EU-27 FDI stock as % of total FDI stock",
                               var == "wb_goods_and_services_exports_as_share_of_gdp" ~ "WB: Goods and services exports as % of GDP",
                               var == "eaeu_membership" ~ "EAEU membership",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 4.1 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 4.1 avg.",
                                      "Atlas: Economic Complexity Index",
                                      "WB: Goods and services exports as % of GDP",
                                      "IMF: Goods exports to EU-27 as % of total exports",
                                      "IMF: Goods exports to Russia as % of total exports",
                                      "IMF: EU-27 FDI stock as % of total FDI stock",
                                      "IMF: Russia FDI stock as % of total FDI stock",
                                      "EAEU membership")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))


sub_obj_4_1_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_country_facet_chart ####
sub_obj_num_var <- "sub_obj_4_2"
sub_obj_4_2_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               values = case_when(year <= 2006 ~ NA_real_,
                                  TRUE ~ values)) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Sub-objective 4.2 avg.",
                               var == "bti_banking_system" ~ "BTI: Banking system",
                               var == "legatum_financing_ecosystem" ~ "Legatum: Financing ecosystem",
                               var == "legatum_fiscal_sustainability" ~ "Legatum: Fiscal sustainability",
                               var == "imf_financial_development_index" ~ "IMF: Financial Development Index",
                               var == "wb_ext_debt_to_russia_as_share_of_total_ext_debt" ~ "World Bank: External debt to Russia",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Sub-objective 4.2 avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Sub-objective 4.2 avg.",
                                      "BTI: Banking system",
                                      "Legatum: Financing ecosystem",
                                      "Legatum: Fiscal sustainability",
                                      "IMF: Financial Development Index",
                                      "World Bank: External debt to Russia")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))


sub_obj_4_2_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# cross_cutting_obj_country_facet_chart ####
sub_obj_num_var <- "sub_obj_c"
cross_cutting_obj_country_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, concept, indicator_name, indicator_standardized_values) %>%
        unite(col = "concept_indicator_name", concept, indicator_name, sep = "_x_") %>%
        pivot_wider(id_cols = c(country, year), names_from = "concept_indicator_name", 
                    values_from = "indicator_standardized_values") %>%
        left_join(., 
                  fmir %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
                          # filter(mcp_grouping %in% c("EU-15"), sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_x_sub_obj_avg = sub_obj_avg),
                  by = c("country", "year")) %>%
        pivot_longer(cols = -c(country, year), names_to = "var", values_to = "values") %>%
        separate(col = "var", into = c("concept", "var"), sep = "_x_") %>%
        mutate(var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               values = case_when(year <= 2006 ~ NA_real_,
                                  TRUE ~ values)) %>%
        mutate(var = case_when(var == "sub_obj_avg" ~ "Cross-cutting obj. avg.",
                               var == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                               var == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption Perceptions Index",
                               var == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Control of corruption",
                               var == "cross_cutting_obj_vdem_political_corruption" ~ "V-Dem: Political corruption index",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Cross-cutting obj. avg.", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = c("#35B779FF", color_palette %>% slice(-c(6, 7)) %>% pull(hex)),
                           breaks = c("Cross-cutting obj. avg.",
                                      "FH: Corruption",
                                      "TI: Corruption Perceptions Index",
                                      "WGI: Control of corruption",
                                      "V-Dem: Political corruption index")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_blank(),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(1, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(linewidth = 6)))


cross_cutting_obj_country_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cross_cutting_obj_country_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/cross_cutting_obj_country_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_c"
sub_obj_c_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_c_vdem_judicial_constraints_on_exec" ~
                                                  "VDem: Judicial constraints on executive",
                                          indicator_name == "sub_obj_c_vdem_leg_constraints_on_exec" ~
                                                  "VDem: Legislative constraints on executive",
                                          indicator_name == "sub_obj_c_fh_national_democratic_gov" ~
                                                  "FH: National democratic governance",
                                          indicator_name == "sub_obj_c_fh_local_democratic_gov" ~
                                                  "FH: Local democratic governance",
                                          indicator_name == "sub_obj_c_fh_judicial_framework_and_indep" ~
                                                  "FH: Judicial framework and indep.",
                                          indicator_name == "sub_obj_c_wgi_rule_of_law" ~
                                                  "WGI: Rule of law")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_c_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_c_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_1_2"
sub_obj_1_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_1_2_vdem_civil_society" ~
                                       "VDem: Civil society",
                               indicator_name == "sub_obj_1_2_fhi_csosi_overall" ~
                                       "FHI 360: Civil society")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_1_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_1_3"
sub_obj_1_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_1_3_fh_electoral_process" ~
                                       "FH: Electoral process",
                               indicator_name == "sub_obj_1_3_vdem_electoral_democracy" ~
                                       "VDem: Electoral democracy index",
                               indicator_name == "sub_obj_1_3_vdem_political_polarization" ~
                                       "VDem: Political polarization",
                               indicator_name == "sub_obj_1_3_vdem_political_violence" ~
                                       "VDem: Political violence", 
                               indicator_name == "sub_obj_1_3_vdem_mobilization_for_autocracy" ~
                                       "VDem: Mobilization for autocracy",
                               indicator_name == "sub_obj_1_3_vdem_gov_cyber_sec_capacity" ~
                                       "VDem: Gov. cyber sec. capacity",
                               indicator_name == "sub_obj_1_3_vdem_political_party_cyber_sec_capacity" ~
                                       "VDem: Political party cyber sec. capacity",
                               indicator_name == "sub_obj_1_3_vdem_foreign_gov_dissem_false_info" ~
                                       "VDem: Foreign govt. dissem. false info",
                               indicator_name == "sub_obj_1_3_vdem_foreign_gov_advertising" ~
                                       "VDem: Foreign govt. advertising")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_1_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_1"
sub_obj_2_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~
                                       "MSI: Professional journalism",
                               indicator_name == "sub_obj_2_1_vdem_media_critical" ~
                                       "VDem: Print/broadcast media critical",
                               indicator_name == "sub_obj_2_1_vdem_media_bias" ~
                                       "VDem: Media bias",
                               indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~
                                       "VDem: Media corrupt")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_indicator_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_2"
sub_obj_2_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_2_2_msi_plurality_of_news" ~
                                       "MSI: Plurality of news",
                               indicator_name == "sub_obj_2_2_vdem_media_range_of_perspectives" ~
                                       "VDem: Print/broadcast media perspectives",
                               indicator_name == "sub_obj_2_2_msi_business_management" ~
                                       "MSI: Business management",
                               indicator_name == "sub_obj_2_2_vdem_online_media_existence" ~
                                       "VDem: Online media existence")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_2_3"
sub_obj_2_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_2_3_msi_freedom_of_speech" ~
                                       "MSI: Freedom of speech",
                               indicator_name == "sub_obj_2_3_vdem_gov_censor_of_media_effort" ~
                                       "VDem: Govt. censorship effort - Media",
                               indicator_name == "sub_obj_2_3_vdem_harassment_of_journalists" ~
                                       "VDem: Harassment of journalists")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_2_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_3_1"
sub_obj_3_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_3_1_aiddata_esi" ~
                                       "AidData: Energy Security Index",
                               indicator_name == "sub_obj_3_1_iea_net_energy_imports_as_share_of_tes" ~
                                       "IEA: Net energy imports as % of primary supply")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_3_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_3_3"
sub_obj_3_3_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_3_3_rise_energy_efficiency_regulation_rank" ~
                                       "RISE: Energy efficiency regulation rank",
                               indicator_name == "sub_obj_3_3_rise_renewable_energy_regulation_rank" ~
                                       "RISE: Renewable energy regulation rank")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_3_3_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_4_1"
sub_obj_4_1_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_4_1_atlas_eci" ~
                                       "Atlas: Economic Complexity Index",
                               indicator_name == "sub_obj_4_1_dots_exports_to_eu_as_share_of_total_exports" ~
                                       "IMF: Exports to EU-15 as % of total exports",
                               indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi" ~
                                       "IMF: Russia FDI stock as % of total FDI stock",
                               indicator_name == "sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports" ~
                                       "IMF: Exports to Russia as % of total exports")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_4_1_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_4_2"
sub_obj_4_2_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "sub_obj_4_2_legatum_financing_ecosystem" ~
                                       "Legatum: Financing ecosystem",
                               indicator_name == "sub_obj_4_2_legatum_fiscal_sustainability" ~
                                       "Legatum: Fiscal sustainability",
                               indicator_name == "sub_obj_4_2_bti_banking_system" ~
                                       "BTI: Banking system")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_4_2_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_indicator_facet_chart ####
sub_obj_num_var <- "sub_obj_c"
sub_obj_c_indicator_facet_chart <- fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), sub_obj_num == sub_obj_num_var) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(values = indicator_standardized_values,
               var = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~
                                       "WGI: Control of corruption",
                               indicator_name == "cross_cutting_obj_fh_corruption" ~
                                       "FH: Corruption")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, 
                                       color = country)) +
        # geom_line(size = 1) +
        scale_color_manual(values = color_palette %>% slice(-6) %>% pull(hex)) +
        scale_x_continuous(breaks = seq(from = 2001, to = 2019, by = 6), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(var)) +
        geom_segment(data = fmir %>%
                             filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                    sub_obj_num == sub_obj_num_var),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  sub_obj_num == sub_obj_num_var) %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 12/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.height = unit(2,"line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))

# inspect
sub_obj_c_indicator_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_indicator_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_c_indicator_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_russian_indicators_ee_facet_chart ####
obj_1_russian_indicators_ee_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), 
               indicator_name %in% c("sub_obj_1_3_csto_membership",
                                     "sub_obj_1_3_russian_military_presence",
                                     "sub_obj_1_3_icews_socio_political_hostility_from_russia",
                                     "sub_obj_1_3_russian_supported_breach_of_territorial_integrity")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "csto_membership" ~ "CSTO membership",
                               var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Hostility from Russia",
                               var == "russian_military_presence" ~ "Russian military presence",
                               var == "russian_supported_breach_of_territorial_integrity" ~ "Russian-supported breach",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Russian-supported breach", after = Inf),
               var = fct_relevel(.f = var, "ICEWS: Hostility from Russia", after = Inf),
               var = fct_relevel(.f = var, "Russian military presence", after = Inf),
               var = fct_relevel(.f = var, "CSTO membership", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("CSTO membership",
                                      "Russian military presence",
                                      "ICEWS: Hostility from Russia",
                                      "Russian-supported breach")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_1_russian_indicators_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_russian_indicators_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_russian_indicators_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_russian_indicators_graduates_facet_chart ####
obj_1_russian_indicators_graduates_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_1_3_csto_membership",
                                     "sub_obj_1_3_russian_military_presence",
                                     "sub_obj_1_3_icews_socio_political_hostility_from_russia",
                                     "sub_obj_1_3_russian_supported_breach_of_territorial_integrity")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "csto_membership" ~ "CSTO membership",
                               var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Hostility from Russia",
                               var == "russian_military_presence" ~ "Russian military presence",
                               var == "russian_supported_breach_of_territorial_integrity" ~ "Russian-supported breach",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "Russian-supported breach", after = Inf),
               var = fct_relevel(.f = var, "ICEWS: Hostility from Russia", after = Inf),
               var = fct_relevel(.f = var, "Russian military presence", after = Inf),
               var = fct_relevel(.f = var, "CSTO membership", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("CSTO membership",
                                      "Russian military presence",
                                      "ICEWS: Hostility from Russia",
                                      "Russian-supported breach")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_1_russian_indicators_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_russian_indicators_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_russian_indicators_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_russian_indicators_ee_facet_chart ####
obj_2_russian_indicators_ee_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), 
               indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian state\nmedia narratives",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "ICEWS: Russian state\nmedia narratives", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(2) %>% pull(hex),
                           breaks = c("ICEWS: Russian state\nmedia narratives")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 5)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_2_russian_indicators_ee_facet_chart


#//////////////////////////////////


# resize to 155%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_russian_indicators_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_russian_indicators_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_russian_indicators_graduates_facet_chart ####
obj_2_russian_indicators_graduates_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian state\nmedia narratives",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "ICEWS: Russian state\nmedia narratives", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(2) %>% pull(hex),
                           breaks = c("ICEWS: Russian state\nmedia narratives")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 5)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 9, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_2_russian_indicators_graduates_facet_chart


#//////////////////////////////////


# resize to 155%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_russian_indicators_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_russian_indicators_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_russian_indicators_ee_facet_chart ####
obj_3_russian_indicators_ee_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes",
                                     "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports",
                                     "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~
                                       "IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                               var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                               var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                       "IEA: Natural gas imports from Russia\nas % of natural gas imports",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "IEA: Natural gas imports from Russia\nas % of natural gas imports", after = Inf),
               var = fct_relevel(.f = var, "IEA: Fossil fuel imports from Russia\nas % of energy imports", after = Inf),
               var = fct_relevel(.f = var, "IEA: Fossil fuel imports from Russia\nas % of primary energy supply", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                                      "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                                      "IEA: Natural gas imports from Russia\nas % of natural gas imports")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_3_russian_indicators_ee_facet_chart


#//////////////////////////////////


# resize to 155%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_russian_indicators_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_russian_indicators_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_russian_indicators_graduates_facet_chart ####
obj_3_russian_indicators_graduates_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes",
                                     "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports",
                                     "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~
                                       "IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                               var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                               var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                       "IEA: Natural gas imports from Russia\nas % of natural gas imports",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "IEA: Natural gas imports from Russia\nas % of natural gas imports", after = Inf),
               var = fct_relevel(.f = var, "IEA: Fossil fuel imports from Russia\nas % of energy imports", after = Inf),
               var = fct_relevel(.f = var, "IEA: Fossil fuel imports from Russia\nas % of primary energy supply", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports from Russia\nas % of primary energy supply",
                                      "IEA: Fossil fuel imports from Russia\nas % of energy imports",
                                      "IEA: Natural gas imports from Russia\nas % of natural gas imports")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_3_russian_indicators_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_russian_indicators_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_russian_indicators_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_russian_indicators_ee_facet_chart ####
obj_4_russian_indicators_ee_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"), 
               indicator_name %in% c("sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports",
                                     "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi",
                                     "sub_obj_4_1_eaeu_membership",
                                     "sub_obj_4_2_wb_ext_debt_to_russia_as_share_of_total_ext_debt")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "cdis_russian_fdi_as_share_of_total_fdi" ~ "IMF: Russia FDI stock\nas % of total FDI stock",
                               var == "dots_exports_to_russia_as_share_of_total_exports" ~ "IMF: Goods exports to Russia\nas % of total exports",
                               var == "eaeu_membership" ~ "EAEU membership",
                               var == "wb_ext_debt_to_russia_as_share_of_total_ext_debt" ~ "WB: External debt to Russia",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "EAEU membership", after = Inf),
               var = fct_relevel(.f = var, "WB: External debt to Russia", after = Inf),
               var = fct_relevel(.f = var, "IMF: Russia FDI stock\nas % of total FDI stock", after = Inf),
               var = fct_relevel(.f = var, "IMF: Goods exports to Russia\nas % of total exports", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("IMF: Goods exports to Russia\nas % of total exports",
                                      "IMF: Russia FDI stock\nas % of total FDI stock",
                                      "WB: External debt to Russia",
                                      "EAEU membership")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_4_russian_indicators_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_russian_indicators_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_russian_indicators_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_russian_indicators_graduates_facet_chart ####
obj_4_russian_indicators_graduates_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports",
                                     "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi",
                                     "sub_obj_4_1_eaeu_membership",
                                     "sub_obj_4_2_wb_ext_debt_to_russia_as_share_of_total_ext_debt")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "cdis_russian_fdi_as_share_of_total_fdi" ~ "IMF: Russia FDI stock\nas % of total FDI stock",
                               var == "dots_exports_to_russia_as_share_of_total_exports" ~ "IMF: Goods exports to Russia\nas % of total exports",
                               var == "eaeu_membership" ~ "EAEU membership",
                               var == "wb_ext_debt_to_russia_as_share_of_total_ext_debt" ~ "WB: External debt to Russia",
                               TRUE ~ var),
               var = fct_relevel(.f = var, "EAEU membership", after = Inf),
               var = fct_relevel(.f = var, "WB: External debt to Russia", after = Inf),
               var = fct_relevel(.f = var, "IMF: Russia FDI stock\nas % of total FDI stock", after = Inf),
               var = fct_relevel(.f = var, "IMF: Goods exports to Russia\nas % of total exports", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(-c(2, 5, 6)) %>% pull(hex),
                           breaks = c("IMF: Goods exports to Russia\nas % of total exports",
                                      "IMF: Russia FDI stock\nas % of total FDI stock",
                                      "WB: External debt to Russia",
                                      "EAEU membership")) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


obj_4_russian_indicators_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_russian_indicators_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_russian_indicators_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_hostility_from_russia_facet_chart ####
balkans_hostility_from_russia_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_1_3_icews_socio_political_hostility_from_russia")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Socio-political\nhostility from Russia",
                               TRUE ~ var)) %>%
               # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Socio-political\nhostility from Russia"
                                      # "Russian-supported breach"
                                      )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_hostility_from_russia_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_hostility_from_russia_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_hostility_from_russia_facet_chart.docx")




#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_hostility_from_russia_facet_chart ####
eurasia_hostility_from_russia_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_1_3_icews_socio_political_hostility_from_russia")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Socio-political\nhostility from Russia",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Socio-political\nhostility from Russia"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_hostility_from_russia_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_hostility_from_russia_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_hostility_from_russia_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_hostility_from_russia_facet_chart ####
graduates_hostility_from_russia_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_1_3_icews_socio_political_hostility_from_russia")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_socio_political_hostility_from_russia" ~ "ICEWS: Socio-political\nhostility from Russia",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Socio-political\nhostility from Russia"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_hostility_from_russia_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_hostility_from_russia_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_hostility_from_russia_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_narratives_in_russian_media_facet_chart ####
balkans_narratives_in_russian_media_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_narratives_pushed_by_russian_state_media" ~ 
                                       "ICEWS: Narratives pushed\nin Russian state media",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Narratives pushed\nin Russian state media"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_narratives_in_russian_media_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_narratives_in_russian_media_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_narratives_in_russian_media_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_narratives_in_russian_media_facet_chart ####
eurasia_narratives_in_russian_media_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_narratives_pushed_by_russian_state_media" ~ 
                                       "ICEWS: Narratives pushed\nin Russian state media",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Narratives pushed\nin Russian state media"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_narratives_in_russian_media_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_narratives_in_russian_media_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_narratives_in_russian_media_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_narratives_in_russian_media_facet_chart ####
graduates_narratives_in_russian_media_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = indicator_standardized_values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "icews_narratives_pushed_by_russian_state_media" ~ 
                                       "ICEWS: Narratives pushed\nin Russian state media",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("ICEWS: Narratives pushed\nin Russian state media"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Score (higher is better)", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_narratives_in_russian_media_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_narratives_in_russian_media_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_narratives_in_russian_media_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_net_energy_imports_as_share_of_tes_facet_chart ####
balkans_net_energy_imports_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_3_1_iea_net_energy_imports_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_net_energy_imports_as_share_of_tes" ~ 
                                       "IEA: Net energy imports\nas % of primary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Net energy imports\nas % of primary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_net_energy_imports_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_net_energy_imports_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_net_energy_imports_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_net_energy_imports_as_share_of_tes_facet_chart ####
eurasia_net_energy_imports_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_3_1_iea_net_energy_imports_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_net_energy_imports_as_share_of_tes" ~ 
                                       "IEA: Net energy imports\nas % of primary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Net energy imports\nas % of primary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 7/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_net_energy_imports_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_net_energy_imports_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_net_energy_imports_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_net_energy_imports_as_share_of_tes_facet_chart ####
graduates_net_energy_imports_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_3_1_iea_net_energy_imports_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_net_energy_imports_as_share_of_tes" ~ 
                                       "IEA: Net energy imports\nas % of primary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Net energy imports\nas % of primary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 7/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_net_energy_imports_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_net_energy_imports_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_net_energy_imports_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart ####
balkans_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart ####
eurasia_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1.8, by = .3), limits = c(0, 1.8), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 5/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart ####
graduates_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1.8, by = .3), limits = c(0, 1.8), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 5/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_fossil_fuel_imports_from_russia_as_share_of_tes_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart ####
balkans_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nfossil fuel imports",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nfossil fuel imports"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart ####
eurasia_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nfossil fuel imports",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nfossil fuel imports"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart ####
graduates_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                       "IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Fossil fuel imports\nfrom Russia as % of\nprimary energy supply"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_fossil_fuel_imports_from_russia_as_share_of_total_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# balkans_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart ####
balkans_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Balkans"), 
               indicator_name %in% c("sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                       "IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Balkans")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Balkans"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


balkans_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(balkans_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/balkans_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart ####
eurasia_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E Eurasia"), 
               indicator_name %in% c("sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                       "IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E Eurasia")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E Eurasia"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


eurasia_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eurasia_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eurasia_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# graduates_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart ####
graduates_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart <- fmir %>% 
        filter(mcp_grouping %in% c("E&E graduates"), 
               indicator_name %in% c("sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports")) %>%
        select(country, year, indicator_name, values, indicator_standardized_values) %>%
        mutate(var = indicator_name,
               values = values,
               var = str_replace(string = var, pattern = regex("^sub_obj_[0-9]_[0-9]_"), replacement = ""),
               var = case_when(var == "iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                       "IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports",
                               TRUE ~ var)) %>%
        # var = fct_relevel(.f = var, "Russian-supported breach", after = Inf)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) +
        # geom_line(size = 1) + 
        scale_color_manual(values = color_palette %>% slice(c(2)) %>% pull(hex),
                           breaks = c("IEA: Natural gas imports\nfrom Russia as % of\nnatural gas imports"
                                      # "Russian-supported breach"
                           )) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3), expand = c(0,0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent()) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = fmir %>% filter(mcp_grouping %in% c("E&E graduates")),
                     mapping = aes(x = fmir %>%
                                           filter(mcp_grouping %in% c("E&E graduates"),
                                                  year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = fmir %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 8/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


graduates_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/graduates_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_missingness ####
obj_num_var <- "obj_1"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_missingness ####
obj_num_var <- "obj_2"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_missingness ####
obj_num_var <- "obj_3"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_missingness ####
obj_num_var <- "obj_4"
chart_data <- fmir %>% 
        filter(obj_num == obj_num_var) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>% 
        unite(col = "sub_obj_num", sub_obj_num, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = sub_obj_num, values_from = sub_obj_avg) %>% 
        left_join(.,
                  fmir %>% filter(obj_num == obj_num_var) %>%
                          distinct(country, mcp_grouping, year, obj_avg) %>%
                          mutate(var = "obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country = case_when(country == "U.S.: U.S." ~ "U.S.",
                                   country == "Russia: Russia" ~ "Russia",
                                   TRUE ~ country),
               country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "Russia" ~ 5,
                                             mcp_grouping == "EU-15" ~ 6,
                                             mcp_grouping == "U.S." ~ 7),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # filter(str_detect(string = variable, pattern = regex(str_c("vdem_judicial_constraints_on_exec",
        #                                                            "vdem_leg_constraints_on_exec",
        #                                                            "fh_national_democratic_gov",
        #                                                            "wgi_rule_of_law",
        #                                                            "sub_obj_avg",
        #                                                            sep = "|")))) %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "obj_avg_2001",
                                      "obj_avg_2002",
                                      "obj_avg_2003",
                                      "obj_avg_2004",
                                      "obj_avg_2005",
                                      "obj_avg_2006",
                                      "obj_avg_2007",
                                      "obj_avg_2008",
                                      "obj_avg_2009",
                                      "obj_avg_2010",
                                      "obj_avg_2011",
                                      "obj_avg_2012",
                                      "obj_avg_2013",
                                      "obj_avg_2014",
                                      "obj_avg_2015",
                                      "obj_avg_2016",
                                      "obj_avg_2017",
                                      "obj_avg_2018",
                                      "obj_avg_2019",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
obj_4_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                   fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list, labels = c("Not missing", "Missing")) + 
        coord_fixed(ratio = 1/2, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 6, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


obj_4_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_1_missingness ####
sub_obj_num_var <- "sub_obj_1_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 6, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_2_missingness ####
sub_obj_num_var <- "sub_obj_1_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_part_1_missingness ####
sub_obj_num_var <- "sub_obj_1_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        filter(indicator_name %in% c("sub_obj_1_3_vdem_electoral_democracy",
                                     "sub_obj_1_3_fh_electoral_process",
                                     "sub_obj_1_3_vdem_political_polarization",
                                     "sub_obj_1_3_vdem_political_violence",
                                     "sub_obj_1_3_vdem_mobilization_for_autocracy",
                                     "sub_obj_1_3_vdem_gov_cyber_sec_capacity")) %>%
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        # left_join(.,
        #           fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
        #                   distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        #                   mutate(var = "sub_obj_avg") %>%
        #                   unite(col = "var", var, year) %>%
        #                   pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
        #           by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # mutate(variable = fct_relevel(.f = variable,
        #                               "sub_obj_avg_2010",
        #                               "sub_obj_avg_2011",
        #                               "sub_obj_avg_2012",
        #                               "sub_obj_avg_2013",
        #                               "sub_obj_avg_2014",
        #                               "sub_obj_avg_2015",
        #                               "sub_obj_avg_2016",
        #                               "sub_obj_avg_2017",
        #                               "sub_obj_avg_2018",
        #                               "sub_obj_avg_2019",
        #                               "sub_obj_avg_2020",
        #                               "sub_obj_avg_2021",
        #                               after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_3_part_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_3_part_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_part_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_part_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_1_3_part_2_missingness ####
sub_obj_num_var <- "sub_obj_1_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        filter(!(indicator_name %in% c("sub_obj_1_3_vdem_electoral_democracy",
                                     "sub_obj_1_3_fh_electoral_process",
                                     "sub_obj_1_3_vdem_political_polarization",
                                     "sub_obj_1_3_vdem_political_violence",
                                     "sub_obj_1_3_vdem_mobilization_for_autocracy",
                                     "sub_obj_1_3_vdem_gov_cyber_sec_capacity"))) %>%
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_1_3_part_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_1_3_part_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_1_3_part_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_1_3_part_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_part_1_missingness ####
sub_obj_num_var <- "sub_obj_2_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                     "sub_obj_2_1_aiddata_content_producers",
                                     "sub_obj_2_1_vdem_media_critical",
                                     "sub_obj_2_1_vdem_media_bias",
                                     "sub_obj_2_1_vdem_media_corrupt",
                                     "sub_obj_2_1_vdem_gov_dissem_false_info_domestically")) %>%
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        # left_join(.,
        #           fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
        #                   distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        #                   mutate(var = "sub_obj_avg") %>%
        #                   unite(col = "var", var, year) %>%
        #                   pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
        #           by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        # mutate(variable = fct_relevel(.f = variable,
        #                               "sub_obj_avg_2010",
        #                               "sub_obj_avg_2011",
        #                               "sub_obj_avg_2012",
        #                               "sub_obj_avg_2013",
        #                               "sub_obj_avg_2014",
        #                               "sub_obj_avg_2015",
        #                               "sub_obj_avg_2016",
        #                               "sub_obj_avg_2017",
        #                               "sub_obj_avg_2018",
        #                               "sub_obj_avg_2019",
        #                               "sub_obj_avg_2020",
        #                               after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_1_part_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_1_part_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_part_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_part_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_part_2_missingness ####
sub_obj_num_var <- "sub_obj_2_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        filter(!(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                     "sub_obj_2_1_aiddata_content_producers",
                                     "sub_obj_2_1_vdem_media_critical",
                                     "sub_obj_2_1_vdem_media_bias",
                                     "sub_obj_2_1_vdem_media_corrupt",
                                     "sub_obj_2_1_vdem_gov_dissem_false_info_domestically"))) %>%
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_1_part_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                                fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_1_part_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_part_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_part_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_2_missingness ####
sub_obj_num_var <- "sub_obj_2_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_3_missingness ####
sub_obj_num_var <- "sub_obj_2_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_2_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_2_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_1_missingness ####
sub_obj_num_var <- "sub_obj_3_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_missingness ####
sub_obj_num_var <- "sub_obj_3_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_3_missingness ####
sub_obj_num_var <- "sub_obj_3_3"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_3_3_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_3_3_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_3_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_3_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_1_missingness ####
sub_obj_num_var <- "sub_obj_4_1"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_4_1_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_4_1_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_1_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_1_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_4_2_missingness ####
sub_obj_num_var <- "sub_obj_4_2"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == sub_obj_num_var) %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_4_2_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_4_2_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_4_2_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_4_2_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_missingness ####
sub_obj_num_var <- "cross_cutting_obj"
chart_data <- fmir %>% 
        filter(str_detect(string = indicator_name, pattern = regex(sub_obj_num_var))) %>%
        select(indicator_name, country, mcp_grouping, year, values) %>% 
        mutate(indicator_name = str_replace(string = indicator_name, pattern = str_c(sub_obj_num_var, "_"), replacement = "")) %>%
        unite(col = "indicator_name", indicator_name, year) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = indicator_name, values_from = values) %>% 
        left_join(.,
                  fmir %>% filter(sub_obj_num == "sub_obj_c") %>%
                          distinct(country, mcp_grouping, year, sub_obj_avg) %>%
                          mutate(var = "sub_obj_avg") %>%
                          unite(col = "var", var, year) %>%
                          pivot_wider(id_cols = country, names_from = var, values_from = sub_obj_avg),
                  by = "country") %>%
        unite(col = "country", mcp_grouping, country, sep = ": ", remove = FALSE) %>%
        mutate(country_fct_level = case_when(mcp_grouping == "E&E Balkans" ~ 1,
                                             mcp_grouping == "E&E Eurasia" ~ 2,
                                             mcp_grouping == "CARs" ~ 3,
                                             mcp_grouping == "E&E graduates" ~ 4,
                                             mcp_grouping == "EU-15" ~ 5),
               country = fct_reorder(.f = country, .x = country_fct_level, .fun = min)) %>%
        select(-c(country_fct_level, mcp_grouping)) %>%
        group_by(country) %>% miss_var_summary() %>%
        ungroup() %>%
        mutate(variable = fct_relevel(.f = variable,
                                      "sub_obj_avg_2010",
                                      "sub_obj_avg_2011",
                                      "sub_obj_avg_2012",
                                      "sub_obj_avg_2013",
                                      "sub_obj_avg_2014",
                                      "sub_obj_avg_2015",
                                      "sub_obj_avg_2016",
                                      "sub_obj_avg_2017",
                                      "sub_obj_avg_2018",
                                      "sub_obj_avg_2019",
                                      "sub_obj_avg_2020",
                                      "sub_obj_avg_2021",
                                      after = Inf)) %>%
        mutate(color = case_when(pct_miss == 0 ~ "#2474B6",
                                 pct_miss == 100 ~ "#7D7D7D"),
               color_bin = case_when(pct_miss == 0 ~ "Not missing",
                                     pct_miss == 100 ~ "Missing"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////        


# create chart
sub_obj_c_missingness <- chart_data %>% ggplot(data = ., mapping = aes(x = variable, y = country, 
                                                                         fill = factor(color_bin, levels = c("Not missing", "Missing")))) +
        geom_tile(color = "#DDDDDD") +
        scale_fill_manual(values = chart_data_color_list) + 
        coord_fixed(ratio = 1/1.5, clip = "off") +
        labs(x = "Indicator by year", y = "Country", fill = NULL) +
        theme_minimal() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 5, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 5, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                legend.key.size = unit(3, "mm"),
                legend.title = element_text(size = 5, family = "Calibri", face = "plain", color = "#333333", hjust = 1,
                                            margin(t = 0, r = 0, b = 0, l = 0, unit = "pt")),
                legend.text = element_text(size = 5, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 


sub_obj_c_missingness


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_missingness)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_c_missingness.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_albania_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Albania"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_albania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_albania_line_chart


#//////////////////////////////////


# resize to 178%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_albania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_albania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_armenia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "armenia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Armenia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_armenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_armenia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_armenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_armenia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_azerbaijan_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "azerbaijan") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Azerbaijan"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_azerbaijan_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_azerbaijan_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_belarus_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "belarus") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Belarus"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_belarus_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_belarus_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_bih_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "bih") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "BiH"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_bih_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_georgia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "georgia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Georgia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_georgia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_kosovo_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "kosovo") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Kosovo"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_kosovo_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_kosovo_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_kosovo_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_kosovo_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_moldova_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "moldova") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Moldova"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_moldova_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_moldova_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_moldova_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_moldova_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_macedonia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "macedonia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "N. Macedonia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_macedonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_macedonia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_macedonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_macedonia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_serbia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "serbia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Serbia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_serbia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_ukraine_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "ukraine") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. ukraine", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "ukraine", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_ukraine_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_ukraine_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_ukraine_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_ukraine_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_bulgaria_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "bulgaria") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. bulgaria", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "bulgaria", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Bulgaria"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_bulgaria_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_bulgaria_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_bulgaria_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_bulgaria_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_croatia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "croatia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. croatia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "croatia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Croatia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_croatia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_croatia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_croatia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_croatia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_czechia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "czechia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. czechia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "czechia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Czechia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_czechia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_czechia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_czechia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_czechia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_estonia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "estonia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. estonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "estonia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Estonia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_estonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_estonia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_estonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_estonia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_hungary_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "hungary") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. hungary", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "hungary", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Hungary"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_hungary_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_latvia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "latvia") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. latvia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "latvia", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Latvia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_latvia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_latvia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_latvia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_latvia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_lithuania_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "lithuania") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. lithuania", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "lithuania", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Lithuania"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_lithuania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_lithuania_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_lithuania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_lithuania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_montenegro_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "montenegro") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. montenegro", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "montenegro", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "montenegro"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_montenegro_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_montenegro_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_montenegro_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_montenegro_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_poland_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "poland") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Poland"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_poland_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_poland_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_romania_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "poland") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Romania"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_romania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_romania_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_romania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_romania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_slovakia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "poland") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Slovakia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_slovakia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_slovakia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_slovakia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_slovakia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_slovenia_line_chart ####
fmir %>% filter(obj_num == "obj_1") %>% count(indicator_name)
fmir %>% count(obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans", year == 2020, country == "poland") %>% 
        select(country, year, indicator_name, values, obj_avg)
fmir %>% 
        filter(obj_num == "obj_1", indicator_name == "obj_1_cdis_russian_fdi_as_share_of_gdp", is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(obj_num == "obj_1", mcp_grouping == "E&E Balkans") %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "poland", obj_num == "obj_1", indicator_name == "obj_1_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Slovenia"
chart_data <- fmir %>% 
        filter(country == current_country) %>%
        mutate(values = obj_avg) %>%
        distinct(country, mcp_grouping, year, obj_num, values) %>%
        # bind_rows(., fmir %>% 
        #                   filter(country == current_country) %>%
        #                   distinct(country, mcp_grouping, year, miri_avg) %>%
        #                   mutate(obj_num = "miri",
        #                          values = miri_avg) %>%
        #                   select(obj_num, country, year, mcp_grouping, values)) %>%
        arrange(desc(obj_num)) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption",
                                     obj_num == "miri" ~ "Resilience Index"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Resilience Index" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_slovenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Resilience Index"),
        #           mapping = aes(x = year + .35, y = label_position, label = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_slovenia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_slovenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_slovenia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_balkans_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                            color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                            color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                            color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                            color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_balkans_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Albania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "BiH"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Kosovo"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "N. Macedonia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Serbia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_balkans_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_balkans_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_balkans_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_balkans_truncated_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = .2, to = .8, by = .2), limits = c(.2, .8))


fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>%
        mutate(miri_avg_for_mcp_grouping = mean(miri_avg)) %>%
        ungroup() %>%
        arrange(year) %>%
        distinct(mcp_grouping, year, miri_avg_for_mcp_grouping) %>%
        rename(values = miri_avg_for_mcp_grouping) %>%
        mutate(country = mcp_grouping,
               miri_avg = values) %>%
        select(country, year, mcp_grouping, miri_avg, values)


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>% 
        bind_rows(., 
                  fmir %>% filter(mcp_grouping == "E&E graduates") %>%
                          distinct(country, mcp_grouping, year, miri_avg) %>%
                          group_by(mcp_grouping, year) %>%
                          mutate(miri_avg_for_mcp_grouping = mean(miri_avg)) %>%
                          ungroup() %>%
                          arrange(year) %>%
                          distinct(mcp_grouping, year, miri_avg_for_mcp_grouping) %>%
                          rename(values = miri_avg_for_mcp_grouping) %>%
                          mutate(country = mcp_grouping,
                                 miri_avg = values) %>%
                          select(country, year, mcp_grouping, miri_avg, values)) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(10) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(shift = 0, gap = .02)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_balkans_truncated_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = .3, to = .7, by = .1), limits = c(.3, .7), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 12, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_balkans_truncated_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_balkans_truncated_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_balkans_truncated_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_eurasia_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_eurasia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Armenia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Azerbaijan"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Belarus"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Georgia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Moldova"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Ukraine"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_eurasia_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_eurasia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_eurasia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_eurasia_truncated_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = .2, to = .8, by = .2), limits = c(.2, .8))


fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>%
        mutate(miri_avg_for_mcp_grouping = mean(miri_avg)) %>%
        ungroup() %>%
        arrange(year) %>%
        distinct(mcp_grouping, year, miri_avg_for_mcp_grouping) %>%
        rename(values = miri_avg_for_mcp_grouping) %>%
        mutate(country = mcp_grouping,
               miri_avg = values) %>%
        select(country, year, mcp_grouping, miri_avg, values)


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>% 
        bind_rows(., 
                  fmir %>% filter(mcp_grouping == "E&E graduates") %>%
                          distinct(country, mcp_grouping, year, miri_avg) %>%
                          group_by(mcp_grouping, year) %>%
                          mutate(miri_avg_for_mcp_grouping = mean(miri_avg)) %>%
                          ungroup() %>%
                          arrange(year) %>%
                          distinct(mcp_grouping, year, miri_avg_for_mcp_grouping) %>%
                          rename(values = miri_avg_for_mcp_grouping) %>%
                          mutate(country = mcp_grouping,
                                 miri_avg = values) %>%
                          select(country, year, mcp_grouping, miri_avg, values)) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(10) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(shift = 0, gap = .03)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_eurasia_truncated_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = .2, to = .7, by = .1), limits = c(.2, .7), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .7, yend = .7), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 12, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_eurasia_truncated_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_eurasia_truncated_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_eurasia_truncated_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_graduates_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Bulgaria" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Croatia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Czechia" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Estonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Hungary" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Latvia" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Romania" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Slovakia" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Slovenia" ~ color_palette %>% slice(13) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_graduates_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Bulgaria"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Croatia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Czechia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Estonia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Hungary"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Latvia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Lithuania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Montenegro"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Poland"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Romania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovakia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovenia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_graduates_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_graduates_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_graduates_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_graduates_truncated_line_chart ####

# plot
fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = .2, to = .8, by = .2), limits = c(.2, .8))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Bulgaria" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Croatia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Czechia" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Estonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Hungary" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Latvia" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Romania" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Slovakia" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Slovenia" ~ color_palette %>% slice(13) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(shift = -.1, gap = .03)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_graduates_truncated_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Bulgaria"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Croatia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Czechia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Estonia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Hungary"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Latvia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Lithuania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Montenegro"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Poland"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Romania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovakia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovenia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = .2, to = .8, by = .2), limits = c(.2, .8), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 9 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_graduates_truncated_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_graduates_truncated_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_graduates_truncated_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_graduates_group_1_line_chart ####

# check graduates based on 2020 ri_avg
fmir %>% filter(mcp_grouping == "E&E graduates", year == 2020) %>% distinct(country, year, miri_avg)

# plot
fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(country %in% c("Bulgaria",
                              "Croatia",
                              "Czechia",
                              "Estonia",
                              "Hungary",
                              "Latvia")) %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Bulgaria" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Croatia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Czechia" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Estonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Hungary" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Latvia" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_graduates_group_1_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Bulgaria"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Croatia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Czechia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Estonia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Hungary"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Latvia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_graduates_group_1_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_graduates_group_1_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_graduates_group_1_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_graduates_group_2_line_chart ####

# check graduates based on 2020 ri_avg
fmir %>% filter(mcp_grouping == "E&E graduates", year == 2020) %>% distinct(country, year, miri_avg) 

# plot
fmir %>% filter(mcp_grouping == "E&E graduates") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg, color = country)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(country %in% c("Lithuania",
                              "Montenegro",
                              "Poland",
                              "Romania",
                              "Slovakia",
                              "Slovenia")) %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        mutate(values = miri_avg) %>%
        arrange(country) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Lithuania" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Romania" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Slovakia" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Slovenia" ~ color_palette %>% slice(13) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_graduates_group_2_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Lithuania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Montenegro"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Poland"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Romania"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovakia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Slovenia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_graduates_group_2_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_graduates_group_2_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_graduates_group_2_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ri_avg_regional_avg_line_chart ####


# plot
fmir %>% distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_miri_avg, color = mcp_grouping)) + geom_line() +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1))


#//////////////////


# get chart_data
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        group_by(mcp_grouping, year) %>% mutate(avg_miri_avg = mean(miri_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_miri_avg) %>%
        mutate(values = avg_miri_avg) %>%
        arrange(mcp_grouping) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ri_avg_regional_avg_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Balkans"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Eurasia"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Graduates"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "CARs"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "EU-15"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ri_avg_regional_avg_line_chart


#//////////////////////////////////


# resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_avg_regional_avg_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_avg_regional_avg_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# get ee_region_obj_infographic ####


# flags from state dept: https://www.state.gov/countries-areas/

# create circle_palette
# https://www.rdocumentation.org/packages/dichromat/versions/1.1/topics/colorRampPalette
# colors come
circle_palette <- colorRampPalette(c(brewer.pal(n = 9, "Blues") %>% as_tibble() %>% slice(4) %>% pull(value), 
                                     brewer.pal(n = 9, "Blues") %>% as_tibble() %>% slice(9) %>% pull(value)))


#//////////////////////


# inspect
brewer.pal(n = 9, "Blues") %>% show_col()
circle_palette(5) %>% show_col()
circle_palette(100) %>% show_col()
col2rgb(col = "#9ECAE1") %>% str_c(., collapse = "/") 
col2rgb(col = "#9ECAE1")
col2rgb(col = "#78A3C3")
col2rgb(col = "#08306B")


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get ee_region_obj_infographic
# note that the obj_avg value will be displayed on the table, but the obj_avg_normalized value will be used to set color quantile
# since the obj_avg_normalized will now range from 0 to 1, while obj_avg does not necessarily because max/min may be in other year
# this ensures full range of circle_palette colors are used to allow for most distinction possible
# obj_avg_normalized btw 0-20 = q1, 21-40 = q2, 41-60 = q3, 61-80 = q4, 81-100 = q5

# get round_to_digits 
round_to_digits <- function(x, digits, big_mark = ",") {
        sign <- sign(x)
        z <- abs(x) * 10^digits
        z <- z + 0.5
        z <- trunc(z)
        z <- z / 10^digits
        z <- z * sign
        return(str_trim(string = format(x = z, nsmall = digits, big.mark = big_mark), side = "both"))
}


#////////////////


ee_region_obj_infographic <- fmir %>% 
        filter(year == 2021,
                mcp_grouping %in% c("E&E Eurasia", "E&E Balkans")) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        mutate(obj_avg = round_to_digits(obj_avg, digits = 2)) %>%
        select(obj_num, country, obj_avg) %>%
        pivot_wider(id_cols = country, names_from = obj_num, values_from = obj_avg) %>%
        left_join(., fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Eurasia", "E&E Balkans")) %>% 
                          distinct(country, miri_avg), by = "country") %>%
        mutate(miri_avg = round_to_digits(miri_avg, digits = 2),
                country = str_c("  ", country)) %>%
        relocate(miri_avg, .after = country) %>%
        arrange(desc(miri_avg))


#//////////////////////


# inspect
ee_region_obj_infographic 
ee_region_obj_infographic %>% glimpse()
ee_region_obj_infographic %>% nrow() # 11
ee_region_obj_infographic %>% ncol() # 7


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_avg_normalized_quantile_cutoffs, creating one set of color thresholds to be applied uniformly to all obj in the table
# this just makes it easier to automatically assign color-coded quantiles for the full range of values for E&E countries
# whereas using the actual obj_avg values themselves would require checks after updates to make sure the cutoffs are still balanced
# across the full range of obj_avg values
# note that this doesn't include miri_avg, but the table does, but this is fine because miri_avg by definition must fall within
# range of max/min obj_avg, and since this only gets the color quantiles based on max/min values, it's fine to exclude miri_avg
obj_avg_normalized_quantile_cutoffs <- fmir %>% 
        filter(year == 2021,
                mcp_grouping %in% c("E&E Eurasia", "E&E Balkans")) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        mutate(obj_avg_min = min(obj_avg),
               obj_avg_max = max(obj_avg),
               obj_avg_normalized = (obj_avg - obj_avg_min) / (obj_avg_max - obj_avg_min),
               q0_to_q20 = .20 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q21_to_q40 = .40 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q41_to_q60 = .60 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q61_to_q80 = .80 * (obj_avg_max - obj_avg_min) + obj_avg_min,
               q81_to_q100 = 1 * (obj_avg_max - obj_avg_min) + obj_avg_min)


#/////////////////////////


# inspect
obj_avg_normalized_quantile_cutoffs 
# obj_avg_normalized = (obj_avg - obj_avg_min) / (obj_avg_max - obj_avg_min)

# check q0-q20 threshold
(0.163 - 0.0439) / (0.641 - 0.0439)

# check q21-q40 threshold
(0.283 - 0.0439) / (0.641 - 0.0439)

# check q41-q60 threshold
(0.402 - 0.0439) / (0.641 - 0.0439)

# check q61-q80 threshold
(0.522 - 0.0439) / (0.641 - 0.0439)

# check q61-q80 threshold
(0.641 - 0.0439) / (0.641 - 0.0439)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# create circle_palette_tbl
# manually apply conditional formatting in excel to highlight and change font color
# =IF(AND(B4>5, B4<10),TRUE,FALSE)
circle_palette_tbl <- obj_avg_normalized_quantile_cutoffs %>% select(starts_with("q")) %>% distinct() %>%
        pivot_longer(cols = everything(), names_to = "quintile", values_to = "obj_avg_threshold") %>%
        left_join(., tibble(hex = circle_palette(5), 
                             quintile = c("q0_to_q20", "q21_to_q40", "q41_to_q60", "q61_to_q80", "q81_to_q100")) %>%
                mutate(rgb = map(.x = hex, .f = ~ col2rgb(col = .x) %>% str_c(., collapse = "."))) %>%
                unnest(rgb),
                by = "quintile")
circle_palette_tbl 


#//////////////////////////////////////////////////////////////////////////////////////////////////


# write ee_region_obj_infographic to file

# note csv will be copied into xlsx shell and formatted
# old: blue header is rgb 31/73/125
# current: gray header is rgb 128/128/128
# grey grid lines are rgb 217/217/217, medium weight
# country rows on left side gets a rgb 217/217/217 heavy border
# grey top/bottom row above/under table is rgb 217/217/217, height = 15
# font is Calibri, size 15, bolded, centered horizontally/vertically in cells; 
# grey font color = rgb 51/51/51, white for column headers
# flag column is width = 15
# country name column is width = 32
# data columns are width = 28
# column header row height = 95
# data row height = 35
# data cells formatted as number with two decimal places, to avoid truncation (e.g. 0.70 converted to 0.7)

# remember to fully spell out macedonia and bih
# output is copied into powerpoint using paste special -> Picture (Enhanced Metafile), aligned center
# flags are copy/pasted in from state dept website, w locked aspect ratio, and resized to 87% 
# ungroup old table and bring flags to front, then drag flags on top of new table
# then right click on grouped image and save as EMF
# emf is then added to slide deck by Insert -> Picture and resized to 175% and centered

# write file
# ee_region_obj_infographic %>% write_csv("output/charts/ee_region_obj_infographic.csv")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# create patch_radar_charts ####

# get custom radarchart2, which takes vlabcol and vlab_fontface arg
# https://stackoverflow.com/questions/54185029/change-labels-colors-in-r-radarchart
# https://r-charts.com/ranking/radar-chart/

# updated workflow to save radarchart as ggplot w/ emf:
# 1) use recordPlot to get last plot as saved object
# 2) use ggplotify::as.ggplot() to wrap cowplot::as_grob to save as ggplot object, then save as normal
# https://stackoverflow.com/questions/29583849/save-a-plot-in-an-object
# https://cran.r-project.org/web/packages/ggplotify/vignettes/ggplotify.html
# https://rdrr.io/cran/cowplot/man/as_grob.html



#/////////////////////////


get_patch_radar_chart <- function (df, country = NULL, axistype = 0, seg = 4, pty = 16, pcol = 1:8, plty = 1:6, 
                         plwd = 1, pdensity = NULL, pangle = 45, pfcol = NA, cglty = 3, 
                         cglwd = 1, cglcol = "navy", axislabcol = "blue", vlabcol = "black", vlab_fontface = 1, title = "", 
                         maxmin = TRUE, na.itp = TRUE, centerzero = FALSE, vlabels = NULL, 
                         vlcex = NULL, caxislabels = NULL, calcex = NULL, paxislabels = NULL, 
                         palcex = NULL, ...) {
       
        # set default parameters
        axistype = 1 
        
        # point symbol
        pty = 32
        
        # color for outside of plotted rings
        pcol = c("#EF6712", "#2474B6")
        
        # color for inside of plotted rings
        pfcol = c(NA, "#2474B670")
        
        # width of plotted rings
        plwd = 8
        
        # line type for plotted rings
        plty = 1
        
        # number of axis segments between center and outer rim
        seg = 5 
        
        # line color for grid segments
        cglcol = "#999999"
        
        # line type for grid segments
        cglty = 1 
        
        # color of axis grid segment labels
        # axislabcol = "#333333", 
        axislabcol = "#333333"
        
        # values for axis grid segment labels
        caxislabels = c("0.0", "0.2", "0.4", "0.6", "0.8", "1.0")
        
        # line width for axis grid segments
        cglwd = 2
        
        # font magnification for outer labels
        vlcex = 2

        # font color for outer labels
        vlabcol = "#333333"
        
        # font face for outer labels
        vlab_fontface = 1
        
        # font magnification for center labels
        calcex = 1.5

        # set font as parameter; 1 is normal, 2 is bold, 3 is italic
        current_parameters <- par(family = "Calibri", font = 1)
        par(current_parameters)
        
        
        #///////////////////////////////////////////////////////////////////////////////////////////////////////
        
        
        if (!is.data.frame(df)) {
                cat("The data must be given as dataframe.\n")
                return()
        }
        if ((n <- length(df)) < 3) {
                cat("The number of variables must be 3 or more.\n")
                return()
        }
        if (maxmin == FALSE) {
                dfmax <- apply(df, 2, max)
                dfmin <- apply(df, 2, min)
                df <- rbind(dfmax, dfmin, df)
        }
        plot(c(-1.2, 1.2), c(-1.2, 1.2), type = "n", frame.plot = FALSE, 
             axes = FALSE, xlab = "", ylab = "", main = title, asp = 1, 
             ...)
        theta <- seq(90, 450, length = n + 1) * pi/180
        theta <- theta[1:n]
        xx <- cos(theta)
        yy <- sin(theta)
        CGap <- ifelse(centerzero, 0, 1)
        for (i in 0:seg) {
                polygon(xx * (i + CGap)/(seg + CGap), yy * (i + CGap)/(seg + 
                                                                               CGap), lty = cglty, lwd = cglwd, border = cglcol)
                if (axistype == 1 | axistype == 3) 
                        CAXISLABELS <- paste(i/seg * 100, "(%)")
                if (axistype == 4 | axistype == 5) 
                        CAXISLABELS <- sprintf("%3.2f", i/seg)
                if (!is.null(caxislabels) & (i < length(caxislabels))) 
                        CAXISLABELS <- caxislabels[i + 1]
                if (axistype == 1 | axistype == 3 | axistype == 4 | 
                    axistype == 5) {
                        if (is.null(calcex)) 
                                text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                     col = axislabcol)
                        else text(-0.05, (i + CGap)/(seg + CGap), CAXISLABELS, 
                                  col = axislabcol, cex = calcex)
                }
        }
        if (centerzero) {
                arrows(0, 0, xx * 1, yy * 1, lwd = cglwd, lty = cglty, 
                       length = 0, col = cglcol)
        }
        else {
                arrows(xx/(seg + CGap), yy/(seg + CGap), xx * 1, yy * 
                               1, lwd = cglwd, lty = cglty, length = 0, col = cglcol)
        }
        PAXISLABELS <- df[1, 1:n]
        if (!is.null(paxislabels)) 
                PAXISLABELS <- paxislabels
        if (axistype == 2 | axistype == 3 | axistype == 5) {
                if (is.null(palcex)) 
                        text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol)
                else text(xx[1:n], yy[1:n], PAXISLABELS, col = axislabcol, 
                          cex = palcex)
        }
        VLABELS <- colnames(df)
        if (!is.null(vlabels)) 
                VLABELS <- vlabels
        if (is.null(vlcex)) 
                text(xx * 1.2, yy * 1.2, VLABELS, col = vlabcol, font = vlab_fontface)
        else text(xx * 1.2, yy * 1.2, VLABELS, cex = vlcex, col = vlabcol, font = vlab_fontface)
        series <- length(df[[1]])
        SX <- series - 2
        if (length(pty) < SX) {
                ptys <- rep(pty, SX)
        }
        else {
                ptys <- pty
        }
        if (length(pcol) < SX) {
                pcols <- rep(pcol, SX)
        }
        else {
                pcols <- pcol
        }
        if (length(plty) < SX) {
                pltys <- rep(plty, SX)
        }
        else {
                pltys <- plty
        }
        if (length(plwd) < SX) {
                plwds <- rep(plwd, SX)
        }
        else {
                plwds <- plwd
        }
        if (length(pdensity) < SX) {
                pdensities <- rep(pdensity, SX)
        }
        else {
                pdensities <- pdensity
        }
        if (length(pangle) < SX) {
                pangles <- rep(pangle, SX)
        }
        else {
                pangles <- pangle
        }
        if (length(pfcol) < SX) {
                pfcols <- rep(pfcol, SX)
        }
        else {
                pfcols <- pfcol
        }
        for (i in 3:series) {
                xxs <- xx
                yys <- yy
                scale <- CGap/(seg + CGap) + (df[i, ] - df[2, ])/(df[1, 
                                                                     ] - df[2, ]) * seg/(seg + CGap)
                if (sum(!is.na(df[i, ])) < 3) {
                        cat(sprintf("[DATA NOT ENOUGH] at %d\n%g\n", i, 
                                    df[i, ]))
                }
                else {
                        for (j in 1:n) {
                                if (is.na(df[i, j])) {
                                        if (na.itp) {
                                                left <- ifelse(j > 1, j - 1, n)
                                                while (is.na(df[i, left])) {
                                                        left <- ifelse(left > 1, left - 1, n)
                                                }
                                                right <- ifelse(j < n, j + 1, 1)
                                                while (is.na(df[i, right])) {
                                                        right <- ifelse(right < n, right + 1, 
                                                                        1)
                                                }
                                                xxleft <- xx[left] * CGap/(seg + CGap) + 
                                                        xx[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                yyleft <- yy[left] * CGap/(seg + CGap) + 
                                                        yy[left] * (df[i, left] - df[2, left])/(df[1, 
                                                                                                   left] - df[2, left]) * seg/(seg + CGap)
                                                xxright <- xx[right] * CGap/(seg + CGap) + 
                                                        xx[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                yyright <- yy[right] * CGap/(seg + CGap) + 
                                                        yy[right] * (df[i, right] - df[2, right])/(df[1, 
                                                                                                      right] - df[2, right]) * seg/(seg + 
                                                                                                                                            CGap)
                                                if (xxleft > xxright) {
                                                        xxtmp <- xxleft
                                                        yytmp <- yyleft
                                                        xxleft <- xxright
                                                        yyleft <- yyright
                                                        xxright <- xxtmp
                                                        yyright <- yytmp
                                                }
                                                xxs[j] <- xx[j] * (yyleft * xxright - yyright * 
                                                                           xxleft)/(yy[j] * (xxright - xxleft) - 
                                                                                            xx[j] * (yyright - yyleft))
                                                yys[j] <- (yy[j]/xx[j]) * xxs[j]
                                        }
                                        else {
                                                xxs[j] <- 0
                                                yys[j] <- 0
                                        }
                                }
                                else {
                                        xxs[j] <- xx[j] * CGap/(seg + CGap) + xx[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                        yys[j] <- yy[j] * CGap/(seg + CGap) + yy[j] * 
                                                (df[i, j] - df[2, j])/(df[1, j] - df[2, 
                                                                                     j]) * seg/(seg + CGap)
                                }
                        }
                        if (is.null(pdensities)) {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], col = pfcols[i - 
                                                                                                                                          2])
                        }
                        else {
                                polygon(xxs, yys, lty = pltys[i - 2], lwd = plwds[i - 
                                                                                          2], border = pcols[i - 2], density = pdensities[i - 
                                                                                                                                                  2], angle = pangles[i - 2], col = pfcols[i - 
                                                                                                                                                                                                   2])
                        }
                        points(xx * scale, yy * scale, pch = ptys[i - 2],
                               col = pcols[i - 2])
                }
        }
        
        
        #//////////////////////////////////////////////////////////////////////////////////////////////
        
        
        # set default legend
        legend(x = .6, y = 1.2, legend = c("EU-15", country), bty = "n",
               pch = 20 , col = c("#EF6712", "#2474B6") , text.col = "#333333", cex = 2, pt.cex = 4)
        
}




#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# get eu_obj_avg 
# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_obj_avg <- fmir %>% filter(mcp_grouping == "EU-15", year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        group_by(obj_num, year) %>%
        mutate(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>%
        slice(1) %>% 
        ungroup() %>% select(-c(country, obj_avg)) 


#//////////////////////


# inspect
eu_obj_avg
eu_obj_avg %>% nrow() # 5
eu_obj_avg %>% ncol() # 3

# test eu_obj_avg
test_eu_obj_avg <- function() {
        
        # test obj_1
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_1", year == 2021) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_1", year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))  
        
        # test obj_2
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_2", year == 2021) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_2", year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        
        # test obj_3
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_3", year == 2021) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_3", year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        
        # test obj_4
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_4", year == 2021) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_4", year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
        
        # test obj_c
        expect_equal(object = eu_obj_avg %>% filter(obj_num == "obj_c", year == 2021) %>% pull(obj_avg_for_eu),
                     expected = fmir %>% filter(obj_num == "obj_c", year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, obj_num, obj_avg) %>% 
                             summarize(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>% pull(obj_avg_for_eu))
}
test_eu_obj_avg()


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# note that for radar charts, if chart is single country, adjust radarchart() to have cex = 1 
# in both the default argument at the top of function, and also in the legend() call at the bottom of function
# if radar charts will be faceted by ee region, then set both these cex values to 1.5

# note for facet chart, the emf is cropped tight in word, pasted into ee_balkans_and_eurasia_obj_facet_radar_chart, 
# then lock aspect ratio and resize to 60%; once all countries added, group and save as EMF; 
# emf then added to main deck and resized to 183% w/ center alignment


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_albania ####


# get current_country
current_country <- "Albania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_albania_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                    str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_armenia ####


# get current_country_obj
current_country <- "Armenia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_armenia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_azerbaijan ####


# get current_country_obj
current_country <- "Azerbaijan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_azerbaijan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_belarus ####


# get current_country_obj
current_country <- "Belarus"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_belarus_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_bih ####

# get current_country
current_country <- "BiH"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_bih_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_georgia ####


# get current_country_obj
current_country <- "Georgia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_georgia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_kosovo ####


# get current_country
current_country <- "Kosovo"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_kosovo_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_moldova ####


# get current_country_obj
current_country <- "Moldova"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_moldova_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_macedonia ####


# get current_country
current_country <- "N. Macedonia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_macedonia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_serbia ####


# get current_country
current_country <- "Serbia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_serbia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_ukraine ####


# get current_country_obj
current_country <- "Ukraine"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_ukraine_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_estonia ####


# get current_country_obj
current_country <- "Estonia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_estonia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_czechia ####


# get current_country_obj
current_country <- "Czechia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data

#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_czechia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_slovenia ####


# get current_country_obj
current_country <- "Slovenia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_slovenia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_latvia ####


# get current_country_obj
current_country <- "Latvia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_latvia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_slovakia ####


# get current_country_obj
current_country <- "Slovakia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_slovakia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_lithuania ####


# get current_country_obj
current_country <- "Lithuania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_lithuania_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_romania ####


# get current_country_obj
current_country <- "Romania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_romania_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_croatia ####


# get current_country_obj
current_country <- "Croatia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_croatia_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_poland ####


# get current_country_obj
current_country <- "Poland"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_poland_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_bulgaria ####


# get current_country_obj
current_country <- "Bulgaria"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_bulgaria_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_montenegro ####


# get current_country_obj
current_country <- "Montenegro"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_montenegro_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_hungary ####


# get current_country_obj
current_country <- "Hungary"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_hungary_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_kazakhstan ####


# get current_country_obj
current_country <- "Kazakhstan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_kazakhstan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_kyrgyzstan ####


# get current_country_obj
current_country <- "Kyrgyzstan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_kyrgyzstan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_tajikistan ####


# get current_country_obj
current_country <- "Tajikistan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_tajikistan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_turkmenistan ####


# get current_country_obj
current_country <- "Turkmenistan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_turkmenistan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_uzbekistan ####


# get current_country_obj
current_country <- "Uzbekistan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(obj_num == "obj_1" ~ str_c("Democratic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_2" ~ str_c("Information \n(", round_to_digits(gap, digits = 2), ")      "),
                                 obj_num == "obj_3" ~ str_c("Energy (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_4" ~ str_c("            Economic (", round_to_digits(gap, digits = 2), ")"),
                                 obj_num == "obj_c" ~ str_c("  Corruption\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_obj
current_country_obj <- fmir %>% filter(country == current_country, year == 2021) %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num) %>%
        select(obj_num, obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = obj_num, values_from = obj_avg)

current_country_obj

# get chart_data
chart_data <- tibble(obj_1 = c(1, 0), 
                     obj_2 = c(1, 0),
                     obj_3 = c(1, 0),
                     obj_4 = c(1, 0),
                     obj_c = c(1, 0)) %>%
        bind_rows(., eu_obj_avg %>% select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = obj_num, values_from = "obj_avg_for_eu")) %>%
        bind_rows(., current_country_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(obj_num, label), by = c("var" = "obj_num")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_patch_radar_chart_uzbekistan_png <- image_read(str_c("output/charts/obj_patch_radar_chart_", 
                                                      str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 

#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_chart_balkans ####

# get gap_label_constants
x_coord_shift <- .35
y_coord_shift <- .2495

democratic_x_coord <- .193
democratic_y_coord <- .8011
information_x_coord <- .042
information_y_coord <- .7155
energy_x_coord <- .1155
energy_y_coord <- .601
economic_x_coord <- .275
economic_y_coord <- .601
corruption_x_coord <- .27
corruption_y_coord <- .7155

# get gap_asterix_tbl
gap_asterix_tbl <- fmir %>% filter(mcp_grouping == "E&E Balkans", 
                year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(location = case_when(country == "Albania" ~ 1,
                                    country == "BiH" ~ 2,
                                    country == "Kosovo" ~ 3,
                                    country == "N. Macedonia" ~ 4,
                                    country == "Serbia" ~ 5)) %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               gap = round_to_digits(gap, digits = 2)) %>%
        group_by(location) %>% 
        mutate(largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0)) %>%
        ungroup() %>%
        arrange(country, desc(gap)) %>%
        mutate(x_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_x_coord,
                                   TRUE ~ NA_real_),
               y_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_y_coord,
                                   TRUE ~ NA_real_),
               x_coord = case_when(location == 1 ~ x_coord,
                                   location == 2 ~ x_coord + x_coord_shift,
                                   location == 3 ~ x_coord + (x_coord_shift * 2),
                                   location == 4 ~ x_coord,
                                   location == 5 ~ x_coord + x_coord_shift,
                                   location == 6 ~ x_coord + (x_coord_shift * 2)),
               y_coord = case_when(location == 1 ~ y_coord,
                                   location == 2 ~ y_coord,
                                   location == 3 ~ y_coord,
                                   location == 4 ~ y_coord - y_coord_shift,
                                   location == 5 ~ y_coord - y_coord_shift,
                                   location == 6 ~ y_coord - y_coord_shift)) %>%
        arrange(country, obj_num)
        
# inspect
gap_asterix_tbl
gap_asterix_tbl %>% glimpse()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                     plot_spacer(),
                                     plot_spacer(),
                                     plot_spacer(),
                                     plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_balkans <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_patch_radar_chart_albania_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_bih_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_kosovo_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_macedonia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_serbia_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_text(text = "*",
                  x = gap_asterix_tbl %>% pull(x_coord),
                  y = gap_asterix_tbl %>% pull(y_coord),
                  hjust = 0, vjust = .5, size = 9,
                  fontface = "bold",
                  color = "#EF6712",
                  family = "Calibri")


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_balkans)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_patch_radar_chart_balkans.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_chart_eurasia ####

# get gap_label_constants
x_coord_shift <- .35
y_coord_shift <- .2495

democratic_x_coord <- .193
democratic_y_coord <- .8011
information_x_coord <- .042
information_y_coord <- .7155
energy_x_coord <- .1155
energy_y_coord <- .601
economic_x_coord <- .275
economic_y_coord <- .601
corruption_x_coord <- .27
corruption_y_coord <- .7155

# get gap_asterix_tbl
gap_asterix_tbl <- fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                                   year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(location = case_when(country == "Armenia" ~ 1,
                                    country == "Azerbaijan" ~ 2,
                                    country == "Belarus" ~ 3,
                                    country == "Georgia" ~ 4,
                                    country == "Moldova" ~ 5,
                                    country == "Ukraine" ~ 6)) %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               gap = round_to_digits(gap, digits = 2)) %>%
        group_by(location) %>% 
        mutate(largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0)) %>%
        ungroup() %>%
        arrange(country, desc(gap)) %>%
        mutate(x_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_x_coord,
                                   TRUE ~ NA_real_),
               y_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_y_coord,
                                   TRUE ~ NA_real_),
               x_coord = case_when(location == 1 ~ x_coord,
                                   location == 2 ~ x_coord + x_coord_shift,
                                   location == 3 ~ x_coord + (x_coord_shift * 2),
                                   location == 4 ~ x_coord,
                                   location == 5 ~ x_coord + x_coord_shift,
                                   location == 6 ~ x_coord + (x_coord_shift * 2)),
               y_coord = case_when(location == 1 ~ y_coord,
                                   location == 2 ~ y_coord,
                                   location == 3 ~ y_coord,
                                   location == 4 ~ y_coord - y_coord_shift,
                                   location == 5 ~ y_coord - y_coord_shift,
                                   location == 6 ~ y_coord - y_coord_shift)) %>%
        arrange(country, obj_num)

# inspect
gap_asterix_tbl
gap_asterix_tbl %>% glimpse()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_eurasia <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_patch_radar_chart_armenia_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_azerbaijan_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_belarus_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_georgia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_moldova_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_ukraine_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_text(text = "*",
                  x = gap_asterix_tbl %>% pull(x_coord),
                  y = gap_asterix_tbl %>% pull(y_coord),
                  hjust = 0, vjust = .5, size = 9,
                  fontface = "bold",
                  color = "#EF6712",
                  family = "Calibri")
        


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_eurasia)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_patch_radar_chart_eurasia.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_chart_graduates_group_1 ####

# get gap_label_constants
x_coord_shift <- .35
y_coord_shift <- .2495

democratic_x_coord <- .193
democratic_y_coord <- .8011
information_x_coord <- .042
information_y_coord <- .7155
energy_x_coord <- .1155
energy_y_coord <- .601
economic_x_coord <- .275
economic_y_coord <- .601
corruption_x_coord <- .27
corruption_y_coord <- .7155

# get gap_asterix_tbl
gap_asterix_tbl <- fmir %>% filter(country %in% c("Bulgaria",
                                                  "Croatia",
                                                  "Czechia",
                                                  "Estonia",
                                                  "Hungary",
                                                  "Latvia"), 
                                   year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(location = case_when(country == "Bulgaria" ~ 1,
                                    country == "Croatia" ~ 2,
                                    country == "Czechia" ~ 3,
                                    country == "Estonia" ~ 4,
                                    country == "Hungary" ~ 5,
                                    country == "Latvia" ~ 6)) %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               gap = round_to_digits(gap, digits = 2)) %>%
        group_by(location) %>% 
        mutate(largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0)) %>%
        ungroup() %>%
        arrange(country, desc(gap)) %>%
        mutate(x_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_x_coord,
                                   TRUE ~ NA_real_),
               y_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_y_coord,
                                   TRUE ~ NA_real_),
               x_coord = case_when(location == 1 ~ x_coord,
                                   location == 2 ~ x_coord + x_coord_shift,
                                   location == 3 ~ x_coord + (x_coord_shift * 2),
                                   location == 4 ~ x_coord,
                                   location == 5 ~ x_coord + x_coord_shift,
                                   location == 6 ~ x_coord + (x_coord_shift * 2)),
               y_coord = case_when(location == 1 ~ y_coord,
                                   location == 2 ~ y_coord,
                                   location == 3 ~ y_coord,
                                   location == 4 ~ y_coord - y_coord_shift,
                                   location == 5 ~ y_coord - y_coord_shift,
                                   location == 6 ~ y_coord - y_coord_shift)) %>%
        arrange(country, obj_num)

# inspect
gap_asterix_tbl
gap_asterix_tbl %>% glimpse()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_graduates_group_1 <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_patch_radar_chart_bulgaria_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_croatia_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_czechia_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_estonia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_hungary_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_latvia_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_text(text = "*",
                  x = gap_asterix_tbl %>% pull(x_coord),
                  y = gap_asterix_tbl %>% pull(y_coord),
                  hjust = 0, vjust = .5, size = 9,
                  fontface = "bold",
                  color = "#EF6712",
                  family = "Calibri")


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_graduates_group_1)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_patch_radar_chart_graduates_group_1.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_chart_graduates_group_2 ####

# get gap_label_constants
x_coord_shift <- .35
y_coord_shift <- .2495

democratic_x_coord <- .193
democratic_y_coord <- .8011
information_x_coord <- .042
information_y_coord <- .7155
energy_x_coord <- .1155
energy_y_coord <- .601
economic_x_coord <- .275
economic_y_coord <- .601
corruption_x_coord <- .27
corruption_y_coord <- .7155

# get gap_asterix_tbl
gap_asterix_tbl <- fmir %>% filter(country %in% c("Lithuania",
                                                  "Montenegro",
                                                  "Poland",
                                                  "Romania",
                                                  "Slovakia",
                                                  "Slovenia"), 
                                   year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(location = case_when(country == "Lithuania" ~ 1,
                                    country == "Montenegro" ~ 2,
                                    country == "Poland" ~ 3,
                                    country == "Romania" ~ 4,
                                    country == "Slovakia" ~ 5,
                                    country == "Slovenia" ~ 6)) %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               gap = round_to_digits(gap, digits = 2)) %>%
        group_by(location) %>% 
        mutate(largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0)) %>%
        ungroup() %>%
        arrange(country, desc(gap)) %>%
        mutate(x_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_x_coord,
                                   TRUE ~ NA_real_),
               y_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_y_coord,
                                   TRUE ~ NA_real_),
               x_coord = case_when(location == 1 ~ x_coord,
                                   location == 2 ~ x_coord + x_coord_shift,
                                   location == 3 ~ x_coord + (x_coord_shift * 2),
                                   location == 4 ~ x_coord,
                                   location == 5 ~ x_coord + x_coord_shift,
                                   location == 6 ~ x_coord + (x_coord_shift * 2)),
               y_coord = case_when(location == 1 ~ y_coord,
                                   location == 2 ~ y_coord,
                                   location == 3 ~ y_coord,
                                   location == 4 ~ y_coord - y_coord_shift,
                                   location == 5 ~ y_coord - y_coord_shift,
                                   location == 6 ~ y_coord - y_coord_shift)) %>%
        arrange(country, obj_num)

# inspect
gap_asterix_tbl
gap_asterix_tbl %>% glimpse()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_graduates_group_2 <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_patch_radar_chart_lithuania_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_montenegro_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_poland_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_romania_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_slovakia_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_slovenia_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_text(text = "*",
                  x = gap_asterix_tbl %>% pull(x_coord),
                  y = gap_asterix_tbl %>% pull(y_coord),
                  hjust = 0, vjust = .5, size = 9,
                  fontface = "bold",
                  color = "#EF6712",
                  family = "Calibri")


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_graduates_group_2)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_patch_radar_chart_graduates_group_2.docx"))



#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_chart_cars ####

# get gap_label_constants
x_coord_shift <- .35
y_coord_shift <- .2495

democratic_x_coord <- .193
democratic_y_coord <- .8011
information_x_coord <- .042
information_y_coord <- .7155
energy_x_coord <- .1155
energy_y_coord <- .601
economic_x_coord <- .275
economic_y_coord <- .601
corruption_x_coord <- .27
corruption_y_coord <- .7155

# get gap_asterix_tbl
gap_asterix_tbl <- fmir %>% filter(country %in% c("Lithuania",
                                                  "Montenegro",
                                                  "Poland",
                                                  "Romania",
                                                  "Slovakia",
                                                  "Slovenia"), 
                                   year == 2021) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(location = case_when(country == "Lithuania" ~ 1,
                                    country == "Montenegro" ~ 2,
                                    country == "Poland" ~ 3,
                                    country == "Romania" ~ 4,
                                    country == "Slovakia" ~ 5,
                                    country == "Slovenia" ~ 6)) %>%
        mutate(gap = (obj_avg - obj_avg_for_eu) * -1,
               gap = round_to_digits(gap, digits = 2)) %>%
        group_by(location) %>% 
        mutate(largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0)) %>%
        ungroup() %>%
        arrange(country, desc(gap)) %>%
        mutate(x_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_x_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_x_coord,
                                   TRUE ~ NA_real_),
               y_coord = case_when(largest_gap_flag == 1 & obj_num == "obj_1" ~ democratic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_2" ~ information_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_3" ~ energy_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_4" ~ economic_y_coord,
                                   largest_gap_flag == 1 & obj_num == "obj_c" ~ corruption_y_coord,
                                   TRUE ~ NA_real_),
               x_coord = case_when(location == 1 ~ x_coord,
                                   location == 2 ~ x_coord + x_coord_shift,
                                   location == 3 ~ x_coord + (x_coord_shift * 2),
                                   location == 4 ~ x_coord,
                                   location == 5 ~ x_coord + x_coord_shift,
                                   location == 6 ~ x_coord + (x_coord_shift * 2)),
               y_coord = case_when(location == 1 ~ y_coord,
                                   location == 2 ~ y_coord,
                                   location == 3 ~ y_coord,
                                   location == 4 ~ y_coord - y_coord_shift,
                                   location == 5 ~ y_coord - y_coord_shift,
                                   location == 6 ~ y_coord - y_coord_shift)) %>%
        arrange(country, obj_num)

# inspect
gap_asterix_tbl
gap_asterix_tbl %>% glimpse()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_cars <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_patch_radar_chart_kazakhstan_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_kyrgyzstan_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_tajikistan_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_turkmenistan_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_patch_radar_chart_uzbekistan_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_text(text = "*",
                  x = gap_asterix_tbl %>% pull(x_coord),
                  y = gap_asterix_tbl %>% pull(y_coord),
                  hjust = 0, vjust = .5, size = 9,
                  fontface = "bold",
                  color = "#EF6712",
                  family = "Calibri")


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_cars)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_patch_radar_chart_cars.docx"))


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# check ron's analysis ####


# inspect balkans vs eurasia avg for latest year
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, obj_num, obj_avg) %>%
        group_by(mcp_grouping, obj_num) %>%
        mutate(regional_avg = mean(obj_avg)) %>%
        ungroup() %>%
        arrange(obj_num, mcp_grouping) %>%
        # print(n = 20)
        distinct(obj_num, mcp_grouping, regional_avg) 

# eurasia avg for obj_1
mean(c(.51, .1, .17, .52, .51, .45))
        

#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# inspect change from 2013 to 2020
# 11 countries * 2 years * 5 obj = 110 records per country
fmir %>% filter(year %in% c(2013, 2020),  
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        mutate(period = case_when(year == 2013 ~ "period_1", 
                                  year %in% c(2018, 2019) ~ "period_2")) %>%
        distinct(country, period, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, period, obj_num), names_from = period, values_from = obj_avg) %>%
        mutate(diff_from_2013_to_2019 = period_2 - period_1) %>%
        arrange(desc(diff_from_2013_to_2019)) %>%
        group_by(country) %>%
        mutate(country_avg_diff = mean(diff_from_2013_to_2019),
               country_sum_diff = sum(diff_from_2013_to_2019),
               improving_obj_flag = case_when(diff_from_2013_to_2019 > 0 ~ 1, TRUE ~ 0),
               count_of_improving_obj = sum(improving_obj_flag)) %>%
        ungroup() %>%
        arrange(desc(country_avg_diff), country) %>%
        # arrange(desc(country_sum_diff), country) %>%
        # arrange(desc(count_of_improving_obj), country) %>%
        print(n = nrow(.))


#////////////////////////////////////////////////////////////////////////////////////////////


# inspect latest year (2019/2018)
# 11 countries * 1 year * 5 obj == 55 records
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        group_by(country) %>%
        mutate(obj_avg_max_flag = case_when(obj_avg == max(obj_avg) ~ 1, TRUE ~ 0),
               obj_avg_min_flag = case_when(obj_avg == min(obj_avg) ~ 1, TRUE ~ 0)) %>%
        ungroup() %>%
        group_by(obj_num) %>%
        mutate(obj_avg_max_flag_sum = sum(obj_avg_max_flag),
                  obj_avg_min_flag_sum = sum(obj_avg_min_flag)) %>%
        ungroup() %>%
        # distinct(obj_num, obj_avg_max_flag_sum) %>%
        # distinct(obj_num, obj_avg_min_flag_sum) %>%
        # arrange(desc(obj_avg_max_flag_sum))
        # arrange(desc(obj_avg_min_flag_sum)) %>%
        # filter(obj_num == "obj_c") %>%
        # filter(obj_num == "obj_3") %>%
        # filter(country == "Belarus") %>%
        # filter(country %in% c("Armenia", "Georgia")) %>%
        filter(obj_avg_max_flag == 1 | obj_avg_min_flag == 1) %>%
        print(n = 30)


#////////////////////////////////////////////////////////////////////////////////////////////


# inspect countries degree of lag compared to eu

# get eu_obj_avg
# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_obj_avg <- fmir %>% filter((obj_num != "obj_3" & year == 2019) | (obj_num == "obj_3" & year == 2018),
                              mcp_grouping == "EU-15") %>% 
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num) %>% 
        group_by(obj_num, year) %>%
        mutate(obj_avg_for_eu = mean(obj_avg, na.rm = TRUE)) %>%
        slice(1) %>% 
        ungroup() %>% select(-c(country, obj_avg)) 

fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping == "E&E Balkans") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, obj_num, obj_avg) %>%
        left_join(., eu_obj_avg %>% select(-year), by = "obj_num") %>%
        mutate(eu_lag = obj_avg - obj_avg_for_eu) %>%
        group_by(country) %>%
        mutate(eu_lag_max_flag = case_when(eu_lag == max(eu_lag) ~ 1, TRUE ~ 0),
               eu_lag_min_flag = case_when(eu_lag == min(eu_lag) ~ 1, TRUE ~ 0)) %>%
        ungroup() %>%
        group_by(obj_num) %>%
        mutate(eu_lag_max_flag_sum = sum(eu_lag_max_flag),
               eu_lag_min_flag_sum = sum(eu_lag_min_flag)) %>%
        ungroup() %>%
        # filter(eu_lag_max_flag == 1) %>%
        # filter(eu_lag_min_flag == 1) %>%
        # distinct(obj_num, eu_lag_max_flag_sum) %>%
        # distinct(obj_num, eu_lag_min_flag_sum) 
        # filter(obj_num == "obj_1")
        # filter(obj_num == "obj_2")
        filter(obj_num == "obj_3")
        # filter(obj_num == "obj_4")
        # filter(obj_num == "obj_c")
        # filter(country == "Serbia")
        # filter(country == "Belarus")
        print(n = 30)


#///////////////////////////////////////////////////////////////////////////


# inspect which countries have greatest resilience in each obj
fmir %>% filter(year == 2019 & obj_num %in% c("obj_1", "obj_2", "obj_4", "obj_c") |
                        year == 2018 & obj_num == "obj_3", 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        # filter(obj_num == "obj_1") %>%
        # filter(obj_num == "obj_2") %>%
        # filter(obj_num == "obj_3") %>%
        # filter(obj_num == "obj_4") %>%
        filter(obj_num == "obj_c") %>%
        arrange(desc(obj_avg))


#///////////////////////////////////////////////////////////////////////////


# inspect the obj with least resilience for each country
fmir %>% filter(year == 2020, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        arrange(country, obj_avg) %>%
        group_by(country) %>% slice(1) %>%
        ungroup()
        

#///////////////////////////////////////////////////////////////////////////


# inspect how many countries had changes in each dimension
fmir %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(year %in% c(2010, 2020)) %>%
        filter(year %in% c(2013, 2020)) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        arrange(country, obj_num, year) %>%
        group_by(country, obj_num) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>% 
        
        # filter(obj_num == "obj_1") %>%
        # filter(obj_num == "obj_2") %>%
        # filter(obj_num == "obj_3") %>%
        # filter(obj_num == "obj_4") %>%
        # filter(obj_num == "obj_c") %>%
        
        # filter(country == "Serbia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        # filter(country == "Ukraine") %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%

        
        filter(year == 2020) %>%
        # arrange(country, diff) %>%
        arrange(obj_num, diff) %>%
        # arrange(diff) %>%
        # filter(diff >= 0)
        # filter(diff < 0) %>%
        # filter(diff <= -.02) %>%
        # arrange(mcp_grouping) %>%
        print(n = nrow(.))


#///////////////////////////////////////////////////////////////////////////


# inspect how many countries had changes in each sub_obj
fmir %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(year %in% c(2010, 2020)) %>%
        filter(year %in% c(2013, 2020)) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        arrange(country, sub_obj_num, year) %>%
        group_by(country, sub_obj_num) %>%
        mutate(diff = sub_obj_avg - lag(sub_obj_avg, n = 1)) %>%
        ungroup() %>% 
        
        filter(sub_obj_num %in% c("sub_obj_2_1", "sub_obj_2_2", "sub_obj_2_3")) %>%
        
        # filter(country == "Serbia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        # filter(country == "Ukraine") %>%
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%


        filter(year == 2020) %>%
        arrange(country, diff) %>%
        # arrange(sub_obj_num, diff) %>%
        # arrange(diff) %>%
        # filter(diff >= 0)
        # filter(diff < 0) %>%
        # filter(diff <= -.02) %>%
        # arrange(mcp_grouping) %>%
        print(n = nrow(.))


#///////////////////////////////////////////////////////////////////////////


# inspect how many countries had changes in each concept
fmir %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(year %in% c(2010, 2020)) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(sub_obj_num %in% c("sub_obj_2_1")) %>%
        
        distinct(country, mcp_grouping, year, concept, concept_avg) %>%
        select(country, mcp_grouping, year, concept, concept_avg) %>%
        arrange(country, concept, year) %>%
        group_by(country, concept) %>%
        mutate(diff = concept_avg - lag(concept_avg, n = 1)) %>%
        ungroup() %>% 

        
        # filter(country == "Serbia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        # filter(country == "Ukraine") %>%
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%
        
        
        filter(year == 2020) %>%
        arrange(country, diff) %>%
        # arrange(concept, diff) %>%
        # arrange(diff) %>%
        # filter(diff >= 0)
        # filter(diff < 0) %>%
        # filter(diff <= -.02) %>%
        # arrange(mcp_grouping) %>%
        print(n = nrow(.))



#///////////////////////////////////////////////////////////////////////////


# inspect distribution of changes in each dimension from 2010-2020 (or other range)
fmir %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(year %in% c(2010, 2020)) %>%
        filter(year %in% c(2013, 2020)) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        arrange(country, obj_num, year) %>%
        group_by(country, obj_num) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>% 
        
        filter(year == 2020) %>%
        # arrange(country, diff) %>%
        arrange(obj_num, diff) %>%
        # arrange(diff) %>%
        # filter(diff >= 0)
        # filter(diff < 0) %>%
        # filter(diff <= -.02) %>%
        # arrange(mcp_grouping) %>%
        # print(n = nrow(.))
        
        group_by(obj_num) %>% skim(diff)
        
        ggplot(data = ., mapping = aes(x = diff, y = obj_num)) + geom_density_ridges()


#//////////////////////////////////////////////////////////////////////////////////////////////////////


# inspect distribution of sub_obj_avg changes by sub_obj
fmir %>% distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        arrange(country, sub_obj_num, year) %>%
        # print(n = 100)
        
        group_by(country, sub_obj_num) %>%
        mutate(diff = sub_obj_avg - lag(sub_obj_avg, n = 1),
               abs_diff = abs(diff)) %>%
        ungroup() %>%
        
        filter(abs_diff < .1) %>%
        
        # arrange(desc(abs_diff)) %>%
        # filter(country == "Albania") %>%
        # filter(sub_obj_num == "sub_obj_3_3") %>%
        # print(n = 20)
        
        ggplot(data = ., mapping = aes(x = diff, y = sub_obj_num)) + geom_density_ridges()


#//////////////////////////////////////////////////////////////////////////////////////////////////////


# inspect distribution of obj_avg changes by obj
fmir %>% distinct(country, year, obj_num, obj_avg) %>%
        arrange(country, obj_num, year) %>%
        # print(n = 100)
        
        group_by(country, obj_num) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1),
               abs_diff = abs(diff)) %>%
        ungroup() %>%
        # print(n = 100)
        
        # filter(abs_diff < .1) %>%
        # filter(obj_num == "obj_1") %>%
        
        group_by(obj_num) %>% skim(diff)
        
        ggplot(data = ., mapping = aes(x = diff, y = obj_num)) + geom_density_ridges()


#///////////////////////////////////////////////////////////////////////////


# inspect countries with obj_avg < .2 and which are on downward trend
fmir %>%
        filter(country == "Azerbaijan") %>%
        filter(year %in% c(2011, 2020)) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        arrange(country, obj_num)


#///////////////////////////////////////////////////////////////////////////


# inspect highest/lowest 2010-2020 ri_avg change, by mcp_grouping
fmir %>% 
        # filter(year %in% c(2010, 2020)) %>% 
        filter(year %in% c(2013, 2020)) %>% 
        # filter(mcp_grouping == "EU-15") %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        arrange(country, year) %>%
        group_by(country) %>%
        mutate(diff = miri_avg - lag(miri_avg, n = 1)) %>%
        ungroup() %>%
        
        # arrange(country) %>%
        
        filter(year == 2020) %>%
        arrange(mcp_grouping, desc(diff)) %>%
        # arrange(desc(diff)) %>%
        
        print(n = nrow(.))


#///////////////////////////////////////////////////////////////////////////


# check values levels for indicators
fmir %>%
        filter(year == 2019) %>%
        # filter(year >= 2019) %>%
        # filter(year %in% c(2013, 2019, 2020)) %>%
        # filter(mcp_grouping == "E&E Balkans") %>%
        # filter(mcp_grouping == "E&E Eurasia") %>%
        # filter(mcp_grouping == "E&E graduates") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%
        filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        # filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        select(country, mcp_grouping, year, indicator_name, values, indicator_standardized_values) %>%
        # arrange(mcp_grouping, desc(indicator_standardized_values)) %>%
        # arrange(country, year) %>%
        arrange(desc(values)) %>%
        print(n = nrow(.))


#///////////////////////////////////////////////////////////////////////////


# check values change for indicators
fmir %>%
        filter(year %in% c(2010, 2019)) %>%
        # filter(mcp_grouping == "E&E Balkans") %>%
        # filter(mcp_grouping == "E&E Eurasia") %>%
        # filter(mcp_grouping == "E&E graduates") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%
        # filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        distinct(country, mcp_grouping, year, indicator_name, values, indicator_standardized_values) %>%
        
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = values - lag(values, n = 1)) %>%
        ungroup() %>%
        
        filter(year == 2019) %>%
        
        # arrange(mcp_grouping, desc(indicator_standardized_values)) %>%
        # arrange(country, year) %>%
        arrange(desc(diff)) %>%
        print(n = nrow(.))


#///////////////////////////////////////////////////////////////////////////


# check values change for indicators
fmir %>%
        filter(year %in% c(2010, 2019)) %>%
        # filter(mcp_grouping == "E&E Balkans") %>%
        # filter(mcp_grouping == "E&E Eurasia") %>%
        # filter(mcp_grouping == "E&E graduates") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary", "Ukraine")) %>%
        # filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        distinct(country, mcp_grouping, year, indicator_name, values, indicator_standardized_values) %>%
        
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = values - lag(values, n = 1)) %>%
        ungroup() %>%
        
        filter(year == 2019) %>%
        
        # arrange(mcp_grouping, desc(indicator_standardized_values)) %>%
        # arrange(country, year) %>%
        arrange(desc(diff)) %>%
        print(n = nrow(.))
 

#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# miri_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(year %in% c(2010, 2021)) %>%
        distinct(country, mcp_grouping, year, miri_avg) %>%
        select(country, mcp_grouping, year, miri_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping), names_from = "year", values_from = "miri_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
miri_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
miri_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(miri_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/miri_2010_2021_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# obj_1_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(obj_num == "obj_1") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping, obj_num), names_from = "year", values_from = "obj_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_1_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_2010_2021_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# obj_2_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(obj_num == "obj_2") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping, obj_num), names_from = "year", values_from = "obj_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_2010_2021_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# obj_3_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(obj_num == "obj_3") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping, obj_num), names_from = "year", values_from = "obj_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_3_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_2010_2021_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# obj_4_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(obj_num == "obj_4") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping, obj_num), names_from = "year", values_from = "obj_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_4_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_2010_2021_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# obj_c_2010_2021_scatterplot ####

year_1 <- "2010"
year_2 <- "2021"
chart_data <- fmir %>%
        filter(obj_num == "obj_c") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        pivot_wider(id_cols = c(country, mcp_grouping, obj_num), names_from = "year", values_from = "obj_avg") %>%
        arrange(country) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_2010_2021_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(year_1), y = !!sym(year_2), label = country_label,
                                       color = color_bin)) + 
        # stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>%
        #                   mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>%
        #                   slice(1),
        #           mapping = aes(x = .12, y = .2, label = correlation),
        #           fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Score in 2010\n(higher is better)", y = "Score in 2021\n(higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 14, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_c_2010_2021_scatterplot


#////////////////////////////////


# size to 95%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_2010_2021_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_2010_2021_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_2_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_2"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
                color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                          TRUE ~ NA_character_),
                color_bin = mcp_grouping,
                color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                  color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                  color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                  color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                  color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                  color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                  color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
                linetype_bin = mcp_grouping,
                linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_2_scatterplot <- obj_1_and_obj_2_ee_scatterplot + obj_1_and_obj_2_all_country_scatterplot 
obj_1_and_obj_2_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_2_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_2_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_3_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_3"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_3_scatterplot <- obj_1_and_obj_3_ee_scatterplot + obj_1_and_obj_3_all_country_scatterplot 
obj_1_and_obj_3_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_3_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_4_scatterplot <- obj_1_and_obj_4_ee_scatterplot + obj_1_and_obj_4_all_country_scatterplot 
obj_1_and_obj_4_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_1_and_obj_c_scatterplot <- obj_1_and_obj_c_ee_scatterplot + obj_1_and_obj_c_all_country_scatterplot 
obj_1_and_obj_c_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_c_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_3_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_3"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_3_scatterplot <- obj_2_and_obj_3_ee_scatterplot + obj_2_and_obj_3_all_country_scatterplot 
obj_2_and_obj_3_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_3_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_4_scatterplot <- obj_2_and_obj_4_ee_scatterplot + obj_2_and_obj_4_all_country_scatterplot 
obj_2_and_obj_4_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_2_and_obj_c_scatterplot <- obj_2_and_obj_c_ee_scatterplot + obj_2_and_obj_c_all_country_scatterplot 
obj_2_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_c_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_3"
obj_b <- "obj_4"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_3_and_obj_4_scatterplot <- obj_3_and_obj_4_ee_scatterplot + obj_3_and_obj_4_all_country_scatterplot 
obj_3_and_obj_4_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_4_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_3"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_3_and_obj_c_scatterplot <- obj_3_and_obj_c_ee_scatterplot + obj_3_and_obj_c_all_country_scatterplot 
obj_3_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_c_scatterplot.docx")



#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_4_and_obj_c_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_4"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, obj_2, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = country,
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_all_country_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_all_country_scatterplot


#///////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Information",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Information",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_ee_scatterplot


#//////////////////////////////////


# combine ee and all_country scatterplots
obj_4_and_obj_c_scatterplot <- obj_4_and_obj_c_ee_scatterplot + obj_4_and_obj_c_all_country_scatterplot 
obj_4_and_obj_c_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_and_obj_c_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_and_obj_c_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_2_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_2_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot <- obj_1_and_obj_2_ee_scatterplot + obj_1_and_obj_3_ee_scatterplot 
obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_2_plus_obj_1_and_obj_3_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot <- obj_1_and_obj_4_ee_scatterplot + obj_1_and_obj_c_ee_scatterplot 
obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_4_plus_obj_1_and_obj_c_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot <- obj_2_and_obj_3_ee_scatterplot + obj_2_and_obj_4_ee_scatterplot 
obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_3_plus_obj_2_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_2"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_2_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_2_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot <- obj_2_and_obj_c_ee_scatterplot + obj_3_and_obj_4_ee_scatterplot 
obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_and_obj_c_plus_obj_3_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot ####


# get chart_data
obj_a <- "obj_3"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_3_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_3_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_4"
obj_b <- "obj_c"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_4_and_obj_c_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_4_and_obj_c_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot <- obj_3_and_obj_c_ee_scatterplot + obj_4_and_obj_c_ee_scatterplot 
obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_and_obj_c_plus_obj_4_and_obj_c_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot ####


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_3_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_3_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# get chart_data
obj_a <- "obj_1"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Obj. 1: Democratic",
                              obj_a == "obj_2" ~ "Obj. 2: Media",
                              obj_a == "obj_3" ~ "Obj. 3: Energy",
                              obj_a == "obj_4" ~ "Obj. 4: Economic",
                              obj_a == "obj_c" ~ "Cross-cutting obj: Corruption")
obj_b_axis_label <- case_when(obj_b == "obj_1" ~ "Obj. 1: Democratic",
                              obj_b == "obj_2" ~ "Obj. 2: Media",
                              obj_b == "obj_3" ~ "Obj. 3: Energy",
                              obj_b == "obj_4" ~ "Obj. 4: Economic",
                              obj_b == "obj_c" ~ "Cross-cutting obj: Corruption")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, country != "Russia",
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ country,
                                         TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_1_and_obj_4_ee_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 2) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 2, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_1_and_obj_4_ee_scatterplot


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# combine scatterplots
obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot <- obj_1_and_obj_3_ee_scatterplot + obj_1_and_obj_4_ee_scatterplot 
obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_and_obj_3_plus_obj_1_and_obj_4_ee_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# cmki_analysis_obj_avg_all_country_bar_chart ####


# plot
fmir %>% filter(year == 2020) %>% 
        select(country, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )


#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2020, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        select(country, mcp_grouping, miri_avg) %>% distinct() %>%
        mutate(values = miri_avg) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "E&E Balkans      ",
                                      mcp_grouping == "E&E Eurasia" ~ "E&E Eurasia      ",
                                      mcp_grouping == "E&E graduates" ~ "E&E graduates      ",
                                      mcp_grouping == "CARs" ~ "CARs      ",
                                     mcp_grouping == "EU-15" ~ "EU-15      "),
               color = case_when(color_bin == "E&E Balkans      " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia      " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates      " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs      " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "EU-15      " ~ color_palette %>% slice(7) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "E&E Balkans      " ~ 1,
                                 color_bin == "E&E Eurasia      " ~ 2,
                                 color_bin == "E&E graduates      " ~ 3,
                                 color_bin == "CARs      " ~ 4,
                                 color_bin == "EU-15      " ~ 5)) %>%
        arrange(level) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "E&E Balkans      " ~ 1,
                                 color_bin == "E&E Eurasia      " ~ 2,
                                 color_bin == "E&E graduates      " ~ 3,
                                 color_bin == "CARs      " ~ 4,
                                 color_bin == "EU-15      " ~ 5)) %>%
        arrange(level) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
cmki_analysis_obj_avg_all_country_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values, fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2),
                           limits = c(0, 1),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 2 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
cmki_analysis_obj_avg_all_country_bar_chart


#//////////////////////////////////


# crop and resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cmki_analysis_obj_avg_all_country_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/cmki_analysis_obj_avg_all_country_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# cmki_analysis_obj_avg_ee_region_bar_chart ####


# plot
fmir %>% filter(year == 2020) %>% 
        select(country, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )


#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2020, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        select(country, mcp_grouping, miri_avg) %>% distinct() %>%
        mutate(values = miri_avg) %>%
        mutate(color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "E&E Balkans      ",
                                     mcp_grouping == "E&E Eurasia" ~ "E&E Eurasia      ",
                                     mcp_grouping == "E&E graduates" ~ "E&E graduates      "),
               color = case_when(color_bin == "E&E Balkans      " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia      " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates      " ~ color_palette %>% slice(3) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "E&E Balkans      " ~ 1,
                                 color_bin == "E&E Eurasia      " ~ 2,
                                 color_bin == "E&E graduates      " ~ 3)) %>%
        arrange(level) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "E&E Balkans      " ~ 1,
                                 color_bin == "E&E Eurasia      " ~ 2,
                                 color_bin == "E&E graduates      " ~ 3)) %>%
        arrange(level) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
cmki_analysis_obj_avg_ee_region_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values, fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2),
                           limits = c(0, 1),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 1 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
cmki_analysis_obj_avg_ee_region_bar_chart


#//////////////////////////////////


# crop and resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(cmki_analysis_obj_avg_ee_region_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/cmki_analysis_obj_avg_ee_region_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_all_country_stacked_bar_chart ####


# inspect
fmir %>% filter(year == 2019, country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_standardized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year == 2020) %>% select(country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        # filter(year == 2020, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>% 
        select(country, mcp_grouping, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        mutate(var = obj_num, values = obj_avg) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Obj. 1: Democratic    ",
                                     var == "obj_2" ~ 
                                             "Obj. 2: Information    ",
                                     var == "obj_3" ~ 
                                             "Obj. 3: Energy    ",
                                     var == "obj_4" ~ 
                                             "Obj. 4: Economic    ",
                                     var == "obj_c" ~
                                             "Cross-cutting obj:\nCorruption    "),
               color = case_when(color_bin == "Obj. 1: Democratic    " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Obj. 2: Information    " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Obj. 3: Energy    " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 4: Economic    " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic    " ~ 5,
                                           color_bin == "Information    " ~ 4,
                                           color_bin == "Energy    " ~ 3,
                                           color_bin == "Economic    " ~ 2,
                                           color_bin == "Corruption    " ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
# for factsheet version with just E&E and graduates: ratio = 1.5 / 1 and font size = 9
# for chart deck version with E&E, graduates, and CARs: ratio = 3 / 1 and font size = 8
obj_avg_all_country_stacked_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values, 
                             fill = factor(color_bin, levels = c("Obj. 1: Democratic    ", 
                                                                 "Obj. 2: Information    ", 
                                                                 "Obj. 3: Energy    ", 
                                                                 "Obj. 4: Economic    ",
                                                                 "Cross-cutting obj:\nCorruption    ")))) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 5, by = 1),
                           limits = c(0, 5),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 3 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_all_country_stacked_bar_chart


#//////////////////////////////////


# crop and resize to 180%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_all_country_stacked_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_all_country_stacked_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_factsheet_country_stacked_bar_chart ####


# inspect
fmir %>% filter(year == 2019, country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_standardized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year == 2020) %>% select(country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>% 
        select(country, mcp_grouping, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        mutate(var = obj_num, values = obj_avg) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Democratic    ",
                                     var == "obj_2" ~ 
                                             "Information    ",
                                     var == "obj_3" ~ 
                                             "Energy    ",
                                     var == "obj_4" ~ 
                                             "Economic    ",
                                     var == "obj_c" ~
                                             "Corruption    "),
               color = case_when(var == "obj_1" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "obj_2" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "obj_3" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "obj_4" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "obj_c" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic    " ~ 5,
                                           color_bin == "Information    " ~ 4,
                                           color_bin == "Energy    " ~ 3,
                                           color_bin == "Economic    " ~ 2,
                                           color_bin == "Corruption    " ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
# for factsheet version with just E&E and graduates: ratio = 1.5 / 1 and font size = 9
# for chart deck version with E&E, graduates, and CARs: ratio = 3 / 1 and font size = 8
obj_avg_factsheet_country_stacked_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values,
                             fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 5, by = 1),
                           limits = c(0, 5),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 1.5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_factsheet_country_stacked_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_factsheet_country_stacked_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_factsheet_country_stacked_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_scaled_factsheet_country_stacked_bar_chart ####


# inspect
fmir %>% filter(year == 2019, country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_standardized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year == 2020) %>% select(country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

# plot mir_avg
fmir %>% filter(year == 2020) %>% select(year, country, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        distinct(country, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE),
                                       y = miri_avg)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )

#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% 
        filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>% 
        select(country, mcp_grouping, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        mutate(var = obj_num, values = obj_avg / 5) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Democratic    ",
                                     var == "obj_2" ~ 
                                             "Information    ",
                                     var == "obj_3" ~ 
                                             "Energy    ",
                                     var == "obj_4" ~ 
                                             "Economic    ",
                                     var == "obj_c" ~
                                             "Corruption    "),
               color = case_when(var == "obj_1" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "obj_2" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "obj_3" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "obj_4" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "obj_c" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic    " ~ 5,
                                           color_bin == "Information    " ~ 4,
                                           color_bin == "Energy    " ~ 3,
                                           color_bin == "Economic    " ~ 2,
                                           color_bin == "Corruption    " ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
# for factsheet version with just E&E and graduates: ratio = 1.5 / 1 and font size = 9
# for chart deck version with E&E, graduates, and CARs: ratio = 3 / 1 and font size = 8
obj_avg_scaled_factsheet_country_stacked_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), 
                             y = values,
                             fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2),
                           limits = c(0, 1),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_scaled_factsheet_country_stacked_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_scaled_factsheet_country_stacked_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_scaled_factsheet_country_stacked_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_avg_diff_country_stacked_bar_chart ####


# plot
fmir %>% filter(year %in% c(2010, 2021)) %>% 
        select(country, year, obj_num, obj_avg) %>% 
        distinct() %>%
        arrange(country, obj_num, year) %>%
        group_by(country, obj_num) %>%
        mutate(obj_avg_diff = obj_avg - lag(obj_avg, n = 1)) %>%
        # mutate(obj_avg_diff = (obj_avg - lag(obj_avg, n = 1)) / 5) %>%
        ungroup() %>%
        filter(year == 2021) %>%
        group_by(country) %>%
        mutate(obj_avg_diff_positive_values = case_when(obj_avg_diff > 0 ~ obj_avg_diff,
                                                        TRUE ~ NA_real_),
               obj_avg_diff_positive_sum = sum(obj_avg_diff_positive_values, na.rm = TRUE),
               obj_avg_diff_sum = sum(obj_avg_diff)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg_diff_positive_sum, .desc = FALSE),
                                       y = obj_avg_diff, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )


# plot miri diff 
fmir %>% filter(year %in% c(2010, 2021), 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, year, miri_avg) %>%
        pivot_wider(id_cols = country, names_from = year, values_from = miri_avg) %>%
        mutate(miri_avg_diff = `2021` - `2010`) %>%
        arrange(desc(miri_avg_diff)) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg_diff, .desc = FALSE), y = miri_avg_diff)) +
        geom_col()


#//////////////////


# add color_bin and color
# note that for the fact sheet alex only wants E&E and graduates, 
# but for the briefing deck all groups are included (eg also CARs and EU-15)
chart_data <- fmir %>% filter(year %in% c(2010, 2021)) %>% 
        select(country, year, obj_num, obj_avg) %>% 
        distinct() %>%
        arrange(country, obj_num, year) %>%
        group_by(country, obj_num) %>%
        mutate(obj_avg_diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2021) %>%
        group_by(country) %>%
        mutate(obj_avg_diff_positive_values = case_when(obj_avg_diff > 0 ~ obj_avg_diff,
                                                        TRUE ~ NA_real_),
               obj_avg_diff_positive_sum = sum(obj_avg_diff_positive_values, na.rm = TRUE),
               obj_avg_diff_sum = sum(obj_avg_diff)) %>%
        ungroup() %>%
        mutate(var = obj_num, 
               values = obj_avg_diff) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Democratic    ",
                                     var == "obj_2" ~ 
                                             "Information    ",
                                     var == "obj_3" ~ 
                                             "Energy    ",
                                     var == "obj_4" ~ 
                                             "Economic    ",
                                     var == "obj_c" ~
                                             "Corruption    "),
               color = case_when(color_bin == "Democratic    " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information    " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy    " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic    " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption    " ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic    " ~ 5,
                                           color_bin == "Information    " ~ 4,
                                           color_bin == "Energy    " ~ 3,
                                           color_bin == "Economic    " ~ 2,
                                           color_bin == "Corruption    " ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE)) 

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
obj_avg_diff_country_stacked_bar_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg_diff_positive_sum, .desc = FALSE),
                                       y = values,  
                                       fill = color_bin)) + 
        geom_col(position = "stack", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = -.8, to = .6, by = .2),
                           limits = c(-.8, .6),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .02)) +
        geom_segment(x = .6, xend = (chart_data %>% count(country) %>% nrow()) + .4, y = 0, yend = 0, linewidth = .5, color = "#333333") +
        labs(x = NULL, y = "Change in score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_diff_country_stacked_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_diff_country_stacked_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_diff_country_stacked_bar_chart.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart ####


# inspect
fmir %>% filter(year %in% c(2010, 2020), country == "Turkmenistan", obj_num == "obj_2") %>% 
        select(country, year, obj_num, indicator_name, values, 
               indicator_min, indicator_max, indicator_q5, indicator_q95, indicator_standardized_values, imputation_condition,
               sub_obj_avg, obj_avg)

# plot
fmir %>% filter(year %in% c(2010, 2018, 2019, 2020), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        mutate(obj_avg = case_when(year %in% c(2018, 2019) ~ NA_real_,
                                   TRUE ~ obj_avg),
               year_fct = factor(year, levels = c(2018, 2010, 2020, 2019))) %>%
        select(country, year, year_fct, obj_num, obj_avg, miri_avg) %>% distinct() %>%
        arrange(country, year) %>%
        ggplot(data = ., mapping = aes(x = year_fct,
                                       y = obj_avg, fill = obj_num)) + 
        geom_col(position = "stack", width = .75) + 
        scale_x_discrete(labels = c("", "2010", "2020", "")) +
        facet_wrap(facets = vars(country), nrow = 1) +
        theme(
                panel.spacing = unit(1.25, "lines"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0), angle = 45, hjust = 1)
        )


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(year %in% c(2010, 2018, 2019, 2020), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        mutate(obj_avg = case_when(year %in% c(2018, 2019) ~ NA_real_,
                                   TRUE ~ obj_avg),
               year_fct = factor(year, levels = c(2018, 2010, 2020, 2019)),
               country = case_when(country == "N. Macedonia" ~ "North\nMacedonia",
                                   TRUE ~ country),
               country_order = case_when(year == 2020 ~ miri_avg)) %>%
        group_by(country) %>% fill(country_order, .direction = "downup") %>%
        ungroup() %>%
        select(country, year, year_fct, obj_num, obj_avg, miri_avg, country_order) %>% distinct() %>%
        mutate(country = fct_reorder(.f = country, .x = country_order, .desc = FALSE)) %>% 
        mutate(var = obj_num, values = obj_avg) %>%
        mutate(color_bin = case_when(var == "obj_1" ~ 
                                             "Obj. 1: Democratic    ",
                                     var == "obj_2" ~ 
                                             "Obj. 2: Information    ",
                                     var == "obj_3" ~ 
                                             "Obj. 3: Energy    ",
                                     var == "obj_4" ~ 
                                             "Obj. 4: Economic    ",
                                     var == "obj_c" ~
                                             "Cross-cutting obj:\nCorruption    "),
               color = case_when(color_bin == "Obj. 1: Democratic    " ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Obj. 2: Information    " ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 3: Energy    " ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Obj. 4: Economic    " ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ color_palette %>% slice(7) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                                 color_bin == "Obj. 2: Information    " ~ 2,
                                 color_bin == "Obj. 3: Energy    " ~ 3,
                                 color_bin == "Obj. 4: Economic    " ~ 4,
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% 
        mutate(level = case_when(color_bin == "Obj. 1: Democratic    " ~ 1,
                                 color_bin == "Obj. 2: Information    " ~ 2,
                                 color_bin == "Obj. 3: Energy    " ~ 3,
                                 color_bin == "Obj. 4: Economic    " ~ 4,
                                 color_bin == "Cross-cutting obj:\nCorruption    " ~ 5)) %>%
        arrange(level) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = year_fct, 
                             y = values, 
                             fill = factor(color_bin, levels = c("Obj. 1: Democratic    ", 
                                                                 "Obj. 2: Information    ", 
                                                                 "Obj. 3: Energy    ", 
                                                                 "Obj. 4: Economic    ",
                                                                 "Cross-cutting obj:\nCorruption    ")))) + 
        geom_col(position = "stack", width = .85) + 
        facet_wrap(facets = vars(country), nrow = 1, strip.position = "top") +
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(labels = c("", "2010", "2020", ""), expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = 5, by = 1),
                           limits = c(0, 5.01),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is bettter)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 2.5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                panel.spacing = unit(0, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                # axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_avg_ee_2010_2020_stacked_grouped_bar_chart_bar_chart.docx")


#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////////////////


# country profiles ####


# load get_country_profile() 
# source("code/get_country_profile.R")

fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country) %>% pull(country) %>%
        walk(.x = ., .f = ~ get_country_profile(current_country = .x, current_fy = 2023))


#//////////////////////


# load finalize_country_profile_as_pdf()
# source("code/finalize_country_profile_as_pdf.R")

fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country) %>% pull(country) %>%
        walk(.x = ., .f = ~ finalize_country_profile_as_pdf(current_country = .x, current_fy = 2023))


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# manual updates to word emf output

# right-click -> wrap text -> hit bring-to-front, and then give random drag and drop 
# (this enables alt+6/7 centering, otherwise word gives a cannot-comply beep if you try to alt+6/7 immediately)
# use alt + 6 and alt + 7 hotkeys to center on page horizontally and vertically
# hit right arrow key once to shift image slightly to right 
# print to pdf


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare miri_avg to globsec vulnerability index ####

# note globsec vulnerability avg is funded by State Dept. GEC
# https://www.globsec.org/publications/the-globsec-vulnerability-index-evaluating-susceptibility-to-foreign-malign-influence-in-8-central-european-western-balkan-countries/
# https://www.globsec.org/wp-content/uploads/2021/11/Vulnerability-Index_Comparative-report.pdf
# https://www.globsec.org/wp-content/uploads/2021/11/Vulnerability-Index_Extended-methodology.pdf
# now have downloadable dataset, though still just same 2021 data. overall score is avg of sector scores: 
# http://www.vulnerabilityindex.org/download-methodology.html

# note the globesec methodology states that survey polling was conducted in october 2020 for report_year 2021; 
# so report_year 2021 will be treated as describing conditions in 2020

# get ri_comparison_to_globsec_vulnerability_index
ri_comparison_to_globsec_vulnerability_index <- fmir %>% 
        filter(country %in% c("Czechia", "Slovakia", "Hungary", "Serbia", "Romania", 
                               "Bulgaria", "N. Macedonia", "Montenegro"),
                year == 2020) %>%
        distinct(country, year, miri_avg) %>%
        rename(ri_avg = miri_avg) %>%
        arrange(country) %>%
        mutate(globsec_avg = case_when(country == "Bulgaria" ~ 42,
                                   country == "Czechia" ~ 29,
                                   country == "Hungary" ~ 44,
                                   country == "Montenegro" ~ 44,
                                   country == "N. Macedonia" ~ 40,
                                   country == "Romania" ~ 29,
                                   country == "Serbia" ~ 55,
                                   country == "Slovakia" ~ 32)) %>%
        arrange(desc(ri_avg)) %>% mutate(ri_rank_best_to_worst = row_number()) %>%
        arrange(globsec_avg) %>% mutate(globsec_rank_best_to_worst = row_number(),
                                        difference_in_rank = ri_rank_best_to_worst - globsec_rank_best_to_worst)
        

# inspect
ri_comparison_to_globsec_vulnerability_index


#////////////////////////////////////////////////////////////////////////////////////////


# write ri_comparison_to_globsec_vulnerability_index
# ri_comparison_to_globsec_vulnerability_index %>% 
#         write.xlsx(file = "output/charts/ri_comparison_to_globsec_vulnerability_index.xlsx", overwrite = TRUE)


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ri_globsec_scatterplot ####

chart_data <- ri_comparison_to_globsec_vulnerability_index %>% 
        mutate(globsec_avg_scaled = globsec_avg / 100,
                color_bin = country,
               color = case_when(color_bin == "Bulgaria" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Czechia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Hungary" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Romania" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Slovakia" ~ color_palette %>% slice(11) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# get round_to_digits 
round_to_digits <- function(x, digits, big_mark = ",") {
        sign <- sign(x)
        z <- abs(x) * 10^digits
        z <- z + 0.5
        z <- trunc(z)
        z <- z / 10^digits
        z <- z * sign
        return(str_trim(string = format(x = z, nsmall = digits, big.mark = big_mark), side = "both"))
}

# create chart
ri_globsec_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = ri_avg, y = globsec_avg_scaled, label = country,
                                       color = factor(color_bin, levels = c("Bulgaria", 
                                                                            "Czechia", 
                                                                            "Hungary", 
                                                                            "Montenegro",
                                                                            "N. Macedonia",
                                                                            "Romania",
                                                                            "Serbia",
                                                                            "Slovakia")))) + 
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = ri_avg, y = globsec_avg, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .1, y = .93, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        # geom_segment(x = 0, y = 1, xend = 1, yend = 0, color = "#7D7D7D", size = .03) +
        # geom_text(data = tibble(x = .1, y = .98), mapping = aes(x = x, y = y), label = "Line of equality",
        #           color = "#7D7D7D", size = 5, fontface = "bold", family = "Calibri", hjust = 0) +
        # geom_text(data = chart_data %>% 
        #                   mutate(correlation = cor(x = ri_avg, y = globsec_avg, use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
        #                   slice(1), 
        #           mapping = aes(x = .1, y = .93, label = correlation),
        #           fontface = "bold", hjust = 0, size = 5, color = "#7D7D7D", family = "Calibri") +
        # geom_point(size = 6) +
        geom_point(size = 4) +
        geom_text_repel(fontface = "bold", 
                        point.padding = 12,
                        size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = c("0", "20", "40", "60", "80", "100")) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1.1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Resilience Index (higher is better)", y = "GLOBSEC Vulnerability Index\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 1 / 1.07, clip = "off") +
        coord_fixed(ratio = 2 / 4, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(10, 0, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 15, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
ri_globsec_scatterplot


#////////////////////////////////


# resize to 97%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_globsec_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_globsec_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare fbic russian influence capacity to resilience index ####

# data is downloaded at bottom of page
# https://www.atlanticcouncil.org/in-depth-research-reports/report/in-brief-15-takeaways-from-our-new-report-measuring-us-and-chinese-global-influence/

# note that fbic influence is directional, so fbic values are different for a given two countries depending on 
# which country is countrya in record and which is countryb
# countrya is the influencer, countryb is the influencee
# from the fbic docs: "A measure of influence capacity (or relational power) held by one country (Country A) in another (Country B)."

# note that the methodology pdf shows how the sub-indices and indices are calculated 
# the final fbic score is based on min/max normalizing the product of bandwidth and dependence

fbic <- read_csv("data/pardee/FBIC Data.csv") %>%
        filter(countrya == "Russia") %>%
        mutate(countryb = case_when(countryb == "Bosnia and Herzegovina" ~ "BiH",
                                    countryb == "Czech Republic" ~ "Czechia",
                                    countryb == "Macedonia" ~ "N. Macedonia",
                                    countryb == "United Kingdom" ~ "U.K.",
                                    countryb == "United States" ~ "U.S.",
                                    TRUE ~ countryb))


#///////////////////////


# inspect
fbic 
fbic %>% glimpse()
fbic %>% nrow() # 5752
fbic %>% ncol() # 13

# check country/years
fbic %>% count(countrya) %>% nrow() # 1
fbic %>% count(countryb) %>% nrow() # 214
fbic %>% count(year) %>% nrow() # 61 
fbic %>% count(year) %>% arrange(year) # # 1960
fbic %>% count(year) %>% arrange(desc(year)) # 2020


# check country names
country_crosswalk %>% filter(ee_region_flag == 1 | country == "U.S.") %>%
        anti_join(., fbic, by = c("country" = "countryb")) %>% select(country)

fbic %>% filter(str_detect(string = countrya, pattern = regex("united", ignore_case = TRUE))) %>% count(countrya)


#////////////////


# inspect security bandwith/dependence
# note that belarus has higher bandwith/dependence on russia, as expected, but 
# ukraine has relatively high bandwith too, though 0 for dependence, which could make sense depending on interpretation of
# what's being measured, but doesn't really get at "security concerns" angle per se
# security bandwith = military alliance index and stock of arms transfers; 
# security dependence = stock of arms transfers as % of arms imports, and stock arms transfers as % of total military stock
fbic %>% filter(countryb %in% c("Belarus", "Ukraine", "Georgia", "Kosovo"), 
                year > 2010
                # year == 2020
                ) %>%
        select(countrya, countryb, year, fbic, securitybandwidth, securitydependence) %>% print(n = nrow(.))


#//////////////////////


# inspect values

# fbic ranges from 0 to 1; 1 represents greater influence held by countrya over countryb (see below confirming high = greater)
# note that fbic is very heavily left skewed, with 75p = .001
# this seems reasonable since most country pairings would have low influence with each other
# even for countrya = Russia and countryb = ee_region, 75p = ~ .12; only a few country/year records have high russian influence
fbic %>% skim(fbic)
# fbic %>% ggplot(data = ., mapping = aes(x = fbic)) + stat_ecdf()
fbic %>% filter(countrya == "Russia", year >= 2010,
                countryb %in% (country_crosswalk %>% filter(ee_region_flag == 1 | country == "U.S.") %>% pull(country))) %>%
        ggplot(data = ., mapping = aes(x = fbic)) + stat_ecdf()

# note that fbic has NA values for countryb = kosovo for 2010-2014; otherwise fbic is complete
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        distinct(country, countrya, year, miri_avg, fbic) %>%
        select(fbic, miri_avg) %>% skim()
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        distinct(country, countrya, year, miri_avg, fbic) %>%
        filter(is.na(fbic)) 

# note that fbic influence is directional, so fbic values are different for a given two countries depending on 
# which country is countrya in record and which is countryb
# countrya is the influencer, countryb is the influencee
# from the fbic docs: "A measure of influence capacity (or relational power) held by one country (Country A) in another (Country B)."
fbic %>% filter(year == 2020, 
                countrya == "Serbia" & countryb == "Russia" | countrya == "Russia" & countryb == "Serbia")

# note that pardee calls the sum of countrya fbic for a given year its "global influence capacity"
# the fbic docs show china having global influence capacity ~ 20 for 2020, which matches the sum(fbic) calculation below
# the fbic docs show a chart of china's high sum(fbic) and describes "rising powers", confirming that higher fbic = more influence
# so for comparison with ri, where fbic measure russia's influence over countries, a high fbic-russian-influence is
# a bad outcome, so lower fbic = better; whereas higher ri = better
fbic %>% filter(year == 2020, countrya == "China") %>% summarize(fbic_sum = sumNA(fbic, na.rm = TRUE))

# top 10 fbic_avg for ee_region countryb is belarus, kyrgyzstan, kazakhstan, tajikistan, armenia, azerbaijan, ukraine, turkmenistan,
# uzbekistan, slovakia
# for ee_presence the top fbic_avg is belarus, armenia, azerbaijan, ukraine, serbia, moldova, georgia, bih, macedonia, albania, kosovo
fbic %>% filter(countrya == "Russia", year >= 2010,
                countryb %in% (country_crosswalk %>% filter(ee_region_flag == 1 | country == "U.S.") %>% pull(country))) %>%
        arrange(desc(fbic)) %>% print(n = 50)
fbic %>% filter(countrya == "Russia", year >= 2010,
                countryb %in% (country_crosswalk %>% filter(ee_region_flag == 1 | country == "U.S.") %>% pull(country))) %>%
        group_by(countryb) %>% mutate(fbic_avg = mean(fbic, na.rm = TRUE)) %>%
        ungroup() %>% select(countrya, countryb, year, fbic, fbic_avg) %>% 
        filter(countryb %in% c(country_crosswalk %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% pull(country))) %>%
        distinct(countrya, countryb, fbic_avg) %>% arrange(desc(fbic_avg)) %>% print(n = nrow(.))


#///////////////////


# plot for all ee_region
# note that all countries with high fbic also have a low ri, which is good
# but there is less fbic variation for countries with low fbic, while there is still significant ri variation 
# for these same countries (eg eu/graduates) 
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg), ., by = c("country" = "countryb", "year")) %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, color = mcp_grouping)) + geom_point() +
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D")

# plot for just ee_presence countries
# much more correlation among ee_presence countries that eu/graduates because fbic has so little variation for low fbic countries
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, color = country)) + geom_point() +
        # geom_segment(x = 0, y = 1, xend = 1, yend = 0, color = "#7D7D7D", size = .03) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01))

# get fbic/ri correlation for all ee_region (-.69)
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg), ., by = c("country" = "countryb", "year")) %>%
        select(fbic, miri_avg) %>%
        # filter(!is.na(fbic)) %>% cor()
        cor(use = "pairwise.complete.obs")

# get fbic/ri correlation for ee_presence countries (-.85)
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        select(fbic, miri_avg) %>%
        # filter(!is.na(fbic)) %>% cor()
        cor(use = "pairwise.complete.obs")

# confirm that regression R-squared is same as correlation^2 for two variables (-.846^2 = -.715)
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        select(fbic, miri_avg) %>% lm(formula = fbic ~ miri_avg, data = .) %>% summary()


#///////////////////


# note however that because ri_avg only ranges for ee_presence countries from .15 - .52, while fbic ranges from 0 - 1,
# the scatterplot trend doesn't far along 45 degree line of equality, like it does for globsec, but correlation within
# the relevant ranges is still high
fmir %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% skim(miri_avg)
fbic %>% filter(countrya == "Russia", year >= 2010,
                countryb %in% c(country_crosswalk %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% pull(country))) %>%
        skim(fbic)
fbic %>% filter(countrya == "Russia", year >= 2010,
                countryb %in% c(country_crosswalk %>% filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% pull(country))) %>%
        # arrange(fbic)
        arrange(desc(fbic))

# plot with 45 degree line - as noted above the 45 degree line isnt appropriate because miri_avg doesn't have same distribution as fbic
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, color = country)) + geom_point() +
        geom_segment(x = 0, y = 1, xend = 1, yend = 0, color = "#7D7D7D", size = .03) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01))

# plot with regression line to better see correlation over meaningful range of values
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, color = country)) + geom_point() +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D")
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") 
        

# plot for just ee_presence countries by year
fbic %>% filter(countrya == "Russia", year >= 2010) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")), ., by = c("country" = "countryb", "year")) %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, color = country)) + geom_point() +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        facet_wrap(facets = vars(year))


#/////////////////////////


# inspect why fbic has greater change over time for belarus and armenia (whereas RI does not)
# this shows on the scatterplot as the most uncorrelated points

# result: 
# both countries had fbic increasing for econmomics (aka more russian influence aka worse outcome)
# but for RI, economic indicators of russian influence were already outliers at the lowest level (worst outcome) in 2010, 
# so couldnt shift to reflect the even worse changees

# for armenia: 
# trade and fdi indicators with russia were at very low levels, but remittances and debt improved over the period
# overall sub_obj_4_1 was very low and decreased, but sub_obj_4_2 increased, so obj_4 stayed relatively flat w slight increase

# for belarus:
# bandwidth increased; dependence was relatively flat
# economic bandwidth increased the most; security bandwidth increased modestly; political bandwidth was flat
fbic %>% filter(countryb %in% c("Armenia", "Belarus"), year >= 2010) %>%
        select(-c(countrya, aregionunpop, bregionunpop))

fbic %>% filter(year >= 2010) %>%
        filter(countryb == "Armenia") %>%
        # filter(countryb == "Belarus") %>%
        # filter(countryb == "Albania") %>%
        select(-c(countrya, aregionunpop, bregionunpop)) %>%
        pivot_longer(cols = -c(countryb, year), names_to = "var", values_to = "values") %>%
        # filter(var %in% c("fbic", "bandwidth", "dependence")) %>%
        filter(var %in% c("fbic", "bandwidth", "politicalbandwidth", "economicbandwidth", "securitybandwidth")) %>%
        # filter(var %in% c("fbic", "dependence", "economicdependence", "securitydependence")) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>% filter(country == "Armenia") %>%
        select(country, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = miri_avg)) + geom_line(size = 1)

fmir %>% filter(country == "Armenia") %>%
        distinct(country, year, obj_num, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = obj_num)) + geom_line(size = 1)

fmir %>% filter(country == "Armenia") %>%
        filter(obj_num == "obj_4") %>%
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_num)) + geom_line(size = 1)

fmir %>% filter(country == "Armenia") %>%
        filter(obj_num == "obj_4") %>%
        distinct(country, year, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line(size = 1)

fmir %>% filter(country == "Armenia") %>%
        # filter(obj_num == "obj_4") %>%
        filter(concept %in% c("Financial health")) %>%
        # filter(concept %in% c("External debt to Russia", "Trade and investment ties with Russia")) %>%
        select(country, year, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line(size = 1)


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ri_fbic_scatterplot ####

chart_data <- fbic %>% filter(countrya == "Russia", year >= 2010, year <= 2020) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
                          filter(year <= 2020), 
                  ., by = c("country" = "countryb", "year")) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Armenia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(12) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# get round_to_digits 
round_to_digits <- function(x, digits, big_mark = ",") {
        sign <- sign(x)
        z <- abs(x) * 10^digits
        z <- z + 0.5
        z <- trunc(z)
        z <- z / 10^digits
        z <- z * sign
        return(str_trim(string = format(x = z, nsmall = digits, big.mark = big_mark), side = "both"))
}

# create chart
ri_fbic_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, label = country,
                                       color = factor(color_bin, levels = c("Albania",
                                                                            "Armenia",
                                                                            "Azerbaijan",
                                                                            "Belarus",
                                                                            "BiH",
                                                                            "Georgia",
                                                                            "Kosovo",
                                                                            "Moldova",
                                                                            "N. Macedonia",
                                                                            "Serbia",
                                                                            "Ukraine"))
                                       # color = mcp_grouping
                                       )) + 
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = miri_avg, y = fbic, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = .2, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        geom_point(size = 3) +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = .1, to = .6, by = .1), limits = c(.1, .62),
                           labels = label_number(accuracy = .01)) +
        labs(x = "Resilience Index (higher is better)", y = "FBIC Russian influence capacity\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 4, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
ri_fbic_scatterplot


#////////////////////////////////


# size to 130%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_fbic_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_fbic_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ri_fbic_facet_scatterplot ####

chart_data <- fbic %>% filter(countrya == "Russia", year >= 2010, year <= 2020) %>%
        left_join(fmir %>% select(country, mcp_grouping, year, miri_avg) %>% 
                          # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
                          filter(year <= 2020), 
                  ., by = c("country" = "countryb", "year")) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Armenia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(12) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#////////////////////////////////////////////////////////////////////////////////////////


# get round_to_digits 
round_to_digits <- function(x, digits, big_mark = ",") {
        sign <- sign(x)
        z <- abs(x) * 10^digits
        z <- z + 0.5
        z <- trunc(z)
        z <- z / 10^digits
        z <- z * sign
        return(str_trim(string = format(x = z, nsmall = digits, big.mark = big_mark), side = "both"))
}

# create chart
ri_fbic_facet_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = fbic, label = country,
                                       # color = factor(color_bin, levels = c("Albania",
                                       #                                      "Armenia",
                                       #                                      "Azerbaijan",
                                       #                                      "Belarus",
                                       #                                      "BiH",
                                       #                                      "Georgia",
                                       #                                      "Kosovo",
                                       #                                      "Moldova",
                                       #                                      "N. Macedonia",
                                       #                                      "Serbia",
                                       #                                      "Ukraine"))
                                       color = mcp_grouping
                                       )) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 2) +
        facet_wrap(facets = vars(year)) +
        # scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .25), limits = c(0, 1),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = .1, to = .6, by = .1), limits = c(.1, .62),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Resilience Index (higher is better)", y = "FBIC Russian influence capacity\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 4, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 0, 5, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
ri_fbic_facet_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ri_fbic_facet_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ri_fbic_facet_scatterplot.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# load eucom oip data on malign influence ####

# oip reports saved at:
# https://drive.google.com/drive/folders/1VFm8JWUKODeuARFrQh7NxAKPMV-DEaKS

# note that OIP 2022 reports are based on surveys in first half-ish of 2022
# "The surveys for the research were conducted from February to April 2022, and the sociopolitical research was undertaken 
# from February to May 1, 2022"
# might be most accurate to say they reflect conditions on ground in 2021 for comparison purposes with RI in the future

# data was pulled from eucom oip 2021 and 2022 overview, 2022 country reports, as well as 2021 bosnia country report
# only had 9 of 13 2022 country reports though
# 2022 overview: 
# - MFI 2018-2022 p21
# - MMP p 62
# 2021 overview:
# - MMP p 81
# - MMVE p 84
# 2021 bosnia:
# - domain scores begin at p 60

# note that eucom oip indicators are on 0-100 scale with low scores = better outcomes (aka lower vulnerability)
eucom <- read_excel(path = "data/eucom/eucom_oip_data_20220721.xlsx") %>%
        mutate(media_trust_and_media_domain = case_when(!is.na(media_domain) ~ media_domain, 
                                                        TRUE ~ media_trust))
# group_by(country) %>%
# fill(c(RNA, CNA, WNA, WMP, MMP, WMVE, MMVE, media_trust, internal_disposition), .direction = "downup") %>%
# ungroup()



#//////////////////////////


# inspect
eucom
eucom %>% glimpse()
eucom %>% nrow() # 65
eucom %>% ncol() # 19


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get fmir_extract of relevant indicators for comparison


fmir_extract <- fmir %>% filter(year %in% 2018:2020) %>%
        distinct(country, year, miri_avg) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     obj_num == "obj_1") %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_1 = obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     sub_obj_num == "sub_obj_1_3") %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_1_3 = sub_obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     concept == "Resilience to external interference") %>%
                          distinct(country, year, concept_avg) %>%
                          rename("resilience_to_external_interference" = concept_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     concept == "Foreign relations") %>%
                          distinct(country, year, concept_avg) %>%
                          rename(foreign_relations = concept_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     obj_num == "obj_2") %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_2 = obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     sub_obj_num == "sub_obj_2_1") %>%
                          distinct(country, year, sub_obj_avg) %>%
                          rename(sub_obj_2_1 = sub_obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     concept == "Trusted information") %>%
                          distinct(country, year, concept_avg) %>%
                          rename(trusted_information = concept_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     concept == "Narratives pushed by Russian state media") %>%
                          distinct(country, year, concept_avg) %>%
                          rename(russian_state_media_narratives = concept_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
                          distinct(country, year, indicator_standardized_values) %>%
                          rename(vdem_foreign_gov_dissem_false_info_isv = indicator_standardized_values),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
                          distinct(country, year, values) %>%
                          rename(vdem_foreign_gov_dissem_false_info_raw = values),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     obj_num == "obj_3") %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_3 = obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     obj_num == "obj_4") %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_4 = obj_avg),
                  by = c("country", "year")) %>%
        left_join(., fmir %>% filter(year %in% 2018:2020,
                                     obj_num == "obj_c") %>%
                          distinct(country, year, obj_avg) %>%
                          rename(obj_c = obj_avg),
                  by = c("country", "year"))


#//////////////////////////////////


# inspect
fmir_extract
fmir_extract %>% glimpse()
fmir_extract %>% nrow() # 129    
fmir_extract %>% ncol() # 16


#//////////////////////////////////////////////////////////////////////////////////////////////////


# add fmir_extract to eucom
# note that fmir year 2020 will be compared to eucom year 2021, since that is best available comparison
eucom <- fmir_extract %>% 
        left_join(eucom %>% mutate(eucom_adj_year = year - 1) %>% select(-year) %>% 
                          relocate(eucom_adj_year, .after = country) %>% rename(year = eucom_adj_year), ., 
                  by = c("country", "year"))


#//////////////////////////


# inspect
eucom
eucom %>% glimpse()
eucom %>% nrow() # 65
eucom %>% ncol() # 33


#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare eucom with fmir_extract ####

# get correlation matrix

# MFI and miri_avg; r = -.53
# MPP and obj_2; r = -.54
# media_domain and obj_2; r = -.25
# political_domain and obj_1; r = -.36
# economic_domain and obj_4; r = -.51

# odd that vdem_foreign_gov_dissem_of_false_info is barely ever negatively correlated with any eucom indicators
eucom %>% 
        filter(year <= 2020) %>%
        # filter(year == 2020) %>%
        select(-c(country, year)) %>% 
        # correlate() %>% rplot()
        cor(use = "pairwise.complete.obs") %>%
        ggcorrplot(corr = ., method = "square", type = "lower", lab = TRUE, colors = c("red", "white", "blue"), lab_size = 3)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eucom_mfi_and_miri_avg_scatterplot ####

# r = -.53
eucom %>% 
        ggplot(data = ., mapping = aes(x = miri_avg, y = MFI, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = miri_avg, y = MFI, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri")


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- eucom %>% 
        filter(year <= 2020) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Belarus" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Bulgaria" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Denmark" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Greece" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(13) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(14) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
eucom_mfi_and_miri_avg_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = miri_avg, y = MFI, label = country,
                                       color = color_bin)) + 
        # geom_text_repel(fontface = "bold", point.padding = 2, size = 4, family = "Calibri") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 5) +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = miri_avg, y = MFI, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .1, y = 23, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 20, to = 60, by = 10), limits = c(20, 60),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = .1, to = .8, by = .1), limits = c(.1, .8),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Resilience Index (higher is better)", y = "OIP Malign Foreign Influence\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 100, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                axis.ticks.x = element_line(color = "#333333"),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
eucom_mfi_and_miri_avg_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eucom_mfi_and_miri_avg_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eucom_mfi_and_miri_avg_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eucom_mmp_and_obj_2_scatterplot ####

# compare obj_2 and MMP; r = -.54
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = MMP, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = MMP, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 50, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri")


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- eucom %>% 
        filter(year <= 2020) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Belarus" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Bulgaria" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Denmark" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Greece" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(13) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(14) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
eucom_mmp_and_obj_2_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = MMP, label = country,
                                       color = color_bin)) + 
        # geom_text_repel(fontface = "bold", point.padding = 2, size = 4, family = "Calibri") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 5) +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = MMP, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .22, y = 42, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 40, to = 100, by = 10), limits = c(40, 100),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = .2, to = .8, by = .1), limits = c(.2, .8),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Information resilience (higher is better)", y = "OIP Malign Media Penetration\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 170, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                axis.ticks.x = element_line(color = "#333333"),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
eucom_mmp_and_obj_2_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eucom_mmp_and_obj_2_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eucom_mmp_and_obj_2_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# no useful trend: compare russian_state_media_narratives and media_trust_and_media_domain; r = .14
# eucom %>% 
#         ggplot(data = ., mapping = aes(x = russian_state_media_narratives, y = media_trust_and_media_domain, color = country, label = country)) + 
#         geom_point(size = 3) + geom_text(nudge_y = -1) +
#         stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
#         geom_text(data = eucom %>% 
#                           mutate(correlation = cor(x = russian_state_media_narratives, y = media_trust_and_media_domain, 
#                                                    use = "pairwise.complete.obs"),
#                                  correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
#                           slice(1), 
#                   mapping = aes(x = .12, y = 22, label = correlation),
#                   fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare russian_state_media_narratives and MMVE; r = -.27
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = russian_state_media_narratives, y = MMVE, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = russian_state_media_narratives, y = MMVE, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 0, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eucom_media_domain_and_obj_2_scatterplot ####

# compare obj_2 and media_domain; r = -.25
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = media_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = media_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- eucom %>% 
        filter(year <= 2020) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Belarus" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Bulgaria" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Denmark" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Greece" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(13) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(14) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
eucom_media_domain_and_obj_2_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = media_domain, label = country,
                                       color = color_bin)) + 
        # geom_text_repel(fontface = "bold", point.padding = 2, size = 4, family = "Calibri") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 5) +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = media_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .22, y = 22, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 20, to = 60, by = 10), limits = c(20, 60),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = .2, to = .8, by = .1), limits = c(.2, .8),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Information resilience (higher is better)", y = "OIP Media Domain\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 120, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                axis.ticks.x = element_line(color = "#333333"),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
eucom_media_domain_and_obj_2_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eucom_media_domain_and_obj_2_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eucom_media_domain_and_obj_2_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare obj_2 and MFI: r = -.50
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = MFI, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = MFI, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eucom_political_domain_and_obj_1_scatterplot ####

# compare obj_1 and poltical_domain: r = -.36
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = political_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_1, y = political_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- eucom %>% 
        filter(year <= 2020) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Belarus" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Bulgaria" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Denmark" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Greece" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(13) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(14) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
eucom_political_domain_and_obj_3_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = obj_1, y = political_domain, label = country,
                                       color = color_bin)) + 
        # geom_text_repel(fontface = "bold", point.padding = 2, size = 4, family = "Calibri") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 5) +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_1, y = political_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .22, y = 22, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 20, to = 60, by = 10), limits = c(20, 62),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = .2, to = .8, by = .1), limits = c(.2, .8),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Democratic resilience (higher is better)", y = "OIP Political Domain\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 120, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                axis.ticks.x = element_line(color = "#333333"),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
eucom_political_domain_and_obj_3_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eucom_political_domain_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eucom_political_domain_and_obj_3_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare obj_1 and social_domain: r = -.22
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_2, y = social_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_2, y = social_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare obj_3 and economic_domain: r = -.51, but leveraged outliers
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_3, y = economic_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_3, y = economic_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") 


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eucom_economic_domain_and_obj_4_scatterplot ####

# compare obj_4 and economic_domain: r = -.51
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_4, y = economic_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_4, y = economic_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri")


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- eucom %>% 
        filter(year <= 2020) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Belarus" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Bulgaria" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Denmark" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Greece" ~ color_palette %>% slice(6) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "Lithuania" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "Montenegro" ~ color_palette %>% slice(11) %>% pull(hex),
                                 color_bin == "Poland" ~ color_palette %>% slice(12) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(13) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(14) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
eucom_economic_domain_and_obj_4_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = obj_4, y = economic_domain, label = country,
                                       color = color_bin)) + 
        # geom_text_repel(fontface = "bold", point.padding = 2, size = 4, family = "Calibri") +
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_point(size = 5) +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_4, y = economic_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .02, y = 22, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 20, to = 80, by = 10), limits = c(20, 80),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 0, to = .7, by = .1), limits = c(0, .7),
                           labels = label_number(accuracy = .1)) +
        labs(x = "Economic resilience (higher is better)", y = "OIP Economic Domain\n(lower is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 150, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#333333", size = .5),
                panel.spacing = unit(1.5, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 1, l = 0), angle = 0, hjust = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(color = "#333333"),
                axis.ticks.x = element_line(color = "#333333"),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 10, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
eucom_economic_domain_and_obj_4_scatterplot


#////////////////////////////////


# resize to 152%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(eucom_economic_domain_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/eucom_economic_domain_and_obj_4_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare obj_3 and security_domain: r = -.52, but leveraged outliers
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_3, y = security_domain, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = obj_3, y = security_domain, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = 30, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# compare MFI and vdem_foreign_gov_dissem_of_false_info_raw; r = .1
eucom %>% 
        filter(year <= 2020) %>%
        ggplot(data = ., mapping = aes(x = vdem_foreign_gov_dissem_false_info_raw, y = MFI, color = country, label = country)) + 
        geom_point(size = 3) + geom_text(nudge_y = -1) +
        stat_smooth(method = "lm", se = FALSE, fullrange = T, color = "#7D7D7D") +
        geom_text(data = eucom %>% 
                          mutate(correlation = cor(x = vdem_foreign_gov_dissem_false_info_raw, y = MFI, use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .12, y = .2, label = correlation),
                  fontface = "bold", hjust = 0, size = 4, color = "#7D7D7D", family = "Calibri")


# inspect vdem
vdem_foreign_gov_dissem_false_info <- vdem %>% select(country_name, year, v2smfordom) %>%
        filter(year >= 2001) %>% 
        rename(sub_obj_1_3_vdem_foreign_gov_dissem_false_info = "v2smfordom") %>%
        pivot_longer(cols = sub_obj_1_3_vdem_foreign_gov_dissem_false_info, names_to = "indicator_name", values_to = "values") %>%
        mutate(high_value_is_good_outcome_flag = 1) 

vdem_foreign_gov_dissem_false_info %>% 
        filter(year == 2020) %>%
        filter(country_name %in% c("Belarus", "Bulgaria", "Georgia", "Kosovo", "Moldova", "Montenegro",
                                   "Poland", "Serbia", "Ukraine")) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country_name, .x = values, .desc = FALSE), y = values)) +
        geom_col() +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = .5)
        )


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ee_ri_level_2021_bar_chart ####

# plot
fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, year, miri_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg, .desc = FALSE), y = miri_avg)) +
        geom_col()
        
        
#//////////////////


# get chart data
chart_data <- fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, year, miri_avg) %>%
        mutate(var = country, values = miri_avg) %>%
        mutate(color_bin = country,
               color = case_when(TRUE ~ color_palette %>% slice(2) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart

ee_ri_level_2021_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = factor(color_bin, levels = c("Albania",
                                                                  "Armenia", 
                                                                  "Azerbaijan",
                                                                  "Belarus",
                                                                  "BiH",
                                                                  "Georgia",
                                                                  "Kosovo",
                                                                  "Moldova",
                                                                  "N. Macedonia",
                                                                  "Serbia",
                                                                  "Ukraine")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list, guide = "none") +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1),
                           limits = c(0, .6),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) 
        # guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
ee_ri_level_2021_bar_chart


#//////////////////////////////////


# resize to 173%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ee_ri_level_2021_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/ee_ri_level_2021_bar_chart.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ee_ri_diff_2010_2021_bar_chart ####

# plot
fmir %>% filter(year %in% c(2010, 2021), 
                mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, year, miri_avg) %>%
        pivot_wider(id_cols = country, names_from = year, values_from = miri_avg) %>%
        mutate(miri_avg_diff = `2021` - `2010`) %>%
        arrange(desc(miri_avg_diff)) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg_diff, .desc = FALSE), y = miri_avg_diff)) +
        geom_col()


#//////////////////


# get chart data
chart_data <- fmir %>% filter(year %in% c(2010, 2021), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, year, miri_avg) %>%
        pivot_wider(id_cols = country, names_from = year, values_from = miri_avg) %>%
        mutate(miri_avg_diff = `2021` - `2010`,
               values = miri_avg_diff) %>%
        mutate(color_bin = country,
               color = case_when(TRUE ~ color_palette %>% slice(2) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart

ee_ri_diff_2010_2021_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = factor(color_bin, levels = c("Albania",
                                                                 "Armenia", 
                                                                 "Azerbaijan",
                                                                 "Belarus",
                                                                 "BiH",
                                                                 "Georgia",
                                                                 "Kosovo",
                                                                 "Moldova",
                                                                 "N. Macedonia",
                                                                 "Serbia",
                                                                 "Ukraine")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list, guide = "none") +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = -.04, to = .12, by = .02),
                           limits = c(-.04, .12),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Change in score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 3 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) 
# guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
ee_ri_diff_2010_2021_bar_chart


#//////////////////////////////////


# resize to 158%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ee_ri_diff_2010_2021_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/ee_ri_diff_2010_2021_bar_chart.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# graduates_ri_diff_2010_2020_bar_chart ####

# plot
fmir %>% filter(year %in% c(2010, 2020), mcp_grouping %in% c("E&E graduates")) %>% 
        distinct(country, year, miri_avg) %>%
        pivot_wider(id_cols = country, names_from = year, values_from = miri_avg) %>%
        mutate(miri_avg_diff = `2020` - `2010`) %>%
        arrange(desc(miri_avg_diff)) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = miri_avg_diff, .desc = FALSE), y = miri_avg_diff)) +
        geom_col()


#//////////////////


# get chart data
chart_data <- fmir %>% filter(year %in% c(2010, 2020), mcp_grouping %in% c("E&E graduates")) %>% 
        distinct(country, year, miri_avg) %>%
        pivot_wider(id_cols = country, names_from = year, values_from = miri_avg) %>%
        mutate(miri_avg_diff = `2020` - `2010`,
               values = miri_avg_diff) %>%
        mutate(color_bin = country,
               color = case_when(TRUE ~ color_palette %>% slice(2) %>% pull(hex)))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart

graduates_ri_diff_2010_2020_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = factor(color_bin, levels = c("Bulgaria",
                                                                 "Croatia", 
                                                                 "Czechia",
                                                                 "Estonia",
                                                                 "Hungary",
                                                                 "Latvia",
                                                                 "Lithuania",
                                                                 "Montenegro",
                                                                 "Poland",
                                                                 "Romania",
                                                                 "Slovakia",
                                                                 "Slovenia")))) + 
        geom_col(width = .8) + 
        scale_fill_manual(values = chart_data_color_list, guide = "none") +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = -.14, to = .08, by = .02),
                           limits = c(-.14, .08),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Change in score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 3 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) 
# guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
graduates_ri_diff_2010_2020_bar_chart


#//////////////////////////////////


# resize to 158%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(graduates_ri_diff_2010_2020_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/graduates_ri_diff_2010_2020_bar_chart.docx")

        
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ee_obj_level_2021_bar_chart ####

# plot
fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(mcp_grouping, obj_num) %>%
        mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% arrange(obj_num, mcp_grouping) %>%
        distinct(obj_num, mcp_grouping, year, obj_avg_mean) %>%
        ggplot(data = ., mapping = aes(x = obj_num, 
                                       y = obj_avg_mean, fill = mcp_grouping)) +
        geom_col(position = "dodge")


# plot without splitting by mcp_grouping
fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(obj_num) %>%
        mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% arrange(obj_num) %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        ggplot(data = ., mapping = aes(x = obj_num, 
                                       y = obj_avg_mean)) +
        geom_col(position = "dodge")


#//////////////////


# get chart data
chart_data <- fmir %>% filter(year == 2021, mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(mcp_grouping, obj_num) %>%
        mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% arrange(obj_num, mcp_grouping) %>%
        distinct(obj_num, mcp_grouping, year, obj_avg_mean) %>%
        mutate(var = case_when(obj_num == "obj_1" ~ "Democratic",
                               obj_num == "obj_2" ~ "Information",
                               obj_num == "obj_3" ~ "Energy",
                               obj_num == "obj_4" ~ "Economic",
                               obj_num == "obj_c" ~ "Corruption",
                               TRUE ~ obj_num), 
               var_order = case_when(obj_num == "obj_1" ~ 1,
                                     obj_num == "obj_2" ~ 2,
                                     obj_num == "obj_3" ~ 3,
                                     obj_num == "obj_4" ~ 4,
                                     obj_num == "obj_c" ~ 5,
                                     TRUE ~ NA_real_),
               var = fct_reorder(.f = var, .x = var_order, .desc = FALSE),
               values = obj_avg_mean) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(3) %>% pull(hex),
                       TRUE ~ NA_character_))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart

ee_obj_level_2021_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = var, 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans",
                                                                 "E&E Eurasia")))) + 
        geom_col(width = .6, position = "dodge") + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = .6, by = .2),
                           limits = c(0, .6),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 4 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) 
# guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
ee_obj_level_2021_bar_chart


#//////////////////////////////////


# resize to 140%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ee_obj_level_2021_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/ee_obj_level_2021_bar_chart.docx")


#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////
#////////////////////////////////////////////////////////////////////////////////////////


# ee_obj_diff_2010_2021_bar_chart ####

# plot
fmir %>% filter(year %in% c(2010, 2021), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(obj_num, mcp_grouping, year) %>%
        mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% arrange(obj_num, mcp_grouping, year) %>%
        distinct(obj_num, mcp_grouping, year, obj_avg_mean) %>%
        pivot_wider(id_cols = c(obj_num, mcp_grouping), names_from = year, values_from = obj_avg_mean) %>%
        mutate(diff_obj_avg_mean = `2021` - `2010`) %>%
        ggplot(data = ., mapping = aes(x = obj_num, y = diff_obj_avg_mean, fill = mcp_grouping)) +
        geom_col(position = "dodge")


#//////////////////


# get chart data
chart_data <- fmir %>% filter(year %in% c(2010, 2021), mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        group_by(obj_num, mcp_grouping, year) %>%
        mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% arrange(obj_num, mcp_grouping, year) %>%
        distinct(obj_num, mcp_grouping, year, obj_avg_mean) %>%
        pivot_wider(id_cols = c(obj_num, mcp_grouping), names_from = year, values_from = obj_avg_mean) %>%
        mutate(diff_obj_avg_mean = `2021` - `2010`) %>%
        mutate(var = case_when(obj_num == "obj_1" ~ "Democratic",
                               obj_num == "obj_2" ~ "Information",
                               obj_num == "obj_3" ~ "Energy",
                               obj_num == "obj_4" ~ "Economic",
                               obj_num == "obj_c" ~ "Corruption",
                               TRUE ~ obj_num), 
               var_order = case_when(obj_num == "obj_1" ~ 1,
                                     obj_num == "obj_2" ~ 2,
                                     obj_num == "obj_3" ~ 3,
                                     obj_num == "obj_4" ~ 4,
                                     obj_num == "obj_c" ~ 5,
                                     TRUE ~ NA_real_),
               var = fct_reorder(.f = var, .x = var_order, .desc = FALSE),
               values = diff_obj_avg_mean) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(mcp_grouping == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 mcp_grouping == "E&E Eurasia" ~ color_palette %>% slice(3) %>% pull(hex),
                                 TRUE ~ NA_character_))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart

ee_obj_diff_2010_2021_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = var, 
                             y = values, 
                             fill = factor(color_bin, levels = c("E&E Balkans",
                                                                 "E&E Eurasia")))) + 
        geom_col(width = .6, position = "dodge") + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = -.06, to = .12, by = .03),
                           limits = c(-.06, .12),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Change in score (higher is better)", 
             title = NULL,
             caption = NULL, fill = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 8, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) 
# guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
ee_obj_diff_2010_2021_bar_chart


#//////////////////////////////////


# resize to 156%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ee_obj_diff_2010_2021_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/ee_obj_diff_2010_2021_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_1_line_chart ####

fmir %>% filter(country == "Ukraine",
                obj_num == "obj_1") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_1") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_num)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% filter(country == current_country,
                              obj_num == "obj_1") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == current_country, obj_num == "obj_1") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        mutate(legend_order = case_when(sub_obj_num == "obj_1" ~ 1,
                                      sub_obj_num == "sub_obj_c" ~ 2,
                                      sub_obj_num == "sub_obj_1_2" ~ 3,
                                      sub_obj_num == "sub_obj_1_3" ~ 4)) %>%
        mutate(values = sub_obj_avg,
               label = case_when(sub_obj_num == "sub_obj_c" ~ "Sub-obj. 1.1",
                                 sub_obj_num == "sub_obj_1_2" ~ "Sub-obj. 1.2",
                                 sub_obj_num == "sub_obj_1_3" ~ "Sub-obj. 1.3",
                                 sub_obj_num == "obj_1" ~ "Obj. 1"),
                color_bin = case_when(sub_obj_num == "sub_obj_c" ~ "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                     sub_obj_num == "sub_obj_1_2" ~ "Sub-obj. 1.2: Civil society",
                                     sub_obj_num == "sub_obj_1_3" ~ "Sub-obj. 1.3: Resilience to electoral /\npolitical interference and polarization",
                                     sub_obj_num == "obj_1" ~ "Obj. 1: Democratic"),
               color = case_when(color_bin == "Sub-obj. 1.1: Checks and balances\nand rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Sub-obj. 1.2: Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Sub-obj. 1.3: Resilience to electoral /\npolitical interference and polarization" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 1: Democratic" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position() 
        

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ukraine_obj_1_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Sub-obj. 1.3: Resilience to electoral /\npolitical interference and polarization",
                                                                  "Sub-obj. 1.2: Civil society",
                                                                  "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                                                  "Obj. 1: Democratic")),
                             linetype = factor(color_bin, levels = c("Sub-obj. 1.3: Resilience to electoral /\npolitical interference and polarization",
                                                                     "Sub-obj. 1.2: Civil society",
                                                                     "Sub-obj. 1.1: Checks and balances\nand rule of law",
                                                                     "Obj. 1: Democratic")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 1.1: Checks and balances\nand rule of law"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 1.2: Civil society"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 1.3: Resilience to electoral /\npolitical interference and polarization"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Obj. 1: Democratic"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.7, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
ukraine_obj_1_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_obj_1_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_obj_1_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_2_line_chart ####

fmir %>% filter(country == "Ukraine",
                obj_num == "obj_2") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_2") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_num)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% filter(country == current_country,
                              obj_num == "obj_2") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == current_country, obj_num == "obj_2") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        mutate(legend_order = case_when(sub_obj_num == "obj_2" ~ 1,
                                        sub_obj_num == "sub_obj_2_1" ~ 2,
                                        sub_obj_num == "sub_obj_2_2" ~ 3,
                                        sub_obj_num == "sub_obj_2_3" ~ 4)) %>%
        mutate(values = sub_obj_avg,
               label = case_when(sub_obj_num == "sub_obj_2_1" ~ "Sub-obj. 2.1",
                                 sub_obj_num == "sub_obj_2_2" ~ "Sub-obj. 2.2",
                                 sub_obj_num == "sub_obj_2_3" ~ "Sub-obj. 2.3",
                                 sub_obj_num == "obj_2" ~ "Obj. 2"),
               color_bin = case_when(sub_obj_num == "sub_obj_2_1" ~ "Sub-obj. 2.1: Trusted media\nand information",
                                     sub_obj_num == "sub_obj_2_2" ~ "Sub-obj. 2.2: Media demand",
                                     sub_obj_num == "sub_obj_2_3" ~ "Sub-obj. 2.3: Media freedom",
                                     sub_obj_num == "obj_2" ~ "Obj. 2: Information"),
               color = case_when(color_bin == "Sub-obj. 2.1: Trusted media\nand information" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Sub-obj. 2.2: Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Sub-obj. 2.3: Media freedom" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 2: Information" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ukraine_obj_2_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Sub-obj. 2.3: Media freedom",
                                                                  "Sub-obj. 2.2: Media demand",
                                                                  "Sub-obj. 2.1: Trusted media\nand information",
                                                                  "Obj. 2: Information")),
                             linetype = factor(color_bin, levels = c("Sub-obj. 2.3: Media freedom",
                                                                     "Sub-obj. 2.2: Media demand",
                                                                     "Sub-obj. 2.1: Trusted media\nand information",
                                                                     "Obj. 2: Information")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 2.1: Trusted media\nand information"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 2.2: Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 2.3: Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Obj. 2: Information"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
ukraine_obj_2_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_obj_2_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_obj_2_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_3_line_chart ####

fmir %>% filter(country == "Ukraine",
                obj_num == "obj_3") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_3") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_num)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% filter(country == current_country,
                              obj_num == "obj_3") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == current_country, obj_num == "obj_3") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        mutate(legend_order = case_when(sub_obj_num == "obj_3" ~ 1,
                                        sub_obj_num == "sub_obj_3_1" ~ 2,
                                        sub_obj_num == "sub_obj_3_2" ~ 3,
                                        sub_obj_num == "sub_obj_3_3" ~ 4)) %>%
        mutate(values = sub_obj_avg,
               label = case_when(sub_obj_num == "sub_obj_3_1" ~ "Sub-obj. 3.1",
                                 sub_obj_num == "sub_obj_3_2" ~ "Sub-obj. 3.2",
                                 sub_obj_num == "sub_obj_3_3" ~ "Sub-obj. 3.3",
                                 sub_obj_num == "obj_3" ~ "Obj. 3"),
               color_bin = case_when(sub_obj_num == "sub_obj_3_1" ~ "Sub-obj. 3.1: Energy security",
                                     sub_obj_num == "sub_obj_3_2" ~ "Sub-obj. 3.2: Independence from\nRussian energy",
                                     sub_obj_num == "sub_obj_3_3" ~ "Sub-obj. 3.3: Energy regulation",
                                     sub_obj_num == "obj_3" ~ "Obj. 3: Energy"),
               color = case_when(color_bin == "Sub-obj. 3.1: Energy security" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Sub-obj. 3.2: Independence from\nRussian energy" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Sub-obj. 3.3: Energy regulation" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Obj. 3: Energy" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ukraine_obj_3_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Sub-obj. 3.3: Energy regulation",
                                                                  "Sub-obj. 3.2: Independence from\nRussian energy",
                                                                  "Sub-obj. 3.1: Energy security",
                                                                  "Obj. 3: Energy")),
                             linetype = factor(color_bin, levels = c("Sub-obj. 3.3: Energy regulation",
                                                                     "Sub-obj. 3.2: Independence from\nRussian energy",
                                                                     "Sub-obj. 3.1: Energy security",
                                                                     "Obj. 3: Energy")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.2: Independence from\nRussian energy"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.3: Energy regulation"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Obj. 3: Energy"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
ukraine_obj_3_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_obj_3_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_obj_3_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_4_line_chart ####

fmir %>% filter(country == "Ukraine",
                obj_num == "obj_4") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_4") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_num)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% filter(country == current_country,
                              obj_num == "obj_4") %>% 
        distinct(country, year, sub_obj_num, sub_obj_avg) %>%
        bind_rows(., fmir %>% filter(country == current_country, obj_num == "obj_4") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(sub_obj_num = obj_num, sub_obj_avg = obj_avg)) %>%
        arrange(desc(year)) %>%
        mutate(legend_order = case_when(sub_obj_num == "obj_4" ~ 1,
                                        sub_obj_num == "sub_obj_4_1" ~ 2,
                                        sub_obj_num == "sub_obj_4_2" ~ 3)) %>%
        mutate(values = sub_obj_avg,
               label = case_when(sub_obj_num == "sub_obj_4_1" ~ "Sub-obj. 4.1",
                                 sub_obj_num == "sub_obj_4_2" ~ "Sub-obj. 4.2",
                                 sub_obj_num == "obj_4" ~ "Obj. 4"),
               color_bin = case_when(sub_obj_num == "sub_obj_4_1" ~ "Sub-obj. 4.1: Economic competitivenss",
                                     sub_obj_num == "sub_obj_4_2" ~ "Sub-obj. 4.2: Financial health",
                                     sub_obj_num == "obj_4" ~ "Obj. 4: Economic"),
               color = case_when(color_bin == "Sub-obj. 4.1: Economic competitivenss" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Sub-obj. 4.2: Financial health" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Obj. 4: Economic" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ukraine_obj_4_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Sub-obj. 4.2: Financial health",
                                                                  "Sub-obj. 4.1: Economic competitivenss",
                                                                  "Obj. 4: Economic")),
                             linetype = factor(color_bin, levels = c("Sub-obj. 4.2: Financial health",
                                                                     "Sub-obj. 4.1: Economic competitivenss",
                                                                     "Obj. 4: Economic")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 4.1: Economic competitivenss"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 4.2: Financial health"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Obj. 4: Economic"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
ukraine_obj_4_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_obj_4_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_obj_4_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_obj_c_line_chart ####

fmir %>% filter(country == "Ukraine",
                obj_num == "obj_c") %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_c") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(indicator_name = obj_num, indicator_standardized_values = obj_avg)) %>%
        arrange(desc(year)) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
current_country <- "Ukraine"
chart_data <- fmir %>% filter(country == "Ukraine",
                              obj_num == "obj_c") %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        bind_rows(., fmir %>% filter(country == "Ukraine", obj_num == "obj_c") %>%
                          distinct(country, year, obj_num, obj_avg) %>%
                          rename(indicator_name = obj_num, indicator_standardized_values = obj_avg)) %>%
        mutate(legend_order = case_when(indicator_name == "obj_c" ~ 1,
                                        indicator_name == "cross_cutting_obj_fh_corruption" ~ 2,
                                        indicator_name == "cross_cutting_obj_ti_cpi" ~ 3,
                                       indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ 4,
                                       indicator_name == "cross_cutting_obj_state_money_laundering" ~ 5)) %>%
        mutate(values = indicator_standardized_values,
               label = case_when(indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH",
                                 indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI",
                                 indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI",
                                 indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State/IMF",
                                 indicator_name == "obj_c" ~ "Cross-cutting Obj."),
               color_bin = case_when(indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption Perceptions Index",
                                     indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Control of corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State/IMF: Money laundering risk",
                                     indicator_name == "obj_c" ~ "Cross-cutting Obj.: Corruption"),
               color = case_when(color_bin == "FH: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "TI: Corruption Perceptions Index" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "WGI: Control of corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State/IMF: Money laundering risk" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Cross-cutting Obj.: Corruption" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(legend_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(legend_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
ukraine_obj_c_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("State/IMF: Money laundering risk",
                                                                  "WGI: Control of corruption",
                                                                  "Corruption Perceptions Index",
                                                                  "FH: Corruption",
                                                                  "Cross-cutting Obj.: Corruption")),
                             linetype = factor(color_bin, levels = c("State/IMF: Money laundering risk",
                                                                     "WGI: Control of corruption",
                                                                     "Corruption Perceptions Index",
                                                                     "FH: Corruption",
                                                                     "Cross-cutting Obj.: Corruption")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Cross-cutting Obj.: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State/IMF: Money laundering risk"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption Perceptions Index"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Control of corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 20, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
ukraine_obj_c_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_obj_c_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_obj_c_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_sub_obj_1_3_icews_socio_political_hostility_from_russia_line_chart ####

# inspect
# note that the trends seem to make sense for the most part
# armenia had inv = 0 in 2015, likely because of gyumri massacre: https://en.wikipedia.org/wiki/Gyumri_massacre
# georgia had drop in 2018, likely due to a range of abkhazia/ossetia reasons: https://en.wikipedia.org/wiki/2018_in_Georgia
# moldova has drops in 2013, likely related to consideration of deeper EU trade ties 
# https://www.nytimes.com/2013/10/23/world/europe/russia-putting-a-strong-arm-on-neighbors.html 
# and in 2017, likely related to remove russian troops etc from transnistria
# https://en.wikipedia.org/wiki/Moldova%E2%80%93Russia_relations#:~:text=Moldova%E2%80%93Russia%20relations%20are%20the,strained%20Moldovan%20relations%20with%20Russia.
# belarus has a drop in 2015, likely related to lukashenko's post-maidan turn to EU/US and fear of russia
# https://www.theguardian.com/world/2015/may/28/belarus-russia-brotherly-love-ukraine-crisis
# not sure why belarus had inv = 0 in 2010
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_1_3_icews_socio_political_hostility_from_russia") %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = country)) + geom_line()
        
# note the only imputations are for 2020
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_1_3_icews_socio_political_hostility_from_russia") %>%
        skim(values_z_std)
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_1_3_icews_socio_political_hostility_from_russia",
                is.na(values_z_std)) %>% 
        select(country, year, indicator_name, values, values_z_std)

# plot raw values_z_std
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_1_3_icews_socio_political_hostility_from_russia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_z_std, color = country)) + geom_line()


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_line_chart ####


# armenia downturn in 2015 is likely related to gyumri massacre and joint air-defense agreement w russia; also maybe eaeu
# https://www.reuters.com/article/us-armenia-russia-defence/armenia-ratifies-agreement-on-joint-air-defense-system-with-russia-idUSKCN0ZG2AS
# https://en.wikipedia.org/wiki/Eurasian_Economic_Union
# https://www.economist.com/europe/2015/03/20/stuck-with-each-other
# armenia in 2016 is likely related four-day NK war with azerbaijan; also trial for gyumri massacre 
# https://en.wikipedia.org/wiki/2016_Nagorno-Karabakh_conflict
# https://en.wikipedia.org/wiki/Armenia%E2%80%93Russia_relations
# armenia remains low in 2018 (2017 is imputed), likely related to velvet revolution
# https://ecfr.eu/publication/russia_armenia_and_europe_after_the_velvet_revolution/
# azerbaijan in 2016 is likely related to four-day NK war with armenia
# https://en.wikipedia.org/wiki/Armenia%E2%80%93Russia_relations
# azerbaijan has a small downturn in 2019, likely related to russian-mediated cease-fire with armenia after day of fighting
# https://www.rferl.org/a/armenia-russia-defense-azerbaijan/31564269.html
# moldova downturn in 2015 likely related to tensions with russia - cut diplomatic ties
# https://en.wikipedia.org/wiki/Moldova%E2%80%93Russia_relations
# moldova in 2016 is likely related to election, w pro-russian dodon winning slightly over sandu
# https://en.wikipedia.org/wiki/2016_Moldovan_presidential_election
# belarus has a drop in 2015, likely related to lukashenko's post-maidan turn to EU/US and fear of russia
# https://www.theguardian.com/world/2015/may/28/belarus-russia-brotherly-love-ukraine-crisis
# belarus had a drop in 2019, likely related to negotiations with putin on deeper integration, which got tense
# https://www.rferl.org/a/belarus-russia-union-state/31446183.html
# georgia has a drop in 2019, likely related to anti-russia protests and tensions increase
# https://www.cnbc.com/2019/07/11/russia-and-georgia-tensions-are-rising-heres-why-and-why-it-matters.html
# moldova had a drop in 2019, likely related to consitutional crisis following sandu election; note russia praised sandu's handling
# https://en.wikipedia.org/wiki/2019_Moldovan_constitutional_crisis
# https://www.euronews.com/2019/06/11/how-did-the-political-crisis-in-moldova-unfold-and-what-happens-next
# note the imputation of 2017 didn't produce an obvious discontinuity - it jumps back up from 2016 drop for azer/armen/moldov,
# but the imputed 2017 value for these countries is similar to imputed 2017, so the imputed 2017 doesn't seem outlandish
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = country)) + geom_line()

# note the only imputations are for 2017 and 2020
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        skim(values_z_std)
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media",
                is.na(values_z_std)) %>% 
        select(country, year, indicator_name, values, values_z_std)

# plot raw values_z_std
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_z_std, color = country)) + geom_line()

# plot alongside sub_obj_2_1_icews_narratives_pushed_by_russian_state_media
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name %in% c("sub_obj_2_1_icews_narratives_pushed_by_russian_state_media",
                                      "sub_obj_1_3_vdem_foreign_gov_dissem_false_info")) %>%
        select(country, year, mcp_grouping, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line() +
        facet_wrap(facets = vars(country))



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_line_chart ####

fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = country)) + geom_line()

# note the only imputations are for 2020
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        skim(values_z_std)
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes",
                is.na(values_z_std)) %>% 
        select(country, year, indicator_name, values, values_z_std)

# plot raw values
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_z_std, color = country)) + geom_line()
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_line_chart ####

fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = country)) + geom_line()

# note the only imputations are for 2020
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        skim(values_z_std)
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports",
                is.na(values_z_std)) %>% 
        select(country, year, indicator_name, values, values_z_std)

# plot raw values
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_z_std, color = country)) + geom_line()
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# eurasia_sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_line_chart ####

fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = country)) + geom_line()

# note there are no missing values
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        skim(values_z_std)
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports",
                is.na(values_z_std)) %>% 
        select(country, year, indicator_name, values, values_z_std)

# plot raw values
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_z_std, color = country)) + geom_line()
fmir %>% filter(mcp_grouping == "E&E Eurasia", 
                indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# moldova trends for RIG SLSB talking points ####


# https://www.usaid.gov/news-information/press-releases/nov-18-2021-administrator-power-trip-moldova

# "As an example, looking at the country profile for Moldova, it shows that the country is most resilient on the 
# information dimension, particularly with regard to media freedom; however, it's least resilient on the energy dimension, 
# particularly with regard to energy security and imports from Russia."

# obj in 2020
fmir %>% filter(country == "Moldova",
                year == 2020) %>%
        distinct(country, year, obj_num, obj_avg) 

# obj trends
fmir %>% filter(country == "Moldova") %>%
        distinct(country, year, obj_num, obj_avg) %>%
        arrange(obj_num, year) %>%
        print(n = nrow(.))
fmir %>% filter(country == "Moldova") %>%
        distinct(country, year, obj_num, obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = obj_avg, color = obj_num)) + geom_line()

# corruption trends
fmir %>% filter(country == "Moldova",
                obj_num == "obj_c", 
                year >= 2015) %>%
        select(country, year, indicator_name, values, values_z_std, indicator_standardized_values, obj_avg) %>%
        arrange(indicator_name, year) %>% 
        print(n = nrow(.))

# democratic trends
fmir %>% filter(country == "Moldova",
                obj_num == "obj_1", 
                year >= 2015) %>%
        select(country, year, indicator_name, values, values_z_std, indicator_standardized_values, obj_avg) %>%
        arrange(indicator_name, year) %>% 
        print(n = nrow(.))


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_serbia_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_serbia_line_chart <- obj_2_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_serbia_line_chart <- obj_2_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_serbia_line_chart <- obj_2_serbia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_serbia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_bih_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_bih_line_chart <- obj_2_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_bih_line_chart <- obj_2_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_bih_line_chart <- obj_2_bih_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_bih_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_georgia_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_georgia_line_chart <- obj_2_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_georgia_line_chart <- obj_2_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_georgia_line_chart <- obj_2_georgia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_georgia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_poland_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_poland_line_chart <- obj_2_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
                # geom_point(size = 2) 
                # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_poland_line_chart <- obj_2_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
                # geom_point(size = 2) 
                # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_poland_line_chart <- obj_2_poland_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_poland_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_poland_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_hungary_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_hungary_line_chart <- obj_2_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_hungary_line_chart <- obj_2_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_hungary_line_chart <- obj_2_hungary_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_hungary_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_azerbaijan_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_2", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_2", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media capacity"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media demand"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Media freedom"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_azerbaijan_line_chart <- obj_2_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_azerbaijan_line_chart <- obj_2_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_azerbaijan_line_chart <- obj_2_azerbaijan_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_azerbaijan_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_azerbaijan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_serbia_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_serbia_line_chart <- obj_c_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_serbia_line_chart <- obj_c_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_serbia_line_chart <- obj_c_serbia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_serbia_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_bih_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "BiH") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_bih_line_chart <- obj_c_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_bih_line_chart <- obj_c_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_bih_line_chart <- obj_c_bih_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_bih_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_georgia_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_georgia_line_chart <- obj_c_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_georgia_line_chart <- obj_c_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_georgia_line_chart <- obj_c_georgia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_georgia_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_poland_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Poland") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_poland_line_chart <- obj_c_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_poland_line_chart <- obj_c_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_poland_line_chart <- obj_c_poland_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_poland_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_poland_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_hungary_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_hungary_line_chart <- obj_c_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_hungary_line_chart <- obj_c_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_hungary_line_chart <- obj_c_hungary_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_hungary_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_azerbaijan_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_azerbaijan_line_chart <- obj_c_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_azerbaijan_line_chart <- obj_c_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_azerbaijan_line_chart <- obj_c_azerbaijan_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_azerbaijan_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_azerbaijan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_albania_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_c", country == "Albania") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_c", country == "Albania") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "cross_cutting_obj_wgi_control_of_corruption" ~ "WGI: Corruption",
                                     indicator_name == "cross_cutting_obj_fh_corruption" ~ "FH: Corruption",
                                     indicator_name == "cross_cutting_obj_ti_cpi" ~ "TI: Corruption",
                                     indicator_name == "cross_cutting_obj_state_money_laundering" ~ "State: Money\nlaundering"),
               color = case_when(color_bin == "WGI: Corruption" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "FH: Corruption" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "TI: Corruption" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "State: Money\nlaundering" ~ color_palette %>% slice(4) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_c_albania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "WGI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "FH: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "TI: Corruption"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "State: Money\nlaundering"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_c_albania_line_chart <- obj_c_albania_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_c_albania_line_chart <- obj_c_albania_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_c_albania_line_chart <- obj_c_albania_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_c_albania_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_albania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_albania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_azerbaijan_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_1", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_1", country == "Azerbaijan") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                     sub_obj_short_name == "Resilience to electoral/political interference and polarization" ~ "Political interfer.",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Political interfer." ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_1_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Rule of law"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Civil society"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Political interfer."),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_1_azerbaijan_line_chart <- obj_1_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_1_azerbaijan_line_chart <- obj_1_azerbaijan_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_1_azerbaijan_line_chart <- obj_1_azerbaijan_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_azerbaijan_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_azerbaijan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_1_belarus_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_1", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_1", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                     sub_obj_short_name == "Resilience to electoral/political interference and polarization" ~ "Political interfer.",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Political interfer." ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_1_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Rule of law"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Civil society"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Political interfer."),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_1_belarus_line_chart <- obj_1_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_1_belarus_line_chart <- obj_1_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_1_belarus_line_chart <- obj_1_belarus_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_1_belarus_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_1_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_1_belarus_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_3_belarus_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_3", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_3", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Independence from Russian energy" ~ "Russian imports",
                                     sub_obj_short_name == "Energy regulation" ~ "Energy reg.",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Energy security" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Russian imports" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy reg." ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_3_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy security"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Russian imports"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Energy reg."),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_3_belarus_line_chart <- obj_3_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_3_belarus_line_chart <- obj_3_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_3_belarus_line_chart <- obj_3_belarus_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_3_belarus_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_3_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_3_belarus_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_4_belarus_line_chart ####

# plot
fmir %>% filter(obj_num == "obj_4", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = sub_obj_short_name)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(obj_num == "obj_4", country == "Belarus") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = case_when(sub_obj_short_name == "Economic competitiveness" ~ "Econ. compet.",
                                     TRUE ~ sub_obj_short_name),
               color = case_when(color_bin == "Econ. compet." ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Financial health" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_4_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Econ. compet."),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Financial health"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_4_belarus_line_chart <- obj_4_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_4_belarus_line_chart <- obj_4_belarus_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_4_belarus_line_chart <- obj_4_belarus_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_4_belarus_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_4_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_4_belarus_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_distribution_density_chart ####

# plot indicator values distribution
fmir %>% 
        # filter(indicator_name == "sub_obj_4_2_wb_ext_debt_to_russia_as_share_of_total_ext_debt") %>%
        # filter(indicator_name == "sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports") %>%
        # filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        # filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        filter(indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        select(indicator_name, indicator_mean, indicator_sd, indicator_midpoint, indicator_median, indicator_iqr, values, values_z_std) %>%
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_mean),
                     xend = chart_data %>% slice(1) %>% pull(indicator_mean),
                     y = 0, yend = 20, color = "green") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_median),
                     xend = chart_data %>% slice(1) %>% pull(indicator_median),
                     y = 0, yend = 20, color = "blue") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     xend = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     y = 0, yend = 20, color = "red") +
        # ggplot(data = ., mapping = aes(y = values, x = indicator_name)) + geom_sina() + coord_flip()
        
        scale_x_continuous(labels = label_percent(accuracy = .01)) +
        labs(x = "Natrual gas imports from Russia as share of natural gas imports") +
        coord_fixed(ratio = 1 / 2, clip = "off") 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        select(country, year, indicator_name, indicator_mean, indicator_sd, indicator_midpoint, 
               indicator_median, indicator_iqr, values, values_z_std,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values) %>%
        mutate(abs_dist_from_midpoint = abs(values - indicator_midpoint))

# inspect
chart_data
chart_data %>% arrange(abs_dist_from_midpoint) %>% 
        select(country, year, values, indicator_mean, indicator_median, indicator_midpoint, abs_dist_from_midpoint,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values)


#////////////////////


# get segment_tbl
segment_tbl <- tibble(segment_name = c("Mean", "Median", "Midpoint"),
                      x = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                            chart_data %>% slice(1) %>% pull(indicator_median),
                            chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      xend = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                            chart_data %>% slice(1) %>% pull(indicator_median),
                            chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      y = 0,
                      yend = 1.5,
                      color_bin = segment_name,
                      color = case_when(segment_name == "Mean" ~ color_palette %>% slice(1) %>% pull(hex),
                                segment_name == "Median" ~ color_palette %>% slice(7) %>% pull(hex),
                                segment_name == "Midpoint" ~ color_palette %>% slice(12) %>% pull(hex)),
                      linetype_bin = color_bin,
                      linetype = case_when(segment_name == "Mean" ~ 1,
                                           segment_name == "Median" ~ 1,
                                           segment_name == "Midpoint" ~ 1),
                      size_bin = color_bin,
                      size = case_when(segment_name == "Mean" ~ 1,
                                       segment_name == "Median" ~ 1,
                                       segment_name == "Midpoint" ~ 1),
                      segment_order = case_when(segment_name == "Mean" ~ 1,
                                                segment_name == "Median" ~ 3,
                                                segment_name == "Midpoint" ~ 2)) %>%
        arrange(segment_order)

# inspect
segment_tbl


#////////////////////


# create color_list for to pass to scale_color_manual
segment_tbl_color_list <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color)
names(segment_tbl_color_list) <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color_bin)
segment_tbl_color_list


#////////////////////


# create linetype_list for to pass to scale_linetype_manual
segment_tbl_linetype_list <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                           linetype_bin == "Median" ~ 3,
                                           linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype)
names(segment_tbl_linetype_list) <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                              linetype_bin == "Median" ~ 3,
                                              linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype_bin)
segment_tbl_linetype_list


#////////////////////


# create size_list for to pass to scale_size
segment_tbl_size_list <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                           size_bin == "Median" ~ 3,
                                           size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size)
names(segment_tbl_size_list) <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                           size_bin == "Median" ~ 3,
                                           size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size_bin)
segment_tbl_size_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_distribution_density_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        
        
        geom_segment(data = segment_tbl %>% filter(segment_name == "Mean"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Median"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Midpoint"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        
        scale_y_continuous(expand = c(0, 0)) +
        scale_x_continuous(labels = label_percent(accuracy = 1), expand = c(0, 0)) +
        scale_color_manual(name = "", values = segment_tbl_color_list) +
        scale_linetype_manual(name = "", values = segment_tbl_linetype_list, guide = "none") +
        scale_size_manual(name = "", values = segment_tbl_size_list) +
        labs(x = "Natural gas imports from Russia\nas a share of natural gas imports",
             y = "Density", color = "") +
        coord_fixed(ratio = 1 / 2.5, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(size = .5, color = "#333333"),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.line.y.left = element_line(color = "#333333"),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_distribution_density_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_distribution_density_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports_distribution_density_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_distribution_density_chart ####

# plot indicator values distribution
fmir %>% 
        # filter(indicator_name == "sub_obj_4_2_wb_ext_debt_to_russia_as_share_of_total_ext_debt") %>%
        # filter(indicator_name == "sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports") %>%
        # filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        # filter(indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        select(indicator_name, indicator_mean, indicator_sd, indicator_midpoint, indicator_median, indicator_iqr, values, values_z_std) %>%
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_mean),
                     xend = chart_data %>% slice(1) %>% pull(indicator_mean),
                     y = 0, yend = 2.5, color = "green") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_median),
                     xend = chart_data %>% slice(1) %>% pull(indicator_median),
                     y = 0, yend = 2.5, color = "blue") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     xend = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     y = 0, yend = 2.5, color = "red") +
        # ggplot(data = ., mapping = aes(y = values, x = indicator_name)) + geom_sina() + coord_flip()
        
        scale_x_continuous(labels = label_percent(accuracy = .01)) +
        labs(x = "Natrual gas imports from Russia as share of natural gas imports") +
        coord_fixed(ratio = 1 / 2, clip = "off") 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        select(country, year, indicator_name, indicator_mean, indicator_sd, indicator_midpoint, 
               indicator_median, indicator_iqr, values, values_z_std,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values) %>%
        mutate(abs_dist_from_midpoint = abs(values - indicator_midpoint),
               abs_dist_from_mean = abs(values - indicator_mean))

# inspect
chart_data
chart_data %>% 
        arrange(abs_dist_from_midpoint) %>%
        # arrange(abs_dist_from_mean) %>%
        select(country, year, values, indicator_mean, indicator_median, indicator_midpoint, 
               abs_dist_from_midpoint, abs_dist_from_mean,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values)


#////////////////////


# get segment_tbl
segment_tbl <- tibble(segment_name = c("Mean", "Median", "Midpoint"),
                      x = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                            chart_data %>% slice(1) %>% pull(indicator_median),
                            chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      xend = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                               chart_data %>% slice(1) %>% pull(indicator_median),
                               chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      y = 0,
                      yend = 2.5,
                      color_bin = segment_name,
                      color = case_when(segment_name == "Mean" ~ color_palette %>% slice(1) %>% pull(hex),
                                        segment_name == "Median" ~ color_palette %>% slice(7) %>% pull(hex),
                                        segment_name == "Midpoint" ~ color_palette %>% slice(12) %>% pull(hex)),
                      linetype_bin = color_bin,
                      linetype = case_when(segment_name == "Mean" ~ 1,
                                           segment_name == "Median" ~ 1,
                                           segment_name == "Midpoint" ~ 1),
                      size_bin = color_bin,
                      size = case_when(segment_name == "Mean" ~ 1,
                                       segment_name == "Median" ~ 1,
                                       segment_name == "Midpoint" ~ 1))

# inspect
segment_tbl


#////////////////////


# create color_list for to pass to scale_color_manual
segment_tbl_color_list <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color)
names(segment_tbl_color_list) <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color_bin)
segment_tbl_color_list


#////////////////////


# create linetype_list for to pass to scale_linetype_manual
segment_tbl_linetype_list <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                              linetype_bin == "Median" ~ 3,
                                              linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype)
names(segment_tbl_linetype_list) <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                              linetype_bin == "Median" ~ 3,
                                              linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype_bin)
segment_tbl_linetype_list


#////////////////////


# create size_list for to pass to scale_size
segment_tbl_size_list <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                          size_bin == "Median" ~ 3,
                                          size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size)
names(segment_tbl_size_list) <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                          size_bin == "Median" ~ 3,
                                          size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size_bin)
segment_tbl_size_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_distribution_density_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        
        
        geom_segment(data = segment_tbl %>% filter(segment_name == "Mean"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Median"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Midpoint"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        
        scale_y_continuous(expand = c(0, 0)) +
        scale_x_continuous(labels = label_percent(accuracy = 1), expand = c(0, 0)) +
        scale_color_manual(name = "", values = segment_tbl_color_list) +
        scale_linetype_manual(name = "", values = segment_tbl_linetype_list, guide = "none") +
        scale_size_manual(name = "", values = segment_tbl_size_list) +
        labs(x = "Fossil fuel imports from Russia as a share of primary energy supply",
             y = "Density", color = "") +
        coord_fixed(ratio = 1 / 2.5, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(size = .5, color = "#333333"),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.line.y.left = element_line(color = "#333333"),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_distribution_density_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_distribution_density_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_distribution_density_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_c_wgi_rule_of_law_distribution_density_chart ####

# plot indicator values distribution
fmir %>% 
        # filter(indicator_name == "sub_obj_4_2_wb_ext_debt_to_russia_as_share_of_total_ext_debt") %>%
        # filter(indicator_name == "sub_obj_4_1_dots_exports_to_russia_as_share_of_total_exports") %>%
        # filter(indicator_name == "sub_obj_4_1_cdis_russian_fdi_as_share_of_total_fdi") %>%
        filter(indicator_name == "sub_obj_c_wgi_rule_of_law") %>%
        # filter(indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports") %>%
        select(indicator_name, indicator_mean, indicator_sd, indicator_midpoint, indicator_median, indicator_iqr, values, values_z_std) %>%
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_mean),
                     xend = chart_data %>% slice(1) %>% pull(indicator_mean),
                     y = 0, yend = 2.5, color = "green") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_median),
                     xend = chart_data %>% slice(1) %>% pull(indicator_median),
                     y = 0, yend = 2.5, color = "blue") +
        geom_segment(x = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     xend = chart_data %>% slice(1) %>% pull(indicator_midpoint),
                     y = 0, yend = 2.5, color = "red") +
        # ggplot(data = ., mapping = aes(y = values, x = indicator_name)) + geom_sina() + coord_flip()
        
        # scale_x_continuous(labels = label_percent(accuracy = .01)) +
        labs(x = "WGI: Rule of law")
        # coord_fixed(ratio = 1 / 2, clip = "off") 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% 
        filter(indicator_name == "sub_obj_c_wgi_rule_of_law") %>%
        select(country, year, indicator_name, indicator_mean, indicator_sd, indicator_midpoint, 
               indicator_median, indicator_iqr, values, values_z_std,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values) %>%
        mutate(abs_dist_from_midpoint = abs(values - indicator_midpoint),
               abs_dist_from_mean = abs(values - indicator_mean))

# inspect
chart_data
chart_data %>% 
        arrange(abs_dist_from_midpoint) %>%
        # arrange(abs_dist_from_mean) %>%
        select(country, year, values, indicator_mean, indicator_median, indicator_midpoint, 
               abs_dist_from_midpoint, abs_dist_from_mean,
               indicator_standardized_values, indicator_rob_standardized_values, indicator_normalized_values)


#////////////////////


# get segment_tbl
segment_tbl <- tibble(segment_name = c("Mean", "Median", "Midpoint"),
                      x = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                            chart_data %>% slice(1) %>% pull(indicator_median),
                            chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      xend = c(chart_data %>% slice(1) %>% pull(indicator_mean),
                               chart_data %>% slice(1) %>% pull(indicator_median),
                               chart_data %>% slice(1) %>% pull(indicator_midpoint)),
                      y = 0,
                      yend = .35,
                      color_bin = segment_name,
                      color = case_when(segment_name == "Mean" ~ color_palette %>% slice(1) %>% pull(hex),
                                        segment_name == "Median" ~ color_palette %>% slice(7) %>% pull(hex),
                                        segment_name == "Midpoint" ~ color_palette %>% slice(12) %>% pull(hex)),
                      linetype_bin = color_bin,
                      linetype = case_when(segment_name == "Mean" ~ 1,
                                           segment_name == "Median" ~ 1,
                                           segment_name == "Midpoint" ~ 1),
                      size_bin = color_bin,
                      size = case_when(segment_name == "Mean" ~ 1,
                                       segment_name == "Median" ~ 1,
                                       segment_name == "Midpoint" ~ 1))

# inspect
segment_tbl


#////////////////////


# create color_list for to pass to scale_color_manual
segment_tbl_color_list <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color)
names(segment_tbl_color_list) <- segment_tbl %>% count(color_bin, color) %>% 
        mutate(color_bin_order = case_when(color_bin == "Mean" ~ 1,
                                           color_bin == "Median" ~ 3,
                                           color_bin == "Midpoint" ~ 2)) %>%
        arrange(color_bin_order) %>%
        pull(color_bin)
segment_tbl_color_list


#////////////////////


# create linetype_list for to pass to scale_linetype_manual
segment_tbl_linetype_list <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                              linetype_bin == "Median" ~ 3,
                                              linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype)
names(segment_tbl_linetype_list) <- segment_tbl %>% count(linetype_bin, linetype) %>% 
        mutate(linetype_bin_order = case_when(linetype_bin == "Mean" ~ 1,
                                              linetype_bin == "Median" ~ 3,
                                              linetype_bin == "Midpoint" ~ 2)) %>%
        arrange(linetype_bin_order) %>%
        pull(linetype_bin)
segment_tbl_linetype_list


#////////////////////


# create size_list for to pass to scale_size
segment_tbl_size_list <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                          size_bin == "Median" ~ 3,
                                          size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size)
names(segment_tbl_size_list) <- segment_tbl %>% count(size_bin, size) %>% 
        mutate(size_bin_order = case_when(size_bin == "Mean" ~ 1,
                                          size_bin == "Median" ~ 3,
                                          size_bin == "Midpoint" ~ 2)) %>%
        arrange(size_bin_order) %>%
        pull(size_bin)
segment_tbl_size_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_c_wgi_rule_of_law_distribution_density_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = values)) + geom_density() +
        
        
        geom_segment(data = segment_tbl %>% filter(segment_name == "Mean"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Median"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        geom_segment(data = segment_tbl %>% filter(segment_name == "Midpoint"), 
                     mapping = aes(x = x, xend = xend, y = y, yend = yend, color = color_bin, linetype = linetype_bin, size = size_bin)) +
        
        scale_y_continuous(expand = c(0, 0)) +
        scale_x_continuous(labels = label_number(accuracy = 1), expand = c(0, 0)) +
        scale_color_manual(name = "", values = segment_tbl_color_list) +
        scale_linetype_manual(name = "", values = segment_tbl_linetype_list, guide = "none") +
        scale_size_manual(name = "", values = segment_tbl_size_list) +
        labs(x = "WGI: Rule of law",
             y = "Density", color = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                axis.ticks.y = element_line(size = .5, color = "#333333"),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.line.y.left = element_line(color = "#333333"),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_c_wgi_rule_of_law_distribution_density_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_c_wgi_rule_of_law_distribution_density_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_c_wgi_rule_of_law_distribution_density_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_serbia_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line() 
        # theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_concept <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Narratives pushed by Russian state media" ~ "Russian media",
                                     concept == "Trusted media" ~ "Media professionalism",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Trusted information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Russian media" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism" ~ 1,
                                           color_bin == "Trusted information" ~ 2,
                                           color_bin == "Russian media" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))
        

# get label_position when y-axis has .1 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_concept_color_list <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_concept_color_list) <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_concept_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_concept_linetype_list <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_concept_linetype_list) <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_concept_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_serbia_patch_chart <- chart_data_concept %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Media professionalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Trusted information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_concept_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_concept_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_concept %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_concept_serbia_patch_chart <- sub_obj_2_1_concept_serbia_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_concept_serbia_patch_chart <- sub_obj_2_1_concept_serbia_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_concept_serbia_patch_chart <- sub_obj_2_1_concept_serbia_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_concept_serbia_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_serbia_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y =indicator_standardized_values, color = indicator_name)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_indicator <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_indicator_color_list <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_indicator_color_list) <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_indicator_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_indicator_linetype_list <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_indicator_linetype_list) <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_indicator_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_indicator_serbia_patch_chart <- chart_data_indicator %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "MSI: Professional journalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "AidData: Content producers"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media critical"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media bias"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media corrupt"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Parties dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. advertising"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "ICEWS: Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_indicator_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_indicator_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_indicator %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_indicator_serbia_patch_chart <- sub_obj_2_1_indicator_serbia_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_indicator_serbia_patch_chart <- sub_obj_2_1_indicator_serbia_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_indicator_serbia_patch_chart <- sub_obj_2_1_indicator_serbia_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 40, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_indicator_serbia_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_2_1_concept_indicator_serbia_patch ####

sub_obj_2_1_concept_indicator_serbia_patch_chart <- (sub_obj_2_1_concept_serbia_patch_chart / sub_obj_2_1_indicator_serbia_patch_chart)
sub_obj_2_1_concept_indicator_serbia_patch_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 105%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_indicator_serbia_patch_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_indicator_serbia_patch_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_bih_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_concept <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Narratives pushed by Russian state media" ~ "Russian media",
                                     concept == "Trusted media" ~ "Media professionalism",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Trusted information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Russian media" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism" ~ 1,
                                           color_bin == "Trusted information" ~ 2,
                                           color_bin == "Russian media" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_concept_color_list <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_concept_color_list) <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_concept_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_concept_linetype_list <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_concept_linetype_list) <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_concept_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_bih_patch_chart <- chart_data_concept %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Media professionalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Trusted information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_concept_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_concept_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_concept %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_concept_bih_patch_chart <- sub_obj_2_1_concept_bih_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_concept_bih_patch_chart <- sub_obj_2_1_concept_bih_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_concept_bih_patch_chart <- sub_obj_2_1_concept_bih_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_concept_bih_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_bih_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y =indicator_standardized_values, color = indicator_name)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_indicator <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_indicator_color_list <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_indicator_color_list) <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_indicator_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_indicator_linetype_list <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_indicator_linetype_list) <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_indicator_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_indicator_bih_patch_chart <- chart_data_indicator %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "MSI: Professional journalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "AidData: Content producers"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media critical"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media bias"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media corrupt"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Parties dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. advertising"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "ICEWS: Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_indicator_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_indicator_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_indicator %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_indicator_bih_patch_chart <- sub_obj_2_1_indicator_bih_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_indicator_bih_patch_chart <- sub_obj_2_1_indicator_bih_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_indicator_bih_patch_chart <- sub_obj_2_1_indicator_bih_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 40, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_indicator_bih_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_2_1_concept_indicator_bih_patch_chart ####

sub_obj_2_1_concept_indicator_bih_patch_chart <- (sub_obj_2_1_concept_bih_patch_chart / sub_obj_2_1_indicator_bih_patch_chart)
sub_obj_2_1_concept_indicator_bih_patch_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 110%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_indicator_bih_patch_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_indicator_bih_patch_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_georgia_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_concept <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Narratives pushed by Russian state media" ~ "Russian media",
                                     concept == "Trusted media" ~ "Media professionalism",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Trusted information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Russian media" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism" ~ 1,
                                           color_bin == "Trusted information" ~ 2,
                                           color_bin == "Russian media" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_concept_color_list <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_concept_color_list) <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_concept_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_concept_linetype_list <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_concept_linetype_list) <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_concept_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_georgia_patch_chart <- chart_data_concept %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Media professionalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Trusted information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_concept_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_concept_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_concept %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_concept_georgia_patch_chart <- sub_obj_2_1_concept_georgia_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_concept_georgia_patch_chart <- sub_obj_2_1_concept_georgia_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_concept_georgia_patch_chart <- sub_obj_2_1_concept_georgia_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_concept_georgia_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_georgia_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y =indicator_standardized_values, color = indicator_name)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_indicator <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_indicator_color_list <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_indicator_color_list) <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_indicator_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_indicator_linetype_list <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_indicator_linetype_list) <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_indicator_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_indicator_georgia_patch_chart <- chart_data_indicator %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "MSI: Professional journalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "AidData: Content producers"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media critical"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media bias"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media corrupt"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Parties dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. advertising"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "ICEWS: Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_indicator_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_indicator_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_indicator %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_indicator_georgia_patch_chart <- sub_obj_2_1_indicator_georgia_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_indicator_georgia_patch_chart <- sub_obj_2_1_indicator_georgia_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_indicator_georgia_patch_chart <- sub_obj_2_1_indicator_georgia_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 40, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_indicator_georgia_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_2_1_concept_indicator_georgia_patch_chart ####

sub_obj_2_1_concept_indicator_georgia_patch_chart <- (sub_obj_2_1_concept_georgia_patch_chart / sub_obj_2_1_indicator_georgia_patch_chart)
sub_obj_2_1_concept_indicator_georgia_patch_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 110%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_indicator_georgia_patch_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_indicator_georgia_patch_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_poland_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_concept <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Narratives pushed by Russian state media" ~ "Russian media",
                                     concept == "Trusted media" ~ "Media professionalism",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Trusted information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Russian media" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism" ~ 1,
                                           color_bin == "Trusted information" ~ 2,
                                           color_bin == "Russian media" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_concept_color_list <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_concept_color_list) <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_concept_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_concept_linetype_list <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_concept_linetype_list) <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_concept_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_poland_patch_chart <- chart_data_concept %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Media professionalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Trusted information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_concept_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_concept_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_concept %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_concept_poland_patch_chart <- sub_obj_2_1_concept_poland_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_concept_poland_patch_chart <- sub_obj_2_1_concept_poland_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_concept_poland_patch_chart <- sub_obj_2_1_concept_poland_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_concept_poland_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_poland_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        filter(country == "Poland") %>%
        # filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y =indicator_standardized_values, color = indicator_name)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_indicator <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_indicator_color_list <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_indicator_color_list) <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_indicator_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_indicator_linetype_list <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_indicator_linetype_list) <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_indicator_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_indicator_poland_patch_chart <- chart_data_indicator %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "MSI: Professional journalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "AidData: Content producers"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media critical"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media bias"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media corrupt"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Parties dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. advertising"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "ICEWS: Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_indicator_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_indicator_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_indicator %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_indicator_poland_patch_chart <- sub_obj_2_1_indicator_poland_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_indicator_poland_patch_chart <- sub_obj_2_1_indicator_poland_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_indicator_poland_patch_chart <- sub_obj_2_1_indicator_poland_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 40, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_indicator_poland_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_2_1_concept_indicator_poland_patch_chart ####

sub_obj_2_1_concept_indicator_poland_patch_chart <- (sub_obj_2_1_concept_poland_patch_chart / sub_obj_2_1_indicator_poland_patch_chart)
sub_obj_2_1_concept_indicator_poland_patch_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 110%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_indicator_poland_patch_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_indicator_poland_patch_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_hungary_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_concept <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Narratives pushed by Russian state media" ~ "Russian media",
                                     concept == "Trusted media" ~ "Media professionalism",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Trusted information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Russian media" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism" ~ 1,
                                           color_bin == "Trusted information" ~ 2,
                                           color_bin == "Russian media" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_concept %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .03)
        }
        
        if((chart_data_concept %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_concept <- chart_data_concept %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_concept_color_list <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_concept_color_list) <- chart_data_concept %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_concept_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_concept_linetype_list <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_concept_linetype_list) <- chart_data_concept %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_concept_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_hungary_patch_chart <- chart_data_concept %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Media professionalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Trusted information"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_concept %>% filter(year == max(year), color_bin == "Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_concept_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_concept_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_concept %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_concept %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_concept_hungary_patch_chart <- sub_obj_2_1_concept_hungary_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_concept %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_concept_hungary_patch_chart <- sub_obj_2_1_concept_hungary_patch_chart +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_concept,
                #              mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_concept,
                             mapping = aes(x = chart_data_concept %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_concept %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_concept %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_concept_hungary_patch_chart <- sub_obj_2_1_concept_hungary_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 10, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_concept_hungary_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_indicator_hungary_patch_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(country == "Serbia") %>%
        # filter(country == "Georgia") %>%
        # filter(country == "BiH") %>%
        # filter(country == "Poland") %>%
        filter(country == "Hungary") %>%
        
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y =indicator_standardized_values, color = indicator_name)) + geom_line() 
# theme(legend.position = "none")


#//////////////////


# get chart_data
chart_data_indicator <- fmir %>% filter(sub_obj_num == "sub_obj_2_1", country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20))


# get label_position when y-axis has .1 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data_indicator %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .04)
        }
        
        if(((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .03)
        }
        
        if((chart_data_indicator %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data_indicator <- chart_data_indicator %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_indicator_color_list <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_indicator_color_list) <- chart_data_indicator %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_indicator_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_indicator_linetype_list <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_indicator_linetype_list) <- chart_data_indicator %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_indicator_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_indicator_hungary_patch_chart <- chart_data_indicator %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "MSI: Professional journalism"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "AidData: Content producers"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media critical"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media bias"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Media corrupt"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "VDem: Parties dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. dissem. false info"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "Foreign gov. advertising"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_text(data = chart_data_indicator %>% filter(year == max(year), color_bin == "ICEWS: Russian media"),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        scale_color_manual(values = chart_data_indicator_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_indicator_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data_indicator %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data_indicator %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        sub_obj_2_1_indicator_hungary_patch_chart <- sub_obj_2_1_indicator_hungary_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data_indicator %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        sub_obj_2_1_indicator_hungary_patch_chart <- sub_obj_2_1_indicator_hungary_patch_chart +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data_indicator,
                #              mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data_indicator,
                             mapping = aes(x = chart_data_indicator %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data_indicator %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data_indicator %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
sub_obj_2_1_indicator_hungary_patch_chart <- sub_obj_2_1_indicator_hungary_patch_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 40, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
sub_obj_2_1_indicator_hungary_patch_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_2_1_concept_indicator_hungary_patch_chart ####

sub_obj_2_1_concept_indicator_hungary_patch_chart <- (sub_obj_2_1_concept_hungary_patch_chart / sub_obj_2_1_indicator_hungary_patch_chart)
sub_obj_2_1_concept_indicator_hungary_patch_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 110%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_indicator_hungary_patch_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_indicator_hungary_patch_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_ee_patch_bar_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        arrange(country, indicator_name, year) %>%
        mutate(non_na_year = case_when(!is.na(values) ~ year,
                                       TRUE ~ NA_integer_)) %>%
        group_by(country, indicator_name) %>%
        mutate(most_recent_non_na_year_flag = case_when(non_na_year == max(non_na_year, na.rm = TRUE) ~ 1,
                                            TRUE ~ 0),
               most_recent_values = case_when(most_recent_non_na_year_flag == 1 ~ values,
                                             TRUE ~ NA_real_)) %>%
        ungroup() %>%
        fill(most_recent_values, .direction = "updown") %>%
        filter(year == 2013) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = most_recent_values - values) %>%
        ungroup() %>%
        # mutate(chart_row = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ "E&E Balkans and E&E Eurasia",
        #                              mcp_grouping %in% c("E&E graduates", "CARs") ~ "E&E graduates and CARs")) %>%
        ggplot(data = ., mapping = aes(x = country, y = diff, fill = indicator_name)) +
        geom_col(position = "dodge", width = .75) + 
        # facet_wrap(facets = vars(chart_row), ncol = 1, nrow = 2, scales = "free") +
        theme(legend.position = "bottom")


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data_ee
chart_data_ee <- fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        arrange(country, indicator_name, year) %>%
        mutate(non_na_year = case_when(!is.na(values) ~ year,
                                       TRUE ~ NA_integer_)) %>%
        group_by(country, indicator_name) %>%
        mutate(most_recent_non_na_year_flag = case_when(non_na_year == max(non_na_year, na.rm = TRUE) ~ 1,
                                                        TRUE ~ 0),
               most_recent_values = case_when(most_recent_non_na_year_flag == 1 ~ values,
                                              TRUE ~ NA_real_)) %>%
        ungroup() %>%
        fill(most_recent_values, .direction = "updown") %>%
        filter(year == 2013) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = most_recent_values - values) %>%
        ungroup() %>%
        select(-values) %>%
        rename(values = diff) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~
                                             "Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                     indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~
                                             "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                     indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                             "Natural gas imports\nfrom Russia\nas % of natural gas imports"),
               color = case_when(color_bin == "Fossil fuel imports\nfrom Russia\nas % of primary energy supply" ~
                                         color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Fossil fuel imports\nfrom Russia\nas % of total imports" ~
                                         color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Natural gas imports\nfrom Russia\nas % of natural gas imports" ~
                                         color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Fossil fuel imports\nfrom Russia\nas % of primary energy supply" ~ 1,
                                 color_bin == "Fossil fuel imports\nfrom Russia\nas % of total imports" ~ 2,
                                 color_bin == "Natural gas imports\nfrom Russia\nas % of natural gas imports" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               labels = values * 100)

# inspect
chart_data_ee


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_ee_color_list <- chart_data_ee %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_ee_color_list) <- chart_data_ee %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_ee_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_ee_linetype_list <- chart_data_ee %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_ee_linetype_list) <- chart_data_ee%>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_ee_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_ee_patch_bar_chart <- chart_data_ee %>%
        ggplot(data = ., aes(x = country, 
                             y = values, 
                             fill = factor(color_bin, levels = c("Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                                                  "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                                                  "Natural gas imports\nfrom Russia\nas % of natural gas imports")),
                             linetype = factor(color_bin, levels = c("Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                                                     "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                                                     "Natural gas imports\nfrom Russia\nas % of natural gas imports")))) +
        geom_col(position = "dodge", width = .75) + 
        # geom_text(data = chart_data_ee %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_ee_color_list) +
        scale_fill_manual(values = chart_data_ee_color_list) +
        scale_linetype_manual(values = chart_data_ee_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -1, to = .4, by = .2), limits = c(-1, .41), expand = c(0, 0),
                           labels = function(breaks) { round(breaks * 100) }) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = -.2, yend = -.2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = -.4, yend = -.4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = -.6, yend = -.6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = -.8, yend = -.8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data_ee,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
        #                            y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_ee,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_ee %>% count(country) %>% nrow()) + .25,
                                   y = -1, yend = -1), color = "#333333", size = .5) +
        geom_col(position = "dodge", width = .75) + 
        labs(x = NULL, y = "Percentage point change\n(decrease is improvement)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        # coord_fixed(ratio = 5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_3_2_ee_patch_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_graduates_cars_patch_bar_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        arrange(country, indicator_name, year) %>%
        mutate(non_na_year = case_when(!is.na(values) ~ year,
                                       TRUE ~ NA_integer_)) %>%
        group_by(country, indicator_name) %>%
        mutate(most_recent_non_na_year_flag = case_when(non_na_year == max(non_na_year, na.rm = TRUE) ~ 1,
                                                        TRUE ~ 0),
               most_recent_values = case_when(most_recent_non_na_year_flag == 1 ~ values,
                                              TRUE ~ NA_real_)) %>%
        ungroup() %>%
        fill(most_recent_values, .direction = "updown") %>%
        filter(year == 2013) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = most_recent_values - values) %>%
        ungroup() %>%
        # mutate(chart_row = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia") ~ "E&E Balkans and E&E Eurasia",
        #                              mcp_grouping %in% c("E&E graduates", "CARs") ~ "E&E graduates and CARs")) %>%
        ggplot(data = ., mapping = aes(x = country, y = diff, fill = indicator_name)) +
        geom_col(position = "dodge", width = .75) + 
        # facet_wrap(facets = vars(chart_row), ncol = 1, nrow = 2, scales = "free") +
        theme(legend.position = "bottom")


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data_graduates_cars
chart_data_graduates_cars <- fmir %>% filter(sub_obj_num == "sub_obj_3_2") %>%
        filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        arrange(country, indicator_name, year) %>%
        mutate(non_na_year = case_when(!is.na(values) ~ year,
                                       TRUE ~ NA_integer_)) %>%
        group_by(country, indicator_name) %>%
        mutate(most_recent_non_na_year_flag = case_when(non_na_year == max(non_na_year, na.rm = TRUE) ~ 1,
                                                        TRUE ~ 0),
               most_recent_values = case_when(most_recent_non_na_year_flag == 1 ~ values,
                                              TRUE ~ NA_real_)) %>%
        ungroup() %>%
        fill(most_recent_values, .direction = "updown") %>%
        filter(year == 2013) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = most_recent_values - values) %>%
        ungroup() %>%
        select(-values) %>%
        rename(values = diff) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~
                                             "Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                     indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~
                                             "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                     indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                             "Natural gas imports\nfrom Russia\nas % of natural gas imports"),
               color = case_when(color_bin == "Fossil fuel imports\nfrom Russia\nas % of primary energy supply" ~
                                         color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Fossil fuel imports\nfrom Russia\nas % of total imports" ~
                                         color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Natural gas imports\nfrom Russia\nas % of natural gas imports" ~
                                         color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Fossil fuel imports\nfrom Russia\nas % of primary energy supply" ~ 1,
                                           color_bin == "Fossil fuel imports\nfrom Russia\nas % of total imports" ~ 2,
                                           color_bin == "Natural gas imports\nfrom Russia\nas % of natural gas imports" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data_graduates_cars


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_graduates_cars_color_list <- chart_data_graduates_cars %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_graduates_cars_color_list) <- chart_data_graduates_cars %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_graduates_cars_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_graduates_cars_linetype_list <- chart_data_graduates_cars %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_graduates_cars_linetype_list) <- chart_data_graduates_cars%>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_graduates_cars_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_graduates_cars_patch_bar_chart <- chart_data_graduates_cars %>%
        ggplot(data = ., aes(x = country, 
                             y = values, 
                             fill = factor(color_bin, levels = c("Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                                                 "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                                                 "Natural gas imports\nfrom Russia\nas % of natural gas imports")),
                             linetype = factor(color_bin, levels = c("Fossil fuel imports\nfrom Russia\nas % of primary energy supply",
                                                                     "Fossil fuel imports\nfrom Russia\nas % of total imports",
                                                                     "Natural gas imports\nfrom Russia\nas % of natural gas imports")))) +
        geom_col(position = "dodge", width = .75) + 
        # geom_text(data = chart_data_graduates_cars %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_graduates_cars_color_list) +
        scale_fill_manual(values = chart_data_graduates_cars_color_list) +
        scale_linetype_manual(values = chart_data_graduates_cars_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.6, to = 1, by = .2), limits = c(-.6, 1.01), expand = c(0, 0),
                           labels = function(breaks) { round(breaks * 100) }) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = -.2, yend = -.2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = -.4, yend = -.4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = -.6, yend = -.6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data_graduates_cars,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
        #                            y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data_graduates_cars,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data_graduates_cars %>% count(country) %>% nrow()) + .25,
                                   y = -.6, yend = -.6), color = "#333333", size = .5) +
        geom_col(position = "dodge", width = .75) + 
        labs(x = NULL, y = "Percentage point change\n(decrease is improvement)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        # coord_fixed(ratio = 5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(5, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_3_2_graduates_cars_patch_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# combine sub_obj_3_2_ee_graduates_cars_patch_bar_chart ####

sub_obj_3_2_ee_graduates_cars_patch_bar_chart <- (sub_obj_3_2_ee_patch_bar_chart / 
                                                        sub_obj_3_2_graduates_cars_patch_bar_chart) 

# inspect
# sub_obj_3_2_ee_graduates_cars_patch_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 94%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_ee_graduates_cars_patch_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_ee_graduates_cars_patch_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_diff_stacked_bar_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = country, y = diff, fill = indicator_name)) +
        geom_col(position = "stack", width = .75) + 
        theme(legend.position = "bottom")


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        select(-values) %>%
        rename(values = diff) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "VDem: Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "VDem: Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "VDem: Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        group_by(country) %>%
        mutate(decreases = case_when(values < 0 ~ values,
                                     TRUE ~ NA_real_),
                sum_of_decreases = sum(decreases, na.rm = TRUE)) %>%
        ungroup()

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data%>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_diff_stacked_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = sum_of_decreases, .desc = TRUE), 
                             y = values, 
                             fill = color_bin,
                             linetype = color_bin)) +
        geom_col(position = "stack", width = .75) + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -4, to = 2, by = 1), limits = c(-4, 2.1), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = -3, yend = -3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .25,
        #                            y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = 2, yend = 2), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .25,
        #                            y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = -4, yend = -4), color = "#333333", size = .5) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .25,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .25,
                                   y = 0, yend = 0), color = "#000000", size = .5) +
        geom_col(position = "stack", width = .75) + 
        labs(x = NULL, y = "Change in index score\n(increase is improvement)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(fill = guide_legend(nrow = 4, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
                linetype = guide_legend(keywidth = 4))
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_diff_stacked_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 130%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_diff_stacked_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_diff_stacked_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_five_country_diff_stacked_bar_chart ####

# plot
fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = country, y = diff, fill = indicator_name)) +
        geom_col(position = "stack", width = .75) + 
        theme(legend.position = "bottom")


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        arrange(country, indicator_name, year) %>%
        group_by(country, indicator_name) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        select(-values) %>%
        rename(values = diff) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "MSI: Professional journalism",
                                     indicator_name == "sub_obj_2_1_aiddata_content_producers" ~ "AidData: Content producers",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     indicator_name == "sub_obj_2_1_vdem_media_bias" ~ "VDem: Media bias",
                                     indicator_name == "sub_obj_2_1_vdem_media_corrupt" ~ "VDem: Media corrupt",
                                     indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                             "VDem: Gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~
                                             "VDem: Parties dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. dissem. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ "VDem: Foreign gov. advertising",
                                     indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media" ~ "ICEWS: Russian media"),
               color = case_when(color_bin == "MSI: Professional journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "AidData: Content producers" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "VDem: Media bias" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "VDem: Media corrupt" ~ color_palette %>% slice(5) %>% pull(hex), 
                                 color_bin == "VDem: Gov. dissem. false info" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "VDem: Parties dissem. false info" ~ color_palette %>% slice(8) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. dissem. false info" ~ color_palette %>% slice(9) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. advertising" ~ color_palette %>% slice(10) %>% pull(hex),
                                 color_bin == "ICEWS: Russian media" ~ color_palette %>% slice(11) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "MSI: Professional journalism" ~ 1,
                                           color_bin == "AidData: Content producers" ~ 2,
                                           color_bin == "VDem: Media critical" ~ 3,
                                           color_bin == "VDem: Media bias" ~ 4,
                                           color_bin == "VDem: Media corrupt" ~ 5,
                                           color_bin == "VDem: Gov. dissem. false info" ~ 6,
                                           color_bin == "VDem: Parties dissem. false info" ~ 7,
                                           color_bin == "VDem: Foreign gov. dissem. false info" ~ 8,
                                           color_bin == "VDem: Foreign gov. advertising" ~ 9,
                                           color_bin == "ICEWS: Russian media" ~ 10),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        group_by(country) %>%
        mutate(decreases = case_when(values < 0 ~ values,
                                     TRUE ~ NA_real_),
               sum_of_decreases = sum(decreases, na.rm = TRUE)) %>%
        ungroup()

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data%>% count(linetype_bin, linetype, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_five_country_diff_stacked_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = sum_of_decreases, .desc = TRUE), 
                             y = values, 
                             fill = color_bin,
                             linetype = color_bin)) +
        geom_col(position = "stack", width = .75) + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -4, to = 1, by = 1), limits = c(-4, 1.1), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -3, yend = -3), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -2, yend = -2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -1, yend = -1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .25,
        #                            y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .25,
        #                            y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -4, yend = -4), color = "#333333", size = .5) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#000000", size = .5) +
        geom_col(position = "stack", width = .75) + 
        labs(x = NULL, y = "Change in index score\n(increase is improvement)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 1 / 2, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
               linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_five_country_diff_stacked_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_five_country_diff_stacked_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_five_country_diff_stacked_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# russian_media_narratives_2020_level_bar_chart ####

# plot
fmir %>% filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = indicator_standardized_values, .desc = FALSE), 
                                       y = indicator_standardized_values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year == 2020) %>%
        select(-values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))
        
# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
russian_media_narratives_2020_level_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .8, by = .2), limits = c(0, .8), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .25,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .25,
        #                            y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#000000", size = .5) +
        geom_col(width = .75) + 
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 4 / .3, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
        # guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
        #        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
russian_media_narratives_2020_level_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(russian_media_narratives_2020_level_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%``
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/russian_media_narratives_2020_level_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# russian_media_narratives_diff_bar_chart_bar_chart ####

# plot
fmir %>% filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        group_by(country) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = diff, .desc = FALSE), 
                                       y = diff)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2020)) %>%
        group_by(country) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        select(-values) %>%
        rename(values = diff) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
russian_media_narratives_diff_bar_chart_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.8, to = .2, by = .2), limits = c(-.8, .2), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.2, yend = -.2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.4, yend = -.4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.6, yend = -.6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.8, yend = -.8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#000000", size = .5) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.8, yend = -.8), color = "#000000", size = .5) +
        geom_col(width = .75) + 
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 4 / .3, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
russian_media_narratives_diff_bar_chart_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(russian_media_narratives_diff_bar_chart_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/russian_media_narratives_diff_bar_chart_bar_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# fiw_ukraine_line_chart ####


# https://freedomhouse.org/report/freedom-world
# https://freedomhouse.org/reports/freedom-world/freedom-world-research-methodology

# higher scores are better outcomes
# condition year is one year prior to "Edition" year

fiw <- read_excel(path = "data/disputed_territories/All_data_FIW_2013-2022.xlsx", sheet = "FIW13-22", skip = 1) %>%
        rename(country = "Country/Territory",
               status = Status,
               total_score = Total) %>%
        mutate(year = Edition - 1) %>%
        select(country, year, status, total_score)
        
# inspect
fiw
fiw %>% glimpse()
fiw %>% nrow() # 2095
fiw %>% ncol() # 4

fiw %>% count(year)
fiw %>% count(country) %>% print(n = nrow(.))


#////////////////////


# plot
fiw %>% filter(country %in% c("Ukraine", "Crimea", "Eastern Donbas")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_score, color = country)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fiw %>% filter(country %in% c("Ukraine", "Crimea", "Eastern Donbas")) %>%
        rename(values = total_score) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Ukraine" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eastern Donbas" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Crimea" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# inspect
chart_data


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
fiw_ukraine_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 4, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 70, by = 10), 
                           limits = c(0, 70), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2012, to = 2021, by = 2)) +
        labs(x = NULL, y = "Score (0 to 100 scale; higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 12, clip = "off") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 50, yend = 50), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60, yend = 60), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 70, yend = 70), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, 
                                   yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
fiw_ukraine_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 122%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(fiw_ukraine_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/fiw_ukraine_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# ukraine_disputed_territories_pie_chart ####

chart_data <- tibble(country = c("Rest of Ukraine", "Eastern Donbas", "Crimea"),
       share_of_pop = c(NA, (3500000 / 44134000), (2300000 / 44134000))) %>%
        mutate(share_of_pop = case_when(country == "Rest of Ukraine" ~ 1 - sum(share_of_pop, na.rm = TRUE),
                                        TRUE ~ share_of_pop),
               color_bin = country,
               color = case_when(color_bin == "Rest of Ukraine" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eastern Donbas" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Crimea" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_order = case_when(color_bin == "Rest of Ukraine" ~ 1,
                                       color_bin == "Eastern Donbas" ~ 2,
                                       color_bin == "Crimea" ~ 3)) %>%
        arrange(desc(color_order)) %>%
        mutate(label = percent(share_of_pop),
               label_position = cumsum(share_of_pop) - (0.5 * share_of_pop))

# inspect
chart_data
expect_equal(object = chart_data %>% mutate(sum = sum(share_of_pop)) %>% distinct(sum) %>% pull(sum),
             expected = 1)


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


ukraine_disputed_territories_pie_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = 1, y = share_of_pop, fill = fct_reorder(.f = country, .x = share_of_pop, .desc = TRUE))) +        # geom_bar(stat = "identity", width = 1, color = "white", fill = chart_data_color_list) +
        geom_col(position = "stack", width = 1, color = "#ffffff") +
        coord_polar(theta = "y", direction = -1, start = 0) +
        scale_fill_manual(values = chart_data_color_list) +
        geom_text(data = chart_data, 
                  mapping = aes(x = 1.3, y = label_position, label = label), 
                  col = "#ffffff", size = 5.25, fontface = "bold") +
        labs(x = "", y = "", fill = "") +
        # theme_void()
        theme_bw() +
        theme(
                plot.background = element_blank(),
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 12, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_blank(),
                panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_blank(),
                axis.text.y = element_blank(),
                # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                            margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                            margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                             margin = margin(t = 0, r = 10, b = 0, l = 5)),
                axis.title.x = element_blank(),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 18, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.margin=margin(0, 0, 0, 0),
                legend.box.margin=margin(-30, 0, 0, 0)
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
ukraine_disputed_territories_pie_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ukraine_disputed_territories_pie_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ukraine_disputed_territories_pie_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# fiw_georgia_line_chart ####


# https://freedomhouse.org/report/freedom-world
# https://freedomhouse.org/reports/freedom-world/freedom-world-research-methodology

# higher scores are better outcomes
# condition year is one year prior to "Edition" year

fiw <- read_excel(path = "data/disputed_territories/All_data_FIW_2013-2022.xlsx", sheet = "FIW13-22", skip = 1) %>%
        rename(country = "Country/Territory",
               status = Status,
               total_score = Total) %>%
        mutate(year = Edition - 1) %>%
        select(country, year, status, total_score)

# inspect
fiw
fiw %>% glimpse()
fiw %>% nrow() # 2095
fiw %>% ncol() # 4

fiw %>% count(year)
fiw %>% count(country) %>% print(n = nrow(.))


#////////////////////


# plot
fiw %>% filter(country %in% c("Georgia", "Abkhazia", "South Ossetia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_score, color = country)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fiw %>% filter(country %in% c("Georgia", "Abkhazia", "South Ossetia")) %>%
        rename(values = total_score) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Georgia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Abkhazia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "South Ossetia" ~ color_palette %>% slice(3) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# inspect
chart_data


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
fiw_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 4, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 70, by = 10), 
                           limits = c(0, 70), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2012, to = 2021, by = 2)) +
        labs(x = NULL, y = "Score (0 to 100 scale; higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 12, clip = "off") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 50, yend = 50), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60, yend = 60), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 70, yend = 70), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, 
                                   yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
fiw_georgia_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 122%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(fiw_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/fiw_georgia_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# georgia_disputed_territories_pie_chart ####

chart_data <- tibble(country = c("Rest of Georgia", "Abkhazia", "South Ossetia"),
                     share_of_pop = c(NA, (243000 / 3714000), (53000 / 3714000))) %>%
        mutate(share_of_pop = case_when(country == "Rest of Georgia" ~ 1 - sum(share_of_pop, na.rm = TRUE),
                                        TRUE ~ share_of_pop),
               color_bin = country,
               color = case_when(color_bin == "Rest of Georgia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Abkhazia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "South Ossetia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_order = case_when(color_bin == "Rest of Georgia" ~ 1,
                                       color_bin == "Abkhazia" ~ 2,
                                       color_bin == "South Ossetia" ~ 3)) %>%
        arrange(desc(color_order)) %>%
        mutate(label = percent(share_of_pop),
               label_position = cumsum(share_of_pop) - (0.5 * share_of_pop)) 
               

# inspect
chart_data
expect_equal(object = chart_data %>% mutate(sum = sum(share_of_pop)) %>% distinct(sum) %>% pull(sum),
             expected = 1)


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


georgia_disputed_territories_pie_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = 1, y = share_of_pop, fill = fct_reorder(.f = country, .x = share_of_pop, .desc = TRUE))) +
        # geom_bar(stat = "identity", width = 1, color = "white", fill = chart_data_color_list) +
        geom_col(position = "stack", width = 1, color = "#ffffff") +
        coord_polar(theta = "y", direction = -1, start = 0) +
        scale_fill_manual(values = chart_data_color_list) +
        geom_text(data = chart_data, 
                  mapping = aes(x = 1.3, y = label_position, label = label), 
                  col = "#ffffff", size = 5.25, fontface = "bold") +
        labs(x = "", y = "", fill = "") +
        # theme_void()
        theme_bw() +
        theme(
                plot.background = element_blank(),
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 12, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_blank(),
                panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_blank(),
                axis.text.y = element_blank(),
                # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                            margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                            margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                             margin = margin(t = 0, r = 10, b = 0, l = 5)),
                axis.title.x = element_blank(),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 18, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.margin=margin(0, 0, 0, 0),
                legend.box.margin=margin(-30, 0, 0, 0)
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
georgia_disputed_territories_pie_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(georgia_disputed_territories_pie_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/georgia_disputed_territories_pie_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# fiw_moldova_line_chart ####


# https://freedomhouse.org/report/freedom-world
# https://freedomhouse.org/reports/freedom-world/freedom-world-research-methodology

# higher scores are better outcomes
# condition year is one year prior to "Edition" year

fiw <- read_excel(path = "data/disputed_territories/All_data_FIW_2013-2022.xlsx", sheet = "FIW13-22", skip = 1) %>%
        rename(country = "Country/Territory",
               status = Status,
               total_score = Total) %>%
        mutate(year = Edition - 1) %>%
        select(country, year, status, total_score)

# inspect
fiw
fiw %>% glimpse()
fiw %>% nrow() # 2095
fiw %>% ncol() # 4

fiw %>% count(year)
fiw %>% count(country) %>% print(n = nrow(.))


#////////////////////


# plot
fiw %>% filter(country %in% c("Moldova", "Transnistria")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_score, color = country)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fiw %>% filter(country %in% c("Moldova", "Transnistria")) %>%
        rename(values = total_score) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Moldova" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Transnistria" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# inspect
chart_data


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
fiw_moldova_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 4, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 70, by = 10), 
                           limits = c(0, 70), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2012, to = 2021, by = 2)) +
        labs(x = NULL, y = "Score (0 to 100 scale; higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 12, clip = "off") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 50, yend = 50), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60, yend = 60), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 70, yend = 70), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, 
                                   yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
fiw_moldova_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 122%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(fiw_moldova_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/fiw_moldova_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# moldova_disputed_territories_pie_chart ####

chart_data <- tibble(country = c("Rest of Moldova", "Transnistria"),
                     share_of_pop = c(NA, (500000 / 2620000))) %>%
        mutate(share_of_pop = case_when(country == "Rest of Moldova" ~ 1 - sum(share_of_pop, na.rm = TRUE),
                                        TRUE ~ share_of_pop),
               color_bin = country,
               color = case_when(color_bin == "Rest of Moldova" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Transnistria" ~ color_palette %>% slice(2) %>% pull(hex)),
               color_order = case_when(color_bin == "Rest of Moldova" ~ 1,
                                       color_bin == "Transnistria" ~ 2)) %>%
        arrange(desc(color_order)) %>%
        mutate(label = percent(share_of_pop),
               label_position = cumsum(share_of_pop) - (0.5 * share_of_pop)) 

# inspect
chart_data
expect_equal(object = chart_data %>% mutate(sum = sum(share_of_pop)) %>% distinct(sum) %>% pull(sum),
             expected = 1)


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


moldova_disputed_territories_pie_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = 1, y = share_of_pop, fill = fct_reorder(.f = country, .x = share_of_pop, .desc = TRUE))) +
        geom_col(position = "stack", width = 1, color = "#ffffff") +
        coord_polar(theta = "y", direction = -1, start = 0) +
        scale_fill_manual(values = chart_data_color_list) +
        geom_text(data = chart_data, 
                  mapping = aes(x = 1.3, y = label_position, label = label), 
                  col = "#ffffff", size = 5.25, fontface = "bold") +
        labs(x = "", y = "", fill = "") +
        # theme_void()
        theme_bw() +
        theme(
                plot.background = element_blank(),
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 12, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_blank(),
                panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_blank(),
                axis.text.y = element_blank(),
                # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                            margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                            margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                             margin = margin(t = 0, r = 10, b = 0, l = 5)),
                axis.title.x = element_blank(),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 18, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.margin=margin(0, 0, 0, 0),
                legend.box.margin=margin(-30, 0, 0, 0)
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
moldova_disputed_territories_pie_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(moldova_disputed_territories_pie_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/moldova_disputed_territories_pie_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# fiw_armenia_line_chart ####


# https://freedomhouse.org/report/freedom-world
# https://freedomhouse.org/reports/freedom-world/freedom-world-research-methodology

# higher scores are better outcomes
# condition year is one year prior to "Edition" year

fiw <- read_excel(path = "data/disputed_territories/All_data_FIW_2013-2022.xlsx", sheet = "FIW13-22", skip = 1) %>%
        rename(country = "Country/Territory",
               status = Status,
               total_score = Total) %>%
        mutate(year = Edition - 1) %>%
        select(country, year, status, total_score)

# inspect
fiw
fiw %>% glimpse()
fiw %>% nrow() # 2095
fiw %>% ncol() # 4

fiw %>% count(year)
fiw %>% count(country) %>% print(n = nrow(.))


#////////////////////


# plot
fiw %>% filter(country %in% c("Armenia", "Nagorno-Karabakh")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_score, color = country)) + geom_line()


#///////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fiw %>% filter(country %in% c("Armenia", "Nagorno-Karabakh")) %>%
        rename(values = total_score) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Nagorno-Karabakh" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>% 
        get_label_position()

# inspect
chart_data


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
fiw_armenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 4, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 70, by = 10), 
                           limits = c(0, 70), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2012, to = 2021, by = 2)) +
        labs(x = NULL, y = "Score (0 to 100 scale; higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 12, clip = "off") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 50, yend = 50), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60, yend = 60), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 70, yend = 70), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, 
                                   yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 11, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 11, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 11, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 11, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
fiw_armenia_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 122%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(fiw_armenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/fiw_armenia_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# armenia_disputed_territories_pie_chart ####

chart_data <- tibble(country = c("Rest of Armenia", "Nagorno-Karabakh"),
                     share_of_pop = c(NA, (150000 / 10093000))) %>%
        mutate(share_of_pop = case_when(country == "Rest of Armenia" ~ 1 - sum(share_of_pop, na.rm = TRUE),
                                        TRUE ~ share_of_pop),
               color_bin = country,
               color = case_when(color_bin == "Rest of Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Nagorno-Karabakh" ~ color_palette %>% slice(2) %>% pull(hex)),
               color_order = case_when(color_bin == "Rest of Armenia" ~ 1,
                                       color_bin == "Nagorno-Karabakh" ~ 2)) %>%
        arrange(desc(color_order)) %>%
        mutate(label = percent(share_of_pop),
               label_position = cumsum(share_of_pop) - (0.5 * share_of_pop)) 

# inspect
chart_data
expect_equal(object = chart_data %>% mutate(sum = sum(share_of_pop)) %>% distinct(sum) %>% pull(sum),
             expected = 1)


#/////////////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_order) %>% arrange(color_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


armenia_disputed_territories_pie_chart <- chart_data %>% 
        ggplot(data = ., mapping = aes(x = 1, y = share_of_pop, fill = fct_reorder(.f = country, .x = share_of_pop, .desc = TRUE))) +
        geom_col(position = "stack", width = 1, color = "#ffffff") +
        coord_polar(theta = "y", direction = -1, start = 0) +
        scale_fill_manual(values = chart_data_color_list) +
        geom_text(data = chart_data, 
                  mapping = aes(x = 1.3, y = label_position, label = label), 
                  col = "#ffffff", size = 5.25, fontface = "bold") +
        labs(x = "", y = "", fill = "") +
        # theme_void()
        theme_bw() +
        theme(
                plot.background = element_blank(),
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 12, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                panel.border = element_blank(),
                panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_blank(),
                axis.text.y = element_blank(),
                # axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                            margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                            margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                #                             margin = margin(t = 0, r = 10, b = 0, l = 5)),
                axis.title.x = element_blank(),
                axis.title.y = element_blank(),
                plot.title = element_text(size = 18, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.margin=margin(0, 0, 0, 0),
                legend.box.margin=margin(-30, 0, 0, 0)
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
armenia_disputed_territories_pie_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 75%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(armenia_disputed_territories_pie_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/armenia_disputed_territories_pie_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart ####

# plot
fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Trusted media" ~ "Media professionalism",
                                     concept == "Trusted information" ~ "Disinformation",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_1_concept_media_prof_and_disinfo_serbia_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_1_concept_media_prof_and_disinfo_bih_line_chart ####

# plot
fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Trusted media" ~ "Media professionalism",
                                     concept == "Trusted information" ~ "Disinformation",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_1_concept_media_prof_and_disinfo_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_1_concept_media_prof_and_disinfo_bih_line_chart <- obj_2_1_concept_media_prof_and_disinfo_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_1_concept_media_prof_and_disinfo_bih_line_chart <- obj_2_1_concept_media_prof_and_disinfo_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_1_concept_media_prof_and_disinfo_bih_line_chart <- obj_2_1_concept_media_prof_and_disinfo_bih_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_1_concept_media_prof_and_disinfo_bih_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_1_concept_media_prof_and_disinfo_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_1_concept_media_prof_and_disinfo_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart ####

# plot
fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Trusted media" ~ "Media professionalism",
                                     concept == "Trusted information" ~ "Disinformation",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart <- obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_1_concept_media_prof_and_disinfo_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_1_concept_media_prof_and_disinfo_poland_line_chart ####

# plot
fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Trusted media" ~ "Media professionalism",
                                     concept == "Trusted information" ~ "Disinformation",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_1_concept_media_prof_and_disinfo_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_1_concept_media_prof_and_disinfo_poland_line_chart <- obj_2_1_concept_media_prof_and_disinfo_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_1_concept_media_prof_and_disinfo_poland_line_chart <- obj_2_1_concept_media_prof_and_disinfo_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_1_concept_media_prof_and_disinfo_poland_line_chart <- obj_2_1_concept_media_prof_and_disinfo_poland_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_1_concept_media_prof_and_disinfo_poland_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_1_concept_media_prof_and_disinfo_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_1_concept_media_prof_and_disinfo_poland_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart ####

# plot
fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = concept_avg, color = concept)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(concept %in% c("Trusted media", "Trusted information"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, concept, concept_avg) %>%
        rename(values = concept_avg) %>%
        mutate(color_bin = case_when(concept == "Trusted media" ~ "Media professionalism",
                                     concept == "Trusted information" ~ "Disinformation",
                                     TRUE ~ concept),
               color = case_when(color_bin == "Media professionalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart <- obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart <- obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart <- obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_1_concept_media_prof_and_disinfo_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# media_professionalism_concept_selected_indicators_serbia_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                      "sub_obj_2_1_vdem_media_critical"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                                    "sub_obj_2_1_vdem_media_critical"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "IREX: Prof. journalism",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "IREX: Prof. journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
media_professionalism_concept_selected_indicators_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        media_professionalism_concept_selected_indicators_serbia_line_chart <- media_professionalism_concept_selected_indicators_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        media_professionalism_concept_selected_indicators_serbia_line_chart <- media_professionalism_concept_selected_indicators_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
media_professionalism_concept_selected_indicators_serbia_line_chart <- media_professionalism_concept_selected_indicators_serbia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
media_professionalism_concept_selected_indicators_serbia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(media_professionalism_concept_selected_indicators_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/media_professionalism_concept_selected_indicators_serbia_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# media_professionalism_concept_selected_indicators_bih_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                      "sub_obj_2_1_vdem_media_critical"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                                    "sub_obj_2_1_vdem_media_critical"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "IREX: Prof. journalism",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "IREX: Prof. journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
media_professionalism_concept_selected_indicators_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        media_professionalism_concept_selected_indicators_bih_line_chart <- media_professionalism_concept_selected_indicators_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        media_professionalism_concept_selected_indicators_bih_line_chart <- media_professionalism_concept_selected_indicators_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
media_professionalism_concept_selected_indicators_bih_line_chart <- media_professionalism_concept_selected_indicators_bih_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
media_professionalism_concept_selected_indicators_bih_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(media_professionalism_concept_selected_indicators_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/media_professionalism_concept_selected_indicators_bih_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# media_professionalism_concept_selected_indicators_georgia_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                      "sub_obj_2_1_vdem_media_critical"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                                    "sub_obj_2_1_vdem_media_critical"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "IREX: Prof. journalism",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "IREX: Prof. journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
media_professionalism_concept_selected_indicators_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        media_professionalism_concept_selected_indicators_georgia_line_chart <- media_professionalism_concept_selected_indicators_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        media_professionalism_concept_selected_indicators_georgia_line_chart <- media_professionalism_concept_selected_indicators_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
media_professionalism_concept_selected_indicators_georgia_line_chart <- media_professionalism_concept_selected_indicators_georgia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
media_professionalism_concept_selected_indicators_georgia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(media_professionalism_concept_selected_indicators_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/media_professionalism_concept_selected_indicators_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# media_professionalism_concept_selected_indicators_poland_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                      "sub_obj_2_1_vdem_media_critical"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                                    "sub_obj_2_1_vdem_media_critical"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "IREX: Prof. journalism",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "IREX: Prof. journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
media_professionalism_concept_selected_indicators_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        media_professionalism_concept_selected_indicators_poland_line_chart <- media_professionalism_concept_selected_indicators_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        media_professionalism_concept_selected_indicators_poland_line_chart <- media_professionalism_concept_selected_indicators_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
media_professionalism_concept_selected_indicators_poland_line_chart <- media_professionalism_concept_selected_indicators_poland_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
media_professionalism_concept_selected_indicators_poland_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(media_professionalism_concept_selected_indicators_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/media_professionalism_concept_selected_indicators_poland_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# media_professionalism_concept_selected_indicators_hungary_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                      "sub_obj_2_1_vdem_media_critical"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_msi_professional_journalism",
                                                    "sub_obj_2_1_vdem_media_critical"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_msi_professional_journalism" ~ "IREX: Prof. journalism",
                                     indicator_name == "sub_obj_2_1_vdem_media_critical" ~ "VDem: Media critical",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "IREX: Prof. journalism" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Media critical" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
media_professionalism_concept_selected_indicators_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        media_professionalism_concept_selected_indicators_hungary_line_chart <- media_professionalism_concept_selected_indicators_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        media_professionalism_concept_selected_indicators_hungary_line_chart <- media_professionalism_concept_selected_indicators_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
media_professionalism_concept_selected_indicators_hungary_line_chart <- media_professionalism_concept_selected_indicators_hungary_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 25, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
media_professionalism_concept_selected_indicators_hungary_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(media_professionalism_concept_selected_indicators_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/media_professionalism_concept_selected_indicators_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# trusted_information_concept_selected_indicators_serbia_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                      "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                    "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Serbia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ "VDem: Domestic gov. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. false info",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "VDem: Domestic gov. false info" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. false info" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
trusted_information_concept_selected_indicators_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        trusted_information_concept_selected_indicators_serbia_line_chart <- trusted_information_concept_selected_indicators_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        trusted_information_concept_selected_indicators_serbia_line_chart <- trusted_information_concept_selected_indicators_serbia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
trusted_information_concept_selected_indicators_serbia_line_chart <- trusted_information_concept_selected_indicators_serbia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
trusted_information_concept_selected_indicators_serbia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(trusted_information_concept_selected_indicators_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/trusted_information_concept_selected_indicators_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# trusted_information_concept_selected_indicators_bih_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                      "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                    "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "BiH") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ "VDem: Domestic gov. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. false info",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "VDem: Domestic gov. false info" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. false info" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
trusted_information_concept_selected_indicators_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        trusted_information_concept_selected_indicators_bih_line_chart <- trusted_information_concept_selected_indicators_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        trusted_information_concept_selected_indicators_bih_line_chart <- trusted_information_concept_selected_indicators_bih_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
trusted_information_concept_selected_indicators_bih_line_chart <- trusted_information_concept_selected_indicators_bih_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
trusted_information_concept_selected_indicators_bih_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(trusted_information_concept_selected_indicators_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/trusted_information_concept_selected_indicators_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# trusted_information_concept_selected_indicators_georgia_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                      "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                    "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Georgia") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ "VDem: Domestic gov. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. false info",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "VDem: Domestic gov. false info" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. false info" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
trusted_information_concept_selected_indicators_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        trusted_information_concept_selected_indicators_georgia_line_chart <- trusted_information_concept_selected_indicators_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        trusted_information_concept_selected_indicators_georgia_line_chart <- trusted_information_concept_selected_indicators_georgia_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
trusted_information_concept_selected_indicators_georgia_line_chart <- trusted_information_concept_selected_indicators_georgia_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
trusted_information_concept_selected_indicators_georgia_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(trusted_information_concept_selected_indicators_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/trusted_information_concept_selected_indicators_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# trusted_information_concept_selected_indicators_poland_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                      "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                    "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Poland") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ "VDem: Domestic gov. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. false info",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "VDem: Domestic gov. false info" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. false info" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
trusted_information_concept_selected_indicators_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        trusted_information_concept_selected_indicators_poland_line_chart <- trusted_information_concept_selected_indicators_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        trusted_information_concept_selected_indicators_poland_line_chart <- trusted_information_concept_selected_indicators_poland_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
trusted_information_concept_selected_indicators_poland_line_chart <- trusted_information_concept_selected_indicators_poland_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
trusted_information_concept_selected_indicators_poland_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(trusted_information_concept_selected_indicators_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/trusted_information_concept_selected_indicators_poland_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# trusted_information_concept_selected_indicators_hungary_line_chart ####

# plot
fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                      "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = indicator_standardized_values, color = indicator_name)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>% filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                    "sub_obj_2_1_vdem_foreign_gov_dissem_false_info"), country == "Hungary") %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, sub_obj_short_name, 
                 concept, indicator_name, indicator_standardized_values) %>%
        rename(values = indicator_standardized_values) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ "VDem: Domestic gov. false info",
                                     indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ "VDem: Foreign gov. false info",
                                     TRUE ~ indicator_name),
               color = case_when(color_bin == "VDem: Domestic gov. false info" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "VDem: Foreign gov. false info" ~ color_palette %>% slice(2) %>% pull(hex)),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"),
               max_value = max(values),
               min_value = min(values),
               max_value_rounded_10 = round_to_threshold(number = max_value, accuracy = .1, fun = ceiling),
               min_value_rounded_10 = round_to_threshold(number = min_value, accuracy = .1, fun = floor),
               max_value_rounded_20 = round_to_threshold(number = max_value, accuracy = .2, fun = ceiling),
               min_value_rounded_20 = round_to_threshold(number = min_value, accuracy = .2, fun = floor),
               values_range_10 = max_value_rounded_10 - min_value_rounded_10,
               values_range_20 = max_value_rounded_20 - min_value_rounded_20,
               final_axis_interval = case_when(values_range_10 <= .61 ~ .1,
                                               values_range_10 > .61 ~ .2),
               final_axis_interval_max = case_when(final_axis_interval == .1 ~ max_value_rounded_10,
                                                   final_axis_interval == .2 ~ max_value_rounded_20),
               final_axis_interval_min = case_when(final_axis_interval == .1 ~ min_value_rounded_10,
                                                   final_axis_interval == .2 ~ min_value_rounded_20),
               coord_fixed_ratio = case_when(values_range_10 <= .6 ~ 6 / values_range_10,
                                             values_range_10 > .6 ~ 6 / values_range_20)) 

# get label_position when y-axis has .1 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) <= .6) {
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) >= .5) & 
           ((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# get label_position when y-axis has .2 intervals
if((chart_data %>% distinct(values_range_10) %>% pull(values_range_10)) > .6) {
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .8) {
                
                chart_data <- chart_data %>% get_label_position(gap = .04)
        }
        
        if(((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) >= .5) & 
           ((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .8)) {
                
                chart_data <- chart_data %>% get_label_position(gap = .03)
        }
        
        if((chart_data %>% distinct(values_range_20) %>% pull(values_range_20)) < .5) {
                
                chart_data <- chart_data %>% get_label_position(gap = .02)
        }
}

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#///////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
trusted_information_concept_selected_indicators_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = color_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                        to = chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max), 
                                        by = chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)), 
                           limits = c((chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) - .0001, 
                                      (chart_data %>% distinct(final_axis_interval_max) %>% pull(final_axis_interval_max)) + .0001), 
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = chart_data %>% distinct(coord_fixed_ratio) %>% pull(coord_fixed_ratio), clip = "off") 
# annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") 


#/////////////////////////


# add segments if axis_intervals are .1
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .1) {
        
        trusted_information_concept_selected_indicators_hungary_line_chart <- trusted_information_concept_selected_indicators_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .1, yend = .1), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .2, yend = .2), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .3, yend = .3), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .4, yend = .4), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .5, yend = .5), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .6, yend = .6), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .7, yend = .7), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .8, yend = .8), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = .9, yend = .9), color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = 1, yend = 1), color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1) 
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#///////////////////////////


# add segments if axis_intervals are .2
if((chart_data %>% distinct(final_axis_interval) %>% pull(final_axis_interval)) == .2) {
        
        trusted_information_concept_selected_indicators_hungary_line_chart <- trusted_information_concept_selected_indicators_hungary_line_chart +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .2),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .4),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .6),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + .8),
                             color = "#DDDDDD", size = .25) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1, 
                                           yend = (chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)) + 1),
                             color = "#DDDDDD", size = .25) +
                # geom_segment(data = chart_data,
                #              mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                #                            xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                #                            y = 0, yend = 0), color = "#333333", size = .5) +
                geom_segment(data = chart_data,
                             mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                           xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                           y = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min), 
                                           yend = chart_data %>% distinct(final_axis_interval_min) %>% pull(final_axis_interval_min)), 
                             color = "#333333", size = .5) +
                geom_line(size = 1)  
        # geom_point(size = 2) 
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) 
}


#//////////////////////////


# add theme
trusted_information_concept_selected_indicators_hungary_line_chart <- trusted_information_concept_selected_indicators_hungary_line_chart + 
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 35, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = -15, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
trusted_information_concept_selected_indicators_hungary_line_chart


#//////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(trusted_information_concept_selected_indicators_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/trusted_information_concept_selected_indicators_hungary_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_2020_level_bar_chart ####

# plot
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year == 2019) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year == 2019) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_2020_level_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1.5, by = .25), limits = c(0, 1.5), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .25, yend = .25), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .75, yend = .75), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 1.25, yend = 1.25), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 1.5, yend = 1.5), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#000000", size = .5) +
        geom_col(width = .75) + 
        labs(x = NULL, y = "Percent", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 4 / .6, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_2020_level_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_2020_level_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes_2020_level_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_diff_bar_chart_bar_chart ####

# plot
fmir %>% filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E graduates", "CARs")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        # filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2019)) %>%
        group_by(country) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = values - lag(values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2019) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = diff, .desc = FALSE), 
                                       y = diff)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports") %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates")) %>%
        distinct(country, mcp_grouping, year, sub_obj_num, indicator_name, indicator_standardized_values, values) %>%
        filter(year %in% c(2010, 2019)) %>%
        group_by(country) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = values - lag(values, n = 1),
               diff_pct_point = diff * 100,
               values = diff_pct_point) %>%
        ungroup() %>%
        filter(year == 2019) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_diff_bar_chart_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -60, to = 20, by = 20), limits = c(-60, 20), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -20, yend = -20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -40, yend = -40), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .5) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -60, yend = -60), color = "#000000", size = .5) +
        geom_col(width = .75) +
        labs(x = NULL, y = "Percentage point change", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 1 / 7, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_diff_bar_chart_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_diff_bar_chart_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports_diff_bar_chart_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# miri_avg_diff_from_2013_to_2020_bar_chart ####

# plot
fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        group_by(country) %>%
        arrange(country, year) %>%
        mutate(diff = miri_avg - lag(miri_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = diff, .desc = FALSE), 
                                       y = diff)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, miri_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        group_by(country) %>%
        arrange(country, year) %>%
        mutate(diff = miri_avg - lag(miri_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
miri_avg_diff_from_2013_to_2020_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.15, to = .1, by = .05), limits = c(-.15, .1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.1, yend = -.1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.05, yend = -.05), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .05, yend = .05), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = 1 - .5,
                                   xend = (chart_data %>% count(country) %>% nrow()) + .5,
                                   y = -.15, yend = -.15), color = "#333333", size = .5) +
        geom_col(width = .75) +
        labs(x = NULL, y = "Change in score (increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 8 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
miri_avg_diff_from_2013_to_2020_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(miri_avg_diff_from_2013_to_2020_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/miri_avg_diff_from_2013_to_2020_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart ####

# plot
fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = obj_num, 
                                       y = diff, fill = obj_num)) +
        geom_col(width = 1) + facet_wrap(facets = vars(country), nrow = 1) 

fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = country, 
                                       y = diff, fill = obj_num)) +
        geom_col(width = .5, position = "dodge") 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(obj_short_name = case_when(obj_num == "obj_1" ~ "Democratic",
                                          obj_num == "obj_2" ~ "Information",
                                          obj_num == "obj_3" ~ "Energy",
                                          obj_num == "obj_4" ~ "Economic",
                                          obj_num == "obj_c" ~ "Corruption"),
               color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic" ~ 1,
                                           color_bin == "Information" ~ 2,
                                           color_bin == "Energy" ~ 3,
                                           color_bin == "Economic" ~ 4,
                                           color_bin == "Corruption" ~ 5))
# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = obj_short_name, .x = color_bin_order, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = 1, position = "dodge") + facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.25, to = .1, by = .05), limits = c(-.25, .1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Change in score\n(increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 3 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(1, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_sub_obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart ####

# plot
fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_short_name, sub_obj_num, sub_obj_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(obj_num == "obj_2") %>%
        group_by(country, sub_obj_num) %>%
        arrange(country, sub_obj_num, year) %>%
        mutate(diff = sub_obj_avg - lag(sub_obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = sub_obj_num, 
                                       y = diff, fill = sub_obj_num)) +
        geom_col(width = 1) + facet_wrap(facets = vars(country), nrow = 1) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_short_name, sub_obj_num, sub_obj_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(obj_num == "obj_2") %>%
        group_by(country, sub_obj_num) %>%
        arrange(country, sub_obj_num, year) %>%
        mutate(diff = sub_obj_avg - lag(sub_obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Trusted media and information" ~ "Media capacity",
                                              TRUE ~ sub_obj_short_name),
               color_bin = sub_obj_short_name,
               color = case_when(color_bin == "Media capacity" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Media demand" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Media freedom" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media capacity" ~ 1,
                                           color_bin == "Media demand" ~ 2,
                                           color_bin == "Media freedom" ~ 3))
# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_sub_obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = sub_obj_short_name, .x = color_bin_order, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = 1, position = "dodge") + facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.3, to = 0, by = .05), limits = c(-.3, .05), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Change in score\n(increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / .1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(1, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -8, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_2_sub_obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_sub_obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_sub_obj_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_concept_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart ####

# plot
fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, concept, concept_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(sub_obj_num == "sub_obj_2_1", concept %in% c("Trusted information", "Trusted media")) %>%
        group_by(country, concept) %>%
        arrange(country, concept, year) %>%
        mutate(diff = concept_avg - lag(concept_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = concept, 
                                       y = diff, fill = concept)) +
        geom_col(width = 1) + facet_wrap(facets = vars(country), nrow = 1) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, concept, concept_avg) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(sub_obj_num == "sub_obj_2_1", concept %in% c("Trusted information", "Trusted media")) %>%
        group_by(country, concept) %>%
        arrange(country, concept, year) %>%
        mutate(diff = concept_avg - lag(concept_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(concept_short_name = case_when(concept == "Trusted media" ~ "Media professionalism",
                                              concept == "Trusted information" ~ "Disinformation",
                                              TRUE ~ concept),
               concept_legend_name = case_when(concept == "Trusted media" ~ "Media professionalism      ",
                                               concept == "Trusted information" ~ "Disinformation      ",
                                               TRUE ~ concept),
               color_bin = concept_legend_name,
               color = case_when(color_bin == "Media professionalism      " ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Disinformation      " ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Media professionalism      " ~ 1,
                                           color_bin == "Disinformation      " ~ 2))
# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_concept_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = concept_short_name, .x = color_bin_order, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = 1, position = "dodge") + facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.35, to = 0, by = .05), limits = c(-.37, .02), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Change in score\n(increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 3, 0, 3), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(1, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -8, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_concept_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_concept_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_concept_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# disinformation_indicators_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart ####

# plot
fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, concept, indicator_name, indicator_standardized_values) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically", "sub_obj_2_1_vdem_foreign_gov_dissem_false_info")) %>%
        group_by(country, indicator_name) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = indicator_name, 
                                       y = diff, fill = indicator_name)) +
        geom_col(width = 1) + facet_wrap(facets = vars(country), nrow = 1) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        filter(country %in% c("Serbia", "BiH", "Georgia", "Poland", "Hungary")) %>%
        distinct(country, mcp_grouping, year, obj_num, sub_obj_num, concept, indicator_name, indicator_standardized_values) %>%
        filter(year %in% c(2013, 2020)) %>%
        filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically", "sub_obj_2_1_vdem_foreign_gov_dissem_false_info")) %>%
        group_by(country, indicator_name) %>%
        arrange(country, indicator_name, year) %>%
        mutate(diff = indicator_standardized_values - lag(indicator_standardized_values, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(indicator_short_name = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ 
                                                        "Domestic gov. false info.",
                                                indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ 
                                                        "Foreign gov. false info.",
                                                TRUE ~ indicator_name),
               color_bin = indicator_short_name,
               color = case_when(color_bin == "Domestic gov. false info." ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Foreign gov. false info." ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Domestic gov. false info." ~ 1,
                                           color_bin == "Foreign gov. false info." ~ 2))
# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
disinformation_indicators_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = indicator_short_name, .x = color_bin_order, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = 1, position = "dodge") + facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = -.6, to = 0, by = .1), limits = c(-.64, .02), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Change in score\n(increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 9 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 3, 0, 3), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(1, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -8, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
disinformation_indicators_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(disinformation_indicators_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/disinformation_indicators_diff_from_2013_to_2020_top_5_backsliders_facet_bar_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# infographic_obj_c_diff_from_2010_to_2020_bar_chart ####

# plot
fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year %in% c(2010, 2020), 
               obj_num == "obj_c",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        group_by(country) %>%
        arrange(country, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = diff, .desc = FALSE), 
                                       y = diff)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year %in% c(2010, 2020), 
               obj_num == "obj_c",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        group_by(country) %>%
        arrange(country, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        rename(values = diff) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
infographic_obj_c_diff_from_2010_to_2020_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -.3, to = .3, by = .1),
                limits = c(-.3, .3),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Change in score\n(increase is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
infographic_obj_c_diff_from_2010_to_2020_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(infographic_obj_c_diff_from_2010_to_2020_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/infographic_obj_c_diff_from_2010_to_2020_bar_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# infographic_obj_c_level_bar_chart ####

# plot
fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num == "obj_c",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = obj_avg, .desc = FALSE), 
                                       y = obj_avg)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num == "obj_c",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        rename(values = obj_avg) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

infographic_obj_c_level_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = 1, by = .25),
                limits = c(0, 1.01),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
infographic_obj_c_level_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(infographic_obj_c_level_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/infographic_obj_c_level_bar_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# infographic_cross_cutting_obj_balkans_patch_line_chart ####
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption") %>% count(indicator_name)
fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))
fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Balkans", 
               year == 2020, country == "Albania") %>% 
        select(country, year, indicator_name, values, sub_obj_avg)
fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
               is.na(values)) %>% 
        count(country) %>% arrange(desc(n)) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                # mcp_grouping == "E&E Balkans"
                mcp_grouping == "E&E Eurasia"
) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                # mcp_grouping == "E&E Balkans"
                mcp_grouping == "E&E Eurasia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line()

# inspect 
fmir %>% filter(country == "N. Macedonia", indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Serbia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, mcp_grouping, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Balkans") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
infographic_cross_cutting_obj_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                  "N. Macedonia", "Serbia")),
                             linetype = factor(color_bin, levels = c("Albania", "BiH", "Kosovo",
                                                                     "N. Macedonia", "Serbia")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 8, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
infographic_cross_cutting_obj_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# infographic_cross_cutting_obj_eurasia_patch_line_chart ####

fmir %>% count(sub_obj_num, sub_obj_short_name, indicator_name) %>% print(n = nrow(.))

# plot
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Eurasia") %>%
        distinct(country, year, sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = sub_obj_avg, color = country)) + geom_line()

# inspect armenia
fmir %>% filter(country == "Armenia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values)
fmir %>% filter(country == "Armenia", sub_obj_num == "cross_cutting_obj", indicator_name == "cross_cutting_obj_vdem_civil_society") %>%
        distinct(country, year, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values)) + geom_line()


#//////////////////


# add color_bin and color
chart_data <- fmir %>% 
        filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", mcp_grouping == "E&E Eurasia") %>%
        mutate(values = sub_obj_avg) %>%
        distinct(country, mcp_grouping, year, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype_bin = country,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
infographic_cross_cutting_obj_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                  "Georgia", "Moldova", "Ukraine")),
                             linetype = factor(color_bin, levels = c("Armenia", "Azerbaijan", "Belarus",
                                                                     "Georgia", "Moldova", "Ukraine")))) + 
        # geom_line(size = 1) + 
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 8, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
infographic_cross_cutting_obj_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# infographic_cross_cutting_obj_mcp_grouping_patch_line_chart ####

# inspect
# note you need to use distinct to get one record per mcp_grouping/year
fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>% select(country, mcp_grouping, year, sub_obj_num, indicator_name, avg_sub_obj_avg) %>%
        filter(year == 2015) %>%
        count(country)

# plot
fmir %>% filter(sub_obj_num == "cross_cutting_obj") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, avg_sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = avg_sub_obj_avg, color = mcp_grouping)) + geom_line()


#//////////////////


# add color_bin and color
# note russia is dropped
chart_data <- fmir %>% filter(indicator_name == "cross_cutting_obj_wgi_control_of_corruption", 
                              country != "Russia") %>%
        group_by(mcp_grouping, year) %>% mutate(avg_sub_obj_avg = mean(sub_obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = avg_sub_obj_avg) %>%
        distinct(mcp_grouping, year, values) %>%
        mutate(mcp_grouping = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                        mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                        mcp_grouping == "E&E graduates" ~ "Graduates",
                                        TRUE ~ mcp_grouping)) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position()

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"

#////////////////////////


infographic_cross_cutting_obj_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = factor(color_bin, levels = c("Balkans", 
                                                                  "Eurasia", 
                                                                  "Graduates", 
                                                                  "CARs",
                                                                  "Russia",
                                                                  "EU-15",
                                                                  "U.S.")),
                             linetype = factor(color_bin, levels = c("Balkans", 
                                                                     "Eurasia", 
                                                                     "Graduates", 
                                                                     "CARs",
                                                                     "Russia",
                                                                     "EU-15",
                                                                     "U.S.")))) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.2, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 3)) +
        labs(x = NULL, y = "Score", 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, ymax = 1, alpha = 0, color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 1, yend = 1), color = "#DDDDDD", size = .25) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 8, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
infographic_cross_cutting_obj_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for cross_cutting_obj_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
infographic_cross_cutting_obj_patch_line_chart <- wrap_plots(plot_spacer(),
                                                             infographic_cross_cutting_obj_balkans_patch_line_chart,
                                                             infographic_cross_cutting_obj_eurasia_patch_line_chart,
                                                             infographic_cross_cutting_obj_mcp_grouping_patch_line_chart, 
                                                             plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(infographic_cross_cutting_obj_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/infographic_cross_cutting_obj_patch_line_chart.docx")



#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_c_and_obj_1_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_1"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, y = obj_c, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_c"
obj_b <- "obj_1"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Democratic resilience\n(higher is better)",
                              obj_a == "obj_2" ~ "Information resilience\n(higher is better)",
                              obj_a == "obj_3" ~ "Energy resilience\n(higher is better)",
                              obj_a == "obj_4" ~ "Economic resilience\n(higher is better)",
                              obj_a == "obj_c" ~ "Corruption resilience\n(higher is better)")
obj_b_axis_label <-  case_when(obj_b == "obj_1" ~ "Democratic resilience\n(higher is better)",
                               obj_b == "obj_2" ~ "Information resilience\n(higher is better)",
                               obj_b == "obj_3" ~ "Energy resilience\n(higher is better)",
                               obj_b == "obj_4" ~ "Economic resilience\n(higher is better)",
                               obj_b == "obj_c" ~ "Corruption resilience\n(higher is better)")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ iso3,
                                         TRUE ~ NA_character_),
               country_label = case_when(country == "Kosovo" ~ "KOS",
                                         TRUE ~ country_label),
               # country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
               #                           TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7),
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_c_and_obj_1_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .79, y = .95),
                  # data = tibble(x = .16, y = .03), 
                  mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 5, fontface = "bold") + 
        geom_point(size = 3) +
        geom_text_repel(fontface = "bold", point.padding = .5, size = 4.5, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 5, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                            margin = margin(t = 0, r = 7, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 7))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_c_and_obj_1_scatterplot


#//////////////////////////////////


# resize to 58%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_obj_1_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_obj_1_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_c_and_obj_2_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_2"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, y = obj_c, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_c"
obj_b <- "obj_2"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Democratic resilience\n(higher is better)",
                              obj_a == "obj_2" ~ "Information resilience\n(higher is better)",
                              obj_a == "obj_3" ~ "Energy resilience\n(higher is better)",
                              obj_a == "obj_4" ~ "Economic resilience\n(higher is better)",
                              obj_a == "obj_c" ~ "Corruption resilience\n(higher is better)")
obj_b_axis_label <-  case_when(obj_b == "obj_1" ~ "Democratic resilience\n(higher is better)",
                               obj_b == "obj_2" ~ "Information resilience\n(higher is better)",
                               obj_b == "obj_3" ~ "Energy resilience\n(higher is better)",
                               obj_b == "obj_4" ~ "Economic resilience\n(higher is better)",
                               obj_b == "obj_c" ~ "Corruption resilience\n(higher is better)")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ iso3,
                                         TRUE ~ NA_character_),
               country_label = case_when(country == "Kosovo" ~ "KOS",
                                         TRUE ~ country_label),
               # country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
               #                           TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7),
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_c_and_obj_2_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .79, y = .95),
                  # data = tibble(x = .16, y = .03), 
                  mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 5, fontface = "bold") + 
        geom_point(size = 3) +
        geom_text_repel(fontface = "bold", point.padding = .5, size = 4.5, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 5, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                            margin = margin(t = 0, r = 7, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 7))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_c_and_obj_2_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_obj_2_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_obj_2_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_c_and_obj_3_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_3"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, y = obj_c, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_c"
obj_b <- "obj_3"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Democratic resilience\n(higher is better)",
                              obj_a == "obj_2" ~ "Information resilience\n(higher is better)",
                              obj_a == "obj_3" ~ "Energy resilience\n(higher is better)",
                              obj_a == "obj_4" ~ "Economic resilience\n(higher is better)",
                              obj_a == "obj_c" ~ "Corruption resilience\n(higher is better)")
obj_b_axis_label <-  case_when(obj_b == "obj_1" ~ "Democratic resilience\n(higher is better)",
                               obj_b == "obj_2" ~ "Information resilience\n(higher is better)",
                               obj_b == "obj_3" ~ "Energy resilience\n(higher is better)",
                               obj_b == "obj_4" ~ "Economic resilience\n(higher is better)",
                               obj_b == "obj_c" ~ "Corruption resilience\n(higher is better)")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ iso3,
                                         TRUE ~ NA_character_),
               country_label = case_when(country == "Kosovo" ~ "KOS",
                                         TRUE ~ country_label),
               # country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
               #                           TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7),
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_c_and_obj_3_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .79, y = .95),
                  # data = tibble(x = .16, y = .03), 
                  mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 5, fontface = "bold") + 
        geom_point(size = 3) +
        geom_text_repel(fontface = "bold", point.padding = .5, size = 4.5, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 5, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                            margin = margin(t = 0, r = 7, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 7))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_c_and_obj_3_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_obj_3_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_obj_3_scatterplot.docx")


#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////


# obj_c_and_obj_4_scatterplot ####

# inspect
fmir %>% distinct(country, year, obj_num, obj_avg) # 2475 records (45 countries * 5 obj * 11 years)

# plot
obj_a <- "obj_4"
obj_b <- "obj_c"
example_chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg)         
example_chart_data


example_chart_data %>% ggplot(data = ., mapping = aes(x = obj_1, y = obj_c, color = mcp_grouping, label = country)) + 
        geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#DDDDDD") +
        geom_point() +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.25, family = "Calibri") +
        geom_text(data = example_chart_data %>% 
                          mutate(correlation = cor(x = !!!syms(obj_a), y = !!!syms(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .52, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 3, color = "#333333", family = "Calibri") +
        theme_bw()


#///////////////////////////


# get chart_data
obj_a <- "obj_c"
obj_b <- "obj_4"
obj_a_axis_label <- case_when(obj_a == "obj_1" ~ "Democratic resilience\n(higher is better)",
                              obj_a == "obj_2" ~ "Information resilience\n(higher is better)",
                              obj_a == "obj_3" ~ "Energy resilience\n(higher is better)",
                              obj_a == "obj_4" ~ "Economic resilience\n(higher is better)",
                              obj_a == "obj_c" ~ "Corruption resilience\n(higher is better)")
obj_b_axis_label <-  case_when(obj_b == "obj_1" ~ "Democratic resilience\n(higher is better)",
                               obj_b == "obj_2" ~ "Information resilience\n(higher is better)",
                               obj_b == "obj_3" ~ "Energy resilience\n(higher is better)",
                               obj_b == "obj_4" ~ "Economic resilience\n(higher is better)",
                               obj_b == "obj_c" ~ "Corruption resilience\n(higher is better)")

chart_data <- fmir %>% distinct(country, mcp_grouping, iso3, year, obj_num, obj_avg) %>%
        filter(year == 2020, 
               obj_num %in% c(obj_a, obj_b)) %>% 
        pivot_wider(id_cols = c(country, mcp_grouping, iso3, year), names_from = obj_num, values_from = obj_avg) %>%
        mutate(country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ iso3,
                                         TRUE ~ NA_character_),
               country_label = case_when(country == "Kosovo" ~ "KOS",
                                         TRUE ~ country_label),
               # country_label = case_when(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs") ~ country,
               #                           TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7),
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
obj_c_and_obj_4_scatterplot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = !!sym(obj_a), y = !!sym(obj_b), label = country_label,
                                       color = factor(color_bin, levels = c("E&E Balkans", 
                                                                            "E&E Eurasia", 
                                                                            "E&E graduates", 
                                                                            "CARs",
                                                                            "Russia",
                                                                            "EU-15",
                                                                            "U.S.")))) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        geom_text(data = tibble(x = .79, y = .95),
                  # data = tibble(x = .16, y = .03), 
                  mapping = aes(x = x, y = y), label = "45-degree line",
                  color = "#7D7D7D", size = 5, fontface = "bold") + 
        geom_point(size = 3) +
        geom_text_repel(fontface = "bold", point.padding = .5, size = 4.5, family = "Calibri",
                        max.overlaps = Inf) +
        geom_text(data = chart_data %>% 
                          mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
                                 correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
                          slice(1), 
                  mapping = aes(x = .03, y = .95, label = correlation),
                  fontface = "bold", hjust = 0, size = 5, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = obj_a_axis_label, y = obj_b_axis_label, 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1.07, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(5, 5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = 0, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 18, color = "#333333",
                                            margin = margin(t = 0, r = 7, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 18, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 18, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 7))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
obj_c_and_obj_4_scatterplot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_obj_4_scatterplot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_obj_4_scatterplot.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_ukraine_line_chart ####

fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_2", "sub_obj_2_3")) %>%
        filter(country == "Ukraine") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "Ukraine") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_3")) %>%
        filter(country == "Ukraine") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "Ukraine") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        mutate(label = country,
               color_bin = case_when(var == "Rule of law" ~ "      Rule of law",
                                     var == "Civil society" ~ "      Civil society",
                                     var == "Media demand" ~ "      Media demand",
                                     var == "Media freedom" ~ "      Media freedom",
                                     var == "Corruption" ~ "      Corruption"),
               color = case_when(var == "Rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Media demand" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Media freedom" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Corruption" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Rule of law" ~ 1,
                                           var == "Civil society" ~ 2,
                                           var == "Media demand" ~ 3,
                                           var == "Media freedom" ~ 4,
                                           var == "Corruption" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_ukraine_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           labels = label_number(accuracy = .2)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_ukraine_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_ukraine_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_ukraine_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_armenia_line_chart ####

fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_2", "sub_obj_2_3")) %>%
        filter(country == "Armenia") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "Armenia") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_3")) %>%
        filter(country == "Armenia") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "Armenia") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        mutate(label = country,
               color_bin = case_when(var == "Rule of law" ~ "      Rule of law",
                                     var == "Civil society" ~ "      Civil society",
                                     var == "Media demand" ~ "      Media demand",
                                     var == "Media freedom" ~ "      Media freedom",
                                     var == "Corruption" ~ "      Corruption"),
               color = case_when(var == "Rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Media demand" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Media freedom" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Corruption" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Rule of law" ~ 1,
                                           var == "Civil society" ~ 2,
                                           var == "Media demand" ~ 3,
                                           var == "Media freedom" ~ 4,
                                           var == "Corruption" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_armenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           labels = label_number(accuracy = .2)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_armenia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_armenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_armenia_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_macedonia_line_chart ####

fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_2", "sub_obj_2_3")) %>%
        filter(country == "N. Macedonia") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "N. Macedonia") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line()


#//////////////////


# get chart_data
chart_data <- fmir %>%
        filter(sub_obj_num %in% c("sub_obj_c", "sub_obj_1_2", "sub_obj_2_3")) %>%
        filter(country == "N. Macedonia") %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        select(country, year, sub_obj_short_name, sub_obj_avg) %>%
        mutate(sub_obj_short_name = case_when(sub_obj_short_name == "Checks and balances and rule of law" ~ "Rule of law",
                                              TRUE ~ sub_obj_short_name)) %>%
        rename(var = sub_obj_short_name, values = sub_obj_avg) %>%
        bind_rows(., 
                  fmir %>%
                          filter(obj_num == "obj_c") %>%
                          filter(country == "N. Macedonia") %>%
                          distinct(country, year, obj_short_name, obj_avg) %>%
                          select(country, year, obj_short_name, obj_avg) %>%
                          mutate(obj_short_name = "Corruption") %>%
                          rename(var = obj_short_name, values = obj_avg)) %>%
        mutate(label = country,
               color_bin = case_when(var == "Rule of law" ~ "      Rule of law",
                                     var == "Civil society" ~ "      Civil society",
                                     var == "Media demand" ~ "      Media demand",
                                     var == "Media freedom" ~ "      Media freedom",
                                     var == "Corruption" ~ "      Corruption"),
               color = case_when(var == "Rule of law" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Civil society" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Media demand" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Media freedom" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Corruption" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Rule of law" ~ 1,
                                           var == "Civil society" ~ 2,
                                           var == "Media demand" ~ 3,
                                           var == "Media freedom" ~ 4,
                                           var == "Corruption" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_macedonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           labels = label_number(accuracy = .2)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_macedonia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_macedonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_c_and_selected_sub_obj_from_obj_1_and_obj_2_macedonia_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_levels_ee_patch_bar_chart ####

# inspect

# obj level
level_plot <- fmir %>% filter(year == 2020,
                              mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>% 
        group_by(obj_num) %>% mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        arrange(obj_avg_mean) %>%
        rename(values = obj_avg_mean) %>%
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = obj_num, .x = values, .desc = FALSE), y = values)) +
        geom_col()

level_plot

# obj change from 2010 to 2020
diff_plot <- fmir %>% filter(year == 2010 | year == 2020,
                             mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        group_by(obj_num) %>%
        mutate(obj_diff_avg = mean(diff)) %>%
        ungroup() %>%
        arrange(obj_num) %>%
        distinct(obj_num, year, obj_diff_avg) %>%
        arrange(obj_diff_avg) %>%
        rename(values = obj_diff_avg) %>%
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = obj_num, .x = values, .desc = FALSE), y = values)) + geom_col()

diff_plot

# combined
level_plot + diff_plot + plot_layout(widths = unit(c(8, 8), units = "cm"), heights = unit(c(5, 5), units = "cm"))


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(year == 2020,
                              mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>% 
        group_by(obj_num) %>% mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        arrange(obj_avg_mean) %>%
        mutate(values = obj_avg_mean) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(2) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic" ~ 1,
                                           color_bin == "Information" ~ 2,
                                           color_bin == "Energy" ~ 3,
                                           color_bin == "Economic" ~ 4,
                                           color_bin == "Corruption" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
obj_levels_ee_patch_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = color_bin, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) + 
        geom_col(position = "dodge", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = 0, to = .5, by = .1),
                           limits = c(0, .51),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Score (higher is better)", 
             title = "Dimension average score (2020)",
             caption = NULL, fill = "") +
        coord_fixed(ratio = 9 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_levels_ee_patch_bar_chart



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_diff_ee_patch_bar_chart ####

# inspect

# obj level
level_plot <- fmir %>% filter(year == 2020,
                              mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>% 
        group_by(obj_num) %>% mutate(obj_avg_mean = mean(obj_avg, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(obj_num, year, obj_avg_mean) %>%
        arrange(obj_avg_mean) %>%
        rename(values = obj_avg_mean) %>%
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = obj_num, .x = values, .desc = FALSE), y = values)) +
        geom_col()

level_plot

# obj change from 2010 to 2020
diff_plot <- fmir %>% filter(year == 2010 | year == 2020,
                             mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        group_by(obj_num) %>%
        mutate(obj_diff_avg = mean(diff)) %>%
        ungroup() %>%
        arrange(obj_num) %>%
        distinct(obj_num, year, obj_diff_avg) %>%
        arrange(obj_diff_avg) %>%
        rename(values = obj_diff_avg) %>%
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = obj_num, .x = values, .desc = FALSE), y = values)) + geom_col()

diff_plot

# combined
level_plot + diff_plot + plot_layout(widths = unit(c(8, 8), units = "cm"), heights = unit(c(5, 5), units = "cm"))


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>% filter(year == 2010 | year == 2020,
                              mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        distinct(country, year, obj_num, obj_avg) %>%
        group_by(country, obj_num) %>%
        arrange(country, obj_num, year) %>%
        mutate(diff = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        filter(year == 2020) %>%
        group_by(obj_num) %>%
        mutate(obj_diff_avg = mean(diff)) %>%
        ungroup() %>%
        arrange(obj_num) %>%
        distinct(obj_num, year, obj_diff_avg) %>%
        arrange(obj_diff_avg) %>%
        rename(values = obj_diff_avg) %>%
        mutate(color_bin = case_when(obj_num == "obj_1" ~ "Democratic",
                                     obj_num == "obj_2" ~ "Information",
                                     obj_num == "obj_3" ~ "Energy",
                                     obj_num == "obj_4" ~ "Economic",
                                     obj_num == "obj_c" ~ "Corruption"),
               color = case_when(color_bin == "Democratic" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Information" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Energy" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Economic" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Corruption" ~ color_palette %>% slice(2) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "Democratic" ~ 1,
                                           color_bin == "Information" ~ 2,
                                           color_bin == "Energy" ~ 3,
                                           color_bin == "Economic" ~ 4,
                                           color_bin == "Corruption" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = TRUE))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color)

names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% 
        arrange(color_bin_order) %>%
        pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
obj_diff_ee_patch_bar_chart <- chart_data %>% 
        ggplot(data = ., aes(x = fct_reorder(.f = color_bin, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) + 
        geom_col(position = "dodge", width = .75) + 
        scale_fill_manual(values = chart_data_color_list) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_continuous(breaks = seq(from = -.02, to = .03, by = .01),
                           limits = c(-.02, .03),
                           expand = c(0, 0),
                           labels = label_number(accuracy = .01)) +
        labs(x = NULL, y = "Change in score\n(higher is better)", 
             title = "Change in dimension average (2010-2020)",
             caption = NULL, fill = "") +
        coord_fixed(ratio = 90 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 2, 0, 2), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))

# inspect
obj_diff_ee_patch_bar_chart


#//////////////////////////////////


# combine patches to get obj_levels_and_diff_patch_bar_chart ####
obj_levels_and_diff_patch_bar_chart <- (obj_levels_ee_patch_bar_chart + theme(plot.margin = unit(c(0, 50, 0, 0), "pt"))) + 
        obj_diff_ee_patch_bar_chart

# inspect
obj_levels_and_diff_patch_bar_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_levels_and_diff_patch_bar_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_levels_and_diff_patch_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# load vibe data ####

# for reference, the new VIBE dataset will replace MSI, but VIBE only has 2021 data
# below is the crosswalk of old MSI dimensions to new VICE dimensions from VIBE's report (also in methodology section on dashboard)
# https://vibe.irex.org/
# https://www.irex.org/sites/default/files/pdf/vibrant-information-barometer-2021.pdf
# MSI Overall scores - VIBE Overall scores
# Freedom of Speech - VIBE Principle 2 (Multiple Channels - How Info Flows)
# Professional Journalism - VIBE Principle 1 (Information Quality)
# Plurality of News - VIBE Indicator 4 (The body of content overall is inclusive and diverse.)
# Business Management - VIBE Indicator 5 (Content production is sufficiently resourced.)
# Supporting Institutions - no direct mapping (Supporting Institutions indicators are spread across VIBE Indicators)
# VIBE Principal 3 (Info Consumption and Engagement) has no MSI corollary
# VIBE Principal 4 (Transformative Action) has no MSI corollary

# note that shannon mcguire confirmed that the year variable listed in MSI and VIBE data is "report year", 
# and data refer to prior year; see email from shannon Feb 14, 2022, 4:25 PM

# note that MSI scoring ranges from 0 to 4; VIBE scoring ranges from 0 to 40
# will multiply MSI 0-4 scores by 10 to convert to VIBE 0-40 scale 
# https://www.irex.org/sites/default/files/pdf/media-sustainability-index-europe-eurasia-2019-full.pdf
# https://vibe.irex.org/


# get vibe

# data year 2020
vibe_2020 <- read_excel(path = "data/irex_msi/vibe-scores-2021.xlsx", 
                        sheet = "VIBE 2021", skip = 1) %>%
        rename(country_name = "...1") %>%
        filter(country_name != "Country Name") %>%
        select(-matches(match = "^\\.\\.\\.")) %>%
        pivot_longer(-c(country_name), names_to = "indicator_name", values_to = "values") %>%
        mutate(report_year = 2021,
               year = 2020,
               values = as.numeric(values),
               high_value_is_good_outcome_flag = 1,
               country_name = case_when(country_name == "Bosnia and Herzegovina" ~ "BiH",
                                        country_name == "Macedonia" ~ "N. Macedonia",
                                        country_name == "North Macedonia" ~ "N. Macedonia",
                                        country_name == "Kazahkstan" ~ "Kazakhstan",
                                        TRUE ~ country_name)) %>%
        select(country_name, year, report_year, indicator_name, values, high_value_is_good_outcome_flag)

# data year 2021
vibe_2021 <- read_excel(path = "data/irex_msi/vibe-scores-2021 - 2022 final.xlsx", 
                        sheet = "VIBE 2022", skip = 1) %>%
        rename(country_name = "...1") %>%
        filter(country_name != "Country Name") %>%
        select(-matches(match = "^\\.\\.\\.")) %>%
        pivot_longer(-c(country_name), names_to = "indicator_name", values_to = "values") %>%
        mutate(report_year = 2022,
               year = 2021,
               values = as.numeric(values),
               high_value_is_good_outcome_flag = 1,
               country_name = case_when(country_name == "Bosnia and Herzegovina" ~ "BiH",
                                        country_name == "Macedonia" ~ "N. Macedonia",
                                        country_name == "North Macedonia" ~ "N. Macedonia",
                                        country_name == "Kazahkstan" ~ "Kazakhstan",
                                        TRUE ~ country_name)) %>%
        select(country_name, year, report_year, indicator_name, values, high_value_is_good_outcome_flag)

# combine 
vibe <- vibe_2020 %>%
        bind_rows(., vibe_2021)


#///////////////////////


# inspect
# note msi has 20 countries for 2001-2007, then 21 countries for 2008-2019
vibe
vibe %>% glimpse()
vibe %>% nrow() # 775
vibe %>% ncol() # 6

# note that vibe 2021 includes the CARs, but 2020 does not
# note that vibe only includes 1 graduate (montenegro)
vibe %>% filter(year == 2020) %>% count(country_name) %>% print(n = nrow(.))
vibe %>% filter(year == 2021) %>% count(country_name) %>% print(n = nrow(.))
vibe %>% filter(year == 2021, !(country_name %in% c(vibe %>% filter(year == 2020) %>% distinct(country_name) %>% pull(country_name)))) %>% 
        count(country_name) %>% print(n = nrow(.))

vibe %>% count(indicator_name) %>% print(n = nrow(.))
vibe %>% filter(indicator_name == "Overall") %>% arrange(desc(values)) %>% print(n = nrow(.))
vibe %>% arrange(values) %>% distinct(country_name)
vibe %>% skim()

# inspect country names
vibe %>% anti_join(., country_crosswalk, by = c("country_name" = "country")) %>% 
        distinct(country_name) %>% arrange(country_name)
vibe %>% 
        filter(str_detect(string = country_name, pattern = regex("yemen", ignore_case = TRUE))) %>%
        distinct(country_name)
country_crosswalk %>% filter(str_detect(string = country, pattern = regex("gamb", ignore_case = TRUE))) %>% select(country)


#/////////////////////////////////////////////////////////////////////////////////////////////////////////////


# join country_crosswalk and fmir_framework
vibe <- vibe %>% 
        rename(country = country_name) %>%
        left_join(., country_crosswalk %>% filter(ee_region_flag == 1 | country == "U.S."), ., 
                  by = c("country")) 


#/////////////////


# inspect
vibe
vibe %>% glimpse()
vibe %>% nrow() # 775
vibe %>% ncol() # 19

# check country/year
vibe %>% count(country) %>% print(n = nrow(.))
vibe %>% distinct(country) %>% nrow() # 18
vibe %>% count(year)
vibe %>% distinct(country, mcp_grouping, ee_region_flag) %>% arrange(mcp_grouping) %>% print(n = nrow(.))


#//////////////////////


# test values

test_vibe_values <- function() {
        
        expect_equal(vibe %>% filter(year == 2020, country == "Armenia", indicator_name == "Overall") %>%
                             pull(values),
                     expected = 23)
        
        expect_equal(vibe %>% filter(year == 2021, country == "Albania", indicator_name == "Overall") %>%
                             pull(values),
                     expected = 22)
        
        expect_equal(vibe %>% filter(year == 2020, country == "Kosovo", indicator_name == "Indicator 3") %>%
                             pull(values),
                     expected = 22)
        
        expect_equal(vibe %>% filter(year == 2021, country == "Tajikistan", indicator_name == "Indicator 10") %>%
                             pull(values),
                     expected = 10)
}

test_vibe_values()


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# vibe_princ_1_info_quality_indic_2_misinfo_bar_chart ####

# plot
vibe %>%
        filter(year == 2021, 
               indicator_name == "Indicator 2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- vibe %>% 
        filter(year == 2021, 
               indicator_name == "Indicator 2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

vibe_princ_1_info_quality_indic_2_misinfo_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = 25, by = 5),
                limits = c(0, 25),
                expand = c(0, 0),
                labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = .3 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
vibe_princ_1_info_quality_indic_2_misinfo_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(vibe_princ_1_info_quality_indic_2_misinfo_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/vibe_princ_1_info_quality_indic_2_misinfo_bar_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# vibe_princ_1_info_quality_indic_3_malinfo_bar_chart ####

# plot
vibe %>%
        filter(year == 2021, 
               indicator_name == "Indicator 3",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- vibe %>% 
        filter(year == 2021, 
               indicator_name == "Indicator 3",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

vibe_princ_1_info_quality_indic_3_malinfo_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = 25, by = 5),
                limits = c(0, 25),
                expand = c(0, 0),
                labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = .3 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
vibe_princ_1_info_quality_indic_3_malinfo_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(vibe_princ_1_info_quality_indic_3_malinfo_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/vibe_princ_1_info_quality_indic_3_malinfo_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# get eu_indicator_avg for radar_charts ####

# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_indicator_avg <- fmir %>% filter(mcp_grouping == "EU-15", year == 2021) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(country, indicator_name) %>% 
        group_by(indicator_name, year) %>%
        arrange(indicator_name, year) %>%
        mutate(indicator_avg_for_eu = mean(indicator_standardized_values, na.rm = TRUE)) %>%
        slice(1) %>% 
        ungroup() %>% select(-c(country, indicator_standardized_values)) 


#//////////////////////


# inspect
eu_indicator_avg
eu_indicator_avg %>% nrow() # 69
eu_indicator_avg %>% ncol() # 3

# test eu_obj_avg
test_eu_indicator_avg <- function() {
        
        expect_equal(object = eu_indicator_avg %>% filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically", 
                                                          year == 2021) %>% pull(indicator_avg_for_eu),
                     expected = fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically", 
                                                year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, indicator_name, indicator_standardized_values) %>% 
                             summarize(indicator_avg_for_eu = mean(indicator_standardized_values, na.rm = TRUE)) %>% pull(indicator_avg_for_eu)) 
        
        expect_equal(object = eu_indicator_avg %>% filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically", 
                                                          year == 2021) %>% pull(indicator_avg_for_eu),
                     expected = fmir %>% filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically", 
                                                year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, indicator_name, indicator_standardized_values) %>% 
                             summarize(indicator_avg_for_eu = mean(indicator_standardized_values, na.rm = TRUE)) %>% pull(indicator_avg_for_eu))
        
        expect_equal(object = eu_indicator_avg %>% filter(indicator_name == "sub_obj_2_1_icews_russian_state_media_focus", 
                                                          year == 2021) %>% pull(indicator_avg_for_eu),
                     expected = fmir %>% filter(indicator_name == "sub_obj_2_1_icews_russian_state_media_focus", 
                                                year == 2021, mcp_grouping == "EU-15") %>% 
                             distinct(country, year, indicator_name, indicator_standardized_values) %>% 
                             summarize(indicator_avg_for_eu = mean(indicator_standardized_values, na.rm = TRUE)) %>% pull(indicator_avg_for_eu))
}
test_eu_indicator_avg()


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# note that for radar charts, if chart is single country, adjust radarchart() to have cex = 1 
# in both the default argument at the top of function, and also in the legend() call at the bottom of function
# if radar charts will be faceted by ee region, then set both these cex values to 1.5

# note for facet chart, the emf is cropped tight in word, pasted into ee_balkans_and_eurasia_obj_facet_radar_chart, 
# then lock aspect ratio and resize to 60%; once all countries added, group and save as EMF; 
# emf then added to main deck and resized to 183% w/ center alignment


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_albania ####


# get current_country
current_country <- "Albania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_albania_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_bih ####


# get current_country
current_country <- "BiH"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_bih_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_kosovo ####


# get current_country
current_country <- "Kosovo"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_kosovo_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_macedonia ####


# get current_country
current_country <- "N. Macedonia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_macedonia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                              str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_serbia ####


# get current_country
current_country <- "Serbia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_serbia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_armenia ####


# get current_country
current_country <- "Armenia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_armenia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_azerbaijan ####


# get current_country
current_country <- "Azerbaijan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_azerbaijan_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                               str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_belarus ####


# get current_country
current_country <- "Belarus"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_belarus_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_georgia ####


# get current_country
current_country <- "Georgia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_georgia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_moldova ####


# get current_country
current_country <- "Moldova"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_moldova_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_ukraine ####


# get current_country
current_country <- "Ukraine"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_ukraine_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_bulgaria ####


# get current_country
current_country <- "Bulgaria"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_bulgaria_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                             str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_croatia ####


# get current_country
current_country <- "Croatia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_croatia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_czechia ####


# get current_country
current_country <- "Czechia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_czechia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_estonia ####


# get current_country
current_country <- "Estonia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_estonia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_hungary ####


# get current_country
current_country <- "Hungary"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_hungary_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_latvia ####


# get current_country
current_country <- "Latvia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_latvia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_lithuania ####


# get current_country
current_country <- "Lithuania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_lithuania_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                              str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_montenegro ####


# get current_country
current_country <- "Montenegro"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_montenegro_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                               str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_poland ####


# get current_country
current_country <- "Poland"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_poland_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_romania ####


# get current_country
current_country <- "Romania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_romania_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                            str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_slovakia ####


# get current_country
current_country <- "Slovakia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_slovakia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                             str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_patch_radar_chart_slovenia ####


# get current_country
current_country <- "Slovenia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        left_join(., eu_indicator_avg %>% select(-year), by = "indicator_name") %>%
        mutate(gap = (indicator_standardized_values - indicator_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically" ~ str_c("Gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" ~ str_c("Pol. party\nfalse info \n(", round_to_digits(gap, digits = 2), ")      "),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" ~ str_c("For. gov. false info (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising" ~ str_c("            For. gov. ads (", round_to_digits(gap, digits = 2), ")"),
                                 indicator_name == "sub_obj_2_1_icews_russian_state_media_focus" ~ str_c("  Russian media\n    (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_indicator
current_country_indicator <- fmir %>% filter(country == current_country, year == 2021,
                                             indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                                   "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                                   "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                                   "sub_obj_2_1_icews_russian_state_media_focus")) %>% 
        distinct(country, year, indicator_name, indicator_standardized_values) %>%
        arrange(indicator_name) %>%
        select(indicator_name, indicator_standardized_values) %>%
        pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = indicator_standardized_values)

current_country_indicator

# get chart_data
chart_data <- tibble("sub_obj_2_1_vdem_gov_dissem_false_info_domestically" = c(1, 0), 
                     "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_dissem_false_info" = c(1, 0),
                     "sub_obj_2_1_vdem_foreign_gov_advertising" = c(1, 0),
                     "sub_obj_2_1_icews_russian_state_media_focus" = c(1, 0)) %>%
        bind_rows(., eu_indicator_avg %>% 
                          filter(indicator_name %in% c("sub_obj_2_1_vdem_gov_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically",
                                                       "sub_obj_2_1_vdem_foreign_gov_dissem_false_info",
                                                       "sub_obj_2_1_vdem_foreign_gov_advertising",
                                                       "sub_obj_2_1_icews_russian_state_media_focus")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = indicator_name, values_from = "indicator_avg_for_eu")) %>%
        bind_rows(., current_country_indicator) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(indicator_name, label), by = c("var" = "indicator_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/indicator_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
indicator_patch_radar_chart_slovenia_png <- image_read(str_c("output/charts/indicator_patch_radar_chart_", 
                                                             str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_chart_balkans ####


# get indicator_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


indicator_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_charts
indicator_patch_radar_chart_balkans <- ggdraw(indicator_patch_radar_chart_layout) + 
        draw_image(indicator_patch_radar_chart_albania_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_bih_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_kosovo_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_macedonia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_serbia_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) 


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(indicator_patch_radar_chart_balkans)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/indicator_patch_radar_chart_balkans.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_chart_eurasia ####


# get indicator_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


indicator_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_charts
indicator_patch_radar_chart_eurasia <- ggdraw(indicator_patch_radar_chart_layout) + 
        draw_image(indicator_patch_radar_chart_armenia_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_azerbaijan_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_belarus_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_georgia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_moldova_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_ukraine_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3)


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(indicator_patch_radar_chart_eurasia)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/indicator_patch_radar_chart_eurasia.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_chart_graduates_part_1 ####


# get indicator_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


indicator_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_charts
indicator_patch_radar_chart_graduates_part_1 <- ggdraw(indicator_patch_radar_chart_layout) + 
        draw_image(indicator_patch_radar_chart_bulgaria_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_croatia_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_czechia_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_estonia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_hungary_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_latvia_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3)


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(indicator_patch_radar_chart_graduates_part_1)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/indicator_patch_radar_chart_graduates_part_1.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_chart_graduates_part_2 ####


# get indicator_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


indicator_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_charts
indicator_patch_radar_chart_graduates_part_2 <- ggdraw(indicator_patch_radar_chart_layout) + 
        draw_image(indicator_patch_radar_chart_lithuania_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_montenegro_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_poland_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_romania_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_slovakia_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_slovenia_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3)


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(indicator_patch_radar_chart_graduates_part_2)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/indicator_patch_radar_chart_graduates_part_2.docx"))


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_bar_chart ####

# plot
fmir %>%
        filter(year == 2021, 
               obj_num == "obj_2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, obj_avg) %>%
        rename(values = obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>%
        filter(year == 2021, 
               obj_num == "obj_2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, obj_avg) %>%
        rename(values = obj_avg) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

obj_2_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = .8, by = .2),
                limits = c(0, .8),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_2_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_diff_bar_chart ####

# plot
fmir %>%
        filter(year %in% c(2010, 2021), 
               obj_num == "obj_2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, obj_avg) %>%
        arrange(country, year) %>%
        group_by(country) %>%
        mutate(diff_obj_avg = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        rename(values = diff_obj_avg) %>%
        filter(year == 2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>%
        filter(year %in% c(2010, 2021), 
               obj_num == "obj_2",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, obj_avg) %>%
        arrange(country, year) %>%
        group_by(country) %>%
        mutate(diff_obj_avg = obj_avg - lag(obj_avg, n = 1)) %>%
        ungroup() %>%
        rename(values = diff_obj_avg) %>%
        filter(year == 2021) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

obj_2_diff_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -.3, to = .2, by = .1),
                limits = c(-.3, .2),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 25 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_2_diff_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_diff_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/obj_2_diff_bar_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_balkans_patch_line_chart ####

fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_2_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_eurasia_patch_line_chart ####

fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(obj_num == "obj_2") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, obj_num, obj_avg) %>%
        select(country, mcp_grouping, year, obj_num, obj_avg) %>%
        rename(var = country, values = obj_avg) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Georgia" ~ 4,
                                           var == "Moldova" ~ 5,
                                           var == "Ukraine" ~ 6),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
obj_2_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
obj_2_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get obj_2_patch_line_chart ####

obj_2_patch_line_chart <- obj_2_balkans_patch_line_chart + 
        # plot_spacer() +
        obj_2_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
obj_2_patch_line_chart 


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_2_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/obj_2_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_bar_chart ####

# plot
fmir %>%
        filter(year == 2021, 
               sub_obj_num == "sub_obj_2_1",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>%
        filter(year == 2021, 
               sub_obj_num == "sub_obj_2_1",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        rename(values = sub_obj_avg) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

sub_obj_2_1_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = .8, by = .2),
                limits = c(0, .8),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_diff_bar_chart ####

# plot
fmir %>%
        filter(year %in% c(2010, 2021), 
               sub_obj_num == "sub_obj_2_1",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        arrange(country, year) %>%
        group_by(country) %>%
        mutate(diff_sub_obj_avg = sub_obj_avg - lag(sub_obj_avg, n = 1)) %>%
        ungroup() %>%
        rename(values = diff_sub_obj_avg) %>%
        filter(year == 2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                                       y = values)) +
        geom_col(width = .75) 


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>%
        filter(year %in% c(2010, 2021), 
               sub_obj_num == "sub_obj_2_1",
               mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        distinct(country, mcp_grouping, year, sub_obj_avg) %>%
        arrange(country, year) %>%
        group_by(country) %>%
        mutate(diff_sub_obj_avg = sub_obj_avg - lag(sub_obj_avg, n = 1)) %>%
        ungroup() %>%
        rename(values = diff_sub_obj_avg) %>%
        filter(year == 2021) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

sub_obj_2_1_diff_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -.3, to = .2, by = .1),
                limits = c(-.32, .2),
                expand = c(0, 0),
                labels = label_number(accuracy = .01)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Score\n(higher is better)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 25 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_diff_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_diff_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/sub_obj_2_1_diff_bar_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_balkans_patch_line_chart ####

fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_eurasia_patch_line_chart ####

fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(sub_obj_num == "sub_obj_2_1") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        select(country, mcp_grouping, year, sub_obj_num, sub_obj_avg) %>%
        rename(var = country, values = sub_obj_avg) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Georgia" ~ 4,
                                           var == "Moldova" ~ 5,
                                           var == "Ukraine" ~ 6),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_patch_line_chart ####

sub_obj_2_1_patch_line_chart <- sub_obj_2_1_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_gov_dissem_false_info_domestically_balkans_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_gov_dissem_false_info_domestically_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_gov_dissem_false_info_domestically_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_gov_dissem_false_info_domestically_eurasia_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_gov_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Moldova" ~ 4,
                                           var == "Ukraine" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_gov_dissem_false_info_domestically_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_gov_dissem_false_info_domestically_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_vdem_gov_dissem_false_info_domestically_patch_line_chart ####

sub_obj_2_1_vdem_gov_dissem_false_info_domestically_patch_line_chart <- sub_obj_2_1_vdem_gov_dissem_false_info_domestically_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_vdem_gov_dissem_false_info_domestically_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_vdem_gov_dissem_false_info_domestically_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_vdem_gov_dissem_false_info_domestically_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_vdem_gov_dissem_false_info_domestically_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_balkans_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_eurasia_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Moldova" ~ 4,
                                           var == "Ukraine" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_patch_line_chart ####

sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_patch_line_chart <- sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_vdem_political_parties_dissem_false_info_domestically_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_dissem_false_info") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Moldova" ~ 4,
                                           var == "Ukraine" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .03, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           breaks = seq(from = 0, to = .8, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 17 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_vdem_foreign_gov_dissem_false_info_patch_line_chart ####

sub_obj_2_1_vdem_foreign_gov_dissem_false_info_patch_line_chart <- sub_obj_2_1_vdem_foreign_gov_dissem_false_info_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_vdem_foreign_gov_dissem_false_info_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_vdem_foreign_gov_dissem_false_info_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_vdem_foreign_gov_dissem_false_info_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_vdem_foreign_gov_dissem_false_info_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_foreign_gov_advertising_balkans_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_foreign_gov_advertising_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_foreign_gov_advertising_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_vdem_foreign_gov_advertising_eurasia_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_vdem_foreign_gov_advertising") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Moldova" ~ 4,
                                           var == "Ukraine" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_vdem_foreign_gov_advertising_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_vdem_foreign_gov_advertising_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_vdem_foreign_gov_advertising_patch_line_chart ####

sub_obj_2_1_vdem_foreign_gov_advertising_patch_line_chart <- sub_obj_2_1_vdem_foreign_gov_advertising_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_vdem_foreign_gov_advertising_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_vdem_foreign_gov_advertising_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_vdem_foreign_gov_advertising_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_vdem_foreign_gov_advertising_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_balkans_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Albania" ~ "    Albania",
                                     var == "BiH" ~ "    BiH",
                                     var == "Kosovo" ~ "    Kosovo",
                                     var == "N. Macedonia" ~ "    N. Macedonia",
                                     var == "Serbia" ~ "    Serbia"),
               color = case_when(var == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "Albania" ~ 1,
                                           var == "BiH" ~ 2,
                                           var == "Kosovo" ~ 3,
                                           var == "N. Macedonia" ~ 4,
                                           var == "Serbia" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 22, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_balkans_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_eurasia_patch_line_chart ####

fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Balkans") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)

fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = var)) + geom_line(size = 1)


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- fmir %>%
        filter(indicator_name == "sub_obj_2_1_icews_narratives_pushed_by_russian_state_media") %>%
        filter(mcp_grouping == "E&E Eurasia") %>%
        distinct(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_standardized_values) %>%
        rename(var = country, values = indicator_standardized_values) %>%
        mutate(label = var,
               color_bin = case_when(var == "Armenia" ~ "    Armenia",
                                     var == "Azerbaijan" ~ "    Azerbaijan",
                                     var == "Belarus" ~ "    Belarus",
                                     var == "Georgia" ~ "    Georgia",
                                     var == "Moldova" ~ "    Moldova",
                                     var == "Ukraine" ~ "    Ukraine"),
               color = case_when(var == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               color_bin_order = case_when(var == "Armenia" ~ 1,
                                           var == "Azerbaijan" ~ 2,
                                           var == "Belarus" ~ 3,
                                           var == "Moldova" ~ 4,
                                           var == "Ukraine" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04, label_var = var)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2.3, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           breaks = seq(from = 0, to = 1, by = .2),
                           labels = label_number(accuracy = .01)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2), 
                           expand = c(.02, .02)) +
        labs(x = NULL, y = "Score (higher is better)", title = "E&E Eurasia", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_eurasia_patch_line_chart


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches to get sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_patch_line_chart ####

sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_patch_line_chart <- sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_balkans_patch_line_chart + 
        # plot_spacer() +
        sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_eurasia_patch_line_chart 
# plot_layout(nrow = 1, widths = c(4, 0, 4))


# inspect
sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_patch_line_chart


#//////////////////////////////////


# resize to 185%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/sub_obj_2_1_icews_narratives_pushed_by_russian_state_media_patch_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# get eu_sub_obj_avg for radar_charts ####

# note that the only NA obj_avg for EU is luxembourg for obj_3 in 2018
eu_sub_obj_avg <- fmir %>% filter(mcp_grouping == "EU-15", year == 2021) %>%
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(country, sub_obj_short_name) %>%
        group_by(sub_obj_short_name, year) %>%
        arrange(sub_obj_short_name, year) %>%
        mutate(sub_obj_avg_for_eu = mean(sub_obj_avg, na.rm = TRUE)) %>%
        slice(1) %>%
        ungroup() %>% select(-c(country, sub_obj_avg))


#//////////////////////


# inspect
eu_sub_obj_avg
eu_sub_obj_avg %>% nrow() # 12
eu_sub_obj_avg %>% ncol() # 3

# test eu_obj_avg
test_eu_sub_obj_avg <- function() {
        
        expect_equal(object = eu_sub_obj_avg %>% filter(sub_obj_short_name == "Civil society",
                                                        year == 2021) %>% pull(sub_obj_avg_for_eu),
                     expected = fmir %>% filter(sub_obj_short_name == "Civil society",
                                                year == 2021, mcp_grouping == "EU-15") %>%
                             distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
                             summarize(sub_obj_avg_for_eu = mean(sub_obj_avg, na.rm = TRUE)) %>% pull(sub_obj_avg_for_eu))
        
        expect_equal(object = eu_sub_obj_avg %>% filter(sub_obj_short_name == "Trust in media",
                                                        year == 2021) %>% pull(sub_obj_avg_for_eu),
                     expected = fmir %>% filter(sub_obj_short_name == "Trust in media",
                                                year == 2021, mcp_grouping == "EU-15") %>%
                             distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
                             summarize(sub_obj_avg_for_eu = mean(sub_obj_avg, na.rm = TRUE)) %>% pull(sub_obj_avg_for_eu))
        
        expect_equal(object = eu_sub_obj_avg %>% filter(sub_obj_short_name == "Economic competitiveness",
                                                        year == 2021) %>% pull(sub_obj_avg_for_eu),
                     expected = fmir %>% filter(sub_obj_short_name == "Economic competitiveness",
                                                year == 2021, mcp_grouping == "EU-15") %>%
                             distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
                             summarize(sub_obj_avg_for_eu = mean(sub_obj_avg, na.rm = TRUE)) %>% pull(sub_obj_avg_for_eu))
}
test_eu_sub_obj_avg()


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# note that for radar charts, if chart is single country, adjust radarchart() to have cex = 1 
# in both the default argument at the top of function, and also in the legend() call at the bottom of function
# if radar charts will be faceted by ee region, then set both these cex values to 1.5

# note for facet chart, the emf is cropped tight in word, pasted into ee_balkans_and_eurasia_obj_facet_radar_chart, 
# then lock aspect ratio and resize to 60%; once all countries added, group and save as EMF; 
# emf then added to main deck and resized to 183% w/ center alignment


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_albania ####


# get current_country
current_country <- "Albania"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_albania_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_bih ####


# get current_country
current_country <- "BiH"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_bih_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                    str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_kosovo ####


# get current_country
current_country <- "Kosovo"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_kosovo_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                       str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_macedonia ####


# get current_country
current_country <- "N. Macedonia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_macedonia_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                          str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_serbia ####


# get current_country
current_country <- "Serbia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_serbia_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                       str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_armenia ####


# get current_country
current_country <- "Armenia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_armenia_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_azerbaijan ####


# get current_country
current_country <- "Azerbaijan"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_azerbaijan_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                           str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_belarus ####


# get current_country
current_country <- "Belarus"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_belarus_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_georgia ####


# get current_country
current_country <- "Georgia"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_georgia_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_moldova ####


# get current_country
current_country <- "Moldova"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_moldova_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////////////


# obj_2_patch_radar_chart_ukraine ####


# get current_country
current_country <- "Ukraine"

# get gap_label_tbl
gap_label_tbl <- fmir %>% filter(country == current_country, 
                                 year == 2021,
                                 sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
        distinct(country, mcp_grouping, year, sub_obj_short_name, sub_obj_avg) %>%
        left_join(., eu_sub_obj_avg %>% select(-year), by = "sub_obj_short_name") %>%
        mutate(gap = (sub_obj_avg - sub_obj_avg_for_eu) * -1,
               largest_gap_flag = case_when(gap == max(gap) ~ 1, 
                                            TRUE ~ 0),
               label = case_when(sub_obj_short_name == "Trust in media" ~ str_c("Trust in media (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media demand" ~ str_c("            Media demand (", round_to_digits(gap, digits = 2), ")"),
                                 sub_obj_short_name == "Media freedom" ~ str_c("Media freedom (", round_to_digits(gap, digits = 2), ")")))

# inspect
gap_label_tbl 

# get current_country_sub_obj
current_country_sub_obj <- fmir %>% filter(country == current_country, year == 2021,
                                           sub_obj_short_name %in% c("Trust in media",
                                                                     "Media demand",
                                                                     "Media freedom")) %>% 
        distinct(country, year, sub_obj_short_name, sub_obj_avg) %>%
        arrange(sub_obj_short_name) %>%
        select(sub_obj_short_name, sub_obj_avg) %>%
        pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = sub_obj_avg)

current_country_sub_obj 

# get chart_data
chart_data <- tibble("Trust in media" = c(1, 0), 
                     "Media demand" = c(1, 0),
                     "Media freedom" = c(1, 0)) %>%
        bind_rows(., eu_sub_obj_avg %>% 
                          filter(sub_obj_short_name %in% c("Trust in media",
                                                           "Media demand",
                                                           "Media freedom")) %>%
                          select(-year) %>% 
                          pivot_wider(id_cols = NULL, names_from = sub_obj_short_name, values_from = "sub_obj_avg_for_eu")) %>%
        bind_rows(., current_country_sub_obj) %>%
        mutate(record_name = c("axis_max", "axis_min", "eu", "country")) %>%
        pivot_longer(cols = -record_name, names_to = "var", values_to = "values") %>%
        left_join(., gap_label_tbl %>% select(sub_obj_short_name, label), by = c("var" = "sub_obj_short_name")) %>%
        select(-var) %>%
        pivot_wider(id_cols = record_name, names_from = label, values_from = values) %>%
        select(-record_name)

# inspect
chart_data


#///////////////////////////////////////////////////////////////////////////////////////////////////


# save plot as png
png(filename = str_c("output/charts/obj_2_patch_radar_chart_", str_to_lower(current_country), ".png"),
    width = 12, height = 8, units = "in", res = 300)
get_patch_radar_chart(df = chart_data, country = current_country)
dev.off()

# load png, crop, and resave as png
# image_read(str_c("output/charts/obj_patch_radar_chart_",
#                  str_to_lower(current_country), ".png")) %>% image_info() # w = 3600, h = 2400 (res/dpi * height/width)
obj_2_patch_radar_chart_ukraine_png <- image_read(str_c("output/charts/obj_2_patch_radar_chart_", 
                                                        str_to_lower(current_country), ".png")) %>%
        image_crop(image = ., geometry = geometry_area(width = 2320, height = 1700, x_off = 775, y_off = 250)) 


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_2_patch_radar_chart_balkans ####


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_balkans <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_2_patch_radar_chart_albania_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_bih_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_kosovo_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_macedonia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_serbia_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) 


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_balkans)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_2_patch_radar_chart_balkans.docx"))


#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_2_patch_radar_chart_eurasia ####


# get obj_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
# plot(layout)


obj_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer(),
                                           plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine obj_patch_radar_charts
obj_patch_radar_chart_eurasia <- ggdraw(obj_patch_radar_chart_layout) + 
        draw_image(obj_2_patch_radar_chart_armenia_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_azerbaijan_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_belarus_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_georgia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_moldova_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(obj_2_patch_radar_chart_ukraine_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3)


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(obj_patch_radar_chart_eurasia)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/obj_2_patch_radar_chart_eurasia.docx"))



#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////
#///////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_chart_eurasia ####


# get indicator_patch_radar_chart_layout
plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


indicator_patch_radar_chart_layout <- wrap_plots(plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer(),
                                                 plot_spacer()) +        
        plot_layout(design = layout)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine indicator_patch_radar_charts
indicator_patch_radar_chart_eurasia <- ggdraw(indicator_patch_radar_chart_layout) + 
        draw_image(indicator_patch_radar_chart_armenia_png, x = .15, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_azerbaijan_png, x = .5, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_belarus_png, x = .85, y = .7, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_georgia_png, x = .15, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_moldova_png, x = .5, y = .45, hjust = .5, vjust = .5, width = .3, height = .3) +
        draw_image(indicator_patch_radar_chart_ukraine_png, x = .85, y = .45, hjust = .5, vjust = .5, width = .3, height = .3)


#///////////////////////////////////////////////////////////////////////////////////////////////////


# note: resize emf in word to 175%, then copy/paste into powerpoint

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(indicator_patch_radar_chart_eurasia)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = str_c("output/charts/indicator_patch_radar_chart_eurasia.docx"))






