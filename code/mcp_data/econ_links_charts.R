extrafont::loadfonts(device="win") 
library(tidyverse)
library(readxl)
library(skimr)
library(rlang)
library(haven)
library(fs)
library(officer)
library(devEMF)
library(ggrepel)
library(rvest)
library(scales)
library(testthat)
library(patchwork)
library(vdemdata)
library(naniar)
library(corrr)
library(GGally)
library(Polychrome)
library(viridis)
library(bazar)
library(treemapify)
library(openxlsx)



# setwd
setwd("C:/Users/sdevine/Desktop/usaid/mcp/economic_data")
options(scipen = 999)


#//////////////////////////////////////////////////////////////////////////////////////////////////////


# create custom color_palette ####
color_palette <- tibble(hex = c("#083D7F", "#2474B6", "#8BBFD0",
                                "#CBCBCB", "#7D7D7D",
                                "#99ba78", "#35B779FF", "#006629", 
                                "#E4DC68", "#FDA159", "#EF6712", "#CE1B1E",
                                "#8B008B", "#DA70D6"))
color_palette
color_palette %>% pull(hex) %>% show_col()

# color_palette supports 11 colors, plus possible extensions via fill/line type
show_col(color_palette %>% slice(1, 3) %>% pull(hex)) # 2 colors
show_col(color_palette %>% slice(1, 2, 3) %>% pull(hex)) # 3 colors
show_col(color_palette %>% slice(1, 2, 3, 4) %>% pull(hex)) # 4 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5) %>% pull(hex)) # 5 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6) %>% pull(hex)) # 6 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7) %>% pull(hex)) # 7 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8) %>% pull(hex)) # 8 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9) %>% pull(hex)) # 9 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) %>% pull(hex)) # 10 colors
show_col(color_palette %>% slice(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11) %>% pull(hex)) # 11 colors


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read country_crosswalk and get country_crosswalk_expanded ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/usaid/mcp/useful_info/country_crosswalk")
country_crosswalk <- read_csv("country_crosswalk.csv")
setwd(current_wd)

# get country_crosswalk_expanded to have a country record for each year
country_crosswalk_expanded <- expand_grid(country = country_crosswalk %>% pull(country), 
                                          year = seq(from = 2001, to = 2021, by = 1)) %>%
        left_join(., country_crosswalk, by = "country")


#/////////////////


# inspect
country_crosswalk_expanded
country_crosswalk_expanded %>% glimpse()
country_crosswalk_expanded %>% count(country) %>% distinct(n)
country_crosswalk_expanded %>% count(year) %>% print(n = nrow(.))

country_crosswalk %>% glimpse()
country_crosswalk %>% print(n = nrow(.))
country_crosswalk %>% skim()
country_crosswalk %>% count(mcp_grouping)


#/////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////


# read round_to_threshold ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
source("round_to_threshold.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read get_label_position ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
source("get_label_position.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read round_to_digits ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
source("round_to_digits.R")
setwd(current_wd)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# read add_group_index ####
current_wd <- getwd()
setwd("C:/Users/sdevine/Desktop/r/assorted_helper_scripts")
source("add_group_index.R")
setwd(current_wd)



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# load econ_links
econ_links <- read_csv(file = "data/economic_exposure_to_russia_and_china/economic_exposure_to_russia_and_china_20220814.csv")

# inspect
econ_links
econ_links %>% glimpse()
econ_links %>% nrow() # 8448
econ_links %>% ncol() # 29

econ_links %>% count(country) # 44
econ_links %>% count(year) # 12
econ_links %>% count(counterpart) # 2
econ_links %>% count(var) # 8
econ_links %>% count(country, year, counterpart, var) %>% arrange(desc(n))

econ_links %>%
        select(country, year, counterpart, var, values) %>%
        count(counterpart, var)


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_ee_facet_bar_chart ####

# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
                total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(year == 2021) %>%
        ggplot(data = ., mapping = aes(x = counterpart, y = values_imputed, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(country), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(year == 2021) %>%
        rename(values_original = values) %>%
        arrange(desc(counterpart), desc(total_econ_exposure_as_share_of_gdp)) %>%
        add_group_index(group_vars = country, group_name = "country_order") %>%
        mutate(country = fct_reorder(.f = country, .x = country_order, .desc = TRUE)) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_ee_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = counterpart, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .9, by = .1), limits = c(0, .9), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 45, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_ee_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_ee_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_ee_facet_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_ee_graduates_facet_bar_chart ####

# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(year == 2021) %>%
        ggplot(data = ., mapping = aes(x = counterpart, y = values_imputed, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(country), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(year == 2021) %>%
        rename(values_original = values) %>%
        arrange(desc(counterpart), desc(total_econ_exposure_as_share_of_gdp)) %>%
        add_group_index(group_vars = country, group_name = "country_order") %>%
        mutate(country = fct_reorder(.f = country, .x = country_order, .desc = TRUE)) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_ee_graduates_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = counterpart, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .25, by = .05), limits = c(0, .25), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 50 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 45, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_ee_graduates_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_ee_graduates_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_ee_graduates_facet_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_cars_facet_bar_chart ####

# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(year == 2021) %>%
        ggplot(data = ., mapping = aes(x = counterpart, y = values_imputed, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(country), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(year == 2021) %>%
        rename(values_original = values) %>%
        arrange(desc(counterpart), desc(total_econ_exposure_as_share_of_gdp)) %>%
        add_group_index(group_vars = country, group_name = "country_order") %>%
        mutate(country = fct_reorder(.f = country, .x = country_order, .desc = TRUE)) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_cars_facet_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = counterpart, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(country), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 45, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 5, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_cars_facet_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_cars_facet_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_cars_facet_bar_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_ee_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        rename(values_original = values) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp) %>%
        mutate(color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
total_econ_exposure_as_share_of_gdp_ee_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 6/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


total_econ_exposure_as_share_of_gdp_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_ee_graduates_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        rename(values_original = values) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp) %>%
        mutate(color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
total_econ_exposure_as_share_of_gdp_ee_graduates_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .4, by = .1), limits = c(0, .4), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 15/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


total_econ_exposure_as_share_of_gdp_ee_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_ee_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_ee_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_cars_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        rename(values_original = values) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp) %>%
        mutate(color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
total_econ_exposure_as_share_of_gdp_cars_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 0, to = .8, by = .1), limits = c(0, .8), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 9/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


total_econ_exposure_as_share_of_gdp_cars_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_cars_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_cars_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_russia_by_var_as_share_of_gdp_ee_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(counterpart == "Russia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(counterpart == "Russia") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_russia_by_var_as_share_of_gdp_ee_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .5, by = .1), limits = c(0, .5), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .5), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 13/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_russia_by_var_as_share_of_gdp_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_russia_by_var_as_share_of_gdp_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_russia_by_var_as_share_of_gdp_ee_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_china_by_var_as_share_of_gdp_ee_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(counterpart == "China") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(counterpart == "China") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_china_by_var_as_share_of_gdp_ee_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .1, by = .02), limits = c(0, .1), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 60/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_china_by_var_as_share_of_gdp_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_china_by_var_as_share_of_gdp_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_china_by_var_as_share_of_gdp_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_russia_by_var_as_share_of_gdp_graduates_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(counterpart == "Russia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(counterpart == "Russia") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_russia_by_var_as_share_of_gdp_graduates_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .25, by = .05), limits = c(0, .25), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .25), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 25 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_russia_by_var_as_share_of_gdp_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_russia_by_var_as_share_of_gdp_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_russia_by_var_as_share_of_gdp_graduates_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_china_by_var_as_share_of_gdp_graduates_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(counterpart == "China") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("E&E graduates")) %>%
        filter(counterpart == "China") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_china_by_var_as_share_of_gdp_graduates_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .2, by = .02), limits = c(0, .2), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .2), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 30/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_china_by_var_as_share_of_gdp_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_china_by_var_as_share_of_gdp_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_china_by_var_as_share_of_gdp_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_russia_by_var_as_share_of_gdp_cars_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(counterpart == "Russia") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(counterpart == "Russia") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_russia_by_var_as_share_of_gdp_cars_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .25, by = .05), limits = c(0, .25), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .5), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 13 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_russia_by_var_as_share_of_gdp_cars_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_russia_by_var_as_share_of_gdp_cars_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_russia_by_var_as_share_of_gdp_cars_facet_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_exposure_to_china_by_var_as_share_of_gdp_cars_facet_chart ####


# plot
econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(counterpart == "China") %>%
        ggplot(data = ., mapping = aes(x = year, y = values_imputed, color = var)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, mcp_grouping, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(mcp_grouping %in% c("CARs")) %>%
        filter(counterpart == "China") %>%
        rename(values_original = values) %>%
        mutate(values = values_imputed) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
econ_exposure_to_china_by_var_as_share_of_gdp_cars_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .2, by = .02), limits = c(0, .2), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, .25), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Economic exposure as % of GDP", x = NULL) +
        coord_fixed(ratio = 30/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "right",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


econ_exposure_to_china_by_var_as_share_of_gdp_cars_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_exposure_to_china_by_var_as_share_of_gdp_cars_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_exposure_to_china_by_var_as_share_of_gdp_cars_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# russian_energy_indicators_ee_facet_chart ####


# plot
fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
               sub_obj_num == "sub_obj_3_2") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = indicator_name)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia"),
               sub_obj_num == "sub_obj_3_2", year <= 2019) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                             "Fossil fuel imports from Russia\nas share of TES",
                                     indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                             "Fossil fuel imports from Russia\nas share of fossil fuel imports",
                                     indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                             "Natural gas imports from Russia\nas share of natural gas imports"),
               color = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                         color_palette %>% slice(1) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                         color_palette %>% slice(2) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                        color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 1,
                                           indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 2,
                                           indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
russian_energy_indicators_ee_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, 1.6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2019, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 3/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


russian_energy_indicators_ee_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(russian_energy_indicators_ee_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/russian_energy_indicators_ee_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# russian_energy_indicators_cars_facet_chart ####


# plot
fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("CARs"),
               sub_obj_num == "sub_obj_3_2") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = indicator_name)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("CARs"),
               sub_obj_num == "sub_obj_3_2", year <= 2019) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                             "Fossil fuel imports from Russia\nas share of TES",
                                     indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                             "Fossil fuel imports from Russia\nas share of fossil fuel imports",
                                     indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                             "Natural gas imports from Russia\nas share of natural gas imports"),
               color = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                         color_palette %>% slice(1) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                         color_palette %>% slice(2) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                         color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 1,
                                           indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 2,
                                           indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
russian_energy_indicators_cars_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2019, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 5/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


russian_energy_indicators_cars_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(russian_energy_indicators_cars_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/russian_energy_indicators_cars_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# russian_energy_indicators_graduates_facet_chart ####


# plot
fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("E&E graduates"),
               sub_obj_num == "sub_obj_3_2") %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = indicator_name)) + 
        geom_line(size = 1) +
        facet_wrap(facets = vars(country))


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- fmir %>% 
        select(country, mcp_grouping, year, sub_obj_num, indicator_name, values, indicator_standardized_values) %>% 
        filter(mcp_grouping %in% c("E&E graduates"),
               sub_obj_num == "sub_obj_3_2", year <= 2019) %>%
        mutate(color_bin = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                             "Fossil fuel imports from Russia\nas share of TES",
                                     indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                             "Fossil fuel imports from Russia\nas share of fossil fuel imports",
                                     indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~
                                             "Natural gas imports from Russia\nas share of natural gas imports"),
               color = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 
                                         color_palette %>% slice(1) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 
                                         color_palette %>% slice(2) %>% pull(hex),
                                 indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 
                                         color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_tes" ~ 1,
                                           indicator_name == "sub_obj_3_2_iea_fossil_fuel_imports_from_russia_as_share_of_total_imports" ~ 2,
                                           indicator_name == "sub_obj_3_2_iea_natural_gas_imports_from_russia_as_share_of_natural_gas_imports" ~ 3),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# plot
russian_energy_indicators_graduates_facet_chart <- chart_data %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = color_bin)) +
        # geom_line(size = 1) +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(limits = c(0, 1.75), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2019, by = 3), expand = c(0,0)) +
        facet_wrap(facets = vars(country)) +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>%
                                           filter(year == min(year)) %>%
                                           slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>%
                                           filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5) +
        geom_line(size = 1) + 
        labs(color = NULL, y = "Percent", x = NULL) +
        coord_fixed(ratio = 3/1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD", size = .25),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_blank(),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                panel.spacing.x = unit(1, "lines"),
                panel.spacing.y = unit(1, "lines"),
                strip.background = element_blank(),
                strip.text = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333"),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#DDDDDD"),
                # axis.ticks.x = element_blank(),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 0, r = 5, b = 0, l = 2)),
                plot.title = element_text(size = 7, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 7, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 7, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                # legend.spacing.x = unit(1.0, 'cm')
                # legend.spacing.y = unit(5.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                legend.key.height = unit(2, "line")
        ) +
        # guides(fill = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333"))
        guides(color = guide_legend(override.aes = list(size = 6)))


russian_energy_indicators_graduates_facet_chart


#//////////////////////////////////


# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(russian_energy_indicators_graduates_facet_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/russian_energy_indicators_graduates_facet_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_albania_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Albania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                                  TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
       
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Albania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_albania_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)
        ) +
        expand_limits(y = c(0, .05)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 35 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_albania_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_albania_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_albania_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_albania_line_chart ####

econ_links %>%
        filter(country == "Albania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Albania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_albania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)), 
                           limits = c(0, .05),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 120 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        # guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_albania_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_albania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_albania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_bih_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "BiH") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "BiH") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_bih_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1), 
                           expand = c(0, 0)
                           ) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        expand_limits(y = c(0, .1)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_bih_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_bih_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_bih_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_bih_line_chart ####

econ_links %>%
        filter(country == "BiH") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "BiH") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_bih_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(.0, .1),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 65 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_bih_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_bih_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_bih_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_belarus_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Belarus") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Belarus") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_belarus_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)
                           ) +
        expand_limits(y = c(0, .8501)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_belarus_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_belarus_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_belarus_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_belarus_line_chart ####

econ_links %>%
        filter(country == "Belarus") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Belarus") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_belarus_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, 1),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_belarus_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_belarus_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_belarus_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_armenia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Armenia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Armenia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_armenia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)
        ) +
        expand_limits(y = c(0, .64)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_armenia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_armenia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_armenia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_armenia_line_chart ####

econ_links %>%
        filter(country == "Armenia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Armenia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_armenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .61),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_armenia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_armenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_armenia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_azerbaijan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Azerbaijan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Azerbaijan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_azerbaijan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)
        ) +
        expand_limits(y = c(0, .1501)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_azerbaijan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_azerbaijan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_azerbaijan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_azerbaijan_line_chart ####

econ_links %>%
        filter(country == "Azerbaijan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Azerbaijan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_azerbaijan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .151),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 35 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_azerbaijan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_azerbaijan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_azerbaijan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_georgia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Georgia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Georgia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_georgia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .16)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_georgia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_georgia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_georgia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_georgia_line_chart ####

econ_links %>%
        filter(country == "georgia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "georgia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_georgia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .151),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 40 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_georgia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_georgia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_georgia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_kosovo_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kosovo") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kosovo") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_kosovo_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .065)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 20 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_kosovo_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_kosovo_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_kosovo_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_kosovo_line_chart ####

econ_links %>%
        filter(country == "Kosovo") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Kosovo") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_kosovo_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .08),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 70 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_kosovo_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_kosovo_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_kosovo_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_moldova_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Moldova") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Moldova") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_moldova_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .45)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 3 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_moldova_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_moldova_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_moldova_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_moldova_line_chart ####

econ_links %>%
        filter(country == "Moldova") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Moldova") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_moldova_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .5),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_moldova_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_moldova_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_moldova_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_macedonia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "N. Macedonia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "N. Macedonia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_macedonia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .12)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_macedonia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_macedonia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_macedonia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_macedonia_line_chart ####

econ_links %>%
        filter(country == "N. Macedonia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "N. Macedonia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_macedonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .151),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 37 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_macedonia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_macedonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_macedonia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_serbia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Serbia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Serbia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_serbia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .151)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 10 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_serbia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_serbia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_serbia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_serbia_line_chart ####

econ_links %>%
        filter(country == "Serbia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Serbia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_serbia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .151),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 40 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_serbia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_serbia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_serbia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_ukraine_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Ukraine") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Ukraine") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_ukraine_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .35)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_ukraine_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_ukraine_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_ukraine_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_ukraine_line_chart ####

econ_links %>%
        filter(country == "Ukraine") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Ukraine") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_ukraine_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .41),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_ukraine_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_ukraine_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_ukraine_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_bulgaria_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Bulgaria") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Bulgaria") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_bulgaria_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .2)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_bulgaria_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_bulgaria_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_bulgaria_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_bulgaria_line_chart ####

econ_links %>%
        filter(country == "Bulgaria") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Bulgaria") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_bulgaria_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .2),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 30 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_bulgaria_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_bulgaria_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_bulgaria_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_croatia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Croatia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Croatia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_croatia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .04)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 35 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_croatia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_croatia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_croatia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_croatia_line_chart ####

econ_links %>%
        filter(country == "Croatia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Croatia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_croatia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .04),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 140 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_croatia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_croatia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_croatia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_czechia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Czechia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Czechia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_czechia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_czechia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_czechia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_czechia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_czechia_line_chart ####

econ_links %>%
        filter(country == "Czechia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Czechia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_czechia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .1),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 60 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_czechia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_czechia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_czechia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_estonia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Estonia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Estonia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_estonia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .2)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_estonia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_estonia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_estonia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_estonia_line_chart ####

econ_links %>%
        filter(country == "Estonia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Estonia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_estonia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .2),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 30 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_estonia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_estonia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_estonia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_hungary_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Hungary") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Hungary") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_hungary_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 14 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_hungary_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_hungary_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_hungary_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_hungary_line_chart ####

econ_links %>%
        filter(country == "Hungary") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Hungary") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_hungary_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .1),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 60 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_hungary_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_hungary_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_hungary_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_latvia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Latvia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Latvia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_latvia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .2)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_latvia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_latvia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_latvia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_latvia_line_chart ####

econ_links %>%
        filter(country == "Latvia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Latvia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_latvia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .2),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 35 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_latvia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_latvia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_latvia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_lithuania_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Lithuania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Lithuania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_lithuania_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .4)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 4 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_lithuania_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_lithuania_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_lithuania_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_lithuania_line_chart ####

econ_links %>%
        filter(country == "Lithuania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Lithuania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_lithuania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .4),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 15 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_lithuania_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_lithuania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_lithuania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_montenegro_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Montenegro") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Montenegro") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_montenegro_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .25)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_montenegro_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_montenegro_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_montenegro_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_montenegro_line_chart ####

econ_links %>%
        filter(country == "Montenegro") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Montenegro") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_montenegro_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .25),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 25 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_montenegro_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_montenegro_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_montenegro_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_poland_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Poland") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Poland") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_poland_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .08)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 20 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_poland_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_poland_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_poland_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_poland_line_chart ####

econ_links %>%
        filter(country == "Poland") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Poland") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_poland_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .08),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 75 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_poland_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_poland_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_poland_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_romania_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Romania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Romania") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_romania_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .03)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 50 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_romania_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_romania_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_romania_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_romania_line_chart ####

econ_links %>%
        filter(country == "Romania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Romania") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_romania_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .04),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 150 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_romania_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_romania_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_romania_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_slovakia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Slovakia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Slovakia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_slovakia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .12)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 12 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_slovakia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_slovakia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_slovakia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_slovakia_line_chart ####

econ_links %>%
        filter(country == "Slovakia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Slovakia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_slovakia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .12),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 50 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_slovakia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_slovakia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_slovakia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_slovenia_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Slovenia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Slovenia") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_slovenia_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .08)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 20 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_slovenia_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_slovenia_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_slovenia_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_slovenia_line_chart ####

econ_links %>%
        filter(country == "Slovenia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Slovenia") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_slovenia_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .151),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 40 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_slovenia_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_slovenia_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_slovenia_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_kazakhstan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kazakhstan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kazakhstan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_kazakhstan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .2)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 7 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_kazakhstan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_kazakhstan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_kazakhstan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_kazakhstan_line_chart ####

econ_links %>%
        filter(country == "Kazakhstan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Kazakhstan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .005)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_kazakhstan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .2),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 30 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_kazakhstan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_kazakhstan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_kazakhstan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_kyrgyzstan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kyrgyzstan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Kyrgyzstan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_kyrgyzstan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .8)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_kyrgyzstan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_kyrgyzstan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_kyrgyzstan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_kyrgyzstan_line_chart ####

econ_links %>%
        filter(country == "Kyrgyzstan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Kyrgyzstan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_kyrgyzstan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_kyrgyzstan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_kyrgyzstan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_kyrgyzstan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_tajikistan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Tajikistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Tajikistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_tajikistan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .8)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 2 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_tajikistan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_tajikistan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_tajikistan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_tajikistan_line_chart ####

econ_links %>%
        filter(country == "Tajikistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Tajikistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_tajikistan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .8),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_tajikistan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_tajikistan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_tajikistan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_turkmenistan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Turkmenistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Turkmenistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_turkmenistan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .3)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 6 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_turkmenistan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_turkmenistan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_turkmenistan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_turkmenistan_line_chart ####

econ_links %>%
        filter(country == "Turkmenistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Turkmenistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_turkmenistan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .5),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 13 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_turkmenistan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_turkmenistan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_turkmenistan_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# econ_links_to_russia_and_china_avg_diff_over_time_uzbekistan_bar_chart ####

# plot
econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Uzbekistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        
        # arrange(country, counterpart, var, year_group) %>% 
        arrange(country, counterpart, year_group) %>%
        # print(n = 100)
        # identity()
        
        filter(!is.na(year_group)) %>%
        ggplot(data = ., mapping = aes(x = year_group, y = values_imputed_year_group_avg, fill = var)) + 
        geom_col(width = .8, position = "stack") +
        facet_wrap(facets = vars(counterpart), nrow = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- econ_links %>% 
        select(country, year, counterpart, var, values, values_imputed, 
               total_econ_exposure_as_share_of_gdp) %>% 
        filter(country == "Uzbekistan") %>%
        mutate(year_group = case_when(year %in% c(2010:2012) ~ "2010-2012\navg.",
                                      year %in% c(2019:2021) ~ "2019-2021\navg.",
                                      TRUE ~ NA_character_)) %>%
        group_by(country, year_group, counterpart, var) %>%
        mutate(values_imputed_year_group_avg = mean(values_imputed, na.rm = TRUE),
               total_econ_exposure_as_share_of_gdp_year_group_avg = mean(total_econ_exposure_as_share_of_gdp, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(country, counterpart, year_group, var, values_imputed_year_group_avg, 
                 total_econ_exposure_as_share_of_gdp_year_group_avg) %>%
        filter(!is.na(year_group)) %>%
        mutate(values = values_imputed_year_group_avg) %>%
        mutate(color_bin = case_when(var == "exports_as_share_of_gdp" ~ "Exports as % of GDP      ",
                                     var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ "Debt owed from counterpart      \nas % of GDP",
                                     var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ "Debt owed to counterpart      \nas % of GDP",
                                     var == "imports_as_share_of_gdp" ~ "Imports as % of GDP      ",
                                     var == "inward_fdi_as_share_of_gdp" ~ "Inward FDI as % of GDP      ",
                                     var == "outward_fdi_as_share_of_gdp" ~ "Outward FDI as % of GDP      ",
                                     var == "remittance_from_counterpart_as_share_of_gdp" ~ "Remittances from counterpart      \nas % of GDP",
                                     var == "remittance_to_counterpart_as_share_of_gdp" ~ "Remittances to counterpart      \nas % of GDP"),
               color = case_when(var == "exports_as_share_of_gdp" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "imports_as_share_of_gdp" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "inward_fdi_as_share_of_gdp" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "outward_fdi_as_share_of_gdp" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(5) %>% pull(hex),
                                 var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(7) %>% pull(hex),
                                 var == "remittance_from_counterpart_as_share_of_gdp" ~ color_palette %>% slice(8) %>% pull(hex),
                                 var == "remittance_to_counterpart_as_share_of_gdp" ~ color_palette %>% slice(9) %>% pull(hex)),
               color_bin_order = case_when(var == "exports_as_share_of_gdp" ~ 1,
                                           var == "imports_as_share_of_gdp" ~ 2,
                                           var == "inward_fdi_as_share_of_gdp" ~ 3,
                                           var == "outward_fdi_as_share_of_gdp" ~ 4,
                                           var == "ext_debt_owed_to_counterpart_as_share_of_gdp" ~ 5,
                                           var == "ext_debt_owed_from_counterpart_as_share_of_gdp" ~ 6,
                                           var == "remittance_from_counterpart_as_share_of_gdp" ~ 7,
                                           var == "remittance_to_counterpart_as_share_of_gdp" ~ 8),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
econ_links_to_russia_and_china_avg_diff_over_time_uzbekistan_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = year_group, 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        facet_wrap(facets = vars(counterpart), nrow = 1) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(labels = label_percent(accuracy = .1),
                           expand = c(0, 0)) +
        expand_limits(y = c(0, .2)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 8 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 0, hjust = .5),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 8, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 8, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 3, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
econ_links_to_russia_and_china_avg_diff_over_time_uzbekistan_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(econ_links_to_russia_and_china_avg_diff_over_time_uzbekistan_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/econ_links_to_russia_and_china_avg_diff_over_time_uzbekistan_bar_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# total_econ_exposure_as_share_of_gdp_uzbekistan_line_chart ####

econ_links %>%
        filter(country == "Uzbekistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        ggplot(data = ., mapping = aes(x = year, y = total_econ_exposure_as_share_of_gdp, color = counterpart)) + geom_line()


#//////////////////


# get chart_data
chart_data <- econ_links %>%
        filter(country == "Uzbekistan") %>%
        select(country, year, counterpart, var, values, values_imputed, total_econ_exposure_as_share_of_gdp) %>%
        distinct(country, year, counterpart, total_econ_exposure_as_share_of_gdp) %>%
        mutate(values = total_econ_exposure_as_share_of_gdp,
               label = counterpart,
               color_bin = counterpart,
               color = case_when(counterpart == "China" ~ color_palette %>% slice(1) %>% pull(hex),
                                 counterpart == "Russia" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(counterpart == "China" ~ 1,
                                           counterpart == "Russia" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid")) %>%
        get_label_position(gap = .01)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
total_econ_exposure_as_share_of_gdp_uzbekistan_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .35, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(expand = c(0, 0),
                           # limits = c(NA, chart_data %>% filter(values == max(values, na.rm = TRUE)) %>% pull(values)),
                           limits = c(0, .2),
                           labels = label_percent(accuracy = .1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2), 
                           expand = c(0, 0)) +
        labs(x = NULL, y = "Economic exposure as % of GDP", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 32 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        expand_limits(x = c(chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                            chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year))) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 9, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "none",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#         linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
total_econ_exposure_as_share_of_gdp_uzbekistan_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(total_econ_exposure_as_share_of_gdp_uzbekistan_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/total_econ_exposure_as_share_of_gdp_uzbekistan_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# load weo data ####

weo_oct_2021 <- read_excel(path = "data/imf/weo/weo_oct_2021_cleaned_20221013.xlsx")
weo_oct_2022 <- read_excel(path = "data/imf/weo/weo_oct_2022_cleaned_20221013.xlsx")


#/////////////////


# inspect
weo_oct_2021 
weo_oct_2021 %>% glimpse()
weo_oct_2021 %>% nrow() # 95175
weo_oct_2021 %>% ncol() # 22

# note that 2021 has 45 indicators, 2022 only has 44 indicators
weo_oct_2021 %>% count(country) %>% print(n = nrow(.))
weo_oct_2021 %>% count(year) %>% arrange(desc(year))
weo_oct_2021 %>% count(year) %>% arrange(year)
weo_oct_2021 %>% count(indicator_name) %>% print(n = nrow(.))


weo_oct_2022 
weo_oct_2022 %>% glimpse()
weo_oct_2022 %>% nrow() # 93060
weo_oct_2022 %>% ncol() # 22

# note that 2021 has 45 indicators, 2022 only has 44 indicators
weo_oct_2022 %>% count(country) %>% print(n = nrow(.))
weo_oct_2022 %>% count(year) %>% arrange(desc(year))
weo_oct_2022 %>% count(year) %>% arrange(year)
weo_oct_2022 %>% count(indicator_name) %>% print(n = nrow(.))


#//////////////////////////////////////////////////////////////////////////////////////////////////


# get weo_2021_2022 
weo_2021_2022 <- weo_oct_2022 %>% 
        rename(values_w_est_2022 = values_w_est) %>%
        left_join(., 
                weo_oct_2021 %>% select(country, year, indicator_name, values_w_est) %>% 
                                   rename(values_w_est_2021 = values_w_est),
                by = c("country", "year", "indicator_name")) %>%
        mutate(values_w_est_diff_btw_2022_and_2021 = values_w_est_2022 - values_w_est_2021)


#/////////////////


# inspect

weo_2021_2022
weo_2021_2022 %>% glimpse()
weo_2021_2022 %>% nrow() # 93060
weo_2021_2022 %>% ncol() # 24


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# gdp_per_capita_ppp_balkans_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
                scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))

# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est,
                color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = 2000)




# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gdp_per_capita_ppp_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
     
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 80000, by = 20000), limits = c(0, 80000), expand = c(0, 0),
                           labels = label_dollar(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = "GDP per capita (PPP)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 80000, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20000, yend = 20000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40000, yend = 40000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60000, yend = 60000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 80000, yend = 80000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gdp_per_capita_ppp_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gdp_per_capita_ppp_eurasia_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))

#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est,
               color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = 2000)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gdp_per_capita_ppp_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 80000, by = 20000), limits = c(0, 80000), expand = c(0, 0),
                           labels = label_dollar(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 80000, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20000, yend = 20000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40000, yend = 40000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60000, yend = 60000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 80000, yend = 80000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gdp_per_capita_ppp_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gdp_per_capita_ppp_mcp_grouping_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) %>%
        # print(n = nrow(.))
        count(estimates_start_after) %>% arrange(desc(n))


weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PPPPC") %>% # gdp per capita at ppp
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, values_w_est_mcp_grouping_avg) %>%
        mutate(values = values_w_est_mcp_grouping_avg,
               color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "Graduates",
                                     TRUE ~ mcp_grouping),
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(mcp_grouping, linetype, sep = "_")) %>% 
        get_label_position(label_var = mcp_grouping, gap = 2000)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gdp_per_capita_ppp_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 80000, by = 20000), limits = c(0, 80000), expand = c(0, 0),
                           labels = label_dollar(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 80000, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20000, yend = 20000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40000, yend = 40000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 60000, yend = 60000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 80000, yend = 80000), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gdp_per_capita_ppp_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for gdp_per_capita_ppp_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
gdp_per_capita_ppp_patch_line_chart <- wrap_plots(plot_spacer(),
                                           gdp_per_capita_ppp_balkans_patch_line_chart,
                                           gdp_per_capita_ppp_eurasia_patch_line_chart,
                                           gdp_per_capita_ppp_mcp_grouping_patch_line_chart, 
                                           plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# resize to 186%

filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(gdp_per_capita_ppp_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/gdp_per_capita_ppp_patch_line_chart.docx")



#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# unemployment_rate_balkans_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))

# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est,
               color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = 1)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
unemployment_rate_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 40, by = 10), limits = c(0, 40), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = "Unemployment rate", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 40, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
unemployment_rate_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# unemployment_rate_eurasia_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est,
               color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = 1)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
unemployment_rate_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 40, by = 10), limits = c(0, 40), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 40, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
unemployment_rate_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# unemployment_rate_mcp_grouping_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) %>%
        # print(n = nrow(.))
        count(estimates_start_after) %>% arrange(desc(n))


weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "LUR") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, values_w_est_mcp_grouping_avg) %>%
        mutate(values = values_w_est_mcp_grouping_avg,
               color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "Graduates",
                                     TRUE ~ mcp_grouping),
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(mcp_grouping, linetype, sep = "_")) %>% 
        get_label_position(label_var = mcp_grouping, gap = 1)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
unemployment_rate_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 40, by = 10), limits = c(0, 40), expand = c(0, 0),
                           labels = label_number(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 40, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 10, yend = 10), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 20, yend = 20), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 30, yend = 30), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 40, yend = 40), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
unemployment_rate_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for unemployment_rate_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
unemployment_rate_patch_line_chart <- wrap_plots(plot_spacer(),
                                                  unemployment_rate_balkans_patch_line_chart,
                                                  unemployment_rate_eurasia_patch_line_chart,
                                                  unemployment_rate_mcp_grouping_patch_line_chart, 
                                                  plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# resize to 186%

filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(unemployment_rate_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/unemployment_rate_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# gen_govt_gross_debt_as_share_of_gdp_balkans_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))

# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est / 100,
               color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gen_govt_gross_debt_as_share_of_gdp_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = "General govt. gross debt as % of GDP", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gen_govt_gross_debt_as_share_of_gdp_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gen_govt_gross_debt_as_share_of_gdp_eurasia_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est / 100,
               color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gen_govt_gross_debt_as_share_of_gdp_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gen_govt_gross_debt_as_share_of_gdp_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gen_govt_gross_debt_as_share_of_gdp_mcp_grouping_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) %>%
        # print(n = nrow(.))
        count(estimates_start_after) %>% arrange(desc(n))


weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, values_w_est_mcp_grouping_avg) %>%
        mutate(values = values_w_est_mcp_grouping_avg / 100,
               color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "Graduates",
                                     TRUE ~ mcp_grouping),
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(mcp_grouping, linetype, sep = "_")) %>% 
        get_label_position(label_var = mcp_grouping, gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
gen_govt_gross_debt_as_share_of_gdp_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
gen_govt_gross_debt_as_share_of_gdp_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for gen_govt_gross_debt_as_share_of_gdp_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
gen_govt_gross_debt_as_share_of_gdp_patch_line_chart <- wrap_plots(plot_spacer(),
                                                 gen_govt_gross_debt_as_share_of_gdp_balkans_patch_line_chart,
                                                 gen_govt_gross_debt_as_share_of_gdp_eurasia_patch_line_chart,
                                                 gen_govt_gross_debt_as_share_of_gdp_mcp_grouping_patch_line_chart, 
                                                 plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# resize to 186%

filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(gen_govt_gross_debt_as_share_of_gdp_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/gen_govt_gross_debt_as_share_of_gdp_patch_line_chart.docx")


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# inflation_avg_consumer_prices_balkans_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% 
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))

# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Balkans")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est / 100,
               color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = .02)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
inflation_avg_consumer_prices_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = -.1, to = .6, by = .1), limits = c(-.1, .6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = "Inflation (avg. consumer prices)", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -.1, 
                  ymax = .6, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -.1, yend = -.1), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
inflation_avg_consumer_prices_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# inflation_avg_consumer_prices_eurasia_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) 

# check sub_region line chart
weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


# check regional line chart
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        mutate(values = values_w_est / 100,
               color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = .02)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
inflation_avg_consumer_prices_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = -.1, to = .6, by = .1), limits = c(-.1, .6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -.1, 
                  ymax = .6, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -.1, yend = -.1), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
inflation_avg_consumer_prices_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# inflation_avg_consumer_prices_mcp_grouping_patch_line_chart ####


# inspect


# check estimates
weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        distinct(country, estimates_start_after) %>%
        # print(n = nrow(.))
        count(estimates_start_after) %>% arrange(desc(n))


weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_w_est_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 1))


#//////////////////


# add color_bin and color
chart_data <- weo_oct_2022 %>% 
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(indicator_name == "PCPIPCH") %>% 
        filter(year >= 2010, year <= 2024) %>%
        select(country, mcp_grouping, year, indicator_name, indicator_desc, indicator_notes, units, scale, 
               estimates_start_after, values, values_w_est) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_w_est_mcp_grouping_avg = mean(values_w_est, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, values_w_est_mcp_grouping_avg) %>%
        mutate(values = values_w_est_mcp_grouping_avg / 100,
               color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "Graduates",
                                     TRUE ~ mcp_grouping),
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(mcp_grouping, linetype, sep = "_")) %>% 
        get_label_position(label_var = mcp_grouping, gap = .02)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list

# title
"CMKI sub-objective 1.2"


#/////////////////////


# create chart
inflation_avg_consumer_prices_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = -.1, to = .6, by = .1), limits = c(-.1, .6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2024, by = 3)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = -.1, 
                  ymax = .6, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = 0, yend = 0), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .1, yend = .1), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .3, yend = .3), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .5, yend = .5), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = -.1, yend = -.1), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
inflation_avg_consumer_prices_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for inflation_avg_consumer_prices_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
inflation_avg_consumer_prices_patch_line_chart <- wrap_plots(plot_spacer(),
                                                                   inflation_avg_consumer_prices_balkans_patch_line_chart,
                                                                   inflation_avg_consumer_prices_eurasia_patch_line_chart,
                                                                   inflation_avg_consumer_prices_mcp_grouping_patch_line_chart, 
                                                                   plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# resize to 186%

filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(inflation_avg_consumer_prices_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/inflation_avg_consumer_prices_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gdp_per_capita_ppp_diff_btw_2021_and_2022_estimates_for_2022 ####

# inspect

weo_2021_2022 %>% 
        filter(indicator_name == "PPPPC") %>%
        filter(year > 2015) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021)
      
# check values_w_est in weo_oct_2021 
weo_oct_2021 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "PPPPC") %>%
        select(country, year, indicator_name, values, values_w_est) %>% 
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# check values_w_est in weo_oct_2022
weo_oct_2022 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "PPPPC") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# plot
# note that ukraine is dropped because it has NA values for 2022 estimates in weo_oct_2022
weo_2021_2022 %>% 
        filter(indicator_name == "PPPPC") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values_w_est_diff_btw_2022_and_2021, .desc = FALSE), 
                                                       y = values_w_est_diff_btw_2022_and_2021)) + geom_col()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- weo_2021_2022 %>% 
        filter(indicator_name == "PPPPC") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        rename(values = values_w_est_diff_btw_2022_and_2021) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

gdp_per_capita_ppp_diff_btw_2021_and_2022_estimates_for_2022 <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -1000, to = 4000, by = 1000),
                limits = c(-1000, 4000),
                expand = c(0, 0),
                labels = label_dollar(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Change in GDP per capita (PPP) forecast", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = .002 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
gdp_per_capita_ppp_diff_btw_2021_and_2022_estimates_for_2022


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(gdp_per_capita_ppp_diff_btw_2021_and_2022_estimates_for_2022)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/gdp_per_capita_ppp_diff_btw_2021_and_2022_estimates_for_2022.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# unemployment_rate_diff_btw_2021_and_2022_estimates_for_2022 ####

# inspect

weo_2021_2022 %>% 
        filter(indicator_name == "LUR") %>%
        filter(year > 2015) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021)

# check values_w_est in weo_oct_2021 
weo_oct_2021 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "LUR") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# check values_w_est in weo_oct_2022
weo_oct_2022 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "LUR") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# plot
# note that ukraine is dropped because it has NA values for 2022 estimates in weo_oct_2022
weo_2021_2022 %>% 
        filter(indicator_name == "LUR") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values_w_est_diff_btw_2022_and_2021, .desc = FALSE), 
                                       y = values_w_est_diff_btw_2022_and_2021)) + geom_col()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- weo_2021_2022 %>% 
        filter(indicator_name == "LUR") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        rename(values = values_w_est_diff_btw_2022_and_2021) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

unemployment_rate_diff_btw_2021_and_2022_estimates_for_2022 <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -4, to = 3, by = 1),
                limits = c(-4, 3),
                expand = c(0, 0),
                labels = label_number(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Change in unemployment rate forecast", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 1 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
unemployment_rate_diff_btw_2021_and_2022_estimates_for_2022


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(unemployment_rate_diff_btw_2021_and_2022_estimates_for_2022)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/unemployment_rate_diff_btw_2021_and_2022_estimates_for_2022.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# gen_govt_gross_debt_as_share_of_gdp_diff_btw_2021_and_2022_estimates_for_2022 ####

# inspect

weo_2021_2022 %>% 
        filter(indicator_name == "GGXWDG_NGDP") %>%
        filter(year > 2015) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021)

# check values_w_est in weo_oct_2021 
weo_oct_2021 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# check values_w_est in weo_oct_2022
weo_oct_2022 %>%
        filter(country == "Albania") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "GGXWDG_NGDP") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# plot
# note that ukraine is dropped because it has NA values for 2022 estimates in weo_oct_2022
weo_2021_2022 %>% 
        filter(indicator_name == "GGXWDG_NGDP") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values_w_est_diff_btw_2022_and_2021, .desc = FALSE), 
                                       y = values_w_est_diff_btw_2022_and_2021)) + geom_col()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- weo_2021_2022 %>% 
        filter(indicator_name == "GGXWDG_NGDP") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        rename(values = values_w_est_diff_btw_2022_and_2021) %>%
        mutate(values = values / 100) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

gen_govt_gross_debt_as_share_of_gdp_diff_btw_2021_and_2022_estimates_for_2022 <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = -.2, to = .05, by = .05),
                limits = c(-.2, .05),
                expand = c(0, 0),
                labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Change in forecast of\ngeneral government gross debt as % of GDP", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 40 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
gen_govt_gross_debt_as_share_of_gdp_diff_btw_2021_and_2022_estimates_for_2022


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(gen_govt_gross_debt_as_share_of_gdp_diff_btw_2021_and_2022_estimates_for_2022)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/gen_govt_gross_debt_as_share_of_gdp_diff_btw_2021_and_2022_estimates_for_2022.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# inflation_avg_consumer_prices_diff_btw_2021_and_2022_estimates_for_2022 ####

# inspect

weo_2021_2022 %>% 
        filter(indicator_name == "PCPIPCH") %>%
        filter(year > 2015) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021)

# check values_w_est in weo_oct_2021 
weo_oct_2021 %>%
        # filter(country == "Albania") %>%
        filter(country == "Ukraine") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "PCPIPCH") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# check values_w_est in weo_oct_2022
weo_oct_2022 %>%
        # filter(country == "Albania") %>%
        filter(country == "Ukraine") %>%
        filter(year %in% c(2021, 2022)) %>%
        filter(indicator_name == "PCPIPCH") %>%
        select(country, year, indicator_name, values, values_w_est) %>%
        mutate(diff = values_w_est - lag(values_w_est, n = 1))

# plot
# note that ukraine is dropped because it has NA values for 2022 estimates in weo_oct_2022
weo_2021_2022 %>% 
        filter(indicator_name == "PCPIPCH") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = values_w_est_diff_btw_2022_and_2021, .desc = FALSE), 
                                       y = values_w_est_diff_btw_2022_and_2021)) + geom_col()


#/////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- weo_2021_2022 %>% 
        filter(indicator_name == "PCPIPCH") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        rename(values = values_w_est_diff_btw_2022_and_2021) %>%
        mutate(values = values / 100) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart

# note that for coord_fixed_ratio the optimal ratio was 10/1 when y-axis spanned range of .6
# so the y-axis units were given pixels equal to (range = .6) * (coord_fixed_numerator = 10) = (pixel units = 6)
# so to get the same size chart with different y-axis range, 
# use formula: range * coord_fixed_numerator = pixel_units; 
# so: (range = 1) * (unknown_coord_fixed_numerator) = (pixel_units = 6)
# after rearranging: unknown_coord_fixed_numerator = (pixel_units = 6) / (range = 1)
# solving: unknown_coord_fixed_numerator = 6
# note the coord_fixed_denominator is 1, and doesn't need to be adjusted in this case because x-axis units are unchanged
# but if needed, could adjust coord_fixed_denominator by similar formula
# range * coord_fixed_denominator = pixel_units

inflation_avg_consumer_prices_diff_btw_2021_and_2022_estimates_for_2022 <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, .x = values, .desc = FALSE), 
                             y = values, 
                             fill = color_bin)) +
        geom_col(width = .75) +
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(
                breaks = seq(from = 0, to = .25, by = .05),
                limits = c(0, .25),
                expand = c(0, 0),
                labels = label_percent(accuracy = 1)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = .1, yend = .1), color = "#DDDDDD", size = .25) +
        # geom_segment(data = chart_data,
        #              mapping = aes(x = 1 - .5,
        #                            xend = (chart_data %>% count(country) %>% nrow()) + .5,
        #                            y = -.15, yend = -.15), color = "#333333", size = .5) +
        # geom_col(width = .75) +
        labs(x = NULL, y = "Change in forecast of\ninflation (average consumer prices)", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 40 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                strip.background = element_blank(),
                plot.margin = unit(c(0, 0, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.x = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5, color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"),
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.1, "cm"),
                legend.spacing.x = unit(.3, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
inflation_avg_consumer_prices_diff_btw_2021_and_2022_estimates_for_2022


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 170%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(inflation_avg_consumer_prices_diff_btw_2021_and_2022_estimates_for_2022)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/inflation_avg_consumer_prices_diff_btw_2021_and_2022_estimates_for_2022.docx")




#/////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- weo_2021_2022 %>% 
        filter(indicator_name == "PCPIPCH") %>%
        filter(year == 2022) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs")) %>%
        filter(!is.na(values_w_est_diff_btw_2022_and_2021)) %>%
        select(country, mcp_grouping, year, indicator_name, values_w_est_2021, values_w_est_2022, values_w_est_diff_btw_2022_and_2021) %>%
        rename(values = values_w_est_diff_btw_2022_and_2021) %>%
        mutate(values = values / 100) %>%
        mutate(color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               color_bin_order = case_when(color_bin == "E&E Balkans" ~ 1,
                                           color_bin == "E&E Eurasia" ~ 2,
                                           color_bin == "E&E graduates" ~ 3,
                                           color_bin == "CARs" ~ 4,
                                           color_bin == "Russia" ~ 5,
                                           color_bin == "EU-15" ~ 6,
                                           color_bin == "U.S." ~ 7))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# read exports_to_eu_27 ####
dots_exports_to_eu_27_as_share_of_total_exports <- read_excel(path = "data/imf/dots/dots_exports_to_eu_27_as_share_of_total_exports.xlsx")

# inspect
dots_exports_to_eu_27_as_share_of_total_exports
dots_exports_to_eu_27_as_share_of_total_exports %>% glimpse()
dots_exports_to_eu_27_as_share_of_total_exports %>% nrow() # 945
dots_exports_to_eu_27_as_share_of_total_exports %>% ncol() # 21

dots_exports_to_eu_27_as_share_of_total_exports %>% 

# plot
dots_exports_to_eu_27_as_share_of_total_exports


#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////
#//////////////////////////////////////////////////////////////////////////////////////////////////


# dots_exports_to_eu_27_as_share_of_total_exports_balkans_patch_line_chart ####


# inspect


# check values
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) 

# check sub_region line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        # filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))

# check regional line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_mcp_grouping_avg = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# add color_bin and color
chart_data <- dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Albania" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "BiH" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Kosovo" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "N. Macedonia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Serbia" ~ color_palette %>% slice(5) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(label_var = country, gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
dots_exports_to_eu_27_as_share_of_total_exports_balkans_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = "Percent", 
             title = "E&E Balkans",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                           margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                                            margin = margin(t = 0, r = 3, b = 0, l = 0)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
dots_exports_to_eu_27_as_share_of_total_exports_balkans_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# dots_exports_to_eu_27_as_share_of_total_exports_eurasia_patch_line_chart ####


# inspect


# check values
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) 

# check sub_region line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))

# check regional line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_mcp_grouping_avg = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# add color_bin and color
chart_data <- dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Eurasia")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        mutate(color_bin = country,
               color = case_when(color_bin == "Armenia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Azerbaijan" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Belarus" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "Georgia" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Moldova" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "Ukraine" ~ color_palette %>% slice(7) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(country, linetype, sep = "_")) %>% 
        get_label_position(gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#//////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
dots_exports_to_eu_27_as_share_of_total_exports_eurasia_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E Eurasia",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 9.5, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
dots_exports_to_eu_27_as_share_of_total_exports_eurasia_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# dots_exports_to_eu_27_as_share_of_total_exports_mcp_grouping_patch_line_chart ####


# inspect


# check values
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) 

# check sub_region line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia")) %>%
        # filter(mcp_grouping %in% c("E&E Balkans")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        ggplot(data = ., mapping = aes(x = year, y = values, color = country)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))

# check regional line chart
dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_mcp_grouping_avg = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        ggplot(data = ., mapping = aes(x = year, y = values_mcp_grouping_avg, color = mcp_grouping)) + geom_line(size = 1) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 1))


#/////////////////////////////////////////////////////////////////////////////////////////////////


# add color_bin and color
chart_data <- dots_exports_to_eu_27_as_share_of_total_exports %>% 
        filter(year >= 2010) %>%
        filter(mcp_grouping %in% c("E&E Balkans", "E&E Eurasia", "E&E graduates", "CARs", "EU-15")) %>%
        select(country, mcp_grouping, year, official_exports_to_eu_27, official_exports_to_world,
               official_exports_to_eu_27_as_share_of_total_exports, values) %>%
        group_by(mcp_grouping, year) %>%
        mutate(values_mcp_grouping_avg = mean(values, na.rm = TRUE)) %>%
        ungroup() %>%
        distinct(mcp_grouping, year, values_mcp_grouping_avg) %>%
        mutate(values = values_mcp_grouping_avg,
               color_bin = case_when(mcp_grouping == "E&E Balkans" ~ "Balkans",
                                     mcp_grouping == "E&E Eurasia" ~ "Eurasia",
                                     mcp_grouping == "E&E graduates" ~ "Graduates",
                                     TRUE ~ mcp_grouping),
               color = case_when(color_bin == "Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "Graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype = case_when(TRUE ~ "solid"),
               linetype_bin = str_c(mcp_grouping, linetype, sep = "_")) %>% 
        get_label_position(label_var = mcp_grouping, gap = .04)

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% count(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
dots_exports_to_eu_27_as_share_of_total_exports_mcp_grouping_patch_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = year, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        # geom_line(size = 1) +
        # geom_point(size = 2) +
        geom_text(data = chart_data %>% filter(year == max(year), color_bin == color_bin),
                  mapping = aes(x = year + .65, y = label_position, label = color_bin),
                  fontface = "bold", hjust = 0, size = 2, family = "Calibri") +
        
        # geom_line(size = 1) +
        
        scale_color_manual(values = chart_data_color_list, guide = "none") +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # geom_line(size = 1) +
        
        scale_y_continuous(breaks = seq(from = 0, to = 1, by = .2), limits = c(0, 1), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 2010, to = 2021, by = 2)) +
        
        # geom_line(size = 1) +
        
        labs(x = NULL, y = NULL, 
             title = "E&E sub-region avg.",
             caption = NULL, color = "", linetype = "") +
        # coord_fixed(ratio = 8 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        geom_rect(data = chart_data,
                  mapping = aes(xmin = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                xmax = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5),
                  ymin = 0, 
                  ymax = 1, 
                  alpha = 0, color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .2, yend = .2), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .4, yend = .4), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .6, yend = .6), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .25,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .25,
                                   y = .8, yend = .8), color = "#DDDDDD", size = .25, linetype = "solid") +
        geom_segment(data = chart_data,
                     mapping = aes(x = chart_data %>% filter(year == min(year)) %>% slice(1) %>% pull(year) - .5,
                                   xend = chart_data %>% filter(year == max(year)) %>% slice(1) %>% pull(year) + .5,
                                   y = 0, yend = 0), color = "#333333", size = .5, linetype = "solid") +
        geom_line(size = 1) + 
        # geom_point(size = 2) +
        # geom_segment(data = segment_tbl, mapping = aes(x = x, xend = xend, y = y, yend = yend)) +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 7, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                panel.border = element_blank(),
                # panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                # axis.text.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                            margin = margin(t = 0, r = -5, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                # axis.title.y = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333",
                #                             margin = margin(t = 0, r = 3, b = 0, l = 0)),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                plot.title = element_text(size = 7, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) 
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
#        linetype = guide_legend(keywidth = 4))

# inspect
dots_exports_to_eu_27_as_share_of_total_exports_mcp_grouping_patch_line_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# combine patches for dots_exports_to_eu_27_as_share_of_total_exports_patch_line_chart ####

plot_width <- 200
plot_height <- 13
layout <- c(
        area(t = 1, l = 1, b = 10, r = plot_width * 3), # spacer 1 to 1
        area(t = 11, l = 1, b = plot_height + 11, r = plot_width), # 2 to 4
        area(t = 11, l = plot_width + 1, b = plot_height + 11, r = plot_width * 2), # 6 to 8
        area(t = 11, l = (plot_width * 2) + 1, b = plot_height + 11, r = plot_width * 3), # 10 to 12
        area(t = plot_height + 12, l = 1, b = plot_height + 22, r = plot_width * 3) # spacer 13 to 13
)
plot(layout)


#///////////////


# create patchwork plot
dots_exports_to_eu_27_as_share_of_total_exports_patch_line_chart <- wrap_plots(plot_spacer(),
                                                             dots_exports_to_eu_27_as_share_of_total_exports_balkans_patch_line_chart,
                                                             dots_exports_to_eu_27_as_share_of_total_exports_eurasia_patch_line_chart,
                                                             dots_exports_to_eu_27_as_share_of_total_exports_mcp_grouping_patch_line_chart, 
                                                             plot_spacer()) +
        plot_layout(design = layout) 


#///////////////////


# resize to 186%

filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(dots_exports_to_eu_27_as_share_of_total_exports_patch_line_chart)
dev.off()

# add emf to word doc  
read_docx() %>% 
        body_add_img(src = filename, width = 6, height = 6) %>% 
        print(target = "output/charts/dots_exports_to_eu_27_as_share_of_total_exports_patch_line_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# read atlas_1digit_ee_region ####
atlas_1digit_ee_region <- read_csv(file = "data/atlas_of_economic_complexity/atlas_1digit_ee_region.csv")

# inspect
atlas_1digit_ee_region
atlas_1digit_ee_region %>% glimpse()
atlas_1digit_ee_region %>% nrow() # 451880
atlas_1digit_ee_region %>% ncol() # 24


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# agriculture_imports_from_ukraine_and_russia_as_share_of_total_agriculture_imports_bar_chart ####

# plot
atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), 
               country != "U.S.",
               year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                        imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>%
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, 
                                                       .x = imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                                                       .desc = FALSE),
                                       y = imports_from_partner_as_share_of_imports_from_world_hs_1digit,
                                       fill = partner_country)) +
        
        # ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = imports_from_partner_as_share_of_gdp_current_sum_ukr_rus, 
        #                                                .desc = FALSE), 
        #                                y = imports_from_partner_as_share_of_gdp_current,
        #                                fill = partner_country)) +

        
        geom_col(position = "stack") +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = .5)
        )


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
chart_data <- atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), 
               country != "U.S.",
               year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                        imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = imports_from_partner_as_share_of_imports_from_world_hs_1digit) %>%
        mutate(color_bin = case_when(partner_country == "Russia" ~ "Russia          ",
                                     partner_country == "Ukraine" ~ "Ukraine          "),
               color = case_when(partner_country == "Russia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 partner_country == "Ukraine" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(partner_country == "Russia" ~ 2,
                                           partner_country == "Ukraine" ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
agriculture_imports_from_ukraine_and_russia_as_share_of_total_agriculture_imports_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, 
                                             .x = imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                                             .desc = FALSE),
                             y = values,
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1),
                        labels = label_percent(accuracy = 1),
                           expand = c(0, 0), limits = c(0, .6)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Percent", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 30 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
agriculture_imports_from_ukraine_and_russia_as_share_of_total_agriculture_imports_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(agriculture_imports_from_ukraine_and_russia_as_share_of_total_agriculture_imports_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/agriculture_imports_from_ukraine_and_russia_as_share_of_total_agriculture_imports_bar_chart.docx")


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# agriculture_imports_from_ukraine_and_russia_as_share_of_gdp_current_bar_chart ####

# plot
# note that turkmenistan has NA values for gdp_current for 2020-2021
atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>%
        
        # ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, 
        #                                                .x = imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
        #                                                .desc = FALSE),
        #                                y = imports_from_partner_as_share_of_imports_from_world_hs_1digit,
        #                                fill = partner_country)) +
        
        ggplot(data = ., mapping = aes(x = fct_reorder(.f = country, .x = imports_from_partner_as_share_of_gdp_current_sum_ukr_rus,
                                                       .desc = FALSE),
                                       y = imports_from_partner_as_share_of_gdp_current,
                                       fill = partner_country)) +
        
        
        geom_col(position = "stack") +
        theme(
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 7, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = .5)
        )


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# chart_data
# note that turkmenistan is dropped due to NA gdp_current for 2020-2021
chart_data <- atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                        imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>%
        mutate(values = imports_from_partner_as_share_of_gdp_current) %>%
        filter(!is.na(values)) %>%
        mutate(color_bin = partner_country,
               color = case_when(partner_country == "Russia" ~ color_palette %>% slice(1) %>% pull(hex),
                                 partner_country == "Ukraine" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(partner_country == "Russia" ~ 2,
                                           partner_country == "Ukraine" ~ 1),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE))

# inspect
chart_data


#///////////////////


# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color, color_bin_order) %>% arrange(color_bin_order) %>% pull(color_bin)
chart_data_color_list


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# create chart
agriculture_imports_from_ukraine_and_russia_as_share_of_gdp_current_bar_chart <- chart_data %>%
        ggplot(data = ., aes(x = fct_reorder(.f = country, 
                                             .x = imports_from_partner_as_share_of_gdp_current_sum_ukr_rus,
                                             .desc = FALSE),
                             y = values,
                             fill = color_bin)) +
        geom_col(width = .8, position = "stack") + 
        # geom_text(data = chart_data %>% filter(year == max(year), color_bin == "Sub-obj. 3.1: Energy security"),
        #           mapping = aes(x = year + .35, y = label_position, label = label, color = color_bin),
        #           fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        # scale_color_manual(values = chart_data_color_list) +
        scale_fill_manual(values = chart_data_color_list) +
        # scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        # scale_y_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
        #                    labels = label_percent(accuracy = 1)) +
        scale_y_continuous(breaks = seq(from = 0, to = .06, by = .01),
                           labels = label_percent(accuracy = 1),
                           expand = c(0, 0), limits = c(0, .06)) +
        # scale_x_continuous(breaks = seq(from = 2010, to = 2020, by = 2)) +
        labs(x = NULL, y = "Percent", 
             caption = NULL, fill = "", color = "", linetype = "") +
        coord_fixed(ratio = 300 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                plot.margin = unit(c(0, 5, 0, 5), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_line(color = "#000000"),
                panel.border = element_rect(color = "#DDDDDD", fill = NA),
                # panel.border = element_blank(),
                # panel.grid = element_blank(),
                panel.spacing = unit(.5, "lines"),
                strip.text.x = element_text(family = "Calibri", face = "plain", size = 8, color = "#333333",
                                            margin = margin(t = 0, r = 0, b = 10, l = 0), angle = 0, hjust = .5),
                # strip.background = element_rect(color = "#ffffff", fill = "#ffffff", size = 1.5, linetype = "solid"),
                strip.background = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(color = "#333333"),
                # axis.ticks.x = element_blank(),
                axis.ticks.x = element_line(color = "#333333"),
                # axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333",
                                           margin = margin(t = 2, r = 0, b = -10, l = 0), angle = 45, hjust = 1),
                # axis.text.x = element_blank(),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                           margin = margin(t = 0, r = 2, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_blank(),
                # axis.title.x = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                #                             margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 9, color = "#333333", 
                                            margin = margin(t = 0, r = 13, b = 0, l = 0)),
                plot.title = element_text(size = 16, face = "bold", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 10, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 9, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 9, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.spacing.x = unit(.3, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
                # legend.key.width = unit(2, "cm")
        ) + 
        guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
# guides(fill = guide_legend(nrow = 5, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1),
#        linetype = guide_legend(keywidth = 4))
# guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
agriculture_imports_from_ukraine_and_russia_as_share_of_gdp_current_bar_chart


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# resize to 120%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(agriculture_imports_from_ukraine_and_russia_as_share_of_gdp_current_bar_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/agriculture_imports_from_ukraine_and_russia_as_share_of_gdp_current_bar_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# ag_imports_from_ukr_and_rus_as_share_of_total_ag_imports_and_gdp_current_scatter_plot ####

# plot
atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), 
               year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, location_code, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>% 
        distinct(country, location_code, year, 
                 imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                 imports_from_partner_as_share_of_gdp_current_sum_ukr_rus) %>%
        
        
        ggplot(data = ., mapping = aes(x = imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                                       y = imports_from_partner_as_share_of_gdp_current_sum_ukr_rus,
                                       color = country, label = location_code)) + 
        geom_point(size = 3) + 
        # geom_text(nudge_y) 
        geom_text_repel(fontface = "bold", point.padding = .3, size = 4, family = "Calibri",
                        max.overlaps = Inf) +
        theme(
                legend.position = "none"
        )


#/////////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- atlas_1digit_ee_region %>%
        filter(partner_country %in% c("Ukraine", "Russia"), 
               country != "U.S.",
               year == 2020, hs_product_name_1digit == "Agriculture") %>%
        select(country, location_code, mcp_grouping, partner_country, year, hs_product_name_1digit, 
               imports_from_partner_hs_1digit, imports_from_world_hs_1digit, gdp_current) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit = imports_from_partner_hs_1digit / imports_from_world_hs_1digit,
               imports_from_partner_as_share_of_gdp_current = imports_from_partner_hs_1digit / gdp_current) %>%
        group_by(country, year, hs_product_name_1digit) %>%
        mutate(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus = sumNA(
                imports_from_partner_as_share_of_imports_from_world_hs_1digit, na.rm = TRUE),
               imports_from_partner_as_share_of_gdp_current_sum_ukr_rus = sumNA(
                       imports_from_partner_as_share_of_gdp_current, na.rm = TRUE)) %>%
        ungroup() %>% 
        distinct(country, location_code, mcp_grouping, year, 
                 imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                 imports_from_partner_as_share_of_gdp_current_sum_ukr_rus) %>%
        mutate(label = case_when(imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus > .05 ~ 
                                         location_code,
                                 TRUE ~ NA_character_),
               color_bin = mcp_grouping,
               color = case_when(color_bin == "E&E Balkans" ~ color_palette %>% slice(1) %>% pull(hex),
                                 color_bin == "E&E Eurasia" ~ color_palette %>% slice(2) %>% pull(hex),
                                 color_bin == "E&E graduates" ~ color_palette %>% slice(3) %>% pull(hex),
                                 color_bin == "CARs" ~ color_palette %>% slice(4) %>% pull(hex),
                                 color_bin == "Russia" ~ color_palette %>% slice(5) %>% pull(hex),
                                 color_bin == "EU-15" ~ color_palette %>% slice(7) %>% pull(hex),
                                 color_bin == "U.S." ~ color_palette %>% slice(8) %>% pull(hex)),
               linetype_bin = mcp_grouping,
               linetype = case_when(TRUE ~ "solid"))

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% count(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% count(color_bin, color) %>% pull(color_bin)
chart_data_color_list


#/////////////////////


# create chart
ag_imports_from_ukr_and_rus_as_share_of_total_ag_imports_and_gdp_current_scatter_plot <- chart_data %>%
        ggplot(data = ., mapping = aes(x = imports_from_partner_as_share_of_imports_from_world_hs_1digit_sum_ukr_rus,
                                                 y = imports_from_partner_as_share_of_gdp_current_sum_ukr_rus,
                                                 label = label, color = color_bin)) + 
        # geom_smooth(method = "lm", se = FALSE, aes(group = 1), color = "#7D7D7D") +
        # geom_segment(x = 0, y = 0, xend = .98, yend = .98, color = "#7D7D7D", size = .25) +
        # geom_text(data = tibble(x = .16, y = .03), mapping = aes(x = x, y = y), label = "45-degree line",
        #           color = "#7D7D7D", size = 2, fontface = "bold") + 
        geom_point(size = 3) +
        geom_text_repel(fontface = "bold", point.padding = .3, size = 3.2, family = "Calibri",
                        max.overlaps = Inf) +
        # geom_text(data = chart_data %>% 
        #                   mutate(correlation = cor(x = !!sym(obj_a), y = !!sym(obj_b), use = "pairwise.complete.obs"),
        #                          correlation = str_c("R = ", round_to_digits(correlation, digits = 2))) %>% 
        #                   slice(1), 
        #           mapping = aes(x = .03, y = .95, label = correlation),
        #           fontface = "bold", hjust = 0, size = 2, color = "#7D7D7D", family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_y_continuous(breaks = seq(from = 0, to = .06, by = .01), limits = c(0, .06), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        scale_x_continuous(breaks = seq(from = 0, to = .6, by = .1), limits = c(0, .6), expand = c(0, 0),
                           labels = label_percent(accuracy = 1)) +
        labs(x = "Agriculture goods imports from RUS & UKR\nas % of total agriculture goods imports", 
             y = "Agriculture goods imports from RUS & UKR\nas % of GDP (current $US)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 5 / 1, clip = "off") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 10, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                # panel.grid.major.y = element_line(color = "#DDDDDD"),
                panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                # axis.ticks.y = element_blank(),
                # axis.ticks.x = element_line(size = .5),
                axis.ticks.length.y.left = unit(.2, "cm"),
                axis.ticks.length.x.bottom = unit(.2, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 4, b = 0, l = 0)),
                axis.line.x.bottom = element_line(color = "#333333"),
                axis.line.y.left = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                # axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 5, r = 0, b = -10, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 5, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333")
                # legend.spacing.y = unit(5.5, "cm"),
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        guides(color = guide_legend(nrow = 2, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 1,
                                    keyheight = .25,
                                    override.aes = list(size = 4))
               # linetype = guide_legend(keywidth = 4)
        )

# inspect
ag_imports_from_ukr_and_rus_as_share_of_total_ag_imports_and_gdp_current_scatter_plot


#//////////////////////////////////


# resize to 182%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(ag_imports_from_ukr_and_rus_as_share_of_total_ag_imports_and_gdp_current_scatter_plot)
dev.off()

# add emf to word doc

read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/ag_imports_from_ukr_and_rus_as_share_of_total_ag_imports_and_gdp_current_scatter_plot.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////////


# read food_price_index ####

food_price_index <- read_csv(file = "data/fao/food_price_index.csv")

# inspect
food_price_index
food_price_index %>% glimpse()
food_price_index %>% nrow() # 786
food_price_index %>% ncol() # 10


#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# food_price_index_nominal_and_real_line_chart ####

# plot

food_price_index %>% 
        ggplot(data = ., mapping = aes(x = date, y = food_price_index, color = index_type)) + geom_line(size = 1)


food_price_index %>% 
        filter(index_type == "real") %>%
        select(-food_price_index) %>%
        pivot_longer(cols = -c(date, year, month, index_type), names_to = "var", values_to = "values") %>%
        ggplot(data = ., mapping = aes(x = date, y = values, color = var)) + geom_line(size = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- food_price_index %>%
        filter(year >= 2010) %>%
        mutate(values = food_price_index,
               label = case_when(index_type == "nominal" ~ "    Nominal",
                                 index_type == "real" ~ "    Real"),
               label_position = values,
               color_bin = case_when(index_type == "nominal" ~ "Nominal          ",
                                     index_type == "real" ~ "Real          "),
               color = case_when(index_type == "nominal" ~ color_palette %>% slice(1) %>% pull(hex),
                                 index_type == "real" ~ color_palette %>% slice(3) %>% pull(hex)),
               color_bin_order = case_when(index_type == "nominal" ~ 1,
                                           index_type == "real" ~ 2),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))
        # get_label_position(label_var = color_bin, gap = 5)

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart

# note chart is annotated to show start of covid-19 on 1/1/2020
# https://www.cdc.gov/museum/timeline/covid19.html#:~:text=January%2010%2C%202020,Coronavirus%20(2019%2DnCoV).
# and start of russian invasion of ukraine on 2/24/2022
# https://www.state.gov/u-s-security-cooperation-with-ukraine/

food_price_index_nominal_and_real_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = date, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(date == max(date), color_bin == color_bin),
                  mapping = aes(x = date + 10, y = label_position, label = label),
                  fontface = "bold", hjust = 0, size = 3.25, family = "Calibri") +
        geom_segment(x = ymd("2020-01-01"), xend = ymd("2020-01-01"), y = 60, yend = 180,
                     color = "#333333", linetype = "dashed") +
        annotate(geom = "text", x = ymd("2019-11-01"), y = 175, label = "COVID-19",
                 fontface = "bold", color = "#333333", hjust = 1, vjust = 1, size = 3.25, family = "Calibri") +
        geom_segment(x = ymd("2022-02-24"), xend = ymd("2022-02-24"), y = 60, yend = 180,
                     color = "#333333", linetype = "dashed") +
        annotate(geom = "text", x = ymd("2022-01-01"), y = 175, label = "Russian\ninvasion", 
                 fontface = "bold", color = "#333333", hjust = 1, vjust = 1, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 60, to = 180, by = 20),
                           expand = c(0, 0),
                           limits = c(60, 180),
                           labels = label_number(accuracy = 1)) +
        scale_x_date(date_labels = "%Y", 
                     expand = c(.01, .01),
                     date_breaks = "2 years") +
        # scale_x_continuous(breaks = str_c(seq(from = 2010, to = 2022, by = 2), rep("-01-01", times = 7)), 
        #                    expand = c(0, 0),
        #                    labels = label_date(format = "%m/%d")) +
        labs(x = NULL, y = "Food Price Index\n(2014-2016 = 100)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 25 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(size = .5, color = "#DDDDDD"),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.1, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 0, hjust = .5),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                # legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
        # guides(color = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
food_price_index_nominal_and_real_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(food_price_index_nominal_and_real_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/food_price_index_nominal_and_real_line_chart.docx")



#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////
#/////////////////////////////////////////////////////////////////////////////////////////////////


# food_price_sub_indices_real_line_chart ####

# plot

food_price_index %>% 
        ggplot(data = ., mapping = aes(x = date, y = food_price_index, color = index_type)) + geom_line(size = 1)


food_price_index %>% 
        filter(index_type == "real") %>%
        select(-food_price_index) %>%
        pivot_longer(cols = -c(date, year, month, index_type), names_to = "var", values_to = "values") %>%
        ggplot(data = ., mapping = aes(x = date, y = values, color = var)) + geom_line(size = 1)


#/////////////////////////////////////////////////////////////////////////////////////////////////


# get chart_data
chart_data <- food_price_index %>%
        filter(year >= 2019,
               index_type == "real") %>%
        select(-food_price_index) %>%
        pivot_longer(cols = -c(date, year, month, index_type), names_to = "var", values_to = "values") %>%
        mutate(label = case_when(var == "meat_price_index" ~ "    Meat",
                                 var == "dairy_price_index" ~ "    Dairy",
                                 var == "cereals_price_index" ~ "    Cereals",
                                 var == "oils_price_index" ~ "    Oils",
                                 var == "sugar_price_index" ~ "    Sugar"),
               label_position = case_when(var == "oils_price_index" ~ values + 5,
                                          var == "dairy_price_index" ~ values - 5,
                                          TRUE ~ values),
               color_bin = case_when(var == "meat_price_index" ~ "Meat          ",
                       var == "dairy_price_index" ~ "Dairy          ",
                       var == "cereals_price_index" ~ "Cereals          ",
                       var == "oils_price_index" ~ "Oils          ",
                       var == "sugar_price_index" ~ "Sugar          "),
               color = case_when(var == "meat_price_index" ~ color_palette %>% slice(1) %>% pull(hex),
                                 var == "dairy_price_index" ~ color_palette %>% slice(2) %>% pull(hex),
                                 var == "cereals_price_index" ~ color_palette %>% slice(3) %>% pull(hex),
                                 var == "oils_price_index" ~ color_palette %>% slice(4) %>% pull(hex),
                                 var == "sugar_price_index" ~ color_palette %>% slice(5) %>% pull(hex)),
               color_bin_order = case_when(var == "meat_price_index" ~ 1,
                                           var == "dairy_price_index" ~ 2,
                                           var == "cereals_price_index" ~ 3,
                                           var == "oils_price_index" ~ 4,
                                           var == "sugar_price_index" ~ 5),
               color_bin = fct_reorder(.f = color_bin, .x = color_bin_order, .desc = FALSE),
               linetype_bin = color_bin,
               linetype = case_when(TRUE ~ "solid"))
# get_label_position(label_var = color_bin, gap = 5)

# inspect
chart_data

# create color_list for to pass to scale_color_manual
chart_data_color_list <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color)
names(chart_data_color_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(color_bin, color) %>% pull(color_bin)
chart_data_color_list

# create linetype_list for to pass to scale_linetype_manual
chart_data_linetype_list <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype)
names(chart_data_linetype_list) <- chart_data %>% arrange(color_bin_order) %>% distinct(linetype_bin, linetype) %>% pull(linetype_bin)
chart_data_linetype_list


#/////////////////////


# create chart
food_price_sub_indices_real_line_chart <- chart_data %>%
        ggplot(data = ., aes(x = date, 
                             y = values, 
                             color = color_bin,
                             linetype = linetype_bin)) + 
        geom_line(size = 1) +
        geom_text(data = chart_data %>% filter(date == max(date), color_bin == color_bin),
                  mapping = aes(x = date + 10, y = label_position, label = label),
                  fontface = "bold", hjust = 0, size = 3.5, family = "Calibri") +
        geom_segment(x = ymd("2020-01-01"), xend = ymd("2020-01-01"), y = 50, yend = 250,
                     color = "#333333", linetype = "dashed") +
        annotate(geom = "text", x = ymd("2019-12-01"), y = 240, label = "COVID-19",
                 fontface = "bold", color = "#333333", hjust = 1, vjust = 1, size = 3.25, family = "Calibri") +
        geom_segment(x = ymd("2022-02-24"), xend = ymd("2022-02-24"), y = 50, yend = 250,
                     color = "#333333", linetype = "dashed") +
        annotate(geom = "text", x = ymd("2022-02-01"), y = 240, label = "Russian\ninvasion", 
                 fontface = "bold", color = "#333333", hjust = 1, vjust = 1, size = 3.25, family = "Calibri") +
        scale_color_manual(values = chart_data_color_list) +
        scale_linetype_manual(values = chart_data_linetype_list, guide = "none") +
        scale_y_continuous(breaks = seq(from = 50, to = 250, by = 50),
                           expand = c(0, 0),
                           limits = c(50, 250),
                           labels = label_number(accuracy = 1)) +
        scale_x_date(date_labels = "%m/%Y", 
                     date_breaks = "2 months",
                     expand = c(.01, .01)) +
        # scale_x_continuous(breaks = str_c(seq(from = 2010, to = 2022, by = 2), rep("-01-01", times = 7)), 
        #                    expand = c(0, 0),
        #                    labels = label_date(format = "%m/%d")) +
        labs(x = NULL, y = "Food Commodity Price Index\n(2014-2016 = 100)", 
             caption = NULL, color = "", linetype = "") +
        coord_fixed(ratio = 4 / 1, clip = "off") +
        # annotate(geom = "rect", xmin = 2008.5, xmax = 2018.5, ymin = 0, ymax = 1.8, alpha = 0, color = "#DDDDDD") +
        theme_bw() +
        theme(
                # plot.background = element_rect(fill = "blue"),
                # plot.background = element_rect(colour = "#DDDDDD", size = .5),
                plot.margin = unit(c(0, 15, 0, 0), "mm"),
                plot.caption = element_text(hjust = 0, size = 11, face = "plain", family = "Calibri", 
                                            color = "#595959", margin = margin(t = 4, r = 0, b = 0, l = 0)),
                # text = element_text(family = "Calibri", size = 46, face = "plain", color = "#000000"),
                panel.grid.minor = element_blank(),
                panel.grid.major.x = element_blank(),
                panel.grid.major.y = element_line(color = "#DDDDDD"),
                # panel.grid.major.y = element_blank(),
                # panel.border = element_blank(),
                panel.border = element_rect(color = "#DDDDDD", size = .5),
                # panel.grid = element_blank(),
                # line = element_blank(),
                # rect = element_blank(),
                axis.line.x.bottom = element_line(colour = "#333333", size = .5),
                
                axis.ticks.y = element_blank(),
                # axis.ticks.y = element_line(size = .5, color = "#DDDDDD"),
                axis.ticks.x = element_line(size = .5),
                # axis.ticks.length.y.left = unit(.1, "cm"),
                axis.ticks.length.x.bottom = unit(.1, "cm"),
                axis.text.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                           margin = margin(t = 3, r = 0, b = 0, l = 0), angle = 45, hjust = 1),
                axis.text.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                           margin = margin(t = 0, r = 0, b = 0, l = 0)),
                # axis.line.x.bottom = element_line(color = "#333333"),
                # axis.line.x.bottom = element_blank(),
                axis.line.y.left = element_blank(),
                axis.title.x = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333", 
                                            margin = margin(t = 13, r = 0, b = 5, l = 0)),
                axis.title.y = element_text(family = "Calibri", face = "plain", size = 10, color = "#333333",
                                            margin = margin(t = 0, r = 10, b = 0, l = 5)),
                # axis.title.y = element_blank(),
                # axis.text.y = element_blank(),
                plot.title = element_text(size = 10, face = "plain", hjust = .5, family = "Calibri", color = "#333333", 
                                          margin = margin(t = 0, r = 0, b = 5, l = 0, unit = "pt")),
                legend.position = "bottom",
                # legend.key.size = unit(2, "mm"), 
                legend.title = element_text(size = 10, family = "Calibri", face = "plain", color = "#333333"),
                legend.text = element_text(size = 10, family = "Calibri", margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"), 
                                           hjust = .5, color = "#333333"),
                legend.spacing.y = unit(.5, "cm"),
                # legend.spacing.x = unit(.5, "cm")
                # legend.key = element_rect(size = 5),
                # legend.key.size = unit(2, 'lines')
        ) +
        # guides(fill = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333"))
        # guides(color = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, color = "#333333", keywidth = 4),
        #         linetype = guide_legend(keywidth = 4))
        guides(color = guide_legend(nrow = 1, byrow = TRUE, label.hjust = 0, override.aes = list(size = 6)))

# inspect
food_price_sub_indices_real_line_chart


#//////////////////////////////////


# resize to 165%

# save chart as emf
filename <- tempfile(fileext = ".emf")
emf(file = filename)
print(food_price_sub_indices_real_line_chart)
dev.off()

# add emf to word doc
read_docx() %>%
        body_add_img(src = filename, width = 6, height = 6) %>%
        print(target = "output/charts/food_price_sub_indices_real_line_chart.docx")



